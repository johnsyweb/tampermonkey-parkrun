# Pete's parkrun userscripts

## A script or scripts for messing with parkrun results pages

You'll need something like [Tampermonkey](https://www.tampermonkey.net) if
you'd like to enjoy them. Or you can use the bookmarklet versions.

## Why?

Why not?

## How to Install Bookmarklets

To use these scripts as bookmarklets, follow these steps:

1. Copy the JavaScript code for the desired bookmarklet from the sections below.
2. Open your browser's bookmarks manager.
3. Create a new bookmark.
4. Paste the JavaScript code into the URL field of the bookmark.
5. Save the bookmark.

Now, you can click the bookmark while on a parkrun results page to run the script.

## Updating Versions

To update the `@version` field in all userscripts, run the following Node.js script:

```bash
node scripts/update-version.js
```

This will automatically update the `@version` field in all `.user.js` files based on the current date and time.

## Bookmarklets

You can also use these scripts as bookmarklets by creating bookmarks with the following URLs:

### parkrun Wilson index display

The "Wilson index" in parkrun is the highest consecutive event number completed, starting from #1. This script calculates and displays a parkrunner's Wilson index on their results page.

```javascript
javascript:(async()=>{var n;function a(e,t=7){var r;let n=null;for(r of e.querySelectorAll('[id="results"]')){var a=r.querySelector("tr");if(a)if(a.querySelectorAll("th, td").length===t){n=r;break}}return n}function o(e){return Array.from(e.querySelectorAll("tbody > tr")).reverse().map(e=>{var t=e.querySelector("td:nth-child(1)").textContent.trim(),r=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();return{eventName:t,eventDate:r,eventNumber:parseInt(e,10)}})}function i(e){let t=0;var r;for(r of e.map(e=>e.eventNumber).sort((e,t)=>e-t)){if(r>=t+2)break;r===t+1&&t++}return t}function c(t){var r=[];for(let e=0;e<t.length;e++){var n=t.slice(0,e+1),a=e+1,o=`${t[e].eventName} # ${t[e].eventNumber} on `+t[e].eventDate,n=i(n);r.push({parkruns:a,event:o,wilsonIndex:n})}return r}async function u(e){var e=await(async(t,r,e=36e5)=>{let n=sessionStorage.getItem(r);if(n){var{data:a,timestamp:o}=JSON.parse(n);if(Date.now()-o<e)return a}return fetch(t).then(e=>{if(e.ok)return e.text();throw new Error(`Failed to fetch: ${e.status} `+e.statusText)}).then(e=>(sessionStorage.setItem(r,JSON.stringify({data:e,timestamp:Date.now()})),e)).catch(e=>{if(console.error(`Error fetching ${t}:`,e),n)return console.warn("Using stale cached data after fetch failure"),JSON.parse(n).data;throw e})})(window.location.origin+`/parkrunner/${e}/all/`,`parkrunner_${e}_all`),e=(new DOMParser).parseFromString(e,"text/html"),t=a(e);return t?(e=e.querySelector("h2"))?(e=p(e))?{friendIndices:c(o(t)),friendInfo:e}:(console.error("Could not extract friend athlete info"),null):(console.error("Friend H2 element not found"),null):(console.error("Friend results table not found"),null)}function p(e){return e.textContent.trim()}function f(e){var t=["#FFA300","#90EE90","#FF69B4","#4169E1","#FFD700","#9370DB","#20B2AA","#FF6347","#DDA0DD","#00CED1"];return t[e%t.length]}function e(){var e=a(document);if(e){var t=document.querySelector("h2");if(t){var r=p(t);if(r){var e=o(e),n=i(e),e=c(e);if(t){var l=document.createElement("div"),s=(l.style.marginTop="20px",l.style.backgroundColor="#2b223d",l.style.padding="20px",l.style.borderRadius="5px",document.createElement("div"));s.textContent="Wilson index: "+n,s.style.fontSize="1.5em",s.style.color="#ffa300",s.style.fontWeight="bold",s.style.marginBottom="20px",s.style.textAlign="center",l.appendChild(s);n=e,s=l,e=r,(r=document.createElement("canvas")).style.width="100%",r.style.height="300px",s.appendChild(r),s=r.getContext("2d");let o=new Chart(s,{type:"line",data:{labels:n.map(e=>e.parkruns),datasets:[{label:e,data:n.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:f(0),backgroundColor:"#2b223d"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Wilson Index"},suggestedMax:Math.ceil(1.1*Math.max(...n.map(e=>e.wilsonIndex)))},x:{title:{display:!0,text:"parkruns"},min:0,suggestedMax:Math.ceil(1.1*n.length)}},plugins:{title:{display:!0,text:"Wilson Index Progress"},tooltip:{callbacks:{label:function(e){e=e.raw;return["Wilson Index: "+e.y,"Event: "+e.event]}}}}}});{r=l;var d=async(e,t)=>{var r,n,a;r=o,e=e,n=t,a=r.data.datasets.length,n={label:t,data:e.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:f(a),backgroundColor:"#2b223d"},r.data.datasets.push(n),r.update(),e=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.x))),a=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.y))),r.options.scales.x.suggestedMax=Math.ceil(1.1*e),r.options.scales.y.suggestedMax=Math.ceil(1.1*a),r.update()};s=document.createElement("form");s.style.marginBottom="20px",s.style.textAlign="center";let n=document.createElement("input"),a=(n.style.width="200px",n.type="text",n.placeholder="Enter friend's athlete ID (e.g. A507)",n.style.padding="5px",n.style.marginRight="10px",n.style.borderRadius="3px",n.style.border="1px solid #ffa300",n.style.backgroundColor="#2b223d",n.style.color="#ffa300",document.createElement("button"));a.textContent="Compare",a.style.padding="5px 10px",a.style.backgroundColor="#ffa300",a.style.color="#2b223d",a.style.border="none",a.style.borderRadius="3px",a.style.cursor="pointer",s.appendChild(n),s.appendChild(a),s.addEventListener("submit",async e=>{e.preventDefault();e=n.value.trim().replace(/^[aA]/,"");if(e){a.disabled=!0,a.textContent="Loading...";try{var{friendIndices:t,friendInfo:r}=await u(e);d(t,r)}catch(e){console.error("Failed to fetch friend's results:",e),alert("Failed to fetch friend's results. Please check the ID and try again.")}finally{a.disabled=!1,a.textContent="Compare"}}}),r.insertBefore(s,r.firstChild)}t.parentNode.insertBefore(l,t.nextSibling)}}else console.error("Could not extract athlete info")}else console.error("H2 element not found")}else console.error("Results table not found")}n="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var r=document.createElement("script");r.src=n,r.onload=e,r.onerror=t,document.head.appendChild(r)}),"undefined"!=typeof module&&module.exports?module.exports={calculateWilsonIndex:i,calculateWilsonIndexOverTime:c,extractEventDetails:o,findResultsTable:a}:e()})();
```

### parkrun Volunteer Days Display

Displays the number of volunteer days for parkrun finishers on results pages

```javascript
javascript:(async()=>{!function t(){document.querySelector(".Results-table")?document.querySelectorAll("tr[data-vols] > td.Results-table-td.Results-table-td--name > div.detailed").forEach(t=>{var e,s=t.closest("tr").getAttribute("data-vols");s&&0<parseInt(s)&&((e=document.createElement("span")).textContent=s+" volunteer day"+("1"===s?"":"s")+" | ",e.classList.add("volunteer-days"),e.style.color="#d35226",t.insertBefore(e,t.firstChild))}):setTimeout(t,500)}()})();
```

### parkrun Stopwatch Bingo

Visualizes your progress on the stopwatch bingo challenge (collecting seconds 00-59)

```javascript
javascript:(async()=>{var n;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var o=document.createElement("script");o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)});{let v={backgroundColor:"#2b223d",clockBorderColor:"#FFA300",clockFaceColor:"#333",completedColor:"#FFA300",pendingColor:"#53BA9D",textColor:"#e0e0e0",subtleTextColor:"#cccccc"};function o(){var t=document.querySelectorAll("#results");return t[t.length-1]}function l(t){var e={},o={};let n=0,l=0,r=null,s=null;t=t.querySelectorAll("tr");let i=[];t.forEach(e=>{e=e.querySelectorAll("td");if(!(e.length<5)){var o=e[0].textContent.trim(),n=e[1].textContent.trim(),l=e[2].textContent.trim(),e=e[4].textContent.trim();if(e&&l&&n&&o){o=o+" # "+l;let t;l=e.match(/(\d+):(\d+):(\d+)/);if(l)t=parseInt(l[3],10);else{l=e.match(/(\d+):(\d+)/);if(!l)return;t=parseInt(l[2],10)}i.push({secondValue:t,date:n,event:o,time:e})}}});var d=i.reverse();for(let t=0;t<d.length;t++){var{secondValue:a,date:c,event:p,time:u}=d[t];if(l++,!(a in e||(e[a]={date:c,event:p,time:u},60!=++n)||s)){s=c,r=p,o[a]=[{date:c,event:p,time:u}];break}o[a]||(o[a]=[]),o[a].push({date:c,event:p,time:u})}return{seconds:e,timeData:o,collectedCount:n,totalParkruns:l,dateOfCompletion:s,firstCompleteEvent:r}}function r(u){e="Stopwatch Bingo Challenge",(C=document.createElement("div")).className="parkrun-bingo-container",C.style.width="100%",C.style.maxWidth="800px",C.style.margin="20px auto",C.style.padding="20px",C.style.backgroundColor=v.backgroundColor,C.style.borderRadius="8px",C.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",C.style.textAlign="center",(t=document.createElement("h3")).textContent=e,t.style.marginBottom="15px",t.style.color=v.clockBorderColor,C.appendChild(t);var e=C,t=document.createElement("div");t.style.marginBottom="20px",t.style.color=v.textColor;let o=`<div style="font-size: 1.2em; margin-bottom: 10px;"><strong>${u.collectedCount} of 60</strong> seconds collected</div>`;o+=`<div>After ${u.totalParkruns} parkruns</div>`,u.dateOfCompletion&&(o+=`<div style="margin-top: 10px; font-size: 1.1em;">üèÜ Bingo completed on ${u.dateOfCompletion} (${u.firstCompleteEvent})</div>`),t.innerHTML=o,e.appendChild(t);var n=document.createElement("div");n.style.position="relative",n.style.width="500px",n.style.height="500px",n.style.margin="0 auto",n.style.borderRadius="50%",n.style.border="10px solid "+v.clockBorderColor,n.style.backgroundColor=v.clockFaceColor,n.style.boxSizing="content-box";for(let p=0;p<60;p++){var l,r,s=p in u.seconds,i=s&&u.timeData[p]?u.timeData[p].length:0,d=((p-.4)/60*360-90)*(Math.PI/180),a=((p+.4)/60*360-90)*(Math.PI/180),c=document.createElement("div"),m=(c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height="100%",c.style.pointerEvents="none",document.createElementNS("http://www.w3.org/2000/svg","svg")),y=(m.setAttribute("width","100%"),m.setAttribute("height","100%"),m.style.position="absolute",m.style.top="0",m.style.left="0",m.style.zIndex="1",document.createElementNS("http://www.w3.org/2000/svg","path")),d=["M 250,250",`L ${250+220*Math.cos(d)},`+(250+220*Math.sin(d)),`A 220,220 0 0,1 ${250+220*Math.cos(a)},`+(250+220*Math.sin(a)),"Z"].join(" ");y.setAttribute("d",d),s?(a=Math.min(i,5)/5,d=v.completedColor,l=parseInt(d.slice(1,3),16),r=parseInt(d.slice(3,5),16),d=parseInt(d.slice(5,7),16),a=1-.3*a,l=Math.floor(l*a).toString(16).padStart(2,"0"),r=Math.floor(r*a).toString(16).padStart(2,"0"),d=Math.floor(d*a).toString(16).padStart(2,"0"),y.setAttribute("fill","#"+l+r+d),y.setAttribute("opacity","1"),a=u.seconds[p],y.setAttribute("title",a.time+` - ${a.date} ${a.event} (${i} occurrences)`)):(y.setAttribute("fill",v.pendingColor),y.setAttribute("opacity","0.4"),y.setAttribute("title",`Missing: ${p.toString().padStart(2,"0")} seconds`)),s&&(y.style.cursor="pointer",y.style.pointerEvents="auto",y.addEventListener("click",()=>{{var d=p,a=u.timeData[p],c=document.getElementById("second-details-popup");c&&c.remove();let t=document.createElement("div"),e=(t.id="second-details-popup",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="400px",t.style.maxHeight="500px",t.style.overflowY="auto",t.style.backgroundColor=v.backgroundColor,t.style.borderRadius="8px",t.style.padding="20px",t.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.5)",t.style.zIndex="1000",t.style.color=v.textColor,document.createElement("div")),o=(e.textContent="‚úï",e.style.position="absolute",e.style.top="10px",e.style.right="15px",e.style.fontSize="20px",e.style.cursor="pointer",e.addEventListener("click",()=>t.remove()),t.appendChild(e),document.createElement("h3")),n=(o.textContent=`${d.toString().padStart(2,"0")} Seconds - ${a.length} Times`,o.style.marginBottom="15px",o.style.color=v.clockBorderColor,t.appendChild(o),document.createElement("table")),l=(n.style.width="100%",n.style.borderCollapse="collapse",n.style.marginTop="10px",document.createElement("thead")),r=document.createElement("tr"),s=([{title:"Date",align:"left"},{title:"Event",align:"left"},{title:"Time",align:"left"}].forEach(t=>{var e=document.createElement("th");e.textContent=t.title,e.style.textAlign=t.align,e.style.padding="8px",e.style.borderBottom="1px solid #555",r.appendChild(e)}),l.appendChild(r),n.appendChild(l),document.createElement("tbody")),i=(a.forEach((t,e)=>{var o=document.createElement("tr"),e=(o.style.backgroundColor=0===e?"rgba(255, 163, 0, 0.2)":"transparent",[{content:t.date},{content:t.event},{content:t.time}].map(t=>`<td style="padding: 8px; border-bottom: 1px solid #444;">${t.content}</td>`).join(""));o.innerHTML=e,s.appendChild(o)}),n.appendChild(s),t.appendChild(n),document.body.appendChild(t),document.createElement("div"));i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0, 0, 0, 0.5)",i.style.zIndex="999",i.addEventListener("click",()=>{t.remove(),i.remove()}),document.body.appendChild(i)}})),m.appendChild(y),c.appendChild(m),n.appendChild(c)}var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.style.position="absolute",p.style.top="0",p.style.left="0",p.style.pointerEvents="none",p.style.zIndex="2";for(let t=0;t<60;t+=5){var h=(t/60*360-90)*(Math.PI/180),g=t%15==0?210:225,b=document.createElementNS("http://www.w3.org/2000/svg","line"),b=(b.setAttribute("x1",250+g*Math.cos(h)),b.setAttribute("y1",250+g*Math.sin(h)),b.setAttribute("x2",250+245*Math.cos(h)),b.setAttribute("y2",250+245*Math.sin(h)),b.setAttribute("stroke",v.textColor),b.setAttribute("stroke-width",t%15==0?3:2),p.appendChild(b),t%15==0?g-25:g-20),g=250+b*Math.cos(h),b=250+b*Math.sin(h),h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",g),h.setAttribute("y",b),h.setAttribute("fill",v.textColor),h.setAttribute("font-size",t%15==0?"16px":"14px"),h.setAttribute("font-weight","bold"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.textContent=t.toString(),p.appendChild(h)}n.appendChild(p);var C=document.createElement("div");C.style.position="absolute",C.style.top="50%",C.style.left="50%",C.style.transform="translate(-50%, -50%)",C.style.width="100px",C.style.height="100px",C.style.borderRadius="50%",C.style.backgroundColor=v.clockBorderColor,C.style.display="flex",C.style.justifyContent="center",C.style.alignItems="center",C.style.color=v.backgroundColor,C.style.fontWeight="bold",C.style.fontSize="20px",C.style.zIndex="3",C.textContent=Math.round(u.collectedCount/60*100)+"%",n.appendChild(C),e.appendChild(n);{var x=e;let o=document.createElement("div"),t=(o.style.marginTop="15px",o.id="bingo-download-btn-container",document.createElement("button"));t.textContent="üíæ Save as Image",t.style.padding="8px 15px",t.style.backgroundColor=v.clockBorderColor,t.style.color=v.backgroundColor,t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontWeight="bold",t.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),t.addEventListener("mouseout",function(){this.style.backgroundColor=v.clockBorderColor}),t.addEventListener("click",function(){o.style.display="none",html2canvas(x,{backgroundColor:v.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(t=>{o.style.display="block";var e=document.createElement("a");e.download="parkrun-stopwatch-bingo.png",e.href=t.toDataURL("image/png"),e.click()})}),o.appendChild(t),x.appendChild(o)}t=document.createElement("div");return t.style.marginTop="20px",t.style.color=v.subtleTextColor,t.style.fontSize="0.9em",t.innerHTML="Stopwatch Bingo: collect finish times with every second from 00-59.<br>Orange segments show seconds you've collected, green segments are still needed.<br>Click on any segment to see details.",e.appendChild(t),e}function t(){var t,e;document.querySelector("#results")?document.querySelector("h2")&&(t=r(l(o())),t=t,e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)):console.log("Results table not found")}"undefined"!=typeof module&&module.exports?module.exports={findResultsTable:o,extractFinishTimes:l}:t()}})();
```

### parkrun Position Bingo Challenge

Tracks progress on the unofficial parkrun position bingo challenge (last two digits of position) with a 10x10 grid visualization and detailed event info.

```javascript
javascript:(async()=>{var n,e,t;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var o=document.createElement("script");o.src=n,o.onload=e,o.onerror=t,document.head.appendChild(o)});{let d=100;function o(n){var t=document.createElement("div"),e=(t.className="parkrun-position-bingo-container",t.style.margin="20px auto",t.style.padding="10px",t.style.backgroundColor="#2b223d",t.style.borderRadius="8px",t.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",t.style.color="#e0e0e0",t.style.textAlign="center",document.createElement("h3")),e=(e.textContent="Position Bingo Challenge",e.style.marginBottom="10px",e.style.color="#FFA300",t.appendChild(e),document.createElement("div")),e=(e.innerHTML='<div style="font-size: 1.2em; margin-bottom: 10px;"><strong>'+n.completedCount+" of "+d+"</strong> positions completed</div><div>After "+n.totalEvents+" parkruns</div>",t.appendChild(e),Math.ceil(d/10)),l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="repeat(10, 100px)",l.style.gridTemplateRows=`repeat(${e}, 100px)`,l.style.gap="5px",l.style.margin="0 auto";for(let o=0;o<d;o++){var i=document.createElement("div"),r=(i.style.boxSizing="border-box",i.style.border="1px solid #666",i.style.borderRadius="4px",i.style.backgroundColor=n.completedPositions[o]?"#FFA300":"#008080",i.style.color="#fff",i.style.textAlign="left",i.style.padding="2px",i.style.fontWeight="bold",i.style.fontSize="0.9em",i.style.cursor=n.completedPositions[o]?"pointer":"default",i.style.aspectRatio="1",document.createElement("div"));r.textContent=o.toString().padStart(2,"0"),r.style.fontSize="1.2em",r.style.marginBottom="5px",i.appendChild(r),n.completedPositions[o]&&((r=document.createElement("div")).innerHTML='<div style="font-size: 0.8em; text-align: center;">'+n.completedPositions[o][0].eventName+'<br><span style="font-size: 0.7em;">'+n.completedPositions[o][0].date+" ("+n.completedPositions[o][0].position+")</span></div>",i.appendChild(r),i.addEventListener("click",()=>{let e=document.createElement("div"),l=(e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.zIndex="999",e.addEventListener("click",()=>{document.body.removeChild(e)}),document.createElement("div"));l.style.position="fixed",l.style.top="50%",l.style.left="50%",l.style.transform="translate(-50%, -50%)",l.style.backgroundColor="#2b223d",l.style.color="#fff",l.style.padding="20px",l.style.borderRadius="8px",l.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",l.style.zIndex="1000",l.style.maxWidth="90%",l.style.maxHeight="80%",l.style.overflowY="auto";var t=document.createElement("h4");t.textContent="Position "+o.toString().padStart(2,"0"),t.style.marginBottom="10px",t.style.color="#FFA300",l.appendChild(t),n.completedPositions[o].forEach(({eventName:e,date:t,position:o})=>{var n=document.createElement("div");n.style.marginBottom="10px",n.innerHTML="<strong>"+e+'</strong><br><span style="font-size: 0.9em;">'+t+" ("+o+")</span>",l.appendChild(n)}),e.appendChild(l),document.body.appendChild(e)})),l.appendChild(i)}t.appendChild(l);{var s=t;let o=document.createElement("div"),e=(o.style.marginTop="15px",o.id="position-bingo-download-btn-container",document.createElement("button"));e.textContent="üíæ Save as Image",e.style.padding="8px 15px",e.style.backgroundColor="#FFA300",e.style.color="#2b223d",e.style.border="none",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontWeight="bold",e.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),e.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),e.addEventListener("click",function(){o.style.display="none",html2canvas(s,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(e=>{o.style.display="block";var t=document.createElement("a");t.download="parkrun-position-bingo.png",t.href=e.toDataURL("image/png"),t.click()})}),o.appendChild(e),s.appendChild(o)}return t}(t=(t=document.querySelectorAll("#results"))[t.length-1])?(t=t=o((e=>{let t={};var o;let n=0;for(o of Array.from(e.querySelectorAll("tr")).reverse()){var l=o.querySelectorAll("td");if(!(l.length<5)){var i=l[3].textContent.trim(),r=parseInt(i.slice(-2),10),s=l[0].textContent.trim(),l=l[1].textContent.trim();if(!isNaN(r)&&0<=r&&r<d&&(t[r]||(t[r]=[]),t[r].push({eventName:s,date:l,position:i}),Object.keys(t).length===d))break;n++}}return{completedPositions:t,remainingPositions:Array.from({length:d},(e,t)=>t).filter(e=>!t[e]),completedCount:Object.keys(t).length,totalEvents:n}})(t)),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")}})();
```

### parkrun Charts

Displays charts on parkrun pages: finishers per minute on results pages and event history on event history pages

```javascript
javascript:(async()=>{var r;r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var o=document.createElement("script");o.src=r,o.onload=e,o.onerror=t,document.head.appendChild(o)});{let n={backgroundColor:"#2b223d",barColor:"#FFA300",lineColor:"#53BA9D",textColor:"#e0e0e0",subtleTextColor:"#cccccc",gridColor:"rgba(200, 200, 200, 0.2)"};function l(e,t,o=800){var r=document.createElement("div"),o=(r.className="parkrun-chart-container "+t+"-container",r.style.width="100%",r.style.maxWidth=o+"px",r.style.margin="20px auto",r.style.padding="15px",r.style.backgroundColor=n.backgroundColor,r.style.borderRadius="8px",r.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.createElement("h3")),e=(o.textContent=e,o.style.textAlign="center",o.style.marginBottom="15px",o.style.color=n.barColor,r.appendChild(o),document.createElement("canvas"));return e.id=t,r.appendChild(e),{container:r,canvas:e}}function a(e){var t=document.querySelector(".Results-table");t&&t.parentNode?t.parentNode.insertBefore(e,t):(document.querySelector(".content")||document.body).appendChild(e)}function i(e,l,a){var t=document.createElement("div"),o=(t.style.display="flex",t.style.justifyContent="center",t.style.marginTop="10px",t.style.marginBottom="10px",document.createElement("button"));o.textContent="üíæ Save as Image",o.style.padding="6px 12px",o.style.backgroundColor=n.barColor,o.style.color="#2b223d",o.style.border="none",o.style.borderRadius="4px",o.style.cursor="pointer",o.style.fontWeight="bold",o.style.display="inline-block",o.style.margin="0 5px",o.title="Download chart as PNG image",o.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),o.addEventListener("mouseout",function(){this.style.backgroundColor=n.barColor}),o.addEventListener("click",function(){var e=document.createElement("a"),t=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/"),r=o[1];let n;n="event-history"===a?r+`-event-history-${t}.png`:r+`-event-${o[3]||"latest"}-finishers-${t}.png`,e.download=n,e.href=l.toDataURL("image/png"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}),t.appendChild(o),e.appendChild(t)}function e(){var e,t,o=(({timeData:t,minMinute:o,maxMinute:r})=>{var n=[],l=[];for(let e=o;e<=r;e++)n.push(e),l.push(t[e]||0);return{labels:n.map(e=>60<=e?Math.floor(e/60)+":"+(e%60).toString().padStart(2,"0"):e+"'"),data:l}})((()=>{let n={};var e=document.querySelectorAll("tr.Results-table-row");let l=1/0,a=0;e.forEach(t=>{t=t.querySelector("td.Results-table-td--time");if(t){t=t.textContent.trim();let e;var o=t.match(/(\d+):(\d+):(\d+)/);if(o){var r=parseInt(o[1]),o=parseInt(o[2]);e=60*r+o}else{r=t.match(/(\d+):(\d+)/);if(!r)return;e=parseInt(r[1])}l=Math.min(l,e),a=Math.max(a,e),n[e]?n[e]++:n[e]=1}});for(let e=l;e<=a;e++)n[e]||(n[e]=0);return{timeData:n,minMinute:l,maxMinute:a}})());0===o.labels.length?console.log("No finish time data found"):document.getElementById("finishersChart")?console.log("Finishers chart already exists, skipping render"):({container:t,canvas:e}=l("Finishers per Minute","finishersChart"),a(t),i(t,e,"finishers"),t=e.getContext("2d"),new Chart(t,{type:"bar",data:{labels:o.labels,datasets:[{label:"Number of Finishers",data:o.data,backgroundColor:n.barColor,borderColor:n.barColor,borderWidth:1}]},options:{animation:!1,responsive:!0,plugins:{legend:{labels:{color:n.textColor}},title:{display:!1,color:n.textColor},tooltip:{callbacks:{title:e=>{var t,o,e=e[0].label;return e.includes(":")?([o,t]=e.split(":"),o+` hour${"1"===o?"":"s"} ${t} minute`+("01"===t?"":"s")):(o=e.replace("'",""))+" minute"+("1"===o?"":"s")},label:e=>e.raw+" finisher"+(1===e.raw?"":"s")}}},scales:{x:{title:{display:!0,text:"Finish Time",color:n.textColor},ticks:{color:n.subtleTextColor},grid:{color:n.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:n.textColor},ticks:{precision:0,color:n.subtleTextColor},grid:{color:n.gridColor}}}}}))}function t(){if(document.getElementById("eventHistoryChart"))console.log("Event history chart already exists, skipping render");else{let t=(()=>{let o=[],r=[],n=[],l=[];var e=document.querySelectorAll("tr.Results-table-row");return Array.from(e).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&o.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&n.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{eventNumbers:o,dates:r,finishers:n,volunteers:l}})();var e,o;0===t.eventNumbers.length?console.log("No event history data found"):({container:o,canvas:e}=l("Event History: Finishers & Volunteers","eventHistoryChart",1e3),e.height=400,e.style.height="400px",e.style.maxHeight="400px",a(o),i(o,e,"event-history"),o=e.getContext("2d"),new Chart(o,{type:"bar",data:{labels:t.eventNumbers,datasets:[{label:"Finishers",data:t.finishers,backgroundColor:n.barColor,borderColor:n.barColor,borderWidth:1,yAxisID:"y-finishers",order:1},{label:"Volunteers",data:t.volunteers,type:"line",borderColor:n.lineColor,backgroundColor:"rgba(83, 186, 157, 0.2)",borderWidth:1,pointBackgroundColor:n.lineColor,pointRadius:2,fill:!1,tension:.2,yAxisID:"y-volunteers",order:0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:2.5,onResize:null,plugins:{legend:{labels:{color:n.textColor,usePointStyle:!0}},tooltip:{mode:"index",callbacks:{title:function(e){e=e[0].dataIndex;return`Event #${t.eventNumbers[e]} (${t.dates[e]})`},label:function(e){var t=e.dataset.label||"";return"Finishers"===t?"Finishers: "+e.raw:"Volunteers"===t?"Volunteers: "+e.raw:e.formattedValue}}}},scales:{x:{title:{display:!0,text:"Event Number",color:n.textColor},ticks:{color:n.subtleTextColor},grid:{color:n.gridColor}},"y-finishers":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:n.textColor},ticks:{precision:0,color:n.subtleTextColor},grid:{color:n.gridColor}},"y-volunteers":{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Number of Volunteers",color:n.lineColor},ticks:{precision:0,color:n.lineColor},grid:{display:!1}}}}}))}}"undefined"==typeof Chart?console.error("Chart.js not loaded"):document.querySelector(".Results-table")?(window.location.href.includes("/eventhistory/")?t:e)():console.log("Results table not found")}})();
```

### parkrun p-index display

The parkrun p-index is an unofficial statistic that measures the number of different parkrun events a person has completed a specific number of times. To achieve a p-index of 10, you must have completed at least 10 different parkrun events 10 times each. This script calculate the p-index for a parkrunner and displays it on their results page.

```javascript
javascript:(async()=>{if("undefined"!=typeof module&&module.exports)module.exports={calculatePIndex:o,extractEventDetails:t,findResultsTable:n};else{var e=n();if(e){({pIndex:e,contributingEvents:r}=o(t(e)));var r,l=document.querySelector("h2");if(l){let t=document.createElement("div"),n=(t.textContent="p-index: "+e,t.style.fontSize="1.5em",t.style.fontWeight="bold",t.style.marginTop="10px",t.style.backgroundColor="#2b223d",t.style.color="#ffa300",t.style.padding="10px",t.style.borderRadius="5px",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.setAttribute("id","p-index-display"),document.createElement("ul"));n.style.listStyleType="none",n.style.padding="0",r.forEach(e=>{var t=document.createElement("li");t.textContent=e,t.style.fontWeight="normal",t.style.fontSize="1em",n.appendChild(t)}),t.appendChild(n),l.parentNode.insertBefore(t,l.nextSibling),setTimeout(()=>{var e=t.getBoundingClientRect(),e=Math.max(e.width,e.height);t.style.width=e+"px",t.style.height=e+"px"},0)}}else console.error("Results table not found")}function t(e){let r=[];e.querySelectorAll("tbody > tr").forEach(e=>{var t=e.querySelector("td:nth-child(1) > a").textContent.trim(),n=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();r.unshift({eventName:t,date:n,eventNumber:e})});e=r.reduce((e,{eventName:t,date:n,eventNumber:r})=>(e[t]||(e[t]=[]),e[t].push({date:n,eventNumber:r}),e),{});return Object.entries(e).sort((e,t)=>t[1].length-e[1].length)}function n(){var e=document.querySelectorAll("#results");return e[e.length-1]}function o(e){e=e.filter(([,e],t)=>e.length>t);let l=e.length;function o(e){return new Date(e.split("/").reverse().join("-"))}e=e.map(([e,t])=>{var n=t[0],r=t[l-1];return{eventName:e,eventCount:t.length,firstDate:n.date,firstEventNumber:n.eventNumber,pIndexDate:r.date,pIndexEventNumber:r.eventNumber,firstDateForSorting:o(n.date),pIndexDateForSorting:o(r.date)}}).sort((e,t)=>e.pIndexDateForSorting-t.pIndexDateForSorting).slice(0,l).map(e=>e.eventName+" ("+e.eventCount+"): "+e.firstDate+" (#"+e.firstEventNumber+") - "+e.pIndexDate+" (#"+e.pIndexEventNumber+")");return{pIndex:l,contributingEvents:e}}})();
```

### parkrun Compass Challenge

Visualizes your progress on the compass challenge (North, South, East, West parkruns)

```javascript
javascript:(async()=>{var n,t,e;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var o=document.createElement("script");o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)});{let h={backgroundColor:"#2b223d",accentColor:"#FFA300",completedColor:"#53BA9D",pendingColor:"#666",textColor:"#e0e0e0",subtleTextColor:"#cccccc"},m={north:/north/i,south:/south/i,east:/east/i,west:/west/i};function o(t){e="Compass Challenge",(r=document.createElement("div")).className="parkrun-compass-container",r.style.width="100%",r.style.maxWidth="800px",r.style.margin="20px auto",r.style.padding="20px",r.style.backgroundColor=h.backgroundColor,r.style.borderRadius="8px",r.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",r.style.textAlign="center",(o=document.createElement("h3")).textContent=e,o.style.marginBottom="15px",o.style.color=h.accentColor,r.appendChild(o);var e=r,o=document.createElement("div");o.style.marginBottom="20px",o.style.color=h.textColor;let n=`<div style="font-size: 1.2em; margin-bottom: 10px;"><strong>${t.completedCount} of 4</strong> compass directions completed</div>`;n+=`<div>After ${t.totalEvents} parkruns</div>`,t.dateOfCompletion&&(n+=`<div style="margin-top: 10px; font-size: 1.1em;">üß≠ Challenge completed on ${t.dateOfCompletion}</div>`),o.innerHTML=n,e.appendChild(o);var r=document.createElement("div");r.style.position="relative",r.style.width="700px",r.style.height="700px",r.style.margin="0 auto",r.style.boxSizing="content-box";let c=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=(c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("viewBox","0 0 700 700"),c.style.position="absolute",c.style.top="0",c.style.left="0",350),p=350;let m=230;o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",u),o.setAttribute("cy",p),o.setAttribute("r",m),o.setAttribute("fill","#334"),o.setAttribute("stroke",h.accentColor),o.setAttribute("stroke-width","5"),c.appendChild(o);[{name:"north",angle:270,label:"N",data:t.directions.north},{name:"east",angle:0,label:"E",data:t.directions.east},{name:"south",angle:90,label:"S",data:t.directions.south},{name:"west",angle:180,label:"W",data:t.directions.west}].forEach(e=>{var o=e.angle*(Math.PI/180),n=u+m*Math.cos(o),r=p+m*Math.sin(o),a=.12*m,l=u+115*Math.cos(o),s=p+115*Math.sin(o),t=o+Math.PI/2,i=l+a*Math.cos(t),d=s+a*Math.sin(t),l=l-a*Math.cos(t),s=s-a*Math.sin(t),a=document.createElementNS("http://www.w3.org/2000/svg","path"),t=(a.setAttribute("d",`M 350 350 L ${i} ${d} L ${n} ${r} L ${l} ${s} Z`),a.setAttribute("fill",e.data?h.completedColor:h.pendingColor),a.setAttribute("stroke","#000"),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-opacity","0.3"),c.appendChild(a),u+115*Math.cos(o)),i=p+115*Math.sin(o),d=document.createElementNS("http://www.w3.org/2000/svg","text");if(d.setAttribute("x",t),d.setAttribute("y",i),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.setAttribute("fill","#fff"),d.setAttribute("font-size","28px"),d.setAttribute("font-weight","bold"),d.setAttribute("stroke","#000"),d.setAttribute("stroke-width","1"),d.setAttribute("paint-order","stroke"),d.textContent=e.label,c.appendChild(d),e.data){n=e.data.eventName.match(/(.+?)(?:\s+parkrun)?$/i),r=(n?n[1]:e.data.eventName)+" - "+e.data.date,l="text-path-"+e.name,s=document.createElementNS("http://www.w3.org/2000/svg","path");let t="";switch(e.name){case"north":t="M 180 105 A 245 245 0 0 1 520 105";break;case"east":t="M 595 180 A 245 245 0 0 1 595 520";break;case"south":t="M 180 595 A 245 245 0 0 0 520 595";break;case"west":t="M 105 520 A 245 245 0 0 1 105 180";break;default:console.warn("Unknown direction: "+e.name)}s.setAttribute("id",l),s.setAttribute("d",t),s.setAttribute("fill","none"),c.appendChild(s);a=document.createElementNS("http://www.w3.org/2000/svg","text"),o=(a.setAttribute("fill","#FFFFFF"),a.setAttribute("font-size","14px"),a.setAttribute("font-weight","bold"),document.createElementNS("http://www.w3.org/2000/svg","textPath"));o.setAttribute("href","#"+l),o.setAttribute("startOffset","50%"),o.setAttribute("text-anchor","middle"),"south"===e.name&&o.setAttribute("side","left"),o.textContent=r,a.appendChild(o),c.appendChild(a)}});var o=document.createElementNS("http://www.w3.org/2000/svg","defs"),a=document.createElementNS("http://www.w3.org/2000/svg","filter"),l=(a.setAttribute("id","text-shadow"),a.setAttribute("x","-20%"),a.setAttribute("y","-20%"),a.setAttribute("width","140%"),a.setAttribute("height","140%"),document.createElementNS("http://www.w3.org/2000/svg","feDropShadow")),l=(l.setAttribute("dx","0"),l.setAttribute("dy","0"),l.setAttribute("stdDeviation","2"),l.setAttribute("flood-color","#000000"),l.setAttribute("flood-opacity","0.7"),a.appendChild(l),o.appendChild(a),c.appendChild(o),document.createElementNS("http://www.w3.org/2000/svg","circle")),a=(l.setAttribute("cx",u),l.setAttribute("cy",p),l.setAttribute("r",30),l.setAttribute("fill",h.accentColor),c.appendChild(l),document.createElementNS("http://www.w3.org/2000/svg","text"));a.setAttribute("x",u),a.setAttribute("y",p),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","middle"),a.setAttribute("fill",h.backgroundColor),a.setAttribute("font-size","24px"),a.setAttribute("font-weight","bold"),a.textContent=Math.round(t.completedCount/4*100)+"%",c.appendChild(a),r.appendChild(c),e.appendChild(r);{var s=e;let o=document.createElement("div"),t=(o.style.marginTop="15px",o.id="compass-download-btn-container",document.createElement("button"));t.textContent="üíæ Save as Image",t.style.padding="8px 15px",t.style.backgroundColor=h.accentColor,t.style.color=h.backgroundColor,t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontWeight="bold",t.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),t.addEventListener("mouseout",function(){this.style.backgroundColor=h.accentColor}),t.addEventListener("click",function(){o.style.display="none",html2canvas(s,{backgroundColor:h.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(t=>{o.style.display="block";var e=document.createElement("a");e.download="parkrun-compass-challenge.png",e.href=t.toDataURL("image/png"),e.click()})}),o.appendChild(t),s.appendChild(o)}return e}document.querySelector("#results")?(t=t=o((t=>{var e={north:null,south:null,east:null,west:null};let o=0,n=null,r=0,a=(t=t.querySelectorAll("tr"),[]);t.forEach(t=>{var e,o,n,t=t.querySelectorAll("td");t.length<5||(e=t[0].textContent.trim(),o=t[1].textContent.trim(),n=t[2].textContent.trim(),(t=t[4].textContent.trim())&&n&&o&&e&&a.push({eventName:e,date:o,eventNumber:n,time:t}))});var l=a.reverse();for(let t=0;!n&&t<l.length;t++){var s,i,{eventName:d,date:c,eventNumber:u,time:p}=l[t];r++;for([s,i]of Object.entries(m))i.test(d)&&!e[s]&&(e[s]={eventName:d,date:c,eventNumber:u,time:p},4===++o)&&(n=n||c)}return{directions:e,completedCount:o,dateOfCompletion:n,totalEvents:r}})((t=document.querySelectorAll("#results"))[t.length-1])),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")}})();
```

### parkrun Alphabet Challenge

Tracks progress on the unofficial parkrun alphabet challenge (A-Z, excluding X) with a 5x5 grid visualization and download feature.

```javascript
javascript:(async()=>{var n,e,t;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var l=document.createElement("script");l.src=n,l.onload=e,l.onerror=t,document.head.appendChild(l)});{let s="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").filter(e=>"X"!==e);function l(n){var t=document.createElement("div"),e=(t.className="parkrun-alphabet-container",t.style.width="100%",t.style.maxWidth="800px",t.style.margin="20px auto",t.style.padding="20px",t.style.backgroundColor="#2b223d",t.style.borderRadius="8px",t.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",t.style.color="#e0e0e0",t.style.textAlign="center",document.createElement("h3")),e=(e.textContent="Alphabet Challenge",e.style.marginBottom="15px",e.style.color="#FFA300",t.appendChild(e),document.createElement("div"));e.innerHTML='<div style="font-size: 1.2em; margin-bottom: 10px;"><strong>'+n.completedCount+" of 25</strong> letters completed</div><div>After "+n.totalEvents+" parkruns</div>"+(n.dateOfCompletion?"<div>üéâ Challenge completed on: "+n.dateOfCompletion+"</div>":""),t.appendChild(e);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="repeat(5, 1fr)",o.style.gap="10px",o.style.marginTop="20px",s.forEach(e=>{var t=document.createElement("div"),l=(t.style.aspectRatio="1",t.style.position="relative",t.style.border="1px solid #666",t.style.borderRadius="4px",t.style.backgroundColor=n.completedLetters[e]?"#FFA300":"#008080",t.style.color="#fff",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-start",t.style.justifyContent="flex-start",t.style.padding="10px",t.style.fontWeight="bold",t.style.fontSize="1em",document.createElement("div"));l.textContent=e,l.style.fontSize="1.5em",l.style.marginBottom="5px",t.appendChild(l),n.completedLetters[e]&&((l=document.createElement("div")).innerHTML='<div style="font-size: 0.8em; text-align: left;">'+n.completedLetters[e].eventName+'<br><span style="font-size: 0.7em;">('+n.completedLetters[e].date+")</span></div>",t.appendChild(l)),o.appendChild(t)}),t.appendChild(o);{var r=t;let l=document.createElement("div"),e=(l.style.marginTop="15px",l.id="alphabet-download-btn-container",document.createElement("button"));e.textContent="üíæ Save as Image",e.style.padding="8px 15px",e.style.backgroundColor="#FFA300",e.style.color="#2b223d",e.style.border="none",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontWeight="bold",e.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),e.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),e.addEventListener("click",function(){l.style.display="none",html2canvas(r,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(e=>{l.style.display="block";var t=document.createElement("a");t.download="parkrun-alphabet-challenge.png",t.href=e.toDataURL("image/png"),t.click()})}),l.appendChild(e),r.appendChild(l)}return t}(t=(t=document.querySelectorAll("#results"))[t.length-1])?(t=t=l((e=>{let t={};var l;let n=0,o=null;for(l of Array.from(e.querySelectorAll("tr")).reverse()){var r=l.querySelectorAll("td");if(!(r.length<1)){var a=r[0].textContent.trim(),r=r[1].textContent.trim(),d=a.charAt(0).toUpperCase();if(n++,s.includes(d)&&!t[d]&&(t[d]={eventName:a,date:r},25===Object.keys(t).length)){o=r;break}}}return e=Object.keys(t).length,{completedLetters:t,remainingLetters:s.filter(e=>!t[e]),completedCount:e,dateOfCompletion:o,totalEvents:n}})(t)),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")}})();
```
<!-- END BOOKMARKLETS SECTION -->


## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please see the [CONTRIBUTING.md](CONTRIBUTING.md) file for guidelines.
