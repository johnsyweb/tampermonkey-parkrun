# Pete's parkrun userscripts

## A script or scripts for messing with parkrun results pages

You'll need something like [Tampermonkey](https://www.tampermonkey.net) if
you'd like to enjoy them. Or you can use the bookmarklet versions.

## Development Setup

This project uses [mise](https://mise.jdx.dev/) for development environment management.

### Prerequisites

- [mise](https://mise.jdx.dev/) - for managing development tools

### Setup

1. Install dependencies with mise (installs Ruby, Node, and pnpm):
   ```bash
   mise install
   ```

2. Install npm dependencies:
   ```bash
   pnpm install
   ```
   
The `mise.toml` file specifies the required versions:
- Ruby 3.4.7 (for Jekyll)
- Node LTS (for development tools)
- pnpm latest (for package management)

3. For microsite development, install Ruby/Jekyll dependencies:
   ```bash
   cd docs
   bundle install
   ```

### Previewing the Microsite Locally

The microsite documentation is built with Jekyll and served from the `docs/` directory.

1. Start the Jekyll server:
   ```bash
   cd docs
   bundle exec jekyll serve --port 4000 --host 0.0.0.0
   ```

2. Visit http://localhost:4000/tampermonkey-parkrun/ in your browser

### Generating Screenshots

To generate screenshots for the microsite:

```bash
pnpm screenshots
```

This will create screenshots of all userscripts in `docs/images/`. Scripts are included if their UserScript header contains `@screenshot-url`; you can optionally add `@screenshot-selector`, `@screenshot-timeout`, and `@screenshot-viewport` (e.g. `1200x800`) in the script header to control how the screenshot is taken.

### Building the Microsite

The microsite is automatically deployed to GitHub Pages on every push to `main`. 

To build the site locally:

```bash
pnpm docs:build
```

To serve the site locally:

```bash
pnpm docs:serve
```

The site will be available at http://localhost:4000/tampermonkey-parkrun/

### Git Hooks

This project uses [husky](https://typicode.github.io/husky/) to manage git hooks. Hooks are automatically installed when you run `pnpm install`.

#### Pre-commit Hook

The pre-commit hook ensures code quality by running:
- `pnpm check-format` - Checks code formatting with Prettier
- `pnpm test` - Runs all Jest tests
- `pnpm lint` - Runs ESLint to check for linting errors

All checks must pass before a commit is allowed. This ensures all code is properly formatted, tested, and linted before being committed.

#### Pre-push Hook

The pre-push hook automatically generates screenshots when userscripts are modified:

- Checks if any `.user.js` files have been modified in the commits being pushed
- Automatically runs `pnpm screenshots` if userscripts were changed
- Prevents the push if screenshot generation fails

**Note:** Screenshots must be generated locally because parkrun websites block automated agents from accessing them in CI environments.

### GitHub Actions Workflow

The project includes a GitHub Actions workflow that:

1. Sets up Ruby (for Jekyll) and Node.js (for scripts)
2. Installs dependencies (via mise, pnpm, and bundler)
3. Generates the scripts data file from userscript metadata in the built scripts
4. Builds the Jekyll site
5. Deploys to GitHub Pages

This workflow runs on every push to `main` and automatically keeps the microsite up to date with the latest scripts.

## Why?

Why not?

## How to Install Bookmarklets

To use these scripts as bookmarklets, follow these steps:

1. Copy the JavaScript code for the desired bookmarklet from the sections below.
2. Open your browser's bookmarks manager.
3. Create a new bookmark.
4. Paste the JavaScript code into the URL field of the bookmark.
5. Save the bookmark.

Now, you can click the bookmark while on a parkrun results page to run the script.

## Updating Versions

To update the `@version` field in all userscripts, run the following Node.js script:

```bash
node scripts/update-version.js
```

This will automatically update the `@version` field in all `.user.js` files based on the current date and time.

## Bookmarklets

You can also use these scripts as bookmarklets by creating bookmarks with the following URLs:

### junior parkrun Group Sunday Link

> Adds a link to the consolidated club report for the most recent Sunday on junior parkrun group pages


[junior-group-sunday-link.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/junior-group-sunday-link.user.js)

```javascript
javascript:(async()=>{function t(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document;return Array.from(t.querySelectorAll("a")).find(function(t){return t.href.includes("/consolidatedclub/?")})||null}function e(t){try{return new URL(t.href).searchParams.get("clubNum")}catch(t){return null}}function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Date,e=new Date(t);return e.setDate(t.getDate()-t.getDay()),e}function r(t){var e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),t=String(t.getDate()).padStart(2,"0");return"".concat(e,"-").concat(n,"-").concat(t)}function o(t,e,n){e="https://www.parkrun.com/results/consolidatedclub/?clubNum=".concat(e,"&eventdate=").concat(n),n=t.cloneNode(!0);return n.href=e,n.textContent="View the consolidated club report for member participation at last Sunday's junior parkruns",n}function a(t,e){t.parentNode.insertBefore(document.createElement("br"),t.nextSibling),t.parentNode.insertBefore(e,t.nextSibling.nextSibling)}var u,c;(c=t())&&(u=e(c))&&a(c,o(c,u,r(n()))),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={findConsolidatedClubLink:t,extractClubNumFromLink:e,getMostRecentSunday:n,formatDateYYYYMMDD:r,buildSundayLink:o,insertAfter:a})})();
```

### parkrun Alphabet Challenge

> Tracks progress on the unofficial parkrun alphabet challenge (A-Z, excluding X) with a 5x5 grid visualization and download feature.


[alphabet-challenge.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/alphabet-challenge.user.js)

```javascript
javascript:(async()=>{var o,e,t,p;function c(e,t){var n,o,r,l,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return r=!(o=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){r=!0,n=e},f:function(){try{o||null==a.return||a.return()}finally{if(r)throw n}}};if(Array.isArray(e)||(a=((e,t)=>{var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0})(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),l=0,{s:t=function(){},n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function d(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"8px",medium:"10px",large:"10px"},container:{padding:"10px",marginTop:"10px"},typography:{heading:"1.1em",stats:"1em",statsSubtext:"0.9em"},grid:{gapSize:"5px",marginTop:"10px",cellPadding:"5px",letterFontSize:"1.2em",letterMarginBottom:"2px",eventFontSize:"0.7em",dateFontSize:"0.65em"},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"},heading:{marginBottom:"10px"}}:{isMobile:!1,spacing:{small:"10px",medium:"15px",large:"20px"},container:{padding:"20px",marginTop:"20px"},typography:{heading:"1.3em",stats:"1.2em",statsSubtext:"1em"},grid:{gapSize:"10px",marginTop:"20px",cellPadding:"10px",letterFontSize:"1.5em",letterMarginBottom:"5px",eventFontSize:"0.8em",dateFontSize:"0.7em"},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"},heading:{marginBottom:"15px"}}}function n(l){var e,t,r,n=d(),o=document.createElement("div"),a=(o.className="parkrun-alphabet-container",o.style.width="100%",o.style.maxWidth="800px",o.style.margin="".concat(n.container.marginTop," auto"),o.style.padding=n.container.padding,o.style.backgroundColor="#2b223d",o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",o.style.color="#e0e0e0",o.style.textAlign="center",document.createElement("h3")),a=(a.textContent="Alphabet Challenge",a.style.marginBottom=n.heading.marginBottom,a.style.color="#FFA300",a.style.fontSize=n.typography.heading,o.appendChild(a),document.createElement("div")),i=(a.innerHTML='<div style="font-size: '.concat(n.typography.stats,"; margin-bottom: ").concat(n.spacing.small,';">')+"<strong>"+l.completedCount+" of 25</strong> letters completed</div>"+'<div style="font-size: '.concat(n.typography.statsSubtext,';">After ')+l.totalEvents+" parkruns</div>"+(l.dateOfCompletion?'<div style="font-size: '.concat(n.typography.statsSubtext,';">ðŸŽ‰ Challenge completed on: ').concat(l.dateOfCompletion,"</div>"):""),o.appendChild(a),document.createElement("div"));return i.style.display="grid",i.style.gridTemplateColumns="repeat(5, 1fr)",i.style.gap=n.grid.gapSize,i.style.marginTop=n.grid.marginTop,p.forEach(function(r){var e=document.createElement("div"),t=(e.style.aspectRatio="1",e.style.position="relative",e.style.border="1px solid #666",e.style.borderRadius="4px",e.style.backgroundColor=l.completedLetters[r]?"#FFA300":"#008080",e.style.color="#fff",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="flex-start",e.style.justifyContent="flex-start",e.style.padding=n.grid.cellPadding,e.style.fontWeight="bold",e.style.fontSize="1em",e.style.cursor=l.completedLetters[r]?"pointer":"default",document.createElement("div"));t.textContent=r,t.style.fontSize=n.grid.letterFontSize,t.style.marginBottom=n.grid.letterMarginBottom,e.appendChild(t),l.completedLetters[r]&&((t=document.createElement("div")).innerHTML='<div style="font-size: '.concat(n.grid.eventFontSize,'; text-align: left;">')+l.completedLetters[r].eventName+"<br>"+'<span style="font-size: '.concat(n.grid.dateFontSize,';">(')+l.completedLetters[r].date+")</span></div>",n.isMobile&&(t.style.display="none"),e.appendChild(t),e.addEventListener("click",function(){var e=d(),t=document.createElement("div"),n=(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.zIndex="999",t.addEventListener("click",function(){document.body.removeChild(t)}),document.createElement("div")),o=(n.style.position="fixed",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.backgroundColor="#2b223d",n.style.color="#fff",e.isMobile?"15px":"20px"),o=(n.style.padding=o,n.style.borderRadius="8px",n.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",n.style.zIndex="1000",n.style.maxWidth=e.isMobile?"95%":"90%",n.style.maxHeight=e.isMobile?"85%":"80%",n.style.overflowY="auto",n.style.fontSize=e.isMobile?"0.9em":"1em",document.createElement("h4")),e=(o.textContent="Letter ".concat(r),o.style.marginBottom="10px",o.style.color="#FFA300",n.appendChild(o),document.createElement("div"));e.style.marginBottom="10px",e.innerHTML="<strong>"+l.completedLetters[r].eventName+'</strong><br><span style="font-size: 0.9em;">'+l.completedLetters[r].date+"</span>",n.appendChild(e),t.appendChild(n),document.body.appendChild(t)})),i.appendChild(e)}),o.appendChild(i),e=o,a=d(),(t=document.createElement("div")).style.marginTop=a.button.marginTop,t.id="alphabet-download-btn-container",(r=document.createElement("button")).textContent="ðŸ’¾ Save as Image",r.style.padding=a.button.padding,r.style.backgroundColor="#FFA300",r.style.color="#2b223d",r.style.border="none",r.style.borderRadius="4px",r.style.cursor="pointer",r.style.fontWeight="bold",r.style.fontSize=a.button.fontSize,r.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),r.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),r.addEventListener("click",function(){r.style.display="none",html2canvas(e,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(function(e){r.style.display="block";var t=document.createElement("a"),n=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/")[2]||"parkrunner";t.download="alphabet-challenge-".concat(o,"-").concat(n,".png"),t.href=e.toDataURL("image/png"),t.click()})}),t.appendChild(r),e.appendChild(t),o}o="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=o,n.onload=e,n.onerror=t,document.head.appendChild(n)}),p="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").filter(function(e){return"X"!==e}),(t=(t=document.querySelectorAll("#results"))[t.length-1])?(t=t=n((e=>{var t,n={},o=0,r=null,l=c(Array.from(e.querySelectorAll("tr")).reverse());try{for(l.s();!(t=l.n()).done;){var a=t.value.querySelectorAll("td");if(!(a.length<1)){var i=a[0].textContent.trim(),d=a[1].textContent.trim(),s=i.charAt(0).toUpperCase();if(o++,p.includes(s)&&!n[s]&&(n[s]={eventName:i,date:d},25===Object.keys(n).length)){r=d;break}}}}catch(e){l.e(e)}finally{l.f()}return e=Object.keys(n).length,{completedLetters:n,remainingLetters:p.filter(function(e){return!n[e]}),completedCount:e,dateOfCompletion:r,totalEvents:o}})(t)),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")})();
```

### parkrun Annual Summary

> Adds an annual participation summary (totals, averages, min/max) to parkrun event history pages


[parkrun-annual-summary.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-annual-summary.user.js)

```javascript
javascript:(async()=>{var r,w,E,S;function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e){return(e=>{if(Array.isArray(e))return o(e)})(e)||(e=>{if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)})(e)||n(e)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function F(){var h,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,l,i,s,c,u,d,p,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype);return b(t,"_invoke",(o=e,a=n,u=r||[],d=!1,p={p:c=0,n:0,v:h,a:m,f:m.bind(h,4),d:function(e,t){return l=e,i=0,s=h,p.n=t,y}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(d&&1===t&&m(t,n),i=t,s=n;(g=i<2?h:s)||!d;){l||(i?i<3?(1<i&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(c=2,l){if(g=l[e=i?e:"next"]){if(!(g=g.call(l,s)))throw TypeError("iterator result is not an object");if(!g.done)return g;s=g.value,i<2&&(i=0)}else 1===i&&(g=l.return)&&g.call(l),i<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),i=1);l=h}else if((g=(d=p.n<0)?s:o.call(a,p))!==y)break}catch(e){l=h,i=1,s=e}finally{c=1}}return{value:g,done:d}}),!0),t;function m(e,t){for(i=e,s=t,g=0;!d&&c&&!n&&g<u.length;g++){var n,r=u[g],o=p.p,a=r[2];3<e?(n=a===t)&&(s=r[(i=r[4])?5:i=3],r[4]=r[5]=h):r[0]<=o&&((n=e<2&&o<r[1])?(i=0,p.v=t,p.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,p.n=a,i=0))}if(n||1<e)return y;throw d=!0,t}}var y={};function f(){}function o(){}function a(){}var g=Object.getPrototypeOf,e=[][t]?g(g([][t]())):(b(g={},t,function(){return this}),g),l=a.prototype=f.prototype=Object.create(e);function i(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,b(e,n,"GeneratorFunction")),e.prototype=Object.create(l),e}return b(l,"constructor",o.prototype=a),b(a,"constructor",o),b(a,n,o.displayName="GeneratorFunction"),b(l),b(l,n,"Generator"),b(l,t,function(){return this}),b(l,"toString",function(){return"[object Generator]"}),(F=function(){return{w:r,m:i}})()}function b(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(b=function(e,t,n,r){function o(t,n){b(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function T(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=(e=>(e=((e,t)=>{if("object"!=p(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=p(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")})(e,"string"),"symbol"==p(e)?e:e+""))(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function N(e,t){return(e=>{if(Array.isArray(e))return e})(e)||((e,t)=>{var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,l,i=[],s=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(c)throw o}}return i}})(e,t)||n(e,t)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function n(e,t){var n;if(e)return"string"==typeof e?o(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function O(i){return function(){var e=this,l=arguments;return new Promise(function(t,n){var r=i.apply(e,l);function o(e){s(r,t,n,o,a,"next",e)}function a(e){s(r,t,n,o,a,"throw",e)}o(void 0)})}}function a(){return(a=O(F().m(function e(){var t,n,r,o,a,l;return F().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t="parkrun_events_cache",e.p=1,a=localStorage.getItem(t)){if(e.p=2,a=JSON.parse(a),r=a.data,a=a.timestamp,(a=Date.now()-a)<864e5)return console.log("Using cached parkrun events (".concat(Math.round(a/1e3/60)," minutes old)")),e.a(2,r);e.n=3}else e.n=5;break;case 3:e.n=5;break;case 4:e.p=4,a=e.v,console.log("Cache parse error, fetching fresh data",a);case 5:return console.log("Fetching parkrun events from https://images.parkrun.com/events.json"),e.n=6,fetch("https://images.parkrun.com/events.json");case 6:if(n=e.v,console.log("Fetch response status:",n.status,n.statusText),n.ok){e.n=7;break}return console.error("Fetch failed with status:",n.status),e.a(2,[]);case 7:return e.n=8,n.json();case 8:if(r=e.v,o=(null==(o=r.events)?void 0:o.features)||r.features||[],console.log("Features array length:",o.length),o&&0!==o.length){e.n=9;break}return console.error("No features found in response data"),e.a(2,[]);case 9:try{localStorage.setItem(t,JSON.stringify({data:o,timestamp:Date.now()})),console.log("Cached",o.length,"parkrun events for 24 hours")}catch(e){console.warn("Failed to cache parkrun events:",e)}return console.log("Successfully loaded",o.length,"parkrun events"),e.a(2,o);case 10:return e.p=10,l=e.v,console.error("Failed to fetch parkruns:",l),console.error("Error details:",l.message,l.stack),e.a(2,[])}},e,null,[[2,4],[1,10]])}))).apply(this,arguments)}function j(){return{eventName:window.location.pathname.split("/")[1],domain:window.location.hostname,url:window.location.origin}}function V(e,t,n,r){var o=(n-e)*Math.PI/180,r=(r-t)*Math.PI/180,t=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))}function l(){return(l=O(F().m(function e(t,n){var r,o,a,l;return F().w(function(e){for(;;)if(0===e.n)return r=t.cloneNode(!0),a=t.querySelectorAll("canvas"),o=r.querySelectorAll("canvas"),a.forEach(function(e,t){try{var n=e.toDataURL("image/png"),r=document.createElement("img");r.src=n,r.alt="Chart snapshot",r.style.maxWidth="100%",r.style.display="block",r.style.backgroundColor="#2b223d",o[t]&&o[t].replaceWith(r)}catch(e){console.error("Failed to serialize chart canvas:",e)}}),a="\n      :root { color-scheme: dark; }\n      body { margin: 0; padding: 20px; background: ".concat(w.backgroundColor,"; color: ").concat(w.textColor,'; font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; line-height: 1.5; }\n      a { color: ').concat(w.lineColor,"; }\n      h1, h2, h3, h4 { color: ").concat(w.barColor,"; margin: 0 0 10px 0; }\n      table { width: 100%; border-collapse: collapse; }\n      th, td { border: 1px solid ").concat(w.gridColor,"; padding: 10px; text-align: left; }\n      th { background: #2b223d; color: ").concat(w.barColor,"; }\n      tr:nth-child(even) td { background: #241c35; }\n      tr:nth-child(odd) td { background: #1f182e; }\n      .parkrun-annual-summary { background: ").concat(w.backgroundColor,"; padding: 16px; border-radius: 6px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25); }\n      .chart-img { max-width: 100%; display: block; }\n      .meta { margin-bottom: 16px; color: ").concat(w.subtleTextColor,"; font-size: 13px; }\n      .meta strong { color: ").concat(w.textColor,"; }\n    "),l='\n      <header>\n        <h1>parkrun Annual Summary</h1>\n        <div class="meta">\n          <div><strong>Event:</strong> '.concat(n.eventShortName,"</div>\n          <div><strong>Generated:</strong> ").concat(n.generatedAt,"</div>\n        </div>\n      </header>\n    "),e.a(2,'<!DOCTYPE html><html><head><meta charset="UTF-8"><title>parkrun Annual Summary - '.concat(n.eventShortName,"</title><style>").concat(a,"</style></head><body>").concat(l).concat(r.outerHTML,"</body></html>"))},e)}))).apply(this,arguments)}function P(){return e.apply(this,arguments)}function e(){return(e=O(F().m(function e(t,n){var r,o;return F().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,function(){return l.apply(this,arguments)}(t,n);case 1:return r=e.v,o="parkrun-annual-summary-".concat(n.eventShortName,"-").concat(n.generatedAtISO,".html"),e.a(2,{blob:new Blob([r],{type:"text/html"}),filename:o})}},e)}))).apply(this,arguments)}function i(){return(i=O(F().m(function e(t,n){var r,o,a,l,i,s,c;return F().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r="".concat(n,"/").concat(t,"/results/eventhistory/"),e.n=1,fetch(r);case 1:return r=e.v,e.n=2,r.text();case 2:return o=e.v,c=new DOMParser,c=c.parseFromString(o,"text/html"),o=null!=(o=null==(o=c.querySelector("h1"))?void 0:o.textContent.trim())?o:"".concat(t," Event History"),a=[],l=[],i=[],s=[],c=c.querySelectorAll("tr.Results-table-row"),Array.from(c).reverse().forEach(function(e){var t=e.getAttribute("data-parkrun"),t=(t&&a.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),l.push(t)),e.getAttribute("data-finishers")),t=(t&&i.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&s.push(parseInt(t,10))}),e.a(2,{eventName:t,title:o,eventNumbers:a,dates:l,finishers:i,volunteers:s});case 3:return e.p=3,c=e.v,console.error("Failed to fetch event history for ".concat(t,":"),c),e.a(2,null)}},e,null,[[0,3]])}))).apply(this,arguments)}function R(a){var l={};return a.dates.forEach(function(e,t){var e=new Date(e).getFullYear(),n=null!=(n=a.finishers[t])?n:0,r=null!=(r=a.volunteers[t])?r:0,o=a.eventNumbers[t],e=(l[e]||(l[e]={year:e,eventCount:0,totalFinishers:0,totalVolunteers:0,minFinishers:null,maxFinishers:null,minVolunteers:null,maxVolunteers:null}),l[e]);e.eventCount++,e.totalFinishers+=n,e.totalVolunteers+=r,(null===e.minFinishers||n<e.minFinishers.value)&&(e.minFinishers={value:n,date:a.dates[t],eventNumber:o}),(null===e.maxFinishers||n>e.maxFinishers.value)&&(e.maxFinishers={value:n,date:a.dates[t],eventNumber:o}),(null===e.minVolunteers||r<e.minVolunteers.value)&&(e.minVolunteers={value:r,date:a.dates[t],eventNumber:o}),(null===e.maxVolunteers||r>e.maxVolunteers.value)&&(e.maxVolunteers={value:r,date:a.dates[t],eventNumber:o})}),Object.keys(l).map(Number).sort(function(e,t){return e-t}).map(function(e){var t=l[e];return{year:e,eventCount:t.eventCount,totalFinishers:t.totalFinishers,totalVolunteers:t.totalVolunteers,avgFinishers:Math.round(t.totalFinishers/t.eventCount),avgVolunteers:Math.round(t.totalVolunteers/t.eventCount),minFinishers:t.minFinishers,maxFinishers:t.maxFinishers,minVolunteers:t.minVolunteers,maxVolunteers:t.maxVolunteers,finishersGrowth:null,volunteersGrowth:null}}).map(function(e,t,n){return 0===t?e:(t=(n=n[t-1]).avgFinishers?(e.avgFinishers-n.avgFinishers)/n.avgFinishers*100:null,n=n.avgVolunteers?(e.avgVolunteers-n.avgVolunteers)/n.avgVolunteers*100:null,T(T({},e),{},{finishersGrowth:t,volunteersGrowth:n}))})}function m(e){return e?e.value.toLocaleString():"-"}function h(e){var t,n;return null===e||Number.isNaN(e)?"-":(t=0<e?"+":"",n=0<e?"#53BA9D":e<0?"#ff6b6b":w.subtleTextColor,'<span style="color: '.concat(n,';">').concat(t).concat(e.toFixed(1),"%</span>"))}function L(o){var e=document.createElement("div"),t=(e.style.marginBottom="15px",e.style.padding="10px",e.style.backgroundColor=w.backgroundColor,e.style.borderRadius="6px",e.style.display="flex",e.style.alignItems="center",e.style.gap="10px",e.style.flexWrap="wrap",document.createElement("span")),a=(t.textContent="Compare with:",t.style.color=w.textColor,t.style.fontWeight="bold",e.appendChild(t),document.createElement("select")),t=(a.style.padding="6px 12px",a.style.backgroundColor="#3a3250",a.style.color=w.textColor,a.style.border="1px solid ".concat(w.gridColor),a.style.borderRadius="4px",a.style.cursor="pointer",document.createElement("option")),l=(t.value="",t.textContent="-- Select parkrun --",a.appendChild(t),o.forEach(function(e){var t=document.createElement("option");t.value=e.properties.eventname,t.textContent="".concat(e.properties.EventShortName," (").concat(e.distance.toFixed(1),"km)"),a.appendChild(t)}),document.createElement("button"));return l.textContent="+ Add",l.style.padding="6px 12px",l.style.backgroundColor=w.lineColor,l.style.color="#2b223d",l.style.border="none",l.style.borderRadius="4px",l.style.cursor="pointer",l.style.fontWeight="bold",l.addEventListener("click",O(F().m(function e(){var t,n,r;return F().w(function(e){for(;;)switch(e.n){case 0:if(t=a.value){e.n=1;break}return e.a(2);case 1:if(S.comparisonEvents.some(function(e){return e.eventName===t}))return alert("This parkrun is already selected for comparison"),e.a(2);e.n=2;break;case 2:return l.disabled=!0,l.textContent="Loading...",n=j(),e.n=3,function(){return i.apply(this,arguments)}(t,n.url);case 3:(n=e.v)?(r=o.find(function(e){return e.properties.eventname===t}),S.comparisonEvents.push(T(T({},n),{},{distance:null==r?void 0:r.distance})),W()):alert("Failed to fetch event history"),l.disabled=!1,l.textContent="+ Add",a.value="";case 4:return e.a(2)}},e)}))),e.appendChild(a),e.appendChild(l),e}function M(e,t){var n=R(e);if(0===n.length)return null;var e=document.createElement("div"),r=(e.className="tab-content",e.style.display=0===t?"block":"none",e.style.backgroundColor=w.backgroundColor,e.style.padding="15px",e.style.borderRadius="6px",document.createElement("div")),o=(r.style.overflowX="auto",document.createElement("table")),a=(o.className="annualSummaryTable",o.style.width="100%",o.style.borderCollapse="collapse",o.style.fontSize="14px",o.style.color=w.textColor,o.style.backgroundColor=w.backgroundColor,{key:"year",dir:"asc"}),l=[{key:"year",label:"Year",align:"left"},{key:"eventCount",label:"Events",align:"center"},{key:"totalFinishers",label:"Finishers Total",align:"right",color:w.barColor},{key:"minFinishers",label:"Finishers Min",align:"right",color:w.barColor},{key:"maxFinishers",label:"Finishers Max",align:"right",color:w.barColor},{key:"avgFinishers",label:"Finishers Avg",align:"right",color:w.barColor},{key:"finishersGrowth",label:"Finishers YoY",align:"right"},{key:"totalVolunteers",label:"Volunteers Total",align:"right",color:w.lineColor},{key:"minVolunteers",label:"Volunteers Min",align:"right",color:w.lineColor},{key:"maxVolunteers",label:"Volunteers Max",align:"right",color:w.lineColor},{key:"avgVolunteers",label:"Volunteers Avg",align:"right",color:w.lineColor},{key:"volunteersGrowth",label:"Volunteers YoY",align:"right"}],i=document.createElement("thead"),s=document.createElement("tr"),c=(s.style.borderBottom="2px solid ".concat(w.gridColor),l.forEach(function(e){var t=document.createElement("th");t.textContent=e.label,t.style.padding="10px",t.style.textAlign=e.align,t.style.cursor="pointer",e.color&&(t.style.color=e.color),t.addEventListener("click",function(){a.key===e.key?a.dir="asc"===a.dir?"desc":"asc":(a.key=e.key,a.dir="desc"),u()}),s.appendChild(t)}),i.appendChild(s),o.appendChild(i),document.createElement("tbody"));function u(){c.innerHTML="",A(n).sort(function(e,t){function n(e){return null==(e=e[r])?-1/0:"object"===p(e)&&void 0!==e.value?e.value:e}var r=a.key,o="asc"===a.dir?1:-1,e=n(e),t=n(t);return e===t?0:t<e?o:-o}).forEach(function(e){var t=document.createElement("tr");t.style.borderBottom="1px solid ".concat(w.gridColor),t.innerHTML='\n          <td style="padding: 10px; text-align: left; font-weight: bold;">'.concat(e.year,'</td>\n          <td style="padding: 10px; text-align: center;">').concat(e.eventCount,'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.barColor,';">').concat(e.totalFinishers.toLocaleString(),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.barColor,';">').concat(m(e.minFinishers),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.barColor,';">').concat(m(e.maxFinishers),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.barColor,';">').concat(e.avgFinishers,'</td>\n          <td style="padding: 10px; text-align: right;">').concat(h(e.finishersGrowth),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.lineColor,';">').concat(e.totalVolunteers.toLocaleString(),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.lineColor,';">').concat(m(e.minVolunteers),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.lineColor,';">').concat(m(e.maxVolunteers),'</td>\n          <td style="padding: 10px; text-align: right; color: ').concat(w.lineColor,';">').concat(e.avgVolunteers,'</td>\n          <td style="padding: 10px; text-align: right;">').concat(h(e.volunteersGrowth),"</td>\n        "),c.appendChild(t)})}o.appendChild(c),r.appendChild(o),e.appendChild(r),u();var l=document.createElement("div"),i=(l.style.display="grid",l.style.gridTemplateColumns="1fr 1fr",l.style.gap="20px",l.style.marginTop="20px",document.createElement("div")),o=(i.style.minWidth="0",document.createElement("canvas")),r=(o.className="annualTotalsChart-".concat(t),i.appendChild(o),document.createElement("div")),d=(r.style.minWidth="0",document.createElement("canvas"));return d.className="annualGrowthChart-".concat(t),r.appendChild(d),l.appendChild(i),l.appendChild(r),e.appendChild(l),"undefined"!=typeof Chart&&(t=o.getContext("2d"),i=d.getContext("2d"),r=n.map(function(e){return e.year.toString()}),new Chart(t,{type:"bar",data:{labels:r,datasets:[{label:"Total Finishers",data:n.map(function(e){return e.totalFinishers}),backgroundColor:w.barColor,borderColor:w.barColor,borderWidth:1},{label:"Total Volunteers",data:n.map(function(e){return e.totalVolunteers}),backgroundColor:w.lineColor,borderColor:w.lineColor,borderWidth:1}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.3,plugins:{legend:{labels:{color:w.textColor}},title:{display:!0,text:"Annual Totals",color:w.textColor}},scales:{x:{title:{display:!0,text:"Year",color:w.textColor},ticks:{color:w.subtleTextColor},grid:{color:w.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Participants",color:w.textColor},ticks:{precision:0,color:w.subtleTextColor},grid:{color:w.gridColor}}}}}),l=n.filter(function(e){return null!==e.finishersGrowth}),new Chart(i,{type:"line",data:{labels:l.map(function(e){return e.year.toString()}),datasets:[{label:"Finishers Growth",data:l.map(function(e){return e.finishersGrowth}),borderColor:w.barColor,backgroundColor:w.barColor,borderWidth:2,pointRadius:4,pointBackgroundColor:w.barColor,fill:!1,tension:.2},{label:"Volunteers Growth",data:l.map(function(e){return e.volunteersGrowth}),borderColor:w.lineColor,backgroundColor:w.lineColor,borderWidth:2,pointRadius:4,pointBackgroundColor:w.lineColor,fill:!1,tension:.2}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.3,plugins:{legend:{labels:{color:w.textColor}},title:{display:!0,text:"Year-over-Year Growth (%)",color:w.textColor}},scales:{x:{title:{display:!0,text:"Year",color:w.textColor},ticks:{color:w.subtleTextColor},grid:{color:w.gridColor}},y:{title:{display:!0,text:"Growth (%)",color:w.textColor},ticks:{color:w.subtleTextColor,callback:function(e){return e+"%"}},grid:{color:w.gridColor}}}}})),e}function G(e){var t=document.createElement("div");return t.style.minWidth="0",t.appendChild(e),t}function I(e,t,o,n,a,r,l){l=6<arguments.length&&void 0!==l&&l,n=n.map(function(e,t){var n=e.event,r=e.yearly,e=E[t%E.length],t=o.map(function(t){var e=r.find(function(e){return e.year===t});return e&&null!=(e=a(e))?e:null});return{label:n.title||n.eventName,data:t,borderColor:e,backgroundColor:e,borderWidth:2,pointRadius:4,pointBackgroundColor:e,fill:!1,tension:.2,spanGaps:!0}}),e=e.getContext("2d");new Chart(e,{type:"line",data:{labels:o.map(function(e){return e.toString()}),datasets:n},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.3,plugins:{legend:{labels:{color:w.textColor}},title:{display:!0,text:t,color:w.textColor}},scales:{x:{title:{display:!0,text:"Year",color:w.textColor},ticks:{color:w.subtleTextColor},grid:{color:w.gridColor}},y:{beginAtZero:!l,title:{display:!0,text:r,color:w.textColor},ticks:{precision:0,color:w.subtleTextColor,callback:l?function(e){return e+"%"}:void 0},grid:{color:w.gridColor}}}}})}function W(){var n,r,o,a,l,i,e,s,c,t,u,d,p,m,h,y,f,g,b,v,x=document.querySelector(".parkrun-annual-summary"),C=(x&&x.remove(),x=null!=(x=null==(x=document.querySelector("h1"))?void 0:x.textContent.trim())?x:"Event History",n=[],r=[],o=[],a=[],C=document.querySelectorAll("tr.Results-table-row"),Array.from(C).reverse().forEach(function(e){var t=e.getAttribute("data-parkrun"),t=(t&&n.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&o.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&a.push(parseInt(t,10))}),{title:x,eventNumbers:n,dates:r,finishers:o,volunteers:a});function k(){l.innerHTML="",[S.currentEvent].concat(A(S.comparisonEvents)).forEach(function(e,t){var n=document.createElement("div"),r=(n.style.display="inline-flex",n.style.alignItems="center",n.style.gap="6px",n.style.padding="4px 10px",n.style.backgroundColor=E[t%E.length],n.style.color="#2b223d",n.style.borderRadius="12px",n.style.fontSize="12px",n.style.fontWeight="bold",document.createElement("span"));r.textContent=e.title||e.eventName,n.appendChild(r),0<t&&((e=document.createElement("span")).textContent="Ã—",e.style.cursor="pointer",e.style.marginLeft="4px",e.style.fontSize="16px",e.addEventListener("click",function(){S.comparisonEvents.splice(t-1,1),W()}),n.appendChild(e)),l.appendChild(n)})}0===C.eventNumbers.length?console.log("No event history data found"):(S.currentEvent=T(T({},C),{},{eventName:j().eventName}),x=[S.currentEvent].concat(A(S.comparisonEvents)),(C=document.createElement("div")).className="parkrun-annual-summary",C.style.width="100%",C.style.maxWidth="1200px",C.style.margin="20px auto",C.style.padding="15px",C.style.backgroundColor=w.backgroundColor,C.style.borderRadius="8px",C.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",(t=document.createElement("h3")).textContent="Annual Participation Summary",t.style.textAlign="center",t.style.marginBottom="15px",t.style.color=w.barColor,C.appendChild(t),null===S.allParkruns?((t=document.createElement("div")).style.padding="10px",t.style.color=w.subtleTextColor,t.style.textAlign="center",t.style.fontSize="13px",t.textContent="Loading parkrun events for comparison...",C.appendChild(t)):0===S.allParkruns.length?((t=document.createElement("div")).style.padding="10px",t.style.color="#ff6b6b",t.style.textAlign="center",t.style.fontSize="13px",t.textContent="Failed to load parkrun events data. Check console for details.",C.appendChild(t),console.error("No parkrun events loaded. Expected data from https://images.parkrun.com/events.json")):0<(t=function(o,e,t){var n,a,l,i,s,c=2<arguments.length&&void 0!==t?t:50,t=e.find(function(e){return e.properties.eventname===o.eventName});return t?(n=N(t.geometry.coordinates,2),a=n[0],l=n[1],i=t.properties.countrycode,s=t.properties.seriesid,e.filter(function(e){var t,n,r;return e.properties.eventname!==o.eventName&&e.properties.countrycode===i&&e.properties.seriesid===s&&(t=(e=N(e.geometry.coordinates,2))[0],e=e[1],n=Math.abs(e-l),r=Math.abs(t-a),!(.5<n||.5<r))&&V(l,a,e,t)<=c}).map(function(e){var t=N(e.geometry.coordinates,2),n=t[0],t=V(l,a,t[1],n);return T(T({},e),{},{distance:t})}).sort(function(e,t){return e.distance-t.distance})):[]}(j(),S.allParkruns)).length?((t=L(t)).className="parkrun-comparison-selector-controls",C.appendChild(t)):((t=document.createElement("div")).style.padding="10px",t.style.color=w.subtleTextColor,t.style.textAlign="center",t.style.fontSize="13px",e=j(),t.textContent="No nearby parkruns found for comparison (within 50km of ".concat(e.eventName,")"),C.appendChild(t),console.log("Current event:",e.eventName,"Total parkruns loaded:",S.allParkruns.length)),0<S.comparisonEvents.length&&((l=document.createElement("div")).id="selectedEventsDisplay",l.style.display="flex",l.style.gap="8px",l.style.flexWrap="wrap",l.style.marginTop="10px",k(),t={container:l,updateDisplay:k},C.appendChild(t.container)),e=x,(t=document.createElement("div")).id="eventTabs",t.style.marginTop="15px",(s=document.createElement("div")).style.display="flex",s.style.gap="5px",s.style.borderBottom="2px solid ".concat(w.gridColor),s.style.marginBottom="15px",(c=document.createElement("div")).id="tabContents",e.forEach(function(e,n){var t=document.createElement("button");t.textContent=e.title||e.eventName,t.style.padding="10px 20px",t.style.backgroundColor=0===n?E[n%E.length]:"#3a3250",t.style.color=0===n?"#2b223d":w.textColor,t.style.border="none",t.style.borderRadius="6px 6px 0 0",t.style.cursor="pointer",t.style.fontWeight="bold",t.dataset.index=n,t.addEventListener("click",function(){s.querySelectorAll("button").forEach(function(e,t){e.style.backgroundColor=t===n?E[t%E.length]:"#3a3250",e.style.color=t===n?"#2b223d":w.textColor}),c.querySelectorAll(".tab-content").forEach(function(e,t){e.style.display=t===n?"block":"none"})}),s.appendChild(t)}),t.appendChild(s),t.appendChild(c),i=(t={tabsContainer:t,tabContents:c}).tabContents,C.appendChild(t.tabsContainer),x.forEach(function(e,t){e=M(e,t);e&&i.appendChild(e)}),1<x.length&&(m=(t=x).length<2?null:((x=document.createElement("div")).id="comparisonSection",x.style.marginTop="30px",x.style.padding="15px",x.style.backgroundColor=w.backgroundColor,x.style.borderRadius="8px",(u=document.createElement("h3")).textContent="Comparison Charts",u.style.textAlign="center",u.style.color=w.barColor,u.style.marginBottom="20px",x.appendChild(u),u=t.map(function(e){return{event:e,yearly:R(e)}}),d=new Set,u.forEach(function(e){e.yearly.forEach(function(e){return d.add(e.year)})}),t=Array.from(d).sort(function(e,t){return e-t}),(m=document.createElement("div")).style.display="grid",m.style.gridTemplateColumns="1fr 1fr",m.style.gap="20px",g=document.createElement("canvas"),m.appendChild(G(g)),b=document.createElement("canvas"),m.appendChild(G(b)),v=document.createElement("canvas"),m.appendChild(G(v)),p=document.createElement("canvas"),m.appendChild(G(p)),x.appendChild(m),(m=document.createElement("div")).style.display="flex",m.style.justifyContent="center",m.style.marginTop="20px",m.style.gap="10px",m.style.flexWrap="wrap",(h=document.createElement("button")).textContent="ðŸ“„ Export HTML",h.style.padding="8px 16px",h.style.backgroundColor=w.barColor,h.style.color="#1c1b2a",h.style.border="none",h.style.borderRadius="4px",h.style.cursor="pointer",h.style.fontWeight="bold",h.style.fontSize="14px",(y=document.createElement("button")).textContent="ðŸ“¤ Share Report",y.style.padding="8px 16px",y.style.backgroundColor=w.lineColor,y.style.color="#2b223d",y.style.border="none",y.style.borderRadius="4px",y.style.cursor="pointer",y.style.fontWeight="bold",y.style.fontSize="14px",f=function(){var t=j(),e=null==(e=S.allParkruns)?void 0:e.find(function(e){return e.properties.eventname===t.eventName}),e=(null==e||null==(e=e.properties)?void 0:e.EventShortName)||t.eventName,n=new Date,r=n.toISOString().split("T")[0];return{eventShortName:e,generatedAt:n.toLocaleString(),generatedAtISO:r}},h.addEventListener("click",O(F().m(function e(){var t,n,r,o,a,l,i;return F().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=h.textContent,n=h.style.display,h.textContent="Exporting...",h.disabled=!0,h.style.display="none",e.p=1,r=document.querySelector(".parkrun-annual-summary")){e.n=2;break}throw new Error("Report container not found");case 2:return o=f(),e.n=3,P(r,o);case 3:o=e.v,l=o.blob,i=o.filename,a=URL.createObjectURL(l),(l=document.createElement("a")).href=a,l.download=i,l.click(),setTimeout(function(){return URL.revokeObjectURL(a)},1e3),console.log("Annual summary HTML export complete"),e.n=5;break;case 4:e.p=4,i=e.v,console.error("Annual summary export failed:",i),alert("Error exporting HTML: "+i.message);case 5:return e.p=5,h.disabled=!1,h.textContent=t,h.style.display=n,e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}))),y.addEventListener("click",O(F().m(function e(){var t,n,r,o,a,l,i,s,c;return F().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=y.textContent,n=y.style.display,y.textContent="Sharing...",y.disabled=!0,y.style.display="none",e.p=1,r=document.querySelector(".parkrun-annual-summary")){e.n=2;break}throw new Error("Report container not found");case 2:return o=f(),e.n=3,P(r,o);case 3:if(l=e.v,a=l.blob,l=l.filename,s=new File([a],l,{type:"text/html"}),navigator.canShare&&navigator.canShare({files:[s]}))return e.n=4,navigator.share({title:"parkrun Annual Summary - ".concat(o.eventShortName),text:"Annual participation summary report",files:[s]});e.n=5;break;case 4:console.log("Annual summary shared via Web Share API"),e.n=6;break;case 5:i=URL.createObjectURL(a),(s=document.createElement("a")).href=i,s.download=l,s.click(),setTimeout(function(){return URL.revokeObjectURL(i)},1e3),alert("Sharing is not supported in this browser, so the HTML report was downloaded instead.");case 6:e.n=8;break;case 7:e.p=7,c=e.v,console.error("Annual summary share failed:",c),alert("Error sharing report: "+c.message);case 8:return e.p=8,y.disabled=!1,y.textContent=t,y.style.display=n,e.f(8);case 9:return e.a(2)}},e,null,[[1,7,8,9]])}))),m.appendChild(h),m.appendChild(y),x.appendChild(m),"undefined"!=typeof Chart&&(I(g,"Annual Totals - Finishers",t,u,function(e){return e.totalFinishers},"Finishers"),I(b,"Annual Totals - Volunteers",t,u,function(e){return e.totalVolunteers},"Volunteers"),I(v,"YoY Growth - Finishers (%)",t,u,function(e){return e.finishersGrowth},"Growth (%)",!0),I(p,"YoY Growth - Volunteers (%)",t,u,function(e){return e.volunteersGrowth},"Growth (%)",!0)),x))&&C.appendChild(m),(g=document.getElementById("eventHistoryChart"))&&g.parentElement?g.parentElement.parentNode.insertBefore(C,g.parentElement.nextSibling):(b="h1",v=C,(b=document.querySelector(b))&&b.parentNode&&(b.nextSibling?b.parentNode.insertBefore(v,b.nextSibling):b.parentNode.appendChild(v))))}function c(){return(c=O(F().m(function e(){var t,n;return F().w(function(e){for(;;)switch(e.n){case 0:if(t=document.querySelector(".Results-table"),n=window.location.href,n=n.includes("/eventhistory/"),t&&n){e.n=1;break}return e.a(2);case 1:return e.n=2,function(){return a.apply(this,arguments)}();case 2:S.allParkruns=e.v,document.getElementById("annualSummaryTable")||document.getElementById("eventTabs")?console.log("Annual summary already exists, skipping render"):W();case 3:return e.a(2)}},e)}))).apply(this,arguments)}r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=r,n.onload=e,n.onerror=t,document.head.appendChild(n)}),w={backgroundColor:"#1c1b2a",barColor:"#f59e0b",lineColor:"#22d3ee",textColor:"#f3f4f6",subtleTextColor:"#d1d5db",gridColor:"rgba(243, 244, 246, 0.18)"},E=["#f59e0b","#22d3ee","#f97316","#10b981","#a855f7","#ef4444","#3b82f6","#84cc16"],S={currentEvent:null,comparisonEvents:[],allParkruns:null},function(){c.apply(this,arguments)}()})();
```

### parkrun Cancellation Impact

> Analyzes the impact of cancelled parkrun events on nearby alternatives


[parkrun-cancellation-impact.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-cancellation-impact.user.js)

```javascript
javascript:(async()=>{var r,k,v,i,g,w;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(){var g,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,a,l,s,i,c,d,u,p,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype);return b(t,"_invoke",(o=e,a=n,d=r||[],u=!1,p={p:c=0,n:0,v:g,a:h,f:h.bind(g,4),d:function(e,t){return l=e,s=0,i=g,p.n=t,y}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(u&&1===t&&h(t,n),s=t,i=n;(f=s<2?g:i)||!u;){l||(s?s<3?(1<s&&(p.n=-1),h(s,i)):p.n=i:p.v=i);try{if(c=2,l){if(f=l[e=s?e:"next"]){if(!(f=f.call(l,i)))throw TypeError("iterator result is not an object");if(!f.done)return f;i=f.value,s<2&&(s=0)}else 1===s&&(f=l.return)&&f.call(l),s<2&&(i=TypeError("The iterator does not provide a '"+e+"' method"),s=1);l=g}else if((f=(u=p.n<0)?i:o.call(a,p))!==y)break}catch(e){l=g,s=1,i=e}finally{c=1}}return{value:f,done:u}}),!0),t;function h(e,t){for(s=e,i=t,f=0;!u&&c&&!n&&f<d.length;f++){var n,r=d[f],o=p.p,a=r[2];3<e?(n=a===t)&&(i=r[(s=r[4])?5:s=3],r[4]=r[5]=g):r[0]<=o&&((n=e<2&&o<r[1])?(s=0,p.v=t,p.n=r[1]):o<a&&(n=e<3||r[0]>t||a<t)&&(r[4]=e,r[5]=t,p.n=a,s=0))}if(n||1<e)return y;throw u=!0,t}}var y={};function m(){}function o(){}function a(){}var f=Object.getPrototypeOf,e=[][t]?f(f([][t]())):(b(f={},t,function(){return this}),f),l=a.prototype=m.prototype=Object.create(e);function s(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,b(e,n,"GeneratorFunction")),e.prototype=Object.create(l),e}return b(l,"constructor",o.prototype=a),b(a,"constructor",o),b(a,n,o.displayName="GeneratorFunction"),b(l),b(l,n,"Generator"),b(l,t,function(){return this}),b(l,"toString",function(){return"[object Generator]"}),(S=function(){return{w:r,m:s}})()}function b(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(b=function(e,t,n,r){function o(t,n){b(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function E(e){return(e=>{if(Array.isArray(e))return o(e)})(e)||(e=>{if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)})(e)||n(e)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function d(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=(e=>(e=((e,t)=>{if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=a(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")})(e,"string"),"symbol"==a(e)?e:e+""))(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function u(e,t){return(e=>{if(Array.isArray(e))return e})(e)||((e,t)=>{var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,l,s=[],i=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{if(!i&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(c)throw o}}return s}})(e,t)||n(e,t)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function n(e,t){var n;if(e)return"string"==typeof e?o(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t,n,r,o,a,l){try{var s=e[a](l),i=s.value}catch(e){return n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function D(s){return function(){var e=this,l=arguments;return new Promise(function(t,n){var r=s.apply(e,l);function o(e){c(r,t,n,o,a,"next",e)}function a(e){c(r,t,n,o,a,"throw",e)}o(void 0)})}}function C(e){return new Date("".concat(e,"T00:00:00Z"))}function p(e,t){e=document.querySelector(e);e&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))}function l(){return(l=D(S().m(function e(){var t,n,r,o,a,l;return S().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t="parkrun_events_cache",e.p=1,a=localStorage.getItem(t)){if(e.p=2,a=JSON.parse(a),r=a.data,a=a.timestamp,(a=Date.now()-a)<g)return console.log("Using cached parkrun events (".concat(Math.round(a/1e3/60)," minutes old)")),e.a(2,r);e.n=3}else e.n=5;break;case 3:e.n=5;break;case 4:e.p=4,a=e.v,console.log("Cache parse error, fetching fresh data",a);case 5:return console.log("Fetching parkrun events from https://images.parkrun.com/events.json"),e.n=6,fetch("https://images.parkrun.com/events.json");case 6:if((n=e.v).ok){e.n=7;break}return console.error("Fetch failed with status:",n.status),e.a(2,[]);case 7:return e.n=8,n.json();case 8:if(r=e.v,(o=(null==(o=r.events)?void 0:o.features)||r.features||[])&&0!==o.length){e.n=9;break}return console.error("No features found in response data"),e.a(2,[]);case 9:try{localStorage.setItem(t,JSON.stringify({data:o,timestamp:Date.now()}))}catch(e){console.warn("Failed to cache parkrun events:",e)}return console.log("Successfully loaded",o.length,"parkrun events"),e.a(2,o);case 10:return e.p=10,l=e.v,console.error("Failed to fetch parkruns:",l),e.a(2,[])}},e,null,[[2,4],[1,10]])}))).apply(this,arguments)}function T(){return{eventName:window.location.pathname.split("/")[1],domain:window.location.hostname,url:window.location.origin}}function h(e,t,n,r){var o=(n-e)*Math.PI/180,r=(r-t)*Math.PI/180,t=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))}function A(t,e,n){for(var r=2<arguments.length&&void 0!==n?n:i,o=C(e.toISOString().split("T")[0]),a=[],l=t.rawDates.length-1;0<=l;l--){var s=C(t.rawDates[l]);if(s<o&&(a.push(l),r<=a.length))break}a.reverse();n={dates:a.map(function(e){return t.dates[e]}),finishers:a.map(function(e){return t.finishers[e]}),volunteers:a.map(function(e){return t.volunteers[e]})},e=(e=>{var t,n;return 0===e.dates.length?{avgFinishers:0,avgVolunteers:0,totalEvents:0,minFinishers:0,maxFinishers:0,minVolunteers:0,maxVolunteers:0}:(t=Math.round(e.finishers.reduce(function(e,t){return e+t},0)/e.dates.length),n=Math.round(e.volunteers.reduce(function(e,t){return e+t},0)/e.dates.length),{avgFinishers:t,avgVolunteers:n,totalEvents:e.dates.length,minFinishers:Math.min.apply(Math,E(e.finishers)),maxFinishers:Math.max.apply(Math,E(e.finishers)),minVolunteers:Math.min.apply(Math,E(e.volunteers)),maxVolunteers:Math.max.apply(Math,E(e.volunteers))})})(n);return{filtered:n,window:0<a.length?{start:C(t.rawDates[a[0]]),end:C(t.rawDates[a[a.length-1]])}:{start:new Date(o),end:new Date(o)},baseline:e}}function x(){return(x=D(S().m(function e(t,n){var r,o,a,l,s,i,c,d,u,p,h;return S().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r="parkrun_history_".concat(t),e.p=1,p=localStorage.getItem(r)){if(e.p=2,p=JSON.parse(p),o=p.data,p=p.timestamp,(p=Date.now()-p)<g)return console.log("Using cached history for ".concat(t," (").concat(Math.round(p/1e3/60)," minutes old)")),e.a(2,o);e.n=3}else e.n=5;break;case 3:e.n=5;break;case 4:e.p=4,p=e.v,console.log("Cache parse error for ".concat(t,", fetching fresh data"),p);case 5:return o="".concat(n,"/").concat(t,"/results/eventhistory/"),e.n=6,fetch(o);case 6:return a=e.v,e.n=7,a.text();case 7:a=e.v,u=new DOMParser,u=u.parseFromString(a,"text/html"),h=null!=(h=null==(h=u.querySelector("h1"))?void 0:h.textContent.trim())?h:t,l=[],s=[],i=[],c=[],d=[],u=u.querySelectorAll("tr.Results-table-row"),Array.from(u).reverse().forEach(function(e){var t=e.getAttribute("data-parkrun"),t=(t&&l.push(t),e.getAttribute("data-date")),t=(t&&(i.push(t),t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),s.push(t)),e.getAttribute("data-finishers")),t=(t&&c.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&d.push(parseInt(t,10))}),u={eventName:t,title:h,eventNumbers:l,dates:s,rawDates:i,finishers:c,volunteers:d};try{localStorage.setItem(r,JSON.stringify({data:u,timestamp:Date.now()}))}catch(e){console.warn("Failed to cache history for ".concat(t,":"),e)}return e.a(2,u);case 8:return e.p=8,h=e.v,console.error("Failed to fetch event history for ".concat(t,":"),h),e.a(2,null)}},e,null,[[2,4],[1,8]])}))).apply(this,arguments)}function s(){return(s=D(S().m(function e(){var t,n,r,o,a,l,s,i;return S().w(function(e){for(;;)switch(e.n){case 0:if((t=document.querySelector(".parkrun-cancellation-impact"))&&t.remove(),0===(t=(()=>{var e=null!=(e=null==(e=document.querySelector("h1"))?void 0:e.textContent.trim())?e:"Event History",n=[],r=[],o=[],a=[],l=[],t=document.querySelectorAll("tr.Results-table-row");return Array.from(t).reverse().forEach(function(e){var t=e.getAttribute("data-parkrun"),t=(t&&n.push(t),e.getAttribute("data-date")),t=(t&&(o.push(t),t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&a.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{title:e,eventNumbers:n,dates:r,rawDates:o,finishers:a,volunteers:l}})()).eventNumbers.length)return console.log("No event history data found"),e.a(2);e.n=1;break;case 1:if(n=((e,t)=>{var n=e.rawDates.map(C);if(!(n.length<1)){for(var r=[],o=1;o<n.length;o++){var a=n[o-1],l=n[o],s=(l-a)/864e5;v<s&&r.push({gapStartDate:a,gapEndDate:l,daysDiff:s,eventsBefore:o,eventsAfter:n.length-o})}if(0<r.length)return e=r[r.length-1],console.log("Detected ".concat(r.length," gap(s); using latest: ").concat(e.daysDiff.toFixed(1)," days")),console.log("All gaps detected:",r),e;if(t&&1<=n.length){var e=n[n.length-1],t=t.toISOString().split("T")[0],i=C(t),c=(i-e)/864e5;if(v<c)return console.log("Detected ongoing gap: ".concat(c.toFixed(1)," days from last event to ").concat(t)),{gapStartDate:e,gapEndDate:i,daysDiff:c,eventsBefore:n.length,eventsAfter:0}}}return null})(t,new Date)){e.n=2;break}return console.log("No cancellation gap detected"),e.a(2);case 2:if(w.currentEvent=d(d({},t),{},{eventName:T().eventName}),w.gapInfo=n,r=T(),(o=document.createElement("div")).className="parkrun-cancellation-impact",o.style.width="100%",o.style.maxWidth="1200px",o.style.margin="20px auto",o.style.padding="15px",o.style.backgroundColor=k.backgroundColor,o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",w.allParkruns&&0!==w.allParkruns.length){e.n=3;break}return(a=document.createElement("div")).style.padding="10px",a.style.color=k.subtleTextColor,a.style.textAlign="center",a.textContent="Loading nearby parkruns...",o.appendChild(a),p("h1",o),e.a(2);case 3:if(w.nearbyParkruns=function(o,e,t){var n,a,l,s,i,c=2<arguments.length&&void 0!==t?t:50,t=e.find(function(e){return e.properties.eventname===o.eventName});return t?(n=u(t.geometry.coordinates,2),a=n[0],l=n[1],s=t.properties.countrycode,i=t.properties.seriesid,e.filter(function(e){var t,n,r;return e.properties.eventname!==o.eventName&&e.properties.countrycode===s&&e.properties.seriesid===i&&(t=(e=u(e.geometry.coordinates,2))[0],e=e[1],n=Math.abs(e-l),r=Math.abs(t-a),!(.5<n||.5<r))&&h(l,a,e,t)<=c}).map(function(e){var t=u(e.geometry.coordinates,2),n=t[0],t=h(l,a,t[1],n);return d(d({},e),{},{distance:t})}).sort(function(e,t){return e.distance-t.distance})):[]}(r,w.allParkruns),0===w.nearbyParkruns.length)return(a=document.createElement("div")).style.padding="10px",a.style.color=k.subtleTextColor,a.style.textAlign="center",a.textContent="No nearby parkruns found within 50km.",o.appendChild(a),p("h1",o),e.a(2);e.n=4;break;case 4:l=w.allParkruns.find(function(e){return e.properties.eventname===r.eventName}),l=(null==l||null==(l=l.properties)?void 0:l.EventShortName)||null,l=(e=>{var t=document.createElement("div"),n=(t.style.padding="20px",t.style.backgroundColor="#2b223d",t.style.borderRadius="8px",t.style.marginBottom="20px",t.style.border="1px solid ".concat(k.gridColor),document.createElement("h3")),r=(n.textContent="Cancellation Impact Analysis",n.style.color=k.barColor,n.style.margin="0 0 15px 0",n.style.fontSize="20px",t.appendChild(n),(n=document.createElement("div")).style.fontSize="16px",n.style.color=k.textColor,n.style.marginBottom="15px",n.innerHTML='<strong style="color: '.concat(k.lineColor,';">').concat(e,"</strong>"),t.appendChild(n),(e=document.createElement("div")).style.fontSize="14px",e.style.lineHeight="1.8",e.style.color=k.subtleTextColor,e.style.marginBottom="18px",e.innerHTML="ðŸ“ Analyzing impact on nearby parkruns within 50km",t.appendChild(e),document.createElement("button"));return r.textContent="â–¶ Start Analysis",r.className="start-analysis-btn",r.style.padding="12px 24px",r.style.backgroundColor=k.lineColor,r.style.color="#1c1b2a",r.style.border="none",r.style.borderRadius="6px",r.style.cursor="pointer",r.style.fontWeight="bold",r.style.fontSize="14px",r.style.transition="all 0.2s",r.addEventListener("mouseenter",function(){r.style.backgroundColor="#0ea5e9",r.style.transform="translateY(-1px)"}),r.addEventListener("mouseleave",function(){r.style.backgroundColor=k.lineColor,r.style.transform="translateY(0)"}),t.appendChild(r),{section:t,startButton:r}})(l),s=l.section,i=l.startButton,o.appendChild(s),p("h1",o),i.addEventListener("click",function(){i.disabled=!0,i.textContent="Starting...",i.style.opacity="0.6",i.style.cursor="not-allowed";var e=(()=>{var e=document.createElement("div"),t=(e.className="parkrun-cancellation-progress",e.style.padding="15px",e.style.backgroundColor=k.backgroundColor,e.style.borderRadius="6px",e.style.marginBottom="15px",e.style.border="1px solid ".concat(k.gridColor),document.createElement("h4")),r=(t.textContent="Analyzing Nearby parkrun Impact",t.style.margin="0 0 12px 0",t.style.color=k.barColor,e.appendChild(t),(t=document.createElement("div")).style.width="100%",t.style.height="20px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",t.style.marginBottom="10px",t.style.overflow="hidden",document.createElement("div")),o=(r.style.width="0%",r.style.height="100%",r.style.backgroundColor=k.lineColor,r.style.transition="width 0.3s ease",t.appendChild(r),e.appendChild(t),document.createElement("div")),n=(o.style.fontSize="13px",o.style.color=k.subtleTextColor,o.style.marginBottom="12px",e.appendChild(o),document.createElement("div"));return n.style.fontSize="12px",n.style.color=k.lineColor,n.style.fontWeight="bold",n.style.marginBottom="10px",e.appendChild(n),(t=document.createElement("button")).textContent="Stop Analysis",t.style.padding="6px 12px",t.style.backgroundColor=k.alertColor,t.style.color=k.textColor,t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontWeight="bold",t.style.fontSize="12px",e.appendChild(t),{progressSection:e,updateProgress:function(e,t){var n=Math.round(e/t*100);r.style.width=n+"%",o.textContent="".concat(e,"/").concat(t," parkruns analyzed")},updateStatus:function(e){n.textContent=e},stop:t,hide:function(){e.style.display="none"}}})();s.insertAdjacentElement("afterend",e.progressSection),w.fetchController=new AbortController,function(){y.apply(this,arguments)}(e,o,s)});case 5:return e.a(2)}},e)}))).apply(this,arguments)}function y(){return(y=D(S().m(function e(t,n,r){var o,a,l,i,s,c,d,u,p,h,g,y,m,f,b;return S().w(function(e){for(;;)switch(e.p=e.n){case 0:o=T(),a=w.nearbyParkruns,s=((e,t)=>{var n=e.rawDates.map(C);if(n.length<1)return[];for(var r,o=[],a=1;a<n.length;a++){var l=n[a-1],s=n[a],i=(s-l)/864e5;v<i&&o.push({gapStartDate:l,gapEndDate:s,daysDiff:i,eventsBefore:a,eventsAfter:n.length-a})}return t&&1<=n.length&&(e=n[n.length-1],t=C(t.toISOString().split("T")[0]),v<(r=(t-e)/864e5))&&o.push({gapStartDate:e,gapEndDate:t,daysDiff:r,eventsBefore:n.length,eventsAfter:0}),console.log("Detected ".concat(o.length," total gap(s)")),o})(w.currentEvent,new Date),l=[],s.forEach(function(e){e=((e,t)=>{var n=[],r=(6-(e=C(e.toISOString().split("T")[0])).getUTCDay())%7,o=(0===r&&(r=7),new Date(e));for(o.setUTCDate(o.getUTCDate()+r);o<t;)n.push(new Date(o)),o.setUTCDate(o.getUTCDate()+7);return n})(e.gapStartDate,e.gapEndDate);l.push.apply(l,E(e))}),l.sort(function(e,t){return t-e}),w.cancellationDates=l,console.log("All Cancellation Saturdays:",l),i=[],s=0;case 1:if(s<a.length){if(w.fetchController.signal.aborted)return console.log("Analysis stopped by user"),e.a(3,8);e.n=2}else e.n=8;break;case 2:return c=a[s],d=c.properties.eventname,u=c.properties.EventShortName||d,p=c.distance.toFixed(1),t.updateStatus("Fetching: ".concat(u," (").concat(p,"km)")),t.updateProgress(s,a.length),e.p=3,e.n=4,function(){return x.apply(this,arguments)}(d,o.url);case 4:(b=e.v)&&i.push({parkrun:c,historyData:b,shortName:u,distance:p}),e.n=6;break;case 5:e.p=5,b=e.v,console.error("Failed to fetch ".concat(d,":"),b);case 6:return e.n=7,new Promise(function(e){return setTimeout(e,100)});case 7:s++,e.n=1;break;case 8:if(h={},g=[],l.forEach(function(l){var e=l.toISOString().split("T")[0],s=[];i.forEach(function(e){var t=e.parkrun,n=e.historyData,r=e.shortName,e=e.distance,o=A(n,l),a=((e,t)=>{for(var n=t.toISOString().split("T")[0],r=0;r<e.rawDates.length;r++)if(e.rawDates[r]===n)return{date:e.dates[r],eventNumber:e.eventNumbers[r],finishers:e.finishers[r],volunteers:e.volunteers[r]};return null})(n,l);s.push({eventName:t.properties.eventname,title:n.title,displayName:r,distance:e,baseline:o.baseline,eventOnDate:a,seasonalTrend:o,change:a?{finishersChange:a.finishers-o.baseline.avgFinishers,volunteersChange:a.volunteers-o.baseline.avgVolunteers,finishersPct:0<o.baseline.avgFinishers?(a.finishers-o.baseline.avgFinishers)/o.baseline.avgFinishers*100:0,volunteersPct:0<o.baseline.avgVolunteers?(a.volunteers-o.baseline.avgVolunteers)/o.baseline.avgVolunteers*100:0}:null})}),1<=s.filter(function(e){return e.eventOnDate}).length?(h[e]=s,g.push(l)):console.log("Skipping ".concat(e,": 0/").concat(s.length," parkruns ran (global cancellation)"))}),y=0<g.length?g:l,t.updateProgress(a.length,a.length),0===g.length)return t.updateStatus("No valid cancellation dates found - all detected dates had global cancellations"),t.stop.textContent="Close",t.stop.style.backgroundColor=k.alertColor,(m=document.createElement("div")).style.padding="15px",m.style.backgroundColor="#3a3250",m.style.borderRadius="6px",m.style.marginTop="15px",m.style.color=k.textColor,m.style.textAlign="center",m.innerHTML='\n        <h3 style="color: '.concat(k.alertColor,'; margin: 0 0 10px 0;">âš  No Valid Analysis Dates</h3>\n        <p style="margin: 0 0 8px 0;">All detected cancellation dates appear to be part of global cancellation periods (e.g., COVID-19).</p>\n        <p style="margin: 0; color: ').concat(k.subtleTextColor,'; font-size: 13px;">\n          No nearby parkruns held events on these dates, indicating system-wide cancellations rather than single-event cancellations.\n        </p>\n      '),n.appendChild(m),t.stop.addEventListener("click",function(){t.hide()}),e.a(2);e.n=9;break;case 9:t.updateStatus("Analysis complete! Found ".concat(g.length," valid cancellation date(s)")),(m=document.querySelector(".start-analysis-btn"))&&(m.style.display="none"),t.stop.textContent="Close",t.stop.style.backgroundColor=k.successColor,w.resultsByDate=h,w.cancellationDates=y,w.analysisComplete=!0,-1===w.currentCancellationIndex&&0<y.length&&(w.currentCancellationIndex=0),f=((r,o,a,l)=>{var e=document.createElement("div"),t=(e.className="parkrun-cancellation-nav",e.style.padding="15px",e.style.backgroundColor="#2b223d",e.style.borderRadius="8px",e.style.marginBottom="20px",e.style.border="1px solid ".concat(k.gridColor),document.createElement("div"));t.style.color=k.textColor,t.style.fontSize="14px",t.style.marginBottom="12px",t.innerHTML="\n      <strong>".concat(a.length," Cancellation Date").concat(1!==a.length?"s":"",' Available</strong>\n      <div style="color: ').concat(k.subtleTextColor,'; font-size: 12px; margin-top: 4px;">\n        Use dropdown or buttons to navigate â€¢ Keyboard: <kbd style="background: #3a3250; padding: 2px 6px; border-radius: 3px; font-family: monospace; border: 1px solid ').concat(k.gridColor,';">â†</kbd> <kbd style="background: #3a3250; padding: 2px 6px; border-radius: 3px; font-family: monospace; border: 1px solid ').concat(k.gridColor,';">â†’</kbd>\n      </div>\n    '),e.appendChild(t);(t=document.createElement("div")).style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.flexWrap="wrap";var n=document.createElement("button"),s=(n.textContent="â†",n.style.padding="6px 10px",l<a.length-1),i=(n.style.backgroundColor=s?k.lineColor:"#3a3250",n.style.color=s?"#2b223d":k.subtleTextColor,n.style.border="1px solid ".concat(k.gridColor),n.style.borderRadius="4px",n.style.cursor=s?"pointer":"not-allowed",n.style.fontWeight="bold",n.style.fontSize="14px",n.style.transition="all 0.2s ease",n.disabled=!s,s&&(n.addEventListener("mouseenter",function(){n.style.transform="translateY(-1px)",n.style.boxShadow="0 2px 4px rgba(34, 211, 238, 0.3)"}),n.addEventListener("mouseleave",function(){n.style.transform="translateY(0)",n.style.boxShadow="none"})),document.createElement("select")),c=(i.style.padding="6px 8px",i.style.backgroundColor="#3a3250",i.style.color=k.textColor,i.style.border="1px solid ".concat(k.gridColor),i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.fontSize="12px",i.style.minWidth="220px",i.style.flex="1",a.forEach(function(e,t){var n=document.createElement("option"),e=e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"});n.value=t,n.textContent=e,n.selected=t===l,i.appendChild(n)}),document.createElement("button")),s=(c.textContent="â†’",c.style.padding="6px 10px",0<l);function d(){var e,t,n=r.querySelector(".parkrun-cancellation-results");n&&n.remove(),L(r,o,a,w.currentCancellationIndex),(n=r.querySelector(".parkrun-cancellation-nav"))&&((e=n.querySelectorAll("select"))[0]&&(e[0].value=w.currentCancellationIndex),n=(e=n.querySelectorAll("button"))[0],e=e[1],n&&(t=w.currentCancellationIndex<a.length-1,n.disabled=!t,n.style.backgroundColor=t?k.lineColor:"#3a3250",n.style.color=t?"#2b223d":k.subtleTextColor,n.style.cursor=t?"pointer":"not-allowed"),e)&&(n=0<w.currentCancellationIndex,e.disabled=!n,e.style.backgroundColor=n?k.lineColor:"#3a3250",e.style.color=n?"#2b223d":k.subtleTextColor,e.style.cursor=n?"pointer":"not-allowed")}function u(){w.currentCancellationIndex<a.length-1&&(w.currentCancellationIndex+=1,d())}function p(){0<w.currentCancellationIndex&&(--w.currentCancellationIndex,d())}return c.style.backgroundColor=s?k.lineColor:"#3a3250",c.style.color=s?"#2b223d":k.subtleTextColor,c.style.border="1px solid ".concat(k.gridColor),c.style.borderRadius="4px",c.style.cursor=s?"pointer":"not-allowed",c.style.fontWeight="bold",c.style.fontSize="14px",c.style.transition="all 0.2s ease",c.disabled=!s,s&&(c.addEventListener("mouseenter",function(){c.style.transform="translateY(-1px)",c.style.boxShadow="0 2px 4px rgba(34, 211, 238, 0.3)"}),c.addEventListener("mouseleave",function(){c.style.transform="translateY(0)",c.style.boxShadow="none"})),t.appendChild(n),t.appendChild(i),t.appendChild(c),e.appendChild(t),n.addEventListener("click",u),c.addEventListener("click",p),i.addEventListener("change",function(e){w.currentCancellationIndex=parseInt(e.target.value,10),d()}),w.keyboardHandler&&document.removeEventListener("keydown",w.keyboardHandler),w.keyboardHandler=function(e){"ArrowLeft"===e.key&&u(),"ArrowRight"===e.key&&p()},document.addEventListener("keydown",w.keyboardHandler),e})(n,h,y,w.currentCancellationIndex),r.insertAdjacentElement("afterend",f),L(n,h,y,w.currentCancellationIndex),setTimeout(function(){t.hide()},500),t.stop.addEventListener("click",function(){t.hide()});case 10:return e.a(2)}},e,null,[[3,5]])}))).apply(this,arguments)}function N(e,t,n){function r(e){switch(t){case"name":return e.displayName||e.eventName;case"distance":return parseFloat(e.distance);case"eventNumber":return e.eventOnDate?parseInt(e.eventOnDate.eventNumber,10):-1;case"baseline":return e.baseline.avgFinishers;case"onDate":return e.eventOnDate?e.eventOnDate.finishers:-1;case"change":return e.change?e.change.finishersChange:-999999;case"changePct":return e.change?e.change.finishersPct:-999999;default:return 0}}e=E(e);return e.sort(function(e,t){e=r(e),t=r(t);return"asc"===n?e-t:t-e}),e}function m(){return(m=D(S().m(function e(t,n){var r,o,a,l;return S().w(function(e){for(;;)if(0===e.n)return r=t.cloneNode(!0),a=t.querySelectorAll("canvas"),o=r.querySelectorAll("canvas"),a.forEach(function(e,t){try{var n=e.toDataURL("image/png"),r=document.createElement("img");r.src=n,r.alt="Chart snapshot",r.style.maxWidth="100%",r.style.display="block",r.style.backgroundColor="#2b223d",o[t]&&o[t].replaceWith(r)}catch(e){console.error("Failed to serialize chart canvas:",e)}}),a="\n      :root { color-scheme: dark; }\n      body { margin: 0; padding: 20px; background: ".concat(k.backgroundColor,"; color: ").concat(k.textColor,'; font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; line-height: 1.5; }\n      a { color: ').concat(k.lineColor,"; }\n      h1, h2, h3, h4 { color: ").concat(k.barColor,"; margin: 0 0 10px 0; }\n      table { width: 100%; border-collapse: collapse; }\n      th, td { border: 1px solid ").concat(k.gridColor,"; padding: 10px; text-align: left; }\n      th { background: #2b223d; color: ").concat(k.barColor,"; }\n      tr:nth-child(even) td { background: #241c35; }\n      tr:nth-child(odd) td { background: #1f182e; }\n      .parkrun-cancellation-results { background: ").concat(k.backgroundColor,"; padding: 16px; border-radius: 6px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25); }\n      .chart-img { max-width: 100%; display: block; }\n      .meta { margin-bottom: 16px; color: ").concat(k.subtleTextColor,"; font-size: 13px; }\n      .meta strong { color: ").concat(k.textColor,"; }\n    "),l='\n      <header>\n        <h1>parkrun Cancellation Impact</h1>\n        <div class="meta">\n          <div><strong>Event:</strong> '.concat(n.eventShortName,"</div>\n          <div><strong>Cancelled date:</strong> ").concat(n.cancellationDateStr,"</div>\n          <div><strong>Generated:</strong> ").concat(n.generatedAt,"</div>\n        </div>\n      </header>\n    "),e.a(2,'<!DOCTYPE html><html><head><meta charset="UTF-8"><title>parkrun Cancellation Impact - '.concat(n.eventShortName," - ").concat(n.cancellationDateStr,"</title><style>").concat(a,"</style></head><body>").concat(l).concat(r.outerHTML,"</body></html>"))},e)}))).apply(this,arguments)}function O(){return e.apply(this,arguments)}function e(){return(e=D(S().m(function e(t,n){var r,o;return S().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,function(){return m.apply(this,arguments)}(t,n);case 1:return r=e.v,o="parkrun-cancellation-impact-".concat(n.eventShortName,"-").concat(n.cancellationDateStr,".html"),e.a(2,{blob:new Blob([r],{type:"text/html"}),filename:o})}},e)}))).apply(this,arguments)}function L(e,t,n,r){function o(e){var t=p.querySelector("tbody"),c=(t&&t.remove(),document.createElement("tbody"));e.forEach(function(e){var t,n,r=document.createElement("tr"),o=(r.style.borderBottom="1px solid ".concat(k.gridColor),r.style.transition="background-color 0.15s ease",null!==e.eventOnDate),a=(o||(r.style.opacity="0.6"),r.addEventListener("mouseenter",function(){r.style.backgroundColor=o?"rgba(34, 211, 238, 0.08)":"rgba(243, 244, 246, 0.03)"}),r.addEventListener("mouseleave",function(){r.style.backgroundColor="transparent"}),document.createElement("td")),l=(a.style.padding="10px",a.style.textAlign="left",a.style.fontWeight="bold",document.createElement("a")),a=(l.href="".concat(T().url,"/").concat(e.eventName,"/results/eventhistory/"),l.textContent=e.displayName||e.eventName,l.style.color=k.lineColor,l.style.textDecoration="none",l.target="_blank",l.addEventListener("mouseenter",function(){l.style.textDecoration="underline"}),l.addEventListener("mouseleave",function(){l.style.textDecoration="none"}),a.appendChild(l),r.appendChild(a),document.createElement("td")),a=(a.style.padding="10px",a.style.textAlign="right",a.style.color=k.subtleTextColor,a.textContent="".concat(e.distance,"km"),r.appendChild(a),document.createElement("td")),a=(a.style.padding="10px",a.style.textAlign="right",e.eventOnDate&&e.eventOnDate.eventNumber?(a.textContent=e.eventOnDate.eventNumber,a.style.color=k.textColor):(a.textContent="â€”",a.style.color=k.subtleTextColor),r.appendChild(a),document.createElement("td")),a=(a.style.padding="10px",a.style.textAlign="right",a.innerHTML="<strong>".concat(e.baseline.avgFinishers,"</strong> / ").concat(e.baseline.avgVolunteers),r.appendChild(a),document.createElement("td")),a=(a.style.padding="10px",a.style.textAlign="right",e.eventOnDate?a.innerHTML="<strong>".concat(e.eventOnDate.finishers,"</strong> / ").concat(e.eventOnDate.volunteers):(a.textContent="â€”",a.style.color=k.subtleTextColor),r.appendChild(a),document.createElement("td")),s=(a.style.padding="10px",a.style.textAlign="right",e.change?(t=0<e.change.finishersChange?"+":"",i=0<e.change.volunteersChange?"+":"",s=0<e.change.finishersChange?k.successColor:k.alertColor,n=0<e.change.volunteersChange?k.successColor:k.alertColor,a.innerHTML='\n          <span style="color: '.concat(s,';">').concat(t).concat(e.change.finishersChange,'</span> /\n          <span style="color: ').concat(n,';">').concat(i).concat(e.change.volunteersChange,"</span>\n        ")):(a.textContent="â€”",a.style.color=k.subtleTextColor),r.appendChild(a),document.createElement("td")),i=(s.style.padding="10px",s.style.textAlign="right",e.change?(t=0<e.change.finishersPct?k.successColor:k.alertColor,n=0<e.change.finishersPct?"+":"",s.innerHTML='<span style="color: '.concat(t,';">').concat(n).concat(e.change.finishersPct.toFixed(1),"%</span>")):(s.textContent="â€”",s.style.color=k.subtleTextColor),r.appendChild(s),document.createElement("td"));i.style.padding="10px",i.style.textAlign="right",e.eventOnDate?e.change.finishersChange<-5?(i.textContent="â†“ Loss",i.style.color=k.alertColor):5<e.change.finishersChange?(i.textContent="â†‘ Gain",i.style.color=k.successColor):(i.textContent="â†’ Stable",i.style.color=k.subtleTextColor):(i.textContent="No Event",i.style.color=k.subtleTextColor),r.appendChild(i),c.appendChild(r)}),p.appendChild(c)}function d(){var t=T(),e=w.allParkruns.find(function(e){return e.properties.eventname===t.eventName});return{eventShortName:(null==e||null==(e=e.properties)?void 0:e.EventShortName)||t.eventName,cancellationDateStr:a.toISOString().split("T")[0]}}var l,a=n[r],s=t[a.toISOString().split("T")[0]]||[],i=a.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),u=document.createElement("div"),n=(u.className="parkrun-cancellation-results",u.style.marginTop="20px",document.createElement("h3")),r=(n.textContent="Nearby parkrun Impact on ".concat(i),n.style.color=k.barColor,n.style.marginTop="20px",n.style.marginBottom="12px",u.appendChild(n),document.createElement("div")),p=(r.style.overflowX="auto",document.createElement("table")),t=(p.style.width="100%",p.style.borderCollapse="collapse",p.style.fontSize="13px",p.style.color=k.textColor,document.createElement("thead")),c=(t.style.position="sticky",t.style.top="0",t.style.backgroundColor="#2b223d",t.style.zIndex="10",document.createElement("tr")),h=(c.style.borderBottom="2px solid ".concat(k.gridColor),[{label:"parkrun",key:"name",align:"left",info:"Click column headers to sort. Default ordering is by distance."},{label:"Distance",key:"distance",align:"right",info:"Distance from cancelled event in kilometers."},{label:"Event #",key:"eventNumber",align:"right",info:"Event number on ".concat(i,". Lower numbers indicate newer parkruns.")},{label:"Baseline (Avg)",key:"baseline",align:"right",info:"12-event baseline average (finishers/volunteers) for events before ".concat(i,".")},{label:"On Date",key:"onDate",align:"right",info:"Actual attendance (finishers/volunteers) on ".concat(i,".")},{label:"Change",key:"change",align:"right",info:"Difference between actual and baseline (finishers/volunteers)."},{label:"Change %",key:"changePct",align:"right",info:"Percentage change in finishers compared to baseline."},{label:"Trend",key:"trend",align:"right",info:"Gain (+5 or more finishers), Loss (-5 or fewer), Stable (within Â±5), or No Event."}]),n=(h.forEach(function(t){var e=document.createElement("th"),n=(e.style.padding="10px",e.style.textAlign=t.align,e.style.color=k.barColor,e.style.fontWeight="bold",e.style.cursor="pointer",e.style.userSelect="none",e.style.position="relative",e.style.transition="background-color 0.15s ease",e.addEventListener("mouseenter",function(){e.style.backgroundColor="rgba(34, 211, 238, 0.1)"}),e.addEventListener("mouseleave",function(){e.style.backgroundColor="transparent"}),document.createElement("span")),n=(n.textContent=t.label,n.style.marginRight="4px",e.appendChild(n),document.createElement("span")),r=(n.style.fontSize="10px",n.style.opacity=w.sortColumn===t.key?"1":"0.3",n.textContent=w.sortColumn!==t.key||"asc"===w.sortDirection?"â–²":"â–¼",e.appendChild(n),document.createElement("span"));r.textContent=" â„¹",r.style.fontSize="12px",r.style.opacity="0.6",r.style.cursor="help",r.style.transition="opacity 0.2s ease",r.title=t.info,r.addEventListener("mouseenter",function(){r.style.opacity="1"}),r.addEventListener("mouseleave",function(){r.style.opacity="0.6"}),e.appendChild(r),e.addEventListener("click",function(){w.sortColumn===t.key?w.sortDirection="asc"===w.sortDirection?"desc":"asc":(w.sortColumn=t.key,w.sortDirection="asc");var e=N(s,w.sortColumn,w.sortDirection);o(e),h.forEach(function(e,t){t=c.children[t].children[1];e.key===w.sortColumn?(t.style.opacity="1",t.textContent="asc"===w.sortDirection?"â–²":"â–¼"):(t.style.opacity="0.3",t.textContent="â–²")})}),c.appendChild(e)}),t.appendChild(c),p.appendChild(t),N(s,w.sortColumn,w.sortDirection)),g=(o(n),r.appendChild(p),u.appendChild(r),A(w.currentEvent,a)),t=document.createElement("div"),n=(t.style.marginTop="16px",t.style.padding="12px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",document.createElement("h3")),r=(n.textContent="Cancelled Event Seasonal Trend",n.style.color=k.barColor,n.style.margin="0 0 8px 0",t.appendChild(n),document.createElement("div")),n=g.window.start.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),y=g.window.end.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),n=(r.style.color=k.textColor,r.style.fontSize="13px",r.style.marginBottom="6px",r.innerHTML="Window: ".concat(n," â†’ ").concat(y," (12-event baseline)"),t.appendChild(r),document.createElement("div")),n=(n.style.color=k.textColor,n.style.fontSize="13px",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fit, minmax(200px, 1fr))",n.style.gap="8px",n.innerHTML="\n      <div>Average finishers: <strong>".concat(g.baseline.avgFinishers,"</strong></div>\n      <div>Min finishers: <strong>").concat(g.baseline.minFinishers,"</strong></div>\n      <div>Max finishers: <strong>").concat(g.baseline.maxFinishers,"</strong></div>\n      <div>Average volunteers: <strong>").concat(g.baseline.avgVolunteers,"</strong></div>\n      <div>Min volunteers: <strong>").concat(g.baseline.minVolunteers,"</strong></div>\n      <div>Max volunteers: <strong>").concat(g.baseline.maxVolunteers,"</strong></div>\n      <div>Total events: <strong>").concat(g.baseline.totalEvents,"</strong></div>\n    "),t.appendChild(n),"undefined"!=typeof Chart&&g.filtered.finishers&&0<g.filtered.finishers.length?((y=document.createElement("canvas")).style.marginTop="12px",t.appendChild(y),new Chart(y.getContext("2d"),{type:"line",data:{labels:g.filtered.dates,datasets:[{label:"Finishers",data:g.filtered.finishers,borderColor:k.lineColor,backgroundColor:"rgba(34, 211, 238, 0.25)",tension:.2,fill:!0},{label:"Volunteers",data:g.filtered.volunteers,borderColor:k.successColor,backgroundColor:"rgba(16, 185, 129, 0.18)",tension:.2,fill:!0},{label:"Finishers baseline avg",data:g.filtered.dates.map(function(){return g.baseline.avgFinishers}),borderColor:k.barColor,borderDash:[6,4],pointRadius:0},{label:"Volunteers baseline avg",data:g.filtered.dates.map(function(){return g.baseline.avgVolunteers}),borderColor:k.gridColor,borderDash:[6,4],pointRadius:0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.6,plugins:{legend:{labels:{color:k.textColor}},title:{display:!0,text:"Finishers & volunteers over baseline window",color:k.textColor}},scales:{x:{ticks:{color:k.subtleTextColor},grid:{color:k.gridColor}},y:{beginAtZero:!0,ticks:{precision:0,color:k.subtleTextColor},grid:{color:k.gridColor},title:{display:!0,text:"Finishers",color:k.textColor}}}}})):((r=document.createElement("div")).style.color=k.subtleTextColor,r.style.fontSize="12px",r.style.marginTop="8px",r.textContent="No historical data available for the baseline window.",t.appendChild(r)),u.appendChild(t),s.filter(function(e){return e.change&&0<e.change.finishersChange&&void 0!==e.change.finishersPct})),y=E(n).sort(function(e,t){return t.change.finishersChange-e.change.finishersChange}).slice(0,1),r=E(n).filter(function(e){return 0<e.change.finishersPct}).sort(function(e,t){return t.change.finishersPct-e.change.finishersPct}).slice(0,1),m=document.createElement("div"),t=(m.style.marginTop="18px",m.style.padding="12px",m.style.backgroundColor="#2b223d",m.style.borderRadius="4px",document.createElement("h3")),n=(t.textContent="Most Impacted parkruns",t.style.color=k.barColor,t.style.margin="0 0 10px 0",m.appendChild(t),document.createElement("div")),t=(n.style.color=k.textColor,n.style.fontSize="13px",0===y.length?(n.textContent="No nearby parkruns saw an attendance increase on this date.",m.appendChild(n)):(t=[],y[0]&&(f=y[0],t.push("Largest absolute gain: <strong>".concat(f.displayName||f.eventName,"</strong> (+").concat(f.change.finishersChange," finishers, ").concat(f.change.finishersPct.toFixed(1),"%)"))),r[0]&&(f=r[0],t.push("Largest relative gain: <strong>".concat(f.displayName||f.eventName,"</strong> (+").concat(f.change.finishersPct.toFixed(1),"%, +").concat(f.change.finishersChange," finishers)"))),n.innerHTML=t.join("<br>"),m.appendChild(n),f=[y[0],r[0]].filter(Boolean),l=new Set,f.forEach(function(e){var t,n,r,o,a;e&&e.seasonalTrend&&e.seasonalTrend.filtered&&(l.has(e.eventName)||(l.add(e.eventName),(t=document.createElement("div")).style.marginTop="12px",t.style.padding="10px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",(n=document.createElement("div")).style.color=k.textColor,n.style.fontWeight="bold",n.style.marginBottom="6px",n.textContent=e.displayName||e.eventName,t.appendChild(n),(n=document.createElement("div")).style.color=k.textColor,n.style.fontSize="12px",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fit, minmax(160px, 1fr))",n.style.gap="6px",n.innerHTML="\n          <div>Avg finishers: <strong>".concat(e.seasonalTrend.baseline.avgFinishers,"</strong></div>\n          <div>Min finishers: <strong>").concat(e.seasonalTrend.baseline.minFinishers,"</strong></div>\n          <div>Max finishers: <strong>").concat(e.seasonalTrend.baseline.maxFinishers,"</strong></div>\n          <div>Avg volunteers: <strong>").concat(e.seasonalTrend.baseline.avgVolunteers,"</strong></div>\n          <div>Min volunteers: <strong>").concat(e.seasonalTrend.baseline.minVolunteers,"</strong></div>\n          <div>Max volunteers: <strong>").concat(e.seasonalTrend.baseline.maxVolunteers,"</strong></div>\n        "),t.appendChild(n),"undefined"!=typeof Chart&&e.seasonalTrend.filtered.finishers&&0<e.seasonalTrend.filtered.finishers.length&&((n=document.createElement("canvas")).style.marginTop="10px",t.appendChild(n),r=E(e.seasonalTrend.filtered.dates),o=E(e.seasonalTrend.filtered.finishers),a=E(e.seasonalTrend.filtered.volunteers),e.eventOnDate&&(r.push(i),o.push(e.eventOnDate.finishers),a.push(e.eventOnDate.volunteers)),new Chart(n.getContext("2d"),{type:"line",data:{labels:r,datasets:[{label:"Finishers",data:o,borderColor:k.lineColor,backgroundColor:"rgba(34, 211, 238, 0.25)",tension:.2,fill:!0},{label:"Volunteers",data:a,borderColor:k.successColor,backgroundColor:"rgba(16, 185, 129, 0.18)",tension:.2,fill:!0},{label:"Finishers baseline avg",data:r.map(function(){return e.seasonalTrend.baseline.avgFinishers}),borderColor:k.barColor,borderDash:[6,4],pointRadius:0},{label:"Volunteers baseline avg",data:r.map(function(){return e.seasonalTrend.baseline.avgVolunteers}),borderColor:k.gridColor,borderDash:[6,4],pointRadius:0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.6,plugins:{legend:{labels:{color:k.textColor}},title:{display:!0,text:"Seasonal trend",color:k.textColor}},scales:{x:{ticks:{color:k.subtleTextColor},grid:{color:k.gridColor}},y:{beginAtZero:!0,ticks:{precision:0,color:k.subtleTextColor},grid:{color:k.gridColor},title:{display:!0,text:"Count",color:k.textColor}}}}})),m.appendChild(t)))})),u.appendChild(m),"undefined"!=typeof Chart&&((t=document.createElement("div")).style.marginTop="30px",(n=document.createElement("h3")).textContent="Visual Impact Analysis",n.style.color=k.barColor,n.style.marginBottom="15px",t.appendChild(n),(y=document.createElement("div")).style.display="grid",y.style.gridTemplateColumns="1fr 1fr",y.style.gap="20px",r=document.createElement("canvas"),(f=document.createElement("div")).style.minWidth="0",f.appendChild(r),y.appendChild(f),n=document.createElement("canvas"),(f=document.createElement("div")).style.minWidth="0",f.appendChild(n),y.appendChild(f),t.appendChild(y),u.appendChild(t),f=s.filter(function(e){return e.eventOnDate}).map(function(e){return e.title||e.eventName}),y=s.filter(function(e){return e.eventOnDate}).map(function(e){return e.baseline.avgFinishers}),t=s.filter(function(e){return e.eventOnDate}).map(function(e){return e.eventOnDate.finishers}),new Chart(r.getContext("2d"),{type:"bar",data:{labels:f,datasets:[{label:"Baseline (12-event avg)",data:y,backgroundColor:k.barColor,borderColor:k.barColor,borderWidth:1},{label:"Actual on ".concat(i),data:t,backgroundColor:k.lineColor,borderColor:k.lineColor,borderWidth:1}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.5,plugins:{legend:{labels:{color:k.textColor}},title:{display:!0,text:"Finishers: Baseline vs Actual",color:k.textColor}},scales:{x:{ticks:{color:k.subtleTextColor,display:!1},grid:{color:k.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Finishers",color:k.textColor},ticks:{precision:0,color:k.subtleTextColor},grid:{color:k.gridColor}}}}}),r=s.filter(function(e){return e.eventOnDate}).map(function(e){return e.baseline.avgVolunteers}),y=s.filter(function(e){return e.eventOnDate}).map(function(e){return e.eventOnDate.volunteers}),new Chart(n.getContext("2d"),{type:"bar",data:{labels:f,datasets:[{label:"Baseline (12-event avg)",data:r,backgroundColor:k.barColor,borderColor:k.barColor,borderWidth:1},{label:"Actual on ".concat(i),data:y,backgroundColor:k.lineColor,borderColor:k.lineColor,borderWidth:1}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.5,plugins:{legend:{labels:{color:k.textColor}},title:{display:!0,text:"Volunteers: Baseline vs Actual",color:k.textColor}},scales:{x:{ticks:{color:k.subtleTextColor,display:!1},grid:{color:k.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Volunteers",color:k.textColor},ticks:{precision:0,color:k.subtleTextColor},grid:{color:k.gridColor}}}}})),document.createElement("div")),n=(t.style.marginTop="20px",t.style.padding="12px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",document.createElement("h4")),f=(n.textContent="Summary",n.style.margin="0 0 8px 0",n.style.color=k.lineColor,t.appendChild(n),s.filter(function(e){return e.eventOnDate&&e.change})),r=f.reduce(function(e,t){return e+t.change.finishersChange},0),y=f.reduce(function(e,t){return e+t.change.volunteersChange},0),n=0<f.length?Math.round(r/f.length):0,b=0<f.length?Math.round(f.reduce(function(e,t){return e+t.change.volunteersChange},0)/f.length):0,v=document.createElement("div"),f=(v.style.fontSize="13px",v.style.color=k.textColor,v.innerHTML='\n      <p style="margin: 4px 0;">\n        <strong>'.concat(s.length,'</strong> nearby parkruns analyzed\n        <span style="color: ').concat(k.subtleTextColor,'; font-size: 11px; margin-left: 8px;" title="parkruns within 50km of the cancelled event in the same country and series">â„¹</span>\n      </p>\n      <p style="margin: 4px 0;">\n        <strong>').concat(f.length,"</strong> held events on ").concat(i,'\n        <span style="color: ').concat(k.subtleTextColor,'; font-size: 11px; margin-left: 8px;" title="Number of nearby parkruns that ran on this date">â„¹</span>\n      </p>\n      <p style="margin: 4px 0;">\n        Average change in finishers: <span style="color: ').concat(n<0?k.alertColor:k.successColor,'; font-weight: bold;">').concat(0<n?"+":"").concat(n,'</span>\n        <span style="color: ').concat(k.subtleTextColor,'; font-size: 11px; margin-left: 8px;" title="Mean difference between actual finishers and 12-event baseline average across events that ran">â„¹</span>\n      </p>\n      <p style="margin: 4px 0;">\n        Average change in volunteers: <span style="color: ').concat(b<0?k.alertColor:k.successColor,'; font-weight: bold;">').concat(0<b?"+":"").concat(b,'</span>\n        <span style="color: ').concat(k.subtleTextColor,'; font-size: 11px; margin-left: 8px;" title="Mean difference between actual volunteers and 12-event baseline average across events that ran">â„¹</span>\n      </p>\n      <p style="margin: 4px 0;">\n        Estimated total additional finishers: <span style="color: ').concat(r<0?k.alertColor:k.successColor,'; font-weight: bold;">').concat(0<r?"+":"").concat(r,'</span>\n        <span style="color: ').concat(k.subtleTextColor,'; font-size: 11px; margin-left: 8px;" title="Sum of all finisher changes across nearby parkruns - positive indicates runners redistributed from the cancelled event">â„¹</span>\n      </p>\n      <p style="margin: 4px 0;">\n        Estimated total additional volunteers: <span style="color: ').concat(y<0?k.alertColor:k.successColor,'; font-weight: bold;">').concat(0<y?"+":"").concat(y,'</span>\n        <span style="color: ').concat(k.subtleTextColor,'; font-size: 11px; margin-left: 8px;" title="Sum of all volunteer changes across nearby parkruns - indicates how many extra volunteers were needed on the day">â„¹</span>\n      </p>\n    '),t.appendChild(v),u.appendChild(t),document.createElement("div")),C=(f.style.display="flex",f.style.justifyContent="center",f.style.marginTop="20px",f.style.gap="10px",f.style.flexWrap="wrap",document.createElement("button")),x=(C.textContent="ðŸ“„ Export HTML",C.style.padding="8px 16px",C.style.backgroundColor=k.barColor,C.style.color="#1c1b2a",C.style.border="none",C.style.borderRadius="4px",C.style.cursor="pointer",C.style.fontWeight="bold",C.style.fontSize="14px",C.addEventListener("click",D(S().m(function e(){var t,n,r,o,a,l,s;return S().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=C.textContent,n=C.style.display,C.textContent="Exporting...",C.disabled=!0,C.style.display="none",e.p=1,o=d(),r=o.eventShortName,o=o.cancellationDateStr,e.n=2,O(u,{eventShortName:r,cancellationDateStr:o,generatedAt:(new Date).toLocaleString()});case 2:r=e.v,o=r.blob,s=r.filename,a=URL.createObjectURL(o),(l=document.createElement("a")).href=a,l.download=s,l.click(),setTimeout(function(){return URL.revokeObjectURL(a)},1e3),console.log("HTML export complete"),e.n=4;break;case 3:e.p=3,s=e.v,console.error("HTML export failed:",s),alert("Error exporting HTML: "+s.message);case 4:return e.p=4,C.disabled=!1,C.textContent=t,C.style.display=n,e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}))),document.createElement("button"));x.textContent="ðŸ“¤ Share Report",x.style.padding="8px 16px",x.style.backgroundColor=k.lineColor,x.style.color="#2b223d",x.style.border="none",x.style.borderRadius="4px",x.style.cursor="pointer",x.style.fontWeight="bold",x.style.fontSize="14px",x.addEventListener("click",D(S().m(function e(){var t,n,r,o,a,l,s,i,c;return S().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=x.textContent,n=x.style.display,x.textContent="Sharing...",x.disabled=!0,x.style.display="none",e.p=1,o=d(),r=o.eventShortName,o=o.cancellationDateStr,e.n=2,O(u,{eventShortName:r,cancellationDateStr:o,generatedAt:(new Date).toLocaleString()});case 2:if(l=e.v,a=l.blob,l=l.filename,i=new File([a],l,{type:"text/html"}),navigator.canShare&&navigator.canShare({files:[i]}))return e.n=3,navigator.share({title:"parkrun Cancellation Impact - ".concat(r),text:"Cancellation date: ".concat(o),files:[i]});e.n=4;break;case 3:console.log("Report shared via Web Share API"),e.n=5;break;case 4:s=URL.createObjectURL(a),(i=document.createElement("a")).href=s,i.download=l,i.click(),setTimeout(function(){return URL.revokeObjectURL(s)},1e3),alert("Sharing is not supported in this browser, so the HTML report was downloaded instead.");case 5:e.n=7;break;case 6:e.p=6,c=e.v,console.error("Share failed:",c),alert("Error sharing report: "+c.message);case 7:return e.p=7,x.disabled=!1,x.textContent=t,x.style.display=n,e.f(7);case 8:return e.a(2)}},e,null,[[1,6,7,8]])}))),f.appendChild(C),f.appendChild(x),u.appendChild(f),e.appendChild(u)}function f(){return(f=D(S().m(function e(){var t,n;return S().w(function(e){for(;;)switch(e.n){case 0:if(t=document.querySelector(".Results-table"),n=window.location.href,n=n.includes("/eventhistory/"),t&&n){e.n=1;break}return e.a(2);case 1:return e.n=2,function(){return l.apply(this,arguments)}();case 2:w.allParkruns=e.v,!function(){s.apply(this,arguments)}();case 3:return e.a(2)}},e)}))).apply(this,arguments)}r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=r,n.onload=e,n.onerror=t,document.head.appendChild(n)}),k={backgroundColor:"#1c1b2a",barColor:"#f59e0b",alertColor:"#ef4444",lineColor:"#22d3ee",textColor:"#f3f4f6",subtleTextColor:"#d1d5db",gridColor:"rgba(243, 244, 246, 0.18)",successColor:"#10b981"},v=7,i=12,w={currentEvent:null,allParkruns:null,gapInfo:null,nearbyParkruns:[],fetchController:null,analysisComplete:!(g=864e5),impactData:null,currentCancellationIndex:-1,cancellationDates:[],sortColumn:"distance",sortDirection:"asc"},function(){f.apply(this,arguments)}()})();
```

### parkrun Charts

> Displays charts on parkrun pages: finishers per minute on results pages and event history on event history pages


[parkrun-charts.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-charts.user.js)

```javascript
javascript:(async()=>{var r,f,d;function n(e,t){return(e=>{if(Array.isArray(e))return e})(e)||((e,t)=>{var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var r,n,a,l,i=[],s=!0,c=!1;try{if(a=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;s=!1}else for(;!(s=(r=a.call(o)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){c=!0,n=e}finally{try{if(!s&&null!=o.return&&(l=o.return(),Object(l)!==l))return}finally{if(c)throw n}}return i}})(e,t)||((e,t)=>{var o;if(e)return"string"==typeof e?a(e,t):"Map"===(o="Object"===(o={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(e,t):void 0})(e,t)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function y(e,t,o){var o=2<arguments.length&&void 0!==o?o:800,r=document.createElement("div"),o=(r.className="parkrun-chart-container "+t+"-container",r.style.width="100%",r.style.maxWidth=o+"px",r.style.margin="20px auto",r.style.padding="15px",r.style.backgroundColor=f.backgroundColor,r.style.borderRadius="8px",r.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.createElement("h3")),e=(o.textContent=e,o.style.textAlign="center",o.style.marginBottom="15px",o.style.color=f.barColor,r.appendChild(o),document.createElement("canvas"));return e.id=t,r.appendChild(e),{container:r,canvas:e}}function g(e,t){e=document.querySelector(e);e&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))}function v(a){var e=document.createElement("div"),l=(e.style.display="flex",e.style.justifyContent="center",e.style.marginTop="10px",e.style.marginBottom="10px",document.createElement("button"));l.textContent="ðŸ’¾ Save as Image",l.style.padding="6px 12px",l.style.backgroundColor=f.barColor,l.style.color="#2b223d",l.style.border="none",l.style.borderRadius="4px",l.style.cursor="pointer",l.style.fontWeight="bold",l.style.display="inline-block",l.style.margin="0 5px",l.title="Download chart as PNG image",l.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),l.addEventListener("mouseout",function(){this.style.backgroundColor=f.barColor}),l.addEventListener("click",function(){l.style.display="none",html2canvas(a,{backgroundColor:f.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(function(e){l.style.display="block";var t=document.createElement("a"),o=(new Date).toISOString().split("T")[0],r=window.location.pathname.split("/")[1],n=a.classList.contains("eventHistoryChart-container")?"event-history":"finishers";t.download="".concat(r,"-").concat(n,"-").concat(o,".png"),t.href=e.toDataURL("image/png"),t.click()})}),e.appendChild(l),a.appendChild(e)}function x(e){for(var t=e.getContext("2d"),o="parkrun-charts",r="unknown",n="",a=("undefined"!=typeof GM_info&&GM_info&&GM_info.script&&(o=GM_info.script.name||o,r=GM_info.script.version||r,n=GM_info.script.homepage||""),["Generated by ".concat(o," v").concat(r),n]),l=(t.save(),t.font=d?"bold 16px Arial":"10px Arial",t.fillStyle=d?"rgba(255, 0, 0, 0.5)":"rgba(200, 200, 200, 0.1)",t.textAlign="right",t.textBaseline="bottom",d?20:14),i=e.width-10,s=e.height-10,c=a.length-1;0<=c;c--){var u=a[c];u&&(t.fillText(u,i,s),s-=l)}t.restore()}function e(){var e,t,o=[[null==(o=document.querySelector("h1"))||null==(o=o.textContent)?void 0:o.trim(),null==(o=document.querySelector("h3"))||null==(o=o.textContent)?void 0:o.trim()].filter(Boolean).join(" | "),"Finishers per Minute"].filter(Boolean).join(": "),r=(e=>{for(var t=e.timeData,o=e.maxMinute,r=[],n=[],a=e.minMinute;a<=o;a++)r.push(a),n.push(t[a]||0);return{labels:r.map(function(e){var t=Math.floor(e/60),e=e%60;return"".concat(t,":").concat(e.toString().padStart(2,"0"))}),data:n}})((()=>{var r={},e=document.querySelectorAll("tr.Results-table-row"),n=1/0,a=0;e.forEach(function(e){e=e.querySelector("td.Results-table-td--time");if(e){var e=e.textContent.trim(),t=e.match(/(\d+):(\d+):(\d+)/);if(t)var o=60*parseInt(t[1])+parseInt(t[2]);else{t=e.match(/(\d+):(\d+)/);if(!t)return;o=parseInt(t[1])}n=Math.min(n,o),a=Math.max(a,o),r[o]?r[o]++:r[o]=1}});for(var t=n;t<=a;t++)r[t]||(r[t]=0);return{timeData:r,minMinute:n,maxMinute:a}})());0===r.labels.length?console.log("No finish time data found"):document.getElementById("finishersChart")?console.log("Finishers chart already exists, skipping render"):(e=(o=y(o,"finishersChart")).container,t=o.canvas,g("h3",e),v(e),o=t.getContext("2d"),new Chart(o,{type:"bar",data:{labels:r.labels,datasets:[{label:"Number of Finishers",data:r.data,backgroundColor:f.barColor,borderColor:f.barColor,borderWidth:1}]},options:{animation:!1,responsive:!0,plugins:{legend:{labels:{color:f.textColor}},title:{display:!1,color:f.textColor},tooltip:{callbacks:{title:function(e){var t,o,e=e[0].label;return e.includes(":")?(o=(t=n(e.split(":"),2))[0],t=t[1],"".concat(o," hour").concat("1"===o?"":"s"," ").concat(t," minute").concat("01"===t?"":"s")):(o=e.replace("'",""),"".concat(o," minute").concat("1"===o?"":"s"))},label:function(e){return"".concat(e.raw," finisher").concat(1===e.raw?"":"s")}}}},scales:{x:{title:{display:!0,text:"Finish Time",color:f.textColor},ticks:{color:f.subtleTextColor},grid:{color:f.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:f.textColor},ticks:{precision:0,color:f.subtleTextColor},grid:{color:f.gridColor}}},onHover:function(){setTimeout(function(){return x(t)},0)},onResize:function(){setTimeout(function(){return x(t)},0)},customPlugin:{id:"watermarkPlugin",afterDraw:function(){setTimeout(function(){return x(t)},0)}}}}),setTimeout(function(){return x(t)},0))}function C(e,t){for(var o=[],r=0;r<e.length;r++)if(r<t-1)o.push(null);else{for(var n=0,a=0;a<t;a++)n+=e[r-a];o.push(parseFloat((n/t).toFixed(1)))}return o}function k(e,t,o){for(var r=1/0,n=-1/0,a=-1,l=-1,i=0;i<e.length;i++)e[i]<r&&(r=e[i],a=i),e[i]===r&&(a=i),n<e[i]&&(n=e[i],l=i),e[i]===n&&(l=i);return{min:{value:r,eventNumber:t[a],date:o[a],index:a},max:{value:n,eventNumber:t[l],date:o[l],index:l}}}function A(e,t){return 0!==e&&0!==t&&Math.floor(Math.log10(e))===Math.floor(Math.log10(t))}function t(){var n,o,r,a,l,e,t,i,s,c,u,d,p,m,h,b;document.getElementById("eventHistoryChart")?console.log("Event history chart already exists, skipping render"):(t=null!=(t=null==(t=document.querySelector("h1"))?void 0:t.textContent.trim())?t:"Event History",o=[],r=[],a=[],l=[],e=document.querySelectorAll("tr.Results-table-row"),Array.from(e).reverse().forEach(function(e){var t=e.getAttribute("data-parkrun"),t=(t&&o.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&a.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),0===(n={title:t,eventNumbers:o,dates:r,finishers:a,volunteers:l}).eventNumbers.length?console.log("No event history data found"):(e=C(n.finishers,12),t=C(n.volunteers,12),m=k(n.finishers,n.eventNumbers,n.dates),h=k(n.volunteers,n.eventNumbers,n.dates),i={"y-parkrunners":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"parkrunners",color:f.textColor},ticks:{precision:0,color:f.subtleTextColor},grid:{color:f.gridColor}},"y-finishers":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:f.barColor},ticks:{precision:0,color:f.barColor},grid:{color:f.gridColor}},"y-volunteers":{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Number of Volunteers",color:f.lineColor},ticks:{precision:0,color:f.lineColor},grid:{display:!1}}},s=(c=A(m.max.value,h.max.value))?"y-parkrunners":"y-finishers",c=c?"y-parkrunners":"y-volunteers",u=(p=y("".concat(n.title,": Finishers & Volunteers"),"eventHistoryChart",1e3)).container,(d=p.canvas).height=400,d.style.height="400px",d.style.maxHeight="400px",g("h1",u),p=d.getContext("2d"),(b=document.createElement("div")).className="chart-stats-footer",b.style.marginTop="10px",b.style.padding="10px",b.style.backgroundColor=f.backgroundColor,b.style.color=f.textColor,b.style.borderRadius="4px",b.style.fontSize="14px",b.style.textAlign="center",b.innerHTML='\n      <span style="color: '.concat(f.barColor,'">Finishers:</span> Min: ').concat(m.min.value," (").concat(m.min.date,", Event #").concat(m.min.eventNumber,") |\n      Max: ").concat(m.max.value," (").concat(m.max.date,", Event #").concat(m.max.eventNumber,')<br>\n      <span style="color: ').concat(f.lineColor,'">Volunteers:</span> Min: ').concat(h.min.value," (").concat(h.min.date,", Event #").concat(h.min.eventNumber,") |\n      Max: ").concat(h.max.value," (").concat(h.max.date,", Event #").concat(h.max.eventNumber,")\n    "),u.appendChild(b),m={title:{display:!0,text:"Date",color:f.textColor},ticks:{color:f.subtleTextColor,maxRotation:45,minRotation:45,callback:function(e,t){var o=n.dates.length,r=1;return 100<o?r=10:50<o?r=5:20<o&&(r=2),0===t||t===n.dates.length-1||t%r==0?n.dates[t]:""}},grid:{color:f.gridColor}},h=[{label:"Finishers",data:n.finishers,backgroundColor:f.barColor,borderColor:f.barColor,borderWidth:1,yAxisID:s,order:1},{label:"".concat(12,"-Event Avg (Finishers)"),data:e,type:"line",borderColor:f.barColor,backgroundColor:"transparent",borderWidth:2,borderDash:[5,5],pointRadius:0,fill:!1,yAxisID:s,order:0},{label:"Volunteers",data:n.volunteers,type:"line",borderColor:f.lineColor,backgroundColor:"rgba(83, 186, 157, 0.2)",borderWidth:1,pointBackgroundColor:f.lineColor,pointRadius:2,fill:!1,tension:.2,yAxisID:c,order:2},{label:"".concat(12,"-Event Avg (Volunteers)"),data:t,type:"line",borderColor:f.lineColor,backgroundColor:"transparent",borderWidth:2,borderDash:[5,5],pointRadius:0,fill:!1,yAxisID:c,order:3}],(b={x:m})[s]=i[s],c!=s&&(b[c]=i[c]),new Chart(p,{type:"bar",data:{labels:n.dates,datasets:h},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:2.5,plugins:{legend:{labels:{color:f.textColor,usePointStyle:!0}},tooltip:{mode:"index",callbacks:{title:function(e){var e=e[0].dataIndex,t=n.eventNumbers[e],e=n.dates[e];return"".concat(e," (Event #").concat(t,")")},label:function(e){var t=e.dataset.label||"";return"Finishers"===t?"Finishers: ".concat(e.raw):"Volunteers"===t?"Volunteers: ".concat(e.raw):t.includes("Avg")?"".concat(t,": ").concat(e.raw):e.formattedValue}}}},scales:b,onHover:function(){setTimeout(function(){return x(d)},0)},onResize:function(){setTimeout(function(){return x(d)},0)},customPlugin:{id:"watermarkPlugin",afterDraw:function(){setTimeout(function(){return x(d)},0)}}}}),setTimeout(function(){return x(d)},0),v(u)))}r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var o=document.createElement("script");o.src=r,o.onload=e,o.onerror=t,document.head.appendChild(o)}),d=!(f={backgroundColor:"#2b223d",barColor:"#FFA300",lineColor:"#53BA9D",textColor:"#e0e0e0",subtleTextColor:"#cccccc",gridColor:"rgba(200, 200, 200, 0.2)"}),"undefined"!=typeof module&&void 0!==module.exports?module.exports.sameOrderOfMagnitude=A:"undefined"==typeof Chart?console.error("Chart.js not loaded"):document.querySelector(".Results-table")?(window.location.href.includes("/eventhistory/")?t:e)():console.log("Results table not found")})();
```

### parkrun Compass Challenge

> Visualizes your progress on the compass challenge (North, South, East, West parkruns)


[compass-challenge.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/compass-challenge.user.js)

```javascript
javascript:(async()=>{var o,t,e,b,w;function y(t,e){return(t=>{if(Array.isArray(t))return t})(t)||((t,e)=>{var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,a,r,i,c=[],s=!0,l=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=r.call(n)).done)&&(c.push(o.value),c.length!==e);s=!0);}catch(t){l=!0,a=t}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return c}})(t,e)||((t,e)=>{var n;if(t)return"string"==typeof t?a(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0})(t,e)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function s(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"10px",medium:"15px",statsMarginBottom:"8px",completionMarginTop:"8px"},container:{padding:"10px",marginTop:"10px"},typography:{heading:"1.1em",stats:"1em",statsSubtext:"0.9em",completion:"0.95em"},compass:{baseSize:320},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"}}:{isMobile:!1,spacing:{small:"20px",medium:"20px",statsMarginBottom:"10px",completionMarginTop:"10px"},container:{padding:"20px",marginTop:"20px"},typography:{heading:"1.3em",stats:"1.2em",statsSubtext:"1em",completion:"1.1em"},compass:{baseSize:700},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"}}}function n(t){var e=s(),n=(n="Compass Challenge",o=s(),(r=document.createElement("div")).className="parkrun-compass-container",r.style.width="100%",r.style.maxWidth="800px",r.style.margin="".concat(o.container.marginTop," auto"),r.style.padding=o.container.padding,r.style.backgroundColor=b.backgroundColor,r.style.borderRadius="8px",r.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",r.style.textAlign="center",(a=document.createElement("h3")).textContent=n,a.style.marginBottom=o.spacing.small,a.style.color=b.accentColor,a.style.fontSize=o.typography.heading,r.appendChild(a),r),o=document.createElement("div"),a=(o.style.marginBottom=e.spacing.small,o.style.color=b.textColor,'<div style="font-size: '.concat(e.typography.stats,"; margin-bottom: ").concat(e.spacing.statsMarginBottom,';"><strong>').concat(t.completedCount," of 4</strong> compass directions completed</div>")),r=(a+='<div style="font-size: '.concat(e.typography.statsSubtext,';">After ').concat(t.totalEvents," parkruns</div>"),t.dateOfCompletion&&(a+='<div style="margin-top: '.concat(e.spacing.completionMarginTop,"; font-size: ").concat(e.typography.completion,';">ðŸ§­ Challenge completed on ').concat(t.dateOfCompletion,"</div>")),o.innerHTML=a,n.appendChild(o),e.isMobile?Math.min(e.compass.baseSize,window.innerWidth-40):e.compass.baseSize),a=document.createElement("div"),p=(a.style.position="relative",a.style.width="".concat(r,"px"),a.style.height="".concat(r,"px"),a.style.margin="0 auto",a.style.boxSizing="content-box",document.createElementNS("http://www.w3.org/2000/svg","svg")),m=(p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.setAttribute("viewBox","0 0 ".concat(700," ").concat(700)),p.style.position="absolute",p.style.top="0",p.style.left="0",350),h=350,o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",m),o.setAttribute("cy",h),o.setAttribute("r",230),o.setAttribute("fill","#334"),o.setAttribute("stroke",b.accentColor),o.setAttribute("stroke-width","5"),p.appendChild(o);[{name:"north",angle:270,label:"N",data:t.directions.north},{name:"east",angle:0,label:"E",data:t.directions.east},{name:"south",angle:90,label:"S",data:t.directions.south},{name:"west",angle:180,label:"W",data:t.directions.west}].forEach(function(t){var e=t.angle*(Math.PI/180),n=m+230*Math.cos(e),o=h+230*Math.sin(e),a=230*.12,r=m+115*Math.cos(e),i=h+115*Math.sin(e),c=e+Math.PI/2,s=r+a*Math.cos(c),l=i+a*Math.sin(c),r=r-a*Math.cos(c),i=i-a*Math.sin(c),a=document.createElementNS("http://www.w3.org/2000/svg","path"),c="M ".concat(m," ").concat(h," L ").concat(s," ").concat(l," L ").concat(n," ").concat(o," L ").concat(r," ").concat(i," Z"),s=(a.setAttribute("d",c),a.setAttribute("fill",t.data?b.completedColor:b.pendingColor),a.setAttribute("stroke","#000"),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-opacity","0.3"),p.appendChild(a),m+115*Math.cos(e)),l=h+115*Math.sin(e),n=document.createElementNS("http://www.w3.org/2000/svg","text");if(n.setAttribute("x",s),n.setAttribute("y",l),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.setAttribute("fill","#fff"),n.setAttribute("font-size","28px"),n.setAttribute("font-weight","bold"),n.setAttribute("stroke","#000"),n.setAttribute("stroke-width","1"),n.setAttribute("paint-order","stroke"),n.textContent=t.label,p.appendChild(n),t.data){var o=t.data.eventName.match(/(.+?)(?:\s+parkrun)?$/i),r=o?o[1]:t.data.eventName,i="".concat(r," - ").concat(t.data.date),c="text-path-".concat(t.name),a=document.createElementNS("http://www.w3.org/2000/svg","path"),d="",u=245;switch(t.name){case"north":d="M ".concat(180," ").concat(105," A ").concat(u," ").concat(u," 0 0 1 ").concat(520," ").concat(105);break;case"east":d="M ".concat(595," ").concat(180," A ").concat(u," ").concat(u," 0 0 1 ").concat(595," ").concat(520);break;case"south":d="M ".concat(180," ").concat(595," A ").concat(u," ").concat(u," 0 0 0 ").concat(520," ").concat(595);break;case"west":d="M ".concat(105," ").concat(520," A ").concat(u," ").concat(u," 0 0 1 ").concat(105," ").concat(180);break;default:console.warn("Unknown direction: ".concat(t.name))}a.setAttribute("id",c),a.setAttribute("d",d),a.setAttribute("fill","none"),p.appendChild(a);e=document.createElementNS("http://www.w3.org/2000/svg","text"),s=(e.setAttribute("fill","#FFFFFF"),e.setAttribute("font-size","14px"),e.setAttribute("font-weight","bold"),document.createElementNS("http://www.w3.org/2000/svg","textPath"));s.setAttribute("href","#".concat(c)),s.setAttribute("startOffset","50%"),s.setAttribute("text-anchor","middle"),"south"===t.name&&s.setAttribute("side","left"),s.textContent=i,e.appendChild(s),p.appendChild(e)}});var i,c,e=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","filter"),o=(r.setAttribute("id","text-shadow"),r.setAttribute("x","-20%"),r.setAttribute("y","-20%"),r.setAttribute("width","140%"),r.setAttribute("height","140%"),document.createElementNS("http://www.w3.org/2000/svg","feDropShadow")),o=(o.setAttribute("dx","0"),o.setAttribute("dy","0"),o.setAttribute("stdDeviation","2"),o.setAttribute("flood-color","#000000"),o.setAttribute("flood-opacity","0.7"),r.appendChild(o),e.appendChild(r),p.appendChild(e),document.createElementNS("http://www.w3.org/2000/svg","circle")),r=(o.setAttribute("cx",m),o.setAttribute("cy",h),o.setAttribute("r",30),o.setAttribute("fill",b.accentColor),p.appendChild(o),document.createElementNS("http://www.w3.org/2000/svg","text"));return r.setAttribute("x",m),r.setAttribute("y",h),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","middle"),r.setAttribute("fill",b.backgroundColor),r.setAttribute("font-size","24px"),r.setAttribute("font-weight","bold"),r.textContent="".concat(Math.round(t.completedCount/4*100),"%"),p.appendChild(r),a.appendChild(p),n.appendChild(a),i=n,e=s(),(o=document.createElement("div")).style.marginTop=e.button.marginTop,o.id="compass-download-btn-container",(c=document.createElement("button")).textContent="ðŸ’¾ Save as Image",c.style.padding=e.button.padding,c.style.backgroundColor=b.accentColor,c.style.color=b.backgroundColor,c.style.border="none",c.style.borderRadius="4px",c.style.cursor="pointer",c.style.fontWeight="bold",c.style.fontSize=e.button.fontSize,c.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),c.addEventListener("mouseout",function(){this.style.backgroundColor=b.accentColor}),c.addEventListener("click",function(){c.style.display="none",html2canvas(i,{backgroundColor:b.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(function(t){c.style.display="block";var e=document.createElement("a"),n=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/")[2]||"parkrunner";e.download="compass-challenge-".concat(o,"-").concat(n,".png"),e.href=t.toDataURL("image/png"),e.click()})}),o.appendChild(c),i.appendChild(o),n}o="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var n=document.createElement("script");n.src=o,n.onload=t,n.onerror=e,document.head.appendChild(n)}),b={backgroundColor:"#2b223d",accentColor:"#FFA300",completedColor:"#53BA9D",pendingColor:"#666",textColor:"#e0e0e0",subtleTextColor:"#cccccc"},w={north:/north/i,south:/south/i,east:/east/i,west:/west/i},document.querySelector("#results")?(t=t=n((t=>{for(var e={north:null,south:null,east:null,west:null},n=0,o=null,a=0,t=t.querySelectorAll("tr"),r=[],i=(t.forEach(function(t){var e,n,o,t=t.querySelectorAll("td");t.length<5||(e=t[0].textContent.trim(),n=t[1].textContent.trim(),o=t[2].textContent.trim(),(t=t[4].textContent.trim())&&o&&n&&e&&r.push({eventName:e,date:n,eventNumber:o,time:t}))}),r.reverse()),c=0;!o&&c<i.length;c++){var s=i[c],l=s.eventName,d=s.date,u=s.eventNumber,p=s.time;a++;for(var m=0,h=Object.entries(w);m<h.length;m++){var b=y(h[m],2),g=b[0];b[1].test(l)&&!e[g]&&(e[g]={eventName:l,date:d,eventNumber:u,time:p},4===++n)&&(o=o||d)}}return{directions:e,completedCount:n,dateOfCompletion:o,totalEvents:a}})((t=document.querySelectorAll("#results"))[t.length-1])),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")})();
```

### parkrun Countries Visited

> Shows country flag emojis next to parkrunner name for all countries they have completed parkruns in


[visited-countries.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/visited-countries.user.js)

```javascript
javascript:(async()=>{function t(e,n){return(e=>{if(Array.isArray(e))return e})(e)||((e,n)=>{var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var t,r,l,o,i=[],u=!0,c=!1;try{if(l=(a=a.call(e)).next,0===n){if(Object(a)!==a)return;u=!1}else for(;!(u=(t=l.call(a)).done)&&(i.push(t.value),i.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(c)throw r}}return i}})(e,n)||((e,n)=>{var a;if(e)return"string"==typeof e?r(e,n):"Map"===(a="Object"===(a={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(e,n):void 0})(e,n)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var a=0,t=Array(n);a<n;a++)t[a]=e[a];return t}function l(e){var e=e.hostname.split("."),n=e[e.length-1];return n="com"===n&&2===e[0].length?e[0]:n}var e,n,o,a,i,u;u={at:{flag:"ðŸ‡¦ðŸ‡¹",name:"Austria"},ru:{flag:"ðŸ‡·ðŸ‡º",name:"Russia"},au:{flag:"ðŸ‡¦ðŸ‡º",name:"Australia"},ca:{flag:"ðŸ‡¨ðŸ‡¦",name:"Canada"},com:{flag:"ðŸ‡ºðŸ‡¸",name:"United States"},de:{flag:"ðŸ‡©ðŸ‡ª",name:"Germany"},dk:{flag:"ðŸ‡©ðŸ‡°",name:"Denmark"},fi:{flag:"ðŸ‡«ðŸ‡®",name:"Finland"},fr:{flag:"ðŸ‡«ðŸ‡·",name:"France"},ie:{flag:"ðŸ‡®ðŸ‡ª",name:"Ireland"},is:{flag:"ðŸ‡®ðŸ‡¸",name:"Iceland"},it:{flag:"ðŸ‡®ðŸ‡¹",name:"Italy"},jp:{flag:"ðŸ‡¯ðŸ‡µ",name:"Japan"},lt:{flag:"ðŸ‡±ðŸ‡¹",name:"Lithuania"},my:{flag:"ðŸ‡²ðŸ‡¾",name:"Malaysia"},nl:{flag:"ðŸ‡³ðŸ‡±",name:"Netherlands"},no:{flag:"ðŸ‡³ðŸ‡´",name:"Norway"},nz:{flag:"ðŸ‡³ðŸ‡¿",name:"New Zealand"},pl:{flag:"ðŸ‡µðŸ‡±",name:"Poland"},se:{flag:"ðŸ‡¸ðŸ‡ª",name:"Sweden"},sg:{flag:"ðŸ‡¸ðŸ‡¬",name:"Singapore"},uk:{flag:"ðŸ‡¬ðŸ‡§",name:"United Kingdom"},us:{flag:"ðŸ‡ºðŸ‡¸",name:"United States "},za:{flag:"ðŸ‡¿ðŸ‡¦",name:"South Africa"}},"undefined"!=typeof module&&module.exports?module.exports={getCountryCodeFromUrl:l}:(i=(i=document.querySelectorAll("#results"))[i.length-1])?(i.querySelectorAll("tr").forEach(function(e){var n,a,e=e.querySelector('td a[href*="parkrun"]');e&&(n=l(new URL(e.href)),n=u[n])&&((a=document.createElement("span")).textContent=" ".concat(n.flag),a.title=n.name,a.style.cursor="help",e.appendChild(a))}),i=i,a=new Map,i.querySelectorAll("tr").forEach(function(e){var e=e.querySelector('td a[href*="parkrun"]');e&&(e=l(new URL(e.href)),a.set(e,(a.get(e)||0)+1))}),(i=i=Array.from(a.entries()).sort(function(e,n){var a=(null==(a=u[e[0]])?void 0:a.name)||e[0],e=(null==(e=u[n[0]])?void 0:e.name)||n[0];return a.localeCompare(e)}).map(function(e){var e=t(e,2),n=e[0],e=e[1],a=u[n];return{symbol:a?a.flag:n,name:a?a.name:n.toUpperCase(),count:e}})).length?(e=document.querySelector("h2"))?((n=document.createElement("div")).id="countries-visited",n.style.marginLeft="10px",n.style.fontSize="1.8em",n.style.marginTop="5px",n.title="".concat(i.length," Countries visited, according to parkrun's domains. Political boundaries may not be accurate."),(o=document.createElement("span")).style.lineHeight="1.5",o.style.display="inline-block",i.forEach(function(e){var n=e.symbol,a=e.name,e=e.count,t=document.createElement("span");t.textContent=n,t.title="".concat(a," (").concat(e,")"),t.style.cursor="help",o.appendChild(t),o.appendChild(document.createTextNode(" "))}),n.appendChild(o),e.appendChild(n)):console.log("No title"):console.log("No countries visited")):console.log("Results table not found")})();
```

### parkrun Launch Returnees

> Identifies and displays participants who attended both the launch event and the latest event


[launch-returnees.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/launch-returnees.user.js)

```javascript
javascript:(async()=>{function m(t){return(t=>{if(Array.isArray(t))return r(t)})(t)||(t=>{if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)})(t)||((t,e)=>{var n;if(t)return"string"==typeof t?r(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0})(t)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function g(){var y,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",n=t.toStringTag||"@@toStringTag";function r(t,e,n,r){var o,a,i,c,u,l,s,f,p,e=e&&e.prototype instanceof m?e:m,e=Object.create(e.prototype);return b(e,"_invoke",(o=t,a=n,s=r||[],f=!1,p={p:l=0,n:0,v:y,a:d,f:d.bind(y,4),d:function(t,e){return i=t,c=0,u=y,p.n=e,h}},function(t,e,n){if(1<l)throw TypeError("Generator is already running");for(f&&1===e&&d(e,n),c=e,u=n;(v=c<2?y:u)||!f;){i||(c?c<3?(1<c&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(l=2,i){if(v=i[t=c?t:"next"]){if(!(v=v.call(i,u)))throw TypeError("iterator result is not an object");if(!v.done)return v;u=v.value,c<2&&(c=0)}else 1===c&&(v=i.return)&&v.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+t+"' method"),c=1);i=y}else if((v=(f=p.n<0)?u:o.call(a,p))!==h)break}catch(t){i=y,c=1,u=t}finally{l=1}}return{value:v,done:f}}),!0),e;function d(t,e){for(c=t,u=e,v=0;!f&&l&&!n&&v<s.length;v++){var n,r=s[v],o=p.p,a=r[2];3<t?(n=a===e)&&(u=r[(c=r[4])?5:c=3],r[4]=r[5]=y):r[0]<=o&&((n=t<2&&o<r[1])?(c=0,p.v=e,p.n=r[1]):o<a&&(n=t<3||r[0]>e||a<e)&&(r[4]=t,r[5]=e,p.n=a,c=0))}if(n||1<t)return h;throw f=!0,e}}var h={};function m(){}function o(){}function a(){}var v=Object.getPrototypeOf,t=[][e]?v(v([][e]())):(b(v={},e,function(){return this}),v),i=a.prototype=m.prototype=Object.create(t);function c(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,b(t,n,"GeneratorFunction")),t.prototype=Object.create(i),t}return b(i,"constructor",o.prototype=a),b(a,"constructor",o),b(a,n,o.displayName="GeneratorFunction"),b(i),b(i,n,"Generator"),b(i,e,function(){return this}),b(i,"toString",function(){return"[object Generator]"}),(g=function(){return{w:r,m:c}})()}function b(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}(b=function(t,e,n,r){function o(e,n){b(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))})(t,e,n,r)}function u(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function o(c){return function(){var t=this,i=arguments;return new Promise(function(e,n){var r=c.apply(t,i);function o(t){u(r,e,n,o,a,"next",t)}function a(t){u(r,e,n,o,a,"throw",t)}o(void 0)})}}o(g().m(function t(){var i,s,a,c,e,u,l,f,p,d,y,h,n,r;return g().w(function(t){for(;;)switch(t.n){case 0:if(r=function(){return(r=o(g().m(function t(){var e,n,r,o;return g().w(function(t){for(;;)switch(t.n){case 0:return o=window.location.pathname,o=o.match(/\/([^/]+)\/results\/latestresults/),o=o[1],e=window.location.origin,o="".concat(e,"/").concat(o,"/results/1/"),n=a(),t.n=1,c(o);case 1:r=t.v,o=m(n.keys()).filter(function(t){return r.has(t)}),h(o,n,r,e);case 2:return t.a(2)}},t)}))).apply(this,arguments)},n=function(){return r.apply(this,arguments)},h=function(t,e,n,r){var o=y(),a=l("Participants Who Attended the Launch Event");o.appendChild(a),0===t.length?(a=f("No attendees from the launch event were present at the latest event."),o.appendChild(a)):(a=d(t,e,n,r),o.appendChild(a)),u(o)},y=function(){var t=document.createElement("div");return t.id="parkrun-launch-returnees",t.style.width="100%",t.style.maxWidth="800px",t.style.margin="20px auto",t.style.padding="15px",t.style.backgroundColor=i.backgroundColor,t.style.borderRadius="8px",t.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",t.style.color=i.textColor,t},d=function(t,e,n,r){var o=document.createElement("div"),a=(o.style.maxHeight="400px",o.style.overflow="auto",document.createElement("ul"));return a.style.listStyleType="none",a.style.padding="0",a.style.margin="0",a.style.textAlign="center",t.forEach(function(t){t=p(t,e,n,r);a.appendChild(t)}),o.appendChild(a),o},p=function(t,e,n,r){var o=document.createElement("li"),a=document.createElement("a"),r=(a.href="".concat(r,"/parkrunner/").concat(t,"/"),a.target="_blank",e.get(t)||n.get(t)||"Unknown parkrunner");return a.textContent="".concat(r," (A").concat(t,")"),a.style.color=i.linkColor,a.style.textDecoration="none",o.appendChild(a),o},f=function(t){var e=document.createElement("p");return e.textContent=t,e.style.textAlign="center",e.style.fontWeight="bold",e},l=function(t){var e=document.createElement("h3");return e.textContent=t,e.style.textAlign="center",e.style.marginBottom="15px",e.style.color=i.headerColor,e},u=function(t){var e=document.querySelector("h1");e&&e.parentNode?e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t):document.body.insertBefore(t,document.body.firstChild)},e=function(){return(e=o(g().m(function t(e){var n,r,o,a,i,c,u,l;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n="parkrun-launch-returnees-".concat(e),t.p=1,r=localStorage.getItem(n))if(r=JSON.parse(r),o=r.data,r=r.timestamp,Date.now()-r<s)return t.a(2,new Map(o));t.n=2;break;case 2:return t.n=3,fetch(e);case 3:return r=t.v,t.n=4,r.text();case 4:for(o=t.v,l=new DOMParser,l=l.parseFromString(o,"text/html"),a=l.querySelectorAll('a[href*="/parkrunner/"]'),i=new Map,c=0;c<a.length;c++)(u=a[c].href.match(/\/parkrunner\/(\d+)/))&&i.set(u[1],a[c].textContent.trim());return l={data:Array.from(i.entries()),timestamp:Date.now()},localStorage.setItem(n,JSON.stringify(l)),t.a(2,i);case 5:return t.p=5,l=t.v,console.error("Error fetching or parsing:",e,l),t.a(2,new Map)}},t,null,[[1,5]])}))).apply(this,arguments)},c=function(t){return e.apply(this,arguments)},a=function(){for(var t=document.querySelectorAll('a[href*="/parkrunner/"]'),e=new Map,n=0;n<t.length;n++){var r=t[n].href.match(/\/parkrunner\/(\d+)/);r&&e.set(r[1],t[n].textContent.trim())}return e},document.getElementById("parkrun-launch-returnees"))return t.a(2);t.n=1;break;case 1:i={backgroundColor:"#2b223d",headerColor:"#FFA300",textColor:"#EEE",linkColor:"#53BA9D"},s=864e5,n();case 2:return t.a(2)}},t)}))()})();
```

### parkrun p-index display

> The parkrun p-index is an unofficial statistic that measures the number of different parkrun events a person has completed a specific number of times. To achieve a p-index of 10, you must have completed at least 10 different parkrun events 10 times each. This script calculate the p-index for a parkrunner and displays it on their results page.


[p-index.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/p-index.user.js)

```javascript
javascript:(async()=>{var r,t,e,n,o,i,a,l,d;function s(t,e){return(t=>{if(Array.isArray(t))return t})(t)||((t,e)=>{var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,l=[],d=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;d=!1}else for(;!(d=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);d=!0);}catch(t){s=!0,o=t}finally{try{if(!d&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return l}})(t,e)||((t,e)=>{var n;if(t)return"string"==typeof t?u(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0})(t,e)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function c(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"10px",medium:"15px"},container:{padding:"10px",marginTop:"10px",width:"100%",maxWidth:"800px",aspectRatio:"auto"},typography:{pIndex:"1.2em",listItem:"0.9em"},listItem:{marginBottom:"5px",textAlign:"left"},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"}}:{isMobile:!1,spacing:{small:"20px",medium:"20px"},container:{padding:"20px",marginTop:"20px",width:"auto",maxWidth:"none",aspectRatio:"1"},typography:{pIndex:"1.5em",listItem:"1em"},listItem:{marginBottom:"8px",textAlign:"center"},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"}}}function p(t){var r=[],t=(t.querySelectorAll("tbody > tr").forEach(function(t){var e=t.querySelector("td:nth-child(1) > a").textContent.trim(),n=t.querySelector("td:nth-child(2)").textContent.trim(),t=t.querySelector("td:nth-child(3)").textContent.trim();r.unshift({eventName:e,date:n,eventNumber:t})}),r.reduce(function(t,e){var n=e.eventName,r=e.date,e=e.eventNumber;return t[n]||(t[n]=[]),t[n].push({date:r,eventNumber:e}),t},{}));return Object.entries(t).sort(function(t,e){return e[1].length-t[1].length})}function m(){var t=document.querySelectorAll("#results");return t[t.length-1]}function y(t){var t=t.filter(function(t,e){return s(t,2)[1].length>e}),o=t.length;function i(t){return new Date(t.split("/").reverse().join("-"))}t=t.map(function(t){var t=s(t,2),e=t[0],t=t[1],n=t[0],r=t[o-1];return{eventName:e,eventCount:t.length,firstDate:n.date,firstEventNumber:n.eventNumber,pIndexDate:r.date,pIndexEventNumber:r.eventNumber,firstDateForSorting:i(n.date),pIndexDateForSorting:i(r.date)}}).sort(function(t,e){return t.pIndexDateForSorting-e.pIndexDateForSorting}).slice(0,o).map(function(t){return t.eventName+" ("+t.eventCount+"): "+t.firstDate+" (#"+t.firstEventNumber+") - "+t.pIndexDate+" (#"+t.pIndexEventNumber+")"});return{pIndex:o,contributingEvents:t}}r="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var n=document.createElement("script");n.src=r,n.onload=t,n.onerror=e,document.head.appendChild(n)}),"undefined"!=typeof module&&module.exports?module.exports={calculatePIndex:y,extractEventDetails:p,findResultsTable:m}:(d=m())?(t=(d=y(p(d))).pIndex,d=d.contributingEvents,a=c(),(l=document.querySelector("h2"))&&((e=document.createElement("div")).textContent="p-index: "+t,e.style.fontSize=a.typography.pIndex,e.style.fontWeight="bold",e.style.marginTop=a.container.marginTop,e.style.backgroundColor="#2b223d",e.style.color="#ffa300",e.style.padding=a.container.padding,e.style.borderRadius="5px",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="center",e.style.width=a.container.width,e.style.maxWidth=a.container.maxWidth,e.style.marginLeft="auto",e.style.marginRight="auto",e.style.aspectRatio=a.container.aspectRatio,e.setAttribute("id","p-index-display"),(n=document.createElement("ul")).style.listStyleType="none",n.style.padding="0",n.style.marginTop=a.spacing.small,n.style.width="100%",d.forEach(function(t){var e=document.createElement("li");e.textContent=t,e.style.fontWeight="normal",e.style.fontSize=a.typography.listItem,e.style.marginBottom=a.listItem.marginBottom,e.style.textAlign=a.listItem.textAlign,e.style.wordBreak="break-word",n.appendChild(e)}),e.appendChild(n),o=e,t=c(),(d=document.createElement("div")).style.marginTop=t.button.marginTop,d.id="p-index-download-btn-container",(i=document.createElement("button")).textContent="ðŸ’¾ Save as Image",i.style.padding=t.button.padding,i.style.backgroundColor="#ffa300",i.style.color="#2b223d",i.style.border="none",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.fontSize=t.button.fontSize,i.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),i.addEventListener("mouseout",function(){this.style.backgroundColor="#ffa300"}),i.addEventListener("click",function(){i.style.display="none",html2canvas(o,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(function(t){i.style.display="block";var e=document.createElement("a"),n=(new Date).toISOString().split("T")[0],r=window.location.pathname.split("/")[2]||"parkrunner";e.download="p-index-".concat(r,"-").concat(n,".png"),e.href=t.toDataURL("image/png"),e.click()})}),d.appendChild(i),o.appendChild(d),l.parentNode.insertBefore(e,l.nextSibling),a.isMobile||setTimeout(function(){var t=e.getBoundingClientRect(),t=Math.max(t.width,t.height);e.style.width=t+"px",e.style.height=t+"px"},0))):console.error("Results table not found")})();
```

### parkrun Position Bingo Challenge

> Tracks progress on the unofficial parkrun position bingo challenge (last two digits of position) with a 10x10 grid visualization and detailed event info.


[position-bingo.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/position-bingo.user.js)

```javascript
javascript:(async()=>{var o,e,t,c;function p(e,t){var n,o,i,r,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return i=!(o=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){i=!0,n=e},f:function(){try{o||null==a.return||a.return()}finally{if(i)throw n}}};if(Array.isArray(e)||(a=((e,t)=>{var n;if(e)return"string"==typeof e?l(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0})(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function m(){return window.innerWidth<768?{isMobile:!0,container:{padding:"10px",marginTop:"10px"},typography:{heading:"1.1em",stats:"1em",statsSubtext:"0.9em"},grid:{boxSize:28,gapSize:3,cellFontSize:"0.7em",cellPadding:"1px",positionFontSize:"0.9em",eventFontSize:"0.65em",dateFontSize:"0.6em"},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"}}:{isMobile:!1,container:{padding:"20px",marginTop:"20px"},typography:{heading:"1.3em",stats:"1.2em",statsSubtext:"1em"},grid:{boxSize:100,gapSize:5,cellFontSize:"0.9em",cellPadding:"2px",positionFontSize:"1.2em",eventFontSize:"0.8em",dateFontSize:"0.7em"},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"}}}function n(r){for(var e,i,n=m(),t=document.createElement("div"),o=(t.id="positionBingoContainer",t.className="parkrun-position-bingo-container",t.style.width="100%",t.style.maxWidth="1200px",t.style.margin="".concat(n.container.marginTop," auto"),t.style.padding=n.container.padding,t.style.backgroundColor="#2b223d",t.style.borderRadius="8px",t.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",t.style.color="#e0e0e0",t.style.textAlign="center",document.createElement("h3")),o=(o.textContent="Position Bingo Challenge",o.style.marginBottom=n.isMobile?"8px":"10px",o.style.color="#FFA300",o.style.fontSize=n.typography.heading,t.appendChild(o),document.createElement("div")),o=(o.innerHTML='<div style="font-size: '.concat(n.typography.stats,"; margin-bottom: ").concat(n.isMobile?"8px":"10px",';">')+"<strong>"+r.completedCount+" of "+c+"</strong> positions completed</div>"+'<div style="font-size: '.concat(n.typography.statsSubtext,';">After ')+r.totalEvents+" parkruns</div>",t.appendChild(o),Math.ceil(c/10)),a=n.grid.boxSize,l=n.grid.gapSize,s=document.createElement("div"),d=(s.style.display="grid",s.style.gridTemplateColumns="repeat(".concat(10,", ").concat(a,"px)"),s.style.gridTemplateRows="repeat(".concat(o,", ").concat(a,"px)"),s.style.gap="".concat(l,"px"),s.style.margin="0 auto",s.style.justifyContent="center",0);d<c;d++)(o=>{var e=document.createElement("div"),t=(e.style.boxSizing="border-box",e.style.border="1px solid #666",e.style.borderRadius="4px",e.style.backgroundColor=r.completedPositions[o]?"#FFA300":"#008080",e.style.color="#fff",e.style.textAlign="left",e.style.padding=n.grid.cellPadding,e.style.fontWeight="bold",e.style.fontSize=n.grid.cellFontSize,e.style.cursor=r.completedPositions[o]?"pointer":"default",e.style.aspectRatio="1",document.createElement("div"));t.textContent=o.toString().padStart(2,"0"),t.style.fontSize=n.grid.positionFontSize,t.style.marginBottom=n.isMobile?"2px":"5px",e.appendChild(t),r.completedPositions[o]&&((t=document.createElement("div")).innerHTML='<div style="font-size: '.concat(n.grid.eventFontSize,'; text-align: center;">')+r.completedPositions[o][0].eventName+"<br>"+'<span style="font-size: '.concat(n.grid.dateFontSize,';">')+r.completedPositions[o][0].date+" ("+r.completedPositions[o][0].position+")</span></div>",n.isMobile&&(t.style.display="none"),e.appendChild(t),e.addEventListener("click",function(){var e=m(),t=document.createElement("div"),i=(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.zIndex="999",t.addEventListener("click",function(){document.body.removeChild(t)}),document.createElement("div")),n=(i.style.position="fixed",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",i.style.backgroundColor="#2b223d",i.style.color="#fff",e.isMobile?"15px":"20px"),n=(i.style.padding=n,i.style.borderRadius="8px",i.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",i.style.zIndex="1000",i.style.maxWidth=e.isMobile?"95%":"90%",i.style.maxHeight=e.isMobile?"85%":"80%",i.style.overflowY="auto",i.style.fontSize=e.isMobile?"0.9em":"1em",document.createElement("h4"));n.textContent="Position ".concat(o.toString().padStart(2,"0")),n.style.marginBottom="10px",n.style.color="#FFA300",i.appendChild(n),r.completedPositions[o].forEach(function(e){var t=e.eventName,n=e.date,e=e.position,o=document.createElement("div");o.style.marginBottom="10px",o.innerHTML="<strong>"+t+'</strong><br><span style="font-size: 0.9em;">'+n+" ("+e+")</span>",i.appendChild(o)}),t.appendChild(i),document.body.appendChild(t)})),s.appendChild(e)})(d);return t.appendChild(s),e=t,o=m(),(a=document.createElement("div")).style.marginTop=o.button.marginTop,a.id="position-bingo-download-btn-container",(i=document.createElement("button")).textContent="ðŸ’¾ Save as Image",i.style.padding=o.button.padding,i.style.backgroundColor="#FFA300",i.style.color="#2b223d",i.style.border="none",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.fontSize=o.button.fontSize,i.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),i.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),i.addEventListener("click",function(){i.style.display="none",html2canvas(e,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(function(e){i.style.display="block";var t=document.createElement("a"),n=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/")[2]||"parkrunner";t.download="position-bingo-".concat(o,"-").concat(n,".png"),t.href=e.toDataURL("image/png"),t.click()})}),a.appendChild(i),e.appendChild(a),t}o="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=o,n.onload=e,n.onerror=t,document.head.appendChild(n)}),c=100,(t=(t=document.querySelectorAll("#results"))[t.length-1])?(t=t=n((e=>{var t,n={},o=0,i=p(Array.from(e.querySelectorAll("tr")).reverse());try{for(i.s();!(t=i.n()).done;){var r=t.value.querySelectorAll("td");if(!(r.length<5)){var a=r[3].textContent.trim(),l=parseInt(a.slice(-2),10),s=r[0].textContent.trim(),d=r[1].textContent.trim();if(!isNaN(l)&&0<=l&&l<c&&(n[l]||(n[l]=[]),n[l].push({eventName:s,date:d,position:a}),Object.keys(n).length===c))break;o++}}}catch(e){i.e(e)}finally{i.f()}return{completedPositions:n,remainingPositions:Array.from({length:c},function(e,t){return t}).filter(function(e){return!n[e]}),completedCount:Object.keys(n).length,totalEvents:o}})(t)),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")})();
```

### parkrun Stopwatch Bingo

> Visualizes your progress on the stopwatch bingo challenge (collecting seconds 00-59)


[stopwatch-bingo.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/stopwatch-bingo.user.js)

```javascript
javascript:(async()=>{var n,k;function o(){var t=document.querySelectorAll("#results");return t[t.length-1]}function l(t){for(var e={},o={},n=0,l=0,r=null,a=null,t=t.querySelectorAll("tr"),i=[],c=(t.forEach(function(t){t=t.querySelectorAll("td");if(!(t.length<5)){var e=t[0].textContent.trim(),o=t[1].textContent.trim(),n=t[2].textContent.trim(),t=t[4].textContent.trim();if(t&&n&&o&&e){var l,e="".concat(e," # ").concat(n),n=t.match(/(\d+):(\d+):(\d+)/);if(n)l=parseInt(n[3],10);else{n=t.match(/(\d+):(\d+)/);if(!n)return;l=parseInt(n[2],10)}i.push({secondValue:l,date:o,event:e,time:t})}}}),i.reverse()),s=0;s<c.length;s++){var d=c[s],p=d.secondValue,m=d.date,u=d.event,d=d.time;if(l++,!(p in e||(e[p]={date:m,event:u,time:d},60!=++n)||a)){o[p]=[{date:a=m,event:r=u,time:d}];break}o[p]||(o[p]=[]),o[p].push({date:m,event:u,time:d})}return{seconds:e,timeData:o,collectedCount:n,totalParkruns:l,dateOfCompletion:a,firstCompleteEvent:r}}function r(g){t="Stopwatch Bingo Challenge",(o=document.createElement("div")).id||(o.id="stopwatchBingoContainer"),o.className="parkrun-bingo-container",o.style.width="100%",o.style.maxWidth="800px",o.style.margin="20px auto",o.style.padding=window.innerWidth<768?"10px":"20px",o.style.backgroundColor=k.backgroundColor,o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",o.style.textAlign="center",(e=document.createElement("h3")).textContent=t,e.style.marginBottom="15px",e.style.color=k.clockBorderColor,e.style.fontSize=window.innerWidth<768?"1.1em":"1.3em",o.appendChild(e);var t=o,e=window.innerWidth<768,o=document.createElement("div");o.style.marginBottom=e?"10px":"20px",o.style.color=k.textColor;for(var n=e?"0.95em":"1.1em",l='<div style="font-size: '.concat(e?"1em":"1.2em",'; margin-bottom: 10px;"><strong>').concat(g.collectedCount," of 60</strong> seconds collected</div>"),x=(l+='<div style="font-size: '.concat(e?"0.9em":"1em",';">After ').concat(g.totalParkruns," parkruns</div>"),g.dateOfCompletion&&(l+='<div style="margin-top: 10px; font-size: '.concat(n,';">ðŸ† Bingo completed on ').concat(g.dateOfCompletion," (").concat(g.firstCompleteEvent,")</div>")),o.innerHTML=l,t.appendChild(o),e?Math.min(320,window.innerWidth-40):500),b=x/500,C=document.createElement("div"),v=(C.style.position="relative",C.style.width="".concat(x,"px"),C.style.height="".concat(x,"px"),C.style.margin="0 auto",C.style.borderRadius="50%",C.style.border="".concat(Math.round(10*b),"px solid ").concat(k.clockBorderColor),C.style.backgroundColor=k.clockFaceColor,C.style.boxSizing="content-box",1),r=0;r<60;r++){var a=g.timeData[r]?g.timeData[r].length:0;v<a&&(v=a)}for(var i=function(i){if(!(i in g.seconds))return 1;var t=g.timeData[i]?g.timeData[i].length:0,e=((i-.4)/60*360-90)*(Math.PI/180),o=Math.PI/180*((i+.4)/60*360-90),n=document.createElement("div"),l=(n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",220*b),r=50*b,a=x/2,c=x/2,s=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=(s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.zIndex="1",document.createElementNS("http://www.w3.org/2000/svg","path")),l=r+Math.max(0,Math.round(t/v*(l-r))),p=a+r*Math.cos(e),m=c+r*Math.sin(e),u=a+l*Math.cos(e),e=c+l*Math.sin(e),y=a+l*Math.cos(o),h=c+l*Math.sin(o),a=a+r*Math.cos(o),c=c+r*Math.sin(o),o=["M ".concat(p,",").concat(m),"L ".concat(u,",").concat(e),"A ".concat(l,",").concat(l," 0 0,1 ").concat(y,",").concat(h),"L ".concat(a,",").concat(c),"A ".concat(r,",").concat(r," 0 0,0 ").concat(p,",").concat(m),"Z"].join(" ");d.setAttribute("d",o),d.setAttribute("fill",k.completedColor),d.setAttribute("opacity","1"),d.setAttribute("title","".concat(i.toString().padStart(2,"0")," Seconds - ").concat(t," ").concat(1===t?"Time":"Times")),d.style.cursor="pointer",d.style.pointerEvents="auto",d.addEventListener("click",function(){var t,e,o,n,l,r,a;t=i,e=g.timeData[i],(o=document.getElementById("second-details-popup"))&&o.remove(),(n=document.createElement("div")).id="second-details-popup",n.style.position="fixed",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.width="400px",n.style.maxHeight="500px",n.style.overflowY="auto",n.style.backgroundColor=k.backgroundColor,n.style.borderRadius="8px",n.style.padding="20px",n.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.5)",n.style.zIndex="1000",n.style.color=k.textColor,(o=document.createElement("div")).textContent="âœ•",o.style.position="absolute",o.style.top="10px",o.style.right="15px",o.style.fontSize="20px",o.style.cursor="pointer",o.addEventListener("click",function(){return n.remove()}),n.appendChild(o),(o=document.createElement("h3")).textContent="".concat(t.toString().padStart(2,"0")," Seconds - ").concat(e.length," Times"),o.style.marginBottom="15px",o.style.color=k.clockBorderColor,n.appendChild(o),(t=document.createElement("table")).style.width="100%",t.style.borderCollapse="collapse",t.style.marginTop="10px",o=document.createElement("thead"),l=document.createElement("tr"),[{title:"Date",align:"left"},{title:"Event",align:"left"},{title:"Time",align:"left"}].forEach(function(t){var e=document.createElement("th");e.textContent=t.title,e.style.textAlign=t.align,e.style.padding="8px",e.style.borderBottom="1px solid #555",l.appendChild(e)}),o.appendChild(l),t.appendChild(o),r=document.createElement("tbody"),e.forEach(function(t,e){var o=document.createElement("tr"),e=(o.style.backgroundColor=0===e?"rgba(255, 163, 0, 0.2)":"transparent",[{content:t.date},{content:t.event},{content:t.time}].map(function(t){return'<td style="padding: 8px; border-bottom: 1px solid #444;">'.concat(t.content,"</td>")}).join(""));o.innerHTML=e,r.appendChild(o)}),t.appendChild(r),n.appendChild(t),document.body.appendChild(n),(a=document.createElement("div")).style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.backgroundColor="rgba(0, 0, 0, 0.5)",a.style.zIndex="999",a.addEventListener("click",function(){n.remove(),a.remove()}),document.body.appendChild(a)}),s.appendChild(d),n.appendChild(s),C.appendChild(n)},c=0;c<60;c++)i(c);var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.pointerEvents="none",s.style.zIndex="2";for(var d=0;d<60;d+=5){var p=(d/60*360-90)*(Math.PI/180),m=245*b,u=(d%15==0?210:225)*b,y=x/2,h=x/2,f=document.createElementNS("http://www.w3.org/2000/svg","line"),m=(f.setAttribute("x1",y+u*Math.cos(p)),f.setAttribute("y1",h+u*Math.sin(p)),f.setAttribute("x2",y+m*Math.cos(p)),f.setAttribute("y2",h+m*Math.sin(p)),f.setAttribute("stroke",k.textColor),f.setAttribute("stroke-width",(d%15==0?3:2)*b),s.appendChild(f),u-(d%15==0?25:20)*b),f=y+m*Math.cos(p),u=h+m*Math.sin(p),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",f),y.setAttribute("y",u),y.setAttribute("fill",k.textColor),y.setAttribute("font-size","".concat((d%15==0?16:14)*b,"px")),y.setAttribute("font-weight","bold"),y.setAttribute("text-anchor","middle"),y.setAttribute("dominant-baseline","middle"),y.textContent=d.toString(),s.appendChild(y)}C.appendChild(s);var w,E,n=document.createElement("div"),n=(n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.width="".concat(100*b,"px"),n.style.height="".concat(100*b,"px"),n.style.borderRadius="50%",n.style.backgroundColor=k.clockBorderColor,n.style.display="flex",n.style.justifyContent="center",n.style.alignItems="center",n.style.color=k.backgroundColor,n.style.fontWeight="bold",n.style.fontSize="".concat(20*b,"px"),n.style.zIndex="3",n.textContent="".concat(Math.round(g.collectedCount/60*100),"%"),C.appendChild(n),t.appendChild(C),w=t,l=window.innerWidth<768,(o=document.createElement("div")).style.marginTop=l?"10px":"15px",o.id="bingo-download-btn-container",(E=document.createElement("button")).textContent="ðŸ’¾ Save as Image",E.style.padding=l?"6px 12px":"8px 15px",E.style.backgroundColor=k.clockBorderColor,E.style.color=k.backgroundColor,E.style.border="none",E.style.borderRadius="4px",E.style.cursor="pointer",E.style.fontWeight="bold",E.style.fontSize=l?"0.9em":"1em",E.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),E.addEventListener("mouseout",function(){this.style.backgroundColor=k.clockBorderColor}),E.addEventListener("click",function(){E.style.display="none",html2canvas(w,{backgroundColor:k.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(function(t){E.style.display="block";var e=document.createElement("a"),o=(new Date).toISOString().split("T")[0],n=window.location.pathname.split("/")[2]||"parkrunner";e.download="stopwatch-bingo-".concat(n,"-").concat(o,".png"),e.href=t.toDataURL("image/png"),e.click()})}),o.appendChild(E),w.appendChild(o),document.createElement("div"));return n.style.marginTop=e?"10px":"20px",n.style.color=k.subtleTextColor,n.style.fontSize=e?"0.8em":"0.9em",n.style.padding=e?"0 5px":"0",n.innerHTML="Stopwatch Bingo: collect finish times with every second from 00-59.<br>Orange segments show seconds you've collected. Segment length indicates frequency.<br>Click on any segment to see details.",t.appendChild(n),t}function t(){var t,e;document.querySelector("#results")?document.querySelector("h2")&&(t=r(l(o())),t=t,e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)):console.log("Results table not found")}n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var o=document.createElement("script");o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)}),k={backgroundColor:"#2b223d",clockBorderColor:"#FFA300",clockFaceColor:"#333",completedColor:"#FFA300",textColor:"#e0e0e0",subtleTextColor:"#cccccc"},"undefined"!=typeof module&&module.exports?module.exports={findResultsTable:o,extractFinishTimes:l}:t()})();
```

### parkrun Volunteer Days Display

> Displays the number of volunteer days for parkrun finishers on results pages, for celebration purposes (and let's not make assumptions about ratios)


[volunteer-days-display.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/volunteer-days-display.user.js)

```javascript
javascript:(async()=>{!function t(){var e,a,n,o;function s(o){var t;e&&((t=Array.from(e.querySelectorAll("tr")).map(function(t,e){return{row:t,index:e}})).sort(function(t,e){var a=parseInt(t.row.getAttribute("data-vols")||"0",10),n=parseInt(e.row.getAttribute("data-vols")||"0",10);return a===n?t.index-e.index:"asc"===o?a-n:n-a}),t.forEach(function(t){return t=t.row,e.appendChild(t)}))}document.querySelector("tr[data-vols]")?(document.querySelectorAll("tr[data-vols] > td.Results-table-td.Results-table-td--name > div.detailed").forEach(function(t){var e,a,n=t.closest("tr").getAttribute("data-vols");n&&0<parseInt(n)&&((e=document.createElement("span")).classList.add("spacer"),e.textContent=" | ",(a=document.createElement("span")).textContent="".concat(n," volunteer day").concat("1"===n?"":"s"),a.classList.add("volunteer-days"),(n=t.firstElementChild)?(n.insertAdjacentElement("afterend",e),e.insertAdjacentElement("afterend",a)):t.appendChild(a))}),(o=document.querySelector("tr[data-vols]"))&&(e=o.closest("tbody"),o=document.querySelector('select[name="sort"], .Results-sort select, select.Results-sort, .Results-controls select'))&&(o.querySelector('option[value="vols-asc"]')||(a=new Option("Sort by Volunteer days â–²","vols-asc"),n=new Option("Sort by Volunteer days â–¼","vols-desc"),o.appendChild(a),o.appendChild(n)),o.dataset.volsSortWired||(o.addEventListener("change",function(t){var e=t.target.value||"";"vols-asc"!==e&&"vols-desc"!==e||(t.cancelable&&t.preventDefault(),"function"==typeof t.stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof t.stopPropagation&&t.stopPropagation(),s(e.endsWith("asc")?"asc":"desc"))},!0),o.addEventListener("change",function(t){"vols-asc"===(t=t.target.value||"")?s("asc"):"vols-desc"===t&&s("desc")}),o.dataset.volsSortWired="true"))):setTimeout(t,500)}()})();
```

### parkrun Walker Analysis

> Highlight and summarize walkers (>=10:00/km) and compare with faster participants on parkrun results pages.


[parkrun-walker-analysis.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-walker-analysis.user.js)

```javascript
javascript:(async()=>{var r;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(){var f,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,i,a,l,u,c,s,d,p,t=t&&t.prototype instanceof b?t:b,t=Object.create(t.prototype);return g(t,"_invoke",(o=e,i=n,s=r||[],d=!1,p={p:c=0,n:0,v:f,a:m,f:m.bind(f,4),d:function(e,t){return a=e,l=0,u=f,p.n=t,y}},function(e,t,n){if(1<c)throw TypeError("Generator is already running");for(d&&1===t&&m(t,n),l=t,u=n;(h=l<2?f:u)||!d;){a||(l?l<3?(1<l&&(p.n=-1),m(l,u)):p.n=u:p.v=u);try{if(c=2,a){if(h=a[e=l?e:"next"]){if(!(h=h.call(a,u)))throw TypeError("iterator result is not an object");if(!h.done)return h;u=h.value,l<2&&(l=0)}else 1===l&&(h=a.return)&&h.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+e+"' method"),l=1);a=f}else if((h=(d=p.n<0)?u:o.call(i,p))!==y)break}catch(e){a=f,l=1,u=e}finally{c=1}}return{value:h,done:d}}),!0),t;function m(e,t){for(l=e,u=t,h=0;!d&&c&&!n&&h<s.length;h++){var n,r=s[h],o=p.p,i=r[2];3<e?(n=i===t)&&(u=r[(l=r[4])?5:l=3],r[4]=r[5]=f):r[0]<=o&&((n=e<2&&o<r[1])?(l=0,p.v=t,p.n=r[1]):o<i&&(n=e<3||r[0]>t||i<t)&&(r[4]=e,r[5]=t,p.n=i,l=0))}if(n||1<e)return y;throw d=!0,t}}var y={};function b(){}function o(){}function i(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(g(h={},t,function(){return this}),h),a=i.prototype=b.prototype=Object.create(e);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,g(e,n,"GeneratorFunction")),e.prototype=Object.create(a),e}return g(a,"constructor",o.prototype=i),g(i,"constructor",o),g(i,n,o.displayName="GeneratorFunction"),g(a),g(a,n,"Generator"),g(a,t,function(){return this}),g(a,"toString",function(){return"[object Generator]"}),(N=function(){return{w:r,m:l}})()}function g(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(g=function(e,t,n,r){function o(t,n){g(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function u(e,t,n,r,o,i,a){try{var l=e[i](a),u=l.value}catch(e){return n(e)}l.done?t(u):Promise.resolve(u).then(r,o)}function O(l){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=l.apply(e,a);function o(e){u(r,t,n,o,i,"next",e)}function i(e){u(r,t,n,o,i,"throw",e)}o(void 0)})}}function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function a(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=(e=>(e=((e,t)=>{if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=i(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")})(e,"string"),"symbol"==i(e)?e:e+""))(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=r,n.onload=e,n.onerror=t,document.head.appendChild(n)});var T,V,j,B,M,U,D,e,I="undefined"!=typeof window&&window.Chart?window.Chart:void 0;function n(o){return o.map(function(e,t){var n,r;return e.timeStr&&0<e.timeSec?e:(n=(n=(n=o).slice(0,t).reverse().find(function(e){return e.timeStr&&0<e.timeSec}))?n.timeSec:null,t=(r=(r=o).slice(t+1).find(function(e){return e.timeStr&&0<e.timeSec}))?r.timeSec:null,r=n||t||0,a(a({},e),{},{timeSec:r,estimatedTime:0<r}))})}function P(){var e,t="",n="",r="",o="undefined"!=typeof document?document.querySelector("h1"):null,o=(o?t=o.textContent.trim():"undefined"!=typeof document&&document.title&&(t=document.title.split("-")[0].trim()),"undefined"!=typeof document?document.querySelector("h3"):null);return o&&((e=(o=o.textContent).match(/(\d{1,2}\/\d{1,2}\/\d{2,4})/))&&(n=e[1]),e=o.match(/#(\d+)/))&&(r=e[1]),{eventName:t,eventDate:n,eventNumber:r}}function R(e,t){var n=e.eventName?e.eventName.replace(/[^a-z0-9]+/gi,"").toLowerCase():"event",r=e.eventDate?e.eventDate.replace(/\//g,"_"):"date",e=e.eventNumber||"num";return"".concat(n,"_").concat(r,"_").concat(e,"_").concat(t,".png")}function L(e){var t=5;try{"string"==typeof e&&e&&e.toLowerCase().includes("-juniors")&&(t=2)}catch(e){}return 10*t*60}function d(e,t){for(var n=0,r=[1e3,500,250,100,50,25,10];n<r.length;n++){var o=r[n];if(o<=e)return{status:"".concat(t," ").concat(o," Club"),milestone:o}}return{status:null,milestone:0}}function G(){D.innerHTML="Breakdown: "+j.map(function(e){return'<button style="margin:0 8px;padding:6px 12px;border-radius:4px;border:none;background:'.concat(B===e.key?"#FFA300":"#00CEAE",';color:#2b223d;font-weight:bold;cursor:pointer;" data-key="').concat(e.key,'">').concat(e.label,"</button>")}).join(""),D.querySelectorAll("button").forEach(function(t){t.onclick=function(){var e;e=t.getAttribute("data-key"),B=e,o()}})}function o(){G();for(var o,r,n,i,a,t,l,u,c,s,d,p,m,e=document.getElementById("walkerRunnerSummaryTable"),f=(e||((e=document.createElement("div")).id="walkerRunnerSummaryTable"),e.innerHTML=(o=B,t=L("undefined"!=typeof document&&document.location?document.location.href:""),l=T.filter(function(e){return e.timeSec>=t}),u=T.filter(function(e){return 0<e.timeSec&&e.timeSec<t}),c=l.length,s=u.length,d=new Set,l.forEach(function(e){return d.add(e[o]||"Unknown")}),u.forEach(function(e){return d.add(e[o]||"Unknown")}),b=Array.from(d),"ageGroup"===o?((b=b.filter(function(e){return e&&"Unknown"!==e&&"Not specified"!==e})).sort(function(e,t){e=parseInt((e||"").split("-")[0],10),t=parseInt((t||"").split("-")[0],10);return isNaN(e)?1:isNaN(t)?-1:e-t}),d.has("Not specified")&&b.push("Not specified"),d.has("Unknown")&&b.push("Unknown")):"parkrunExperience"===o?(r=["First Timer (anywhere)","First Timer (to this event)","Multiple parkruns","parkrun 10 Club","parkrun 25 Club","parkrun 50 Club","parkrun 100 Club","parkrun 250 Club","parkrun 500 Club","parkrun 1000 Club"],n=function(e){var t,n=r.indexOf(e);return-1!==n?n:(n=e.match(/parkrun (\d+) Club/))?(n=parseInt(n[1],10),-1!==(t=[10,25,50,100,250,500,1e3].indexOf(n))?3+t:200+n):"Unknown"===e?9999:999},b.sort(function(e,t){return n(e)-n(t)})):"volunteerStatus"===o?(i=["Yet to Volunteer","Volunteered once","Volunteered multiple times","Volunteer 10 Club","Volunteer 25 Club","Volunteer 50 Club","Volunteer 100 Club","Volunteer 250 Club","Volunteer 500 Club","Volunteer 1000 Club"],a=function(e){var t=i.indexOf(e);return-1!==t?t:(t=e.match(/(\d+)/))?200+parseInt(t[1],10):"Has Volunteered"===e?150:"Unknown"===e?9999:999},b.sort(function(e,t){return a(e)-a(t)})):b.sort(),f=(p=c+s)?(c/p*100).toFixed(1):"0.0",y=p?(s/p*100).toFixed(1):"0.0",m='<div style="text-align:center;margin-bottom:0.5em;font-size:1.08em;">\n      <strong>Walkers:</strong> '.concat(c," (").concat(f,"%) &nbsp; | &nbsp; <strong>Runners:</strong> ").concat(s," (").concat(y,"%) &nbsp; | &nbsp; <strong>Total finishers:</strong> ").concat(p,"\n    </div>"),m+='<table class="Results-table" style="margin:1em auto;font-size:1.1em;">\n      <thead><tr><th>'.concat(j.find(function(e){return e.key===o}).label,"</th><th>Walkers (n)</th><th>Walkers (%)</th><th>Runners (n)</th><th>Runners (%)</th><th>Total (n)</th><th>Total (%)</th></tr></thead><tbody>"),b.forEach(function(t){var e=l.filter(function(e){return(e[o]||"Unknown")===t}).length,n=u.filter(function(e){return(e[o]||"Unknown")===t}).length,r=e+n;m+="<tr><td>".concat(t,'</td><td style="text-align:right">').concat(e,'</td><td style="text-align:right">').concat(c?(e/c*100).toFixed(1):"0.0",'%</td><td style="text-align:right">').concat(n,'</td><td style="text-align:right">').concat(s?(n/s*100).toFixed(1):"0.0",'%</td><td style="text-align:right">').concat(r,'</td><td style="text-align:right">').concat(p?(r/p*100).toFixed(1):"0.0","%</td></tr>")}),m=m+'<tr style="font-weight:bold;"><td>Total</td><td style="text-align:right">'.concat(c,'</td><td style="text-align:right">100.0%</td><td style="text-align:right">').concat(s,'</td><td style="text-align:right">100.0%</td><td style="text-align:right">').concat(p,'</td><td style="text-align:right">100.0%</td></tr>')+"</tbody></table>"),document.getElementById("walkerAnalysisContainer")),y=(f||((f=document.createElement("div")).id="walkerAnalysisContainer",f.style.width="100%",f.style.maxWidth="900px",f.style.margin="20px auto"),f.innerHTML="",document.getElementById(M)),b=(y||((y=document.createElement("div")).id=M),f.appendChild(y),f.appendChild(D),f.appendChild(e),document.querySelector("h3")),h=(b&&b.parentNode?f.parentNode===b.parentNode&&f.previousSibling===b||(b.nextSibling?b.parentNode.insertBefore(f,b.nextSibling):b.parentNode.appendChild(f)):document.body.appendChild(f),B),y=j.find(function(e){return e.key===B}).label,e=M,g=(b=(n=>{var r={},o=1/0,i=0;return T.forEach(function(e){var t;0!==e.timeSec&&(t=Math.floor(e.timeSec/60),o=Math.min(o,t),i=Math.max(i,t),r[t]||(r[t]={}),e=e[n]||"Unknown",r[t][e]=(r[t][e]||0)+1)}),{bins:r,minMinute:o,maxMinute:i}})(h)).bins,v=b.maxMinute,k=[],x=b.minMinute;x<=v;x++)k.push(x);var C=new Set,w=(Object.values(g).forEach(function(e){return Object.keys(e).forEach(function(e){return C.add(e)})}),Array.from(C)),E=(w=((e,t)=>{var n,r,o,i,a;return"ageGroup"===t?((n=e.filter(function(e){return e&&"Unknown"!==e&&"Not specified"!==e})).sort(function(e,t){e=parseInt((e||"").split("-")[0],10),t=parseInt((t||"").split("-")[0],10);return isNaN(e)?1:isNaN(t)?-1:e-t}),e.includes("Not specified")&&n.push("Not specified"),e.includes("Unknown")&&n.push("Unknown"),n):"parkrunExperience"===t?(r=["First Timer (anywhere)","First Timer (to this event)","Multiple parkruns","parkrun 10 Club","parkrun 25 Club","parkrun 50 Club","parkrun 100 Club","parkrun 250 Club","parkrun 500 Club","parkrun 1000 Club"],o=function(e){var t,n=r.indexOf(e);return-1!==n?n:(n=e.match(/parkrun (\d+) Club/))?(n=parseInt(n[1],10),-1!==(t=[10,25,50,100,250,500,1e3].indexOf(n))?3+t:200+n):"Unknown"===e?9999:999},e.slice().sort(function(e,t){return o(e)-o(t)})):"volunteerStatus"===t?(i=["Yet to Volunteer","Volunteered once","Volunteered multiple times","Volunteer 10 Club","Volunteer 25 Club","Volunteer 50 Club","Volunteer 100 Club","Volunteer 250 Club","Volunteer 500 Club","Volunteer 1000 Club"],a=function(e){var t=i.indexOf(e);return-1!==t?t:(t=e.match(/(\d+)/))?200+parseInt(t[1],10):"Has Volunteered"===e?150:"Unknown"===e?9999:999},e.slice().sort(function(e,t){return a(e)-a(t)})):e.slice().sort()})(w,h)).map(function(t){return{label:t,data:k.map(function(e){return g[e]&&g[e][t]?g[e][t]:0}),backgroundColor:(e=t,"volunteerStatus"===h?(r=e.match(/(\d+)/))?(r=parseInt(r[1],10),V[r]||"#cccccc"):V[e]||"#cccccc":"parkrunExperience"===h?(r=e.match(/(\d+)/))?(r=parseInt(r[1],10),V[r]||"#cccccc"):{"First Timer (anywhere)":"#FFE049","First Timer (to this event)":"#FFA300","Multiple parkruns":"#00CEAE",Unknown:"#A1B6B7"}[e]||"#cccccc":"gender"===h?{Male:"#00CEAE",Female:"#E21145","Not specified":"#FFE049",Unknown:"#A1B6B7"}[e]||"#FFA300":"ageGroup"===h?"Not specified"===e?"#F2F2F2":"Unknown"===e?"#A1B6B7":(r=e.match(/^(\d+)-/))&&(r=parseInt(r[1],10),n=["#DA70D6","#9370DB","#6495ED","#4169E1","#1E90FF","#00BFFF","#00CED1","#20B2AA","#3CB371","#32CD32","#9ACD32","#FFD700","#FFA500","#FF8C00","#FF6347","#DC143C","#DB7093"],r=Math.floor((r-10)/5),n[Math.min(r,n.length-1)])||"#cccccc":["#FFA300","#00CEAE","#E21145","#EBE9F0","#FFE049","#2C504A","#6D5698","#C81D31","#A1B6B7"][w.indexOf(e)%9]),stack:"stack1"};var e,n,r}),F=k.map(function(e){var t=Math.floor(e/60),e=e%60;return"".concat(t,":").concat(e.toString().padStart(2,"0"))}),S=document.getElementById(e);S?S.innerHTML="":(S=document.createElement("div")).id=e,S.style.background="#2b223d",S.style.borderRadius="8px",S.style.margin="20px auto",S.style.padding="15px",S.style.maxWidth="900px",S.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",(b=document.createElement("h3")).textContent="Finishers per Minute by ".concat(y),b.style.textAlign="center",b.style.marginBottom="15px",b.style.color="#FFA300",S.appendChild(b);var A=document.createElement("canvas");S.appendChild(A),(e=document.createElement("button")).textContent="ðŸ’¾ Save as Image",e.style.padding="6px 12px",e.style.backgroundColor="#FFA300",e.style.color="#2b223d",e.style.border="none",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.fontWeight="bold",e.style.display="inline-block",e.style.margin="10px auto 0 auto",e.title="Download chart as PNG image",e.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),e.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),e.addEventListener("click",O(N().m(function e(){var t,n,r,o,i,a,l,u,c,s,d,p;return N().w(function(e){for(;;)switch(e.n){case 0:try{t=P(),n=S.querySelector("h3"),r=n?n.textContent.replace(/[^a-z0-9]+/gi,"-").replace(/^-+|-+$/g,"").toLowerCase():"chart",o=R(t,r),a=(i=A).width,l=a,u=i.height+100,(c=document.createElement("canvas")).width=l,c.height=u,(s=c.getContext("2d")).fillStyle="#2b223d",s.fillRect(0,0,l,u),s.fillStyle="#FFA300",s.textAlign="center",s.textBaseline="middle",s.font="bold 56px Arial",d=n?n.textContent:"Finishers per Minute",s.fillText(d,l/2,50),s.drawImage(i,0,100),(p=document.createElement("a")).download=o,p.href=c.toDataURL("image/png"),p.click()}catch(e){alert("Failed to export image: "+e)}case 1:return e.a(2)}},e)}))),(y=S.querySelector(".walker-controls-footer"))||((y=document.createElement("div")).className="walker-controls-footer",y.style.display="flex",y.style.justifyContent="center",y.style.marginTop="12px",S.appendChild(y)),y.innerHTML="",y.appendChild(e),U&&(U.destroy(),U=null),setTimeout(function(){I&&(U=new I(A.getContext("2d"),{type:"bar",data:{labels:F,datasets:E},options:{responsive:!0,layout:{padding:{left:60,right:60,top:40,bottom:40}},plugins:{legend:{labels:{color:"#e0e0e0"}},title:{display:!1}},scales:{x:{stacked:!0,title:{display:!0,text:"Finish Time",color:"#e0e0e0"},ticks:{color:"#cccccc"},grid:{color:"rgba(200,200,200,0.2)"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:"#e0e0e0"},ticks:{color:"#cccccc",precision:0},grid:{color:"rgba(200,200,200,0.2)"}}}}}))},0),(f=document.getElementById(M))&&f.parentNode?f.nextSibling?f.parentNode.insertBefore(D,f.nextSibling):f.parentNode.appendChild(D):document.body.appendChild(D)}(e=Array.from(document.querySelectorAll("tr.Results-table-row"))).length&&(T=n(e.map(function(e,t){var n=e.querySelector(".Results-table-td--time .compact"),n=n?n.textContent.trim():"",r=(r=n)?2===(r=r.split(":").map(Number)).length?60*r[0]+r[1]:3===r.length?3600*r[0]+60*r[1]+r[2]:0:0,o=(e.getAttribute("data-gender")||"").trim(),i=parseInt(e.getAttribute("data-runs"),10),a=parseInt(e.getAttribute("data-vols"),10),l=(e.getAttribute("data-achievement")||"").trim(),u="Unknown",l=(!isNaN(i)&&0<i&&(u=1===i?"First Timer (anywhere)":"First Timer!"===l?"First Timer (to this event)":!(i<10)&&d(i,"parkrun").status||"Multiple parkruns"),"Unknown"),i=0,a=(isNaN(a)||(0===a?l="Yet to Volunteer":1===a?l="Volunteered once":1<a&&a<10?l="Volunteered multiple times":(l=(a=d(a,"Volunteer")).status||"Has Volunteered",i=a.milestone)),e.innerHTML.match(/milestone-v(\d+)/)),a=(a&&(l="Volunteer ".concat(a[1]," Club"),i=parseInt(a[1],10)),""),c=e.querySelector(".Results-table-td--agegrade"),c=(c&&(c=c.textContent.trim())&&(a=c.replace("%","")),"Unknown"),s=e.getAttribute("data-agegroup")||"",s=(s?c=s.replace(/^[A-Z]+/,""):(s=e.querySelector(".Results-table-td--agegroup"))?c=s.textContent.trim().replace(/^[A-Z]+/,"")||(n?"Not specified":"Unknown"):n&&(c="Not specified"),o.toLowerCase());return{timeStr:n,timeSec:r,gender:s="male"===s||"m"===s?"Male":"female"===s||"f"===s?"Female":n?"Not specified":"Unknown",parkrunExperience:u,volunteerStatus:l,volunteerMilestone:i,ageGrade:a,ageGroup:c,_row:e,_idx:t}})),V={10:"#EBE9F0",25:"#6D5698",50:"#C81D31",100:"#2E393B",250:"#2C504A",500:"#2E4DA7",1e3:"#FFE049","Volunteered once":"#90EE90","Volunteered multiple times":"#00CEAE","Has Volunteered":"#00CEAE","Yet to Volunteer":"#FFA300",Unknown:"#A1B6B7"},j=[{key:"parkrunExperience",label:"parkrun Experience"},{key:"volunteerStatus",label:"Volunteer Experience"},{key:"gender",label:"Gender"},{key:"ageGroup",label:"Age Group"}],B="parkrunExperience",M="finishersStackedChart",U=null,(D=document.getElementById("walkerAnalysisControls"))||((D=document.createElement("div")).id="walkerAnalysisControls",D.style.textAlign="center",D.style.margin="20px 0 10px 0",D.style.color="#e0e0e0",D.style.background="#2b223d",D.style.padding="10px",D.style.borderRadius="8px",D.style.maxWidth="900px",D.style.marginLeft="auto",D.style.marginRight="auto"),o()),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={assignUnknownFinishTimes:n,getEventMetadata:P,generateExportFilename:R,computeWalkerThreshold:L})})();
```

### parkrun Wilson index display

> The "Wilson index" in parkrun is the highest consecutive event number completed, starting from #1. This script calculates and displays a parkrunner's Wilson index on their results page.


[w-index.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/w-index.user.js)

```javascript
javascript:(async()=>{var r;function s(){var h,t="function"==typeof Symbol?Symbol:{},e=t.iterator||"@@iterator",n=t.toStringTag||"@@toStringTag";function r(t,e,n,r){var o,a,i,l,c,s,u,d,f,e=e&&e.prototype instanceof m?e:m,e=Object.create(e.prototype);return g(e,"_invoke",(o=t,a=n,u=r||[],d=!1,f={p:s=0,n:0,v:h,a:p,f:p.bind(h,4),d:function(t,e){return i=t,l=0,c=h,f.n=e,y}},function(t,e,n){if(1<s)throw TypeError("Generator is already running");for(d&&1===e&&p(e,n),l=e,c=n;(x=l<2?h:c)||!d;){i||(l?l<3?(1<l&&(f.n=-1),p(l,c)):f.n=c:f.v=c);try{if(s=2,i){if(x=i[t=l?t:"next"]){if(!(x=x.call(i,c)))throw TypeError("iterator result is not an object");if(!x.done)return x;c=x.value,l<2&&(l=0)}else 1===l&&(x=i.return)&&x.call(i),l<2&&(c=TypeError("The iterator does not provide a '"+t+"' method"),l=1);i=h}else if((x=(d=f.n<0)?c:o.call(a,f))!==y)break}catch(t){i=h,l=1,c=t}finally{s=1}}return{value:x,done:d}}),!0),e;function p(t,e){for(l=t,c=e,x=0;!d&&s&&!n&&x<u.length;x++){var n,r=u[x],o=f.p,a=r[2];3<t?(n=a===e)&&(c=r[(l=r[4])?5:l=3],r[4]=r[5]=h):r[0]<=o&&((n=t<2&&o<r[1])?(l=0,f.v=e,f.n=r[1]):o<a&&(n=t<3||r[0]>e||a<e)&&(r[4]=t,r[5]=e,f.n=a,l=0))}if(n||1<t)return y;throw d=!0,e}}var y={};function m(){}function o(){}function a(){}var x=Object.getPrototypeOf,t=[][e]?x(x([][e]())):(g(x={},e,function(){return this}),x),i=a.prototype=m.prototype=Object.create(t);function l(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,g(t,n,"GeneratorFunction")),t.prototype=Object.create(i),t}return g(i,"constructor",o.prototype=a),g(a,"constructor",o),g(a,n,o.displayName="GeneratorFunction"),g(i),g(i,n,"Generator"),g(i,e,function(){return this}),g(i,"toString",function(){return"[object Generator]"}),(s=function(){return{w:r,m:l}})()}function g(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}(g=function(t,e,n,r){function o(e,n){g(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))})(t,e,n,r)}function c(t,e,n,r,o,a,i){try{var l=t[a](i),c=l.value}catch(t){return n(t)}l.done?e(c):Promise.resolve(c).then(r,o)}function u(l){return function(){var t=this,i=arguments;return new Promise(function(e,n){var r=l.apply(t,i);function o(t){c(r,e,n,o,a,"next",t)}function a(t){c(r,e,n,o,a,"throw",t)}o(void 0)})}}function d(t){return(t=>{if(Array.isArray(t))return o(t)})(t)||(t=>{if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)})(t)||f(t)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function l(t,e){var n,r,o,a,i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return o=!(r=!0),{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,n=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw n}}};if(Array.isArray(t)||(i=f(t))||e&&t&&"number"==typeof t.length)return i&&(t=i),a=0,{s:e=function(){},n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,e){var n;if(t)return"string"==typeof t?o(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function p(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:7,r=null,o=l(t.querySelectorAll('[id="results"]'));try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.querySelector("tr");if(i)if(i.querySelectorAll("th, td").length===n){r=a;break}}}catch(t){o.e(t)}finally{o.f()}return r}function h(t){return Array.from(t.querySelectorAll("tbody > tr")).reverse().map(function(t){var e=t.querySelector("td:nth-child(1)").textContent.trim(),n=t.querySelector("td:nth-child(2)").textContent.trim(),t=t.querySelector("td:nth-child(3)").textContent.trim();return{eventName:e,eventDate:n,eventNumber:parseInt(t,10)}})}function y(t){var e,n=0,r=l(t.map(function(t){return t.eventNumber}).sort(function(t,e){return t-e}));try{for(r.s();!(e=r.n()).done;){var o=e.value;if(n+2<=o)break;o===n+1&&n++}}catch(t){r.e(t)}finally{r.f()}return n}function m(t){for(var e=[],n=0;n<t.length;n++){var r=t.slice(0,n+1),o=n+1,a="".concat(t[n].eventName," # ").concat(t[n].eventNumber," on ").concat(t[n].eventDate),r=y(r);e.push({parkruns:o,event:a,wilsonIndex:r})}return e}function x(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"10px",medium:"15px"},container:{padding:"10px",marginTop:"10px"},typography:{wilsonIndex:"1.2em",input:"16px",button:"16px"},chart:{height:"250px",fonts:{title:14,axisTitle:12,axisTicks:10,legend:11,tooltipTitle:12,tooltipBody:11}},form:{marginBottom:"10px",input:{width:"calc(100% - 20px)",maxWidth:"300px",padding:"8px",marginRight:"0"},button:{padding:"8px 15px",width:"calc(100% - 20px)",maxWidth:"300px"},layout:{display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"}}}:{isMobile:!1,spacing:{small:"20px",medium:"20px"},container:{padding:"20px",marginTop:"20px"},typography:{wilsonIndex:"1.5em",input:"inherit",button:"inherit"},chart:{height:"300px",fonts:{title:16,axisTitle:14,axisTicks:12,legend:12,tooltipTitle:14,tooltipBody:12}},form:{marginBottom:"20px",input:{width:"300px",maxWidth:"300px",padding:"5px",marginRight:"10px"},button:{padding:"5px 10px",width:"auto",maxWidth:"none"},layout:{display:"block",flexDirection:"row",gap:"0",alignItems:"flex-start"}}}}function b(){return(b=u(s().m(function t(e,n){var r,o,a,i,l=arguments;return s().w(function(t){for(;;)switch(t.n){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:36e5,o=sessionStorage.getItem(n))if(i=JSON.parse(o),a=i.data,i=i.timestamp,Date.now()-i<r)return t.a(2,a);t.n=1;break;case 1:return t.a(2,fetch(e).then(function(t){if(t.ok)return t.text();throw new Error("Failed to fetch: ".concat(t.status," ").concat(t.statusText))}).then(function(t){return sessionStorage.setItem(n,JSON.stringify({data:t,timestamp:Date.now()})),t}).catch(function(t){if(console.error("Error fetching ".concat(e,":"),t),o)return console.warn("Using stale cached data after fetch failure"),JSON.parse(o).data;throw t}))}},t)}))).apply(this,arguments)}function v(){return(v=u(s().m(function t(e){var n,r,o,a,i,l,c;return s().w(function(t){for(;;)switch(t.n){case 0:return r="parkrunner_".concat(e,"_all"),n="".concat(window.location.origin,"/parkrunner/").concat(e,"/all/"),t.n=1,function(){return b.apply(this,arguments)}(n,r);case 1:if(n=t.v,r=new DOMParser,o=r.parseFromString(n,"text/html"),a=p(o)){t.n=2;break}return console.error("Friend results table not found"),t.a(2,null);case 2:if(i=o.querySelector("h2")){t.n=3;break}return console.error("Friend H2 element not found"),t.a(2,null);case 3:if(l=k(i)){t.n=4;break}return console.error("Could not extract friend athlete info"),t.a(2,null);case 4:return c=h(a),c=m(c),t.a(2,{friendIndices:c,friendInfo:l})}},t)}))).apply(this,arguments)}function w(t,a){var e=x(),n=document.createElement("form"),i=(n.style.marginBottom=e.form.marginBottom,n.style.textAlign="center",n.style.display=e.form.layout.display,n.style.flexDirection=e.form.layout.flexDirection,n.style.gap=e.form.layout.gap,n.style.alignItems=e.form.layout.alignItems,document.createElement("input")),l=(i.style.width=e.form.input.width,i.style.maxWidth=e.form.input.maxWidth,i.type="text",i.placeholder="Enter friend's athlete ID (e.g. A507)",i.style.padding=e.form.input.padding,i.style.marginRight=e.form.input.marginRight,i.style.borderRadius="3px",i.style.border="1px solid #ffa300",i.style.backgroundColor="#2b223d",i.style.color="#ffa300",i.style.fontSize=e.typography.input,document.createElement("button"));l.textContent="Compare",l.style.padding=e.form.button.padding,l.style.width=e.form.button.width,l.style.maxWidth=e.form.button.maxWidth,l.style.backgroundColor="#ffa300",l.style.color="#2b223d",l.style.border="none",l.style.borderRadius="3px",l.style.cursor="pointer",l.style.fontSize=e.typography.button,l.style.fontWeight="bold",n.appendChild(i),n.appendChild(l),n.addEventListener("submit",(()=>{var e=u(s().m(function t(e){var n,r,o;return s().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e.preventDefault(),n=i.value.trim().replace(/^[aA]/,"")){t.n=1;break}return t.a(2);case 1:return l.disabled=!0,l.textContent="Loading...",t.p=2,t.n=3,function(){return v.apply(this,arguments)}(n);case 3:r=t.v,o=r.friendIndices,a(o,r.friendInfo),t.n=5;break;case 4:t.p=4,o=t.v,console.error("Failed to fetch friend's results:",o),alert("Failed to fetch friend's results. Please check the ID and try again.");case 5:return t.p=5,l.disabled=!1,l.textContent="Compare",t.f(5);case 6:return t.a(2)}},t,null,[[2,4,5,6]])}));return function(t){return e.apply(this,arguments)}})()),t.insertBefore(n,t.firstChild)}function k(t){return t.textContent.trim()}function S(t){var e=["#FFA300","#90EE90","#FF69B4","#4169E1","#FFD700","#9370DB","#20B2AA","#FF6347","#DDA0DD","#00CED1"];return e[t%e.length]}function t(){var t,e,l,n,r,o,a,i,c=p(document);c?(t=document.querySelector("h2"))?(a=k(t))?(n=y(c=h(c)),c=m(c),t&&(r=x(),(e=document.createElement("div")).id="w-index-display",e.style.width="100%",e.style.maxWidth="800px",e.style.margin="".concat(r.container.marginTop," auto"),e.style.backgroundColor="#2b223d",e.style.padding=r.container.padding,e.style.borderRadius="5px",(o=document.createElement("div")).textContent="Wilson index: ".concat(n),o.style.fontSize=r.typography.wilsonIndex,o.style.color="#ffa300",o.style.fontWeight="bold",o.style.marginBottom=r.spacing.small,o.style.textAlign="center",e.appendChild(o),n=c,r=e,o=a,c=x(),(a=document.createElement("div")).style.width="100%",a.style.maxWidth="100%",a.style.height=c.chart.height,a.style.position="relative",a.style.boxSizing="border-box",a.style.overflow="hidden",i=document.createElement("canvas"),a.appendChild(i),r.appendChild(a),r=i.getContext("2d"),l=new Chart(r,{type:"line",data:{labels:n.map(function(t){return t.parkruns}),datasets:[{label:o,data:n.map(function(t){return{x:t.parkruns,y:t.wilsonIndex,event:t.event}}),borderColor:S(0),backgroundColor:"#2b223d"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Wilson Index",font:{size:c.chart.fonts.axisTitle}},ticks:{font:{size:c.chart.fonts.axisTicks}},suggestedMax:Math.ceil(1.1*Math.max.apply(Math,d(n.map(function(t){return t.wilsonIndex}))))},x:{title:{display:!0,text:"parkruns",font:{size:c.chart.fonts.axisTitle}},ticks:{font:{size:c.chart.fonts.axisTicks}},min:0,suggestedMax:Math.ceil(1.1*n.length)}},plugins:{title:{display:!0,text:"Wilson Index Progress",font:{size:c.chart.fonts.title}},legend:{labels:{font:{size:c.chart.fonts.legend}}},tooltip:{callbacks:{label:function(t){t=t.raw;return["Wilson Index: ".concat(t.y),"Event: ".concat(t.event)]}},titleFont:{size:c.chart.fonts.tooltipTitle},bodyFont:{size:c.chart.fonts.tooltipBody}}}}}),w(e,(()=>{var n=u(s().m(function t(a,i){return s().w(function(t){for(;;)switch(t.n){case 0:n=a,r=i,o=void 0,o=(e=l).data.datasets.length,r={label:i,data:n.map(function(t){return{x:t.parkruns,y:t.wilsonIndex,event:t.event}}),borderColor:S(o),backgroundColor:"#2b223d"},e.data.datasets.push(r),e.update(),n=Math.max.apply(Math,d(e.data.datasets.flatMap(function(t){return t.data.map(function(t){return t.x})}))),o=Math.max.apply(Math,d(e.data.datasets.flatMap(function(t){return t.data.map(function(t){return t.y})}))),e.options.scales.x.suggestedMax=Math.ceil(1.1*n),e.options.scales.y.suggestedMax=Math.ceil(1.1*o),e.update();case 1:return t.a(2)}var e,n,r,o},t)}));return function(t,e){return n.apply(this,arguments)}})()),t.parentNode.insertBefore(e,t.nextSibling))):console.error("Could not extract athlete info"):console.error("H2 element not found"):console.error("Results table not found")}r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((t,e)=>{var n=document.createElement("script");n.src=r,n.onload=t,n.onerror=e,document.head.appendChild(n)}),"undefined"!=typeof module&&module.exports?module.exports={calculateWilsonIndex:y,calculateWilsonIndexOverTime:m,extractEventDetails:h,findResultsTable:p}:t()})();
```
<!-- END BOOKMARKLETS SECTION -->
















































































































## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please see the [CONTRIBUTING.md](CONTRIBUTING.md) file for guidelines.
