# Pete's parkrun userscripts

## A script or scripts for messing with parkrun results pages

You'll need something like [Tampermonkey](https://www.tampermonkey.net) if
you'd like to enjoy them. Or you can use the bookmarklet versions.

## Why?

Why not?

## Bookmarklets

You can also use these scripts as bookmarklets by creating bookmarks with the following URLs:

### parkrun Wilson index display

The "Wilson index" in parkrun is the highest consecutive event number completed, starting from #1. This script calculates and displays a parkrunner's Wilson index on their results page.

```javascript
javascript:(async()=>{var n;function a(e,t=7){var r;let n=null;for(r of e.querySelectorAll('[id="results"]')){var a=r.querySelector("tr");if(a)if(a.querySelectorAll("th, td").length===t){n=r;break}}return n}function o(e){return Array.from(e.querySelectorAll("tbody > tr")).reverse().map(e=>{var t=e.querySelector("td:nth-child(1)").textContent.trim(),r=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();return{eventName:t,eventDate:r,eventNumber:parseInt(e,10)}})}function i(e){let t=0;var r;for(r of e.map(e=>e.eventNumber).sort((e,t)=>e-t)){if(r>=t+2)break;r===t+1&&t++}return t}function c(t){var r=[];for(let e=0;e<t.length;e++){var n=t.slice(0,e+1),a=e+1,o=`${t[e].eventName} # ${t[e].eventNumber} on `+t[e].eventDate,n=i(n);r.push({parkruns:a,event:o,wilsonIndex:n})}return r}async function u(e){var e=await(async(t,r,e=36e5)=>{let n=sessionStorage.getItem(r);if(n){var{data:a,timestamp:o}=JSON.parse(n);if(Date.now()-o<e)return a}return fetch(t).then(e=>{if(e.ok)return e.text();throw new Error(`Failed to fetch: ${e.status} `+e.statusText)}).then(e=>(sessionStorage.setItem(r,JSON.stringify({data:e,timestamp:Date.now()})),e)).catch(e=>{if(console.error(`Error fetching ${t}:`,e),n)return console.warn("Using stale cached data after fetch failure"),JSON.parse(n).data;throw e})})(window.location.origin+`/parkrunner/${e}/all/`,`parkrunner_${e}_all`),e=(new DOMParser).parseFromString(e,"text/html"),t=a(e);return t?(e=e.querySelector("h2"))?(e=p(e))?{friendIndices:c(o(t)),friendInfo:e}:(console.error("Could not extract friend athlete info"),null):(console.error("Friend H2 element not found"),null):(console.error("Friend results table not found"),null)}function p(e){return e.textContent.trim()}function f(e){var t=["#FFA300","#90EE90","#FF69B4","#4169E1","#FFD700","#9370DB","#20B2AA","#FF6347","#DDA0DD","#00CED1"];return t[e%t.length]}function e(){var e=a(document);if(e){var t=document.querySelector("h2");if(t){var r=p(t);if(r){var e=o(e),n=i(e),e=c(e);if(t){var l=document.createElement("div"),s=(l.style.marginTop="20px",l.style.backgroundColor="#2b223d",l.style.padding="20px",l.style.borderRadius="5px",document.createElement("div"));s.textContent="Wilson index: "+n,s.style.fontSize="1.5em",s.style.color="#ffa300",s.style.fontWeight="bold",s.style.marginBottom="20px",s.style.textAlign="center",l.appendChild(s);n=e,s=l,e=r,(r=document.createElement("canvas")).style.width="100%",r.style.height="300px",s.appendChild(r),s=r.getContext("2d");let o=new Chart(s,{type:"line",data:{labels:n.map(e=>e.parkruns),datasets:[{label:e,data:n.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:f(0),backgroundColor:"#2b223d"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Wilson Index"},suggestedMax:Math.ceil(1.1*Math.max(...n.map(e=>e.wilsonIndex)))},x:{title:{display:!0,text:"parkruns"},min:0,suggestedMax:Math.ceil(1.1*n.length)}},plugins:{title:{display:!0,text:"Wilson Index Progress"},tooltip:{callbacks:{label:function(e){e=e.raw;return["Wilson Index: "+e.y,"Event: "+e.event]}}}}}});{r=l;var d=async(e,t)=>{var r,n,a;r=o,e=e,n=t,a=r.data.datasets.length,n={label:t,data:e.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:f(a),backgroundColor:"#2b223d"},r.data.datasets.push(n),r.update(),e=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.x))),a=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.y))),r.options.scales.x.suggestedMax=Math.ceil(1.1*e),r.options.scales.y.suggestedMax=Math.ceil(1.1*a),r.update()};s=document.createElement("form");s.style.marginBottom="20px",s.style.textAlign="center";let n=document.createElement("input"),a=(n.style.width="200px",n.type="text",n.placeholder="Enter friend's athlete ID (e.g. A507)",n.style.padding="5px",n.style.marginRight="10px",n.style.borderRadius="3px",n.style.border="1px solid #ffa300",n.style.backgroundColor="#2b223d",n.style.color="#ffa300",document.createElement("button"));a.textContent="Compare",a.style.padding="5px 10px",a.style.backgroundColor="#ffa300",a.style.color="#2b223d",a.style.border="none",a.style.borderRadius="3px",a.style.cursor="pointer",s.appendChild(n),s.appendChild(a),s.addEventListener("submit",async e=>{e.preventDefault();e=n.value.trim().replace(/^[aA]/,"");if(e){a.disabled=!0,a.textContent="Loading...";try{var{friendIndices:t,friendInfo:r}=await u(e);d(t,r)}catch(e){console.error("Failed to fetch friend's results:",e),alert("Failed to fetch friend's results. Please check the ID and try again.")}finally{a.disabled=!1,a.textContent="Compare"}}}),r.insertBefore(s,r.firstChild)}t.parentNode.insertBefore(l,t.nextSibling)}}else console.error("Could not extract athlete info")}else console.error("H2 element not found")}else console.error("Results table not found")}n="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var r=document.createElement("script");r.src=n,r.onload=e,r.onerror=t,document.head.appendChild(r)}),"undefined"!=typeof module&&module.exports?module.exports={calculateWilsonIndex:i,calculateWilsonIndexOverTime:c,extractEventDetails:o,findResultsTable:a}:e()})();
```

### parkrun Volunteer Days Display

Displays the number of volunteer days for parkrun finishers on results pages

```javascript
javascript:(async()=>{!function t(){document.querySelector(".Results-table")?document.querySelectorAll("tr[data-vols] > td.Results-table-td.Results-table-td--name > div.detailed").forEach(t=>{var e,s=t.closest("tr").getAttribute("data-vols");s&&0<parseInt(s)&&((e=document.createElement("span")).textContent=s+` volunteer day${"1"===s?"":"s"} | `,e.classList.add("volunteer-days"),e.style.color="#d35226",t.insertBefore(e,t.firstChild))}):setTimeout(t,500)}()})();
```

### parkrun Stopwatch Bingo

Visualizes your progress on the stopwatch bingo challenge (collecting seconds 00-59)

```javascript
javascript:(async()=>{var l;l="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var o=document.createElement("script");o.src=l,o.onload=t,o.onerror=e,document.head.appendChild(o)});{let v={backgroundColor:"#2b223d",clockBorderColor:"#FFA300",clockFaceColor:"#333",completedColor:"#FFA300",pendingColor:"#53BA9D",textColor:"#e0e0e0",subtleTextColor:"#cccccc"};function o(){var t=document.querySelectorAll("#results");return t[t.length-1]}function n(t){var e={},o={};let l=0,n=0,r=null,s=null;t=t.querySelectorAll("tr");let d=[];t.forEach(e=>{e=e.querySelectorAll("td");if(!(e.length<5)){var o=e[0].textContent.trim(),l=e[1].textContent.trim(),n=e[2].textContent.trim(),e=e[4].textContent.trim();if(e&&n&&l&&o){o=o+" # "+n;let t;n=e.match(/(\d+):(\d+):(\d+)/);if(n)t=parseInt(n[3],10);else{n=e.match(/(\d+):(\d+)/);if(!n)return;t=parseInt(n[2],10)}d.push({secondValue:t,date:l,event:o,time:e})}}});var i=d.reverse();for(let t=0;t<i.length;t++){var{secondValue:a,date:c,event:p,time:u}=i[t];if(n++,!(a in e||(e[a]={date:c,event:p,time:u},60!=++l)||s)){s=c,r=p,o[a]=[{date:c,event:p,time:u}];break}o[a]||(o[a]=[]),o[a].push({date:c,event:p,time:u})}return{seconds:e,timeData:o,collectedCount:l,totalParkruns:n,dateOfCompletion:s,firstCompleteEvent:r}}function r(p){e="Stopwatch Bingo Challenge",(x=document.createElement("div")).className="parkrun-bingo-container",x.style.width="100%",x.style.maxWidth="800px",x.style.margin="20px auto",x.style.padding="20px",x.style.backgroundColor=v.backgroundColor,x.style.borderRadius="8px",x.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",x.style.textAlign="center",(t=document.createElement("h3")).textContent=e,t.style.marginBottom="15px",t.style.color=v.clockBorderColor,x.appendChild(t);var e=x,t=document.createElement("div");t.style.marginBottom="20px",t.style.color=v.textColor;let o=`<div style="font-size: 1.2em; margin-bottom: 10px;"><strong>${p.collectedCount} of 60</strong> seconds collected</div>`;o+=`<div>After ${p.totalParkruns} parkruns</div>`,p.dateOfCompletion&&(o+=`<div style="margin-top: 10px; font-size: 1.1em;">üèÜ Bingo completed on ${p.dateOfCompletion} (${p.firstCompleteEvent})</div>`),t.innerHTML=o,e.appendChild(t);var l=document.createElement("div");l.style.position="relative",l.style.width="500px",l.style.height="500px",l.style.margin="0 auto",l.style.borderRadius="50%",l.style.border="10px solid "+v.clockBorderColor,l.style.backgroundColor=v.clockFaceColor,l.style.boxSizing="content-box";for(let c=0;c<60;c++){var n=c in p.seconds,r=n&&p.timeData[c]?p.timeData[c].length:0,s=((c-.4)/60*360-90)*(Math.PI/180),d=((c+.4)/60*360-90)*(Math.PI/180),i=document.createElement("div"),a=(i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",document.createElementNS("http://www.w3.org/2000/svg","svg")),u=(a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.zIndex="1",document.createElementNS("http://www.w3.org/2000/svg","path")),m=250+220*Math.cos(s),s=250+220*Math.sin(s),y=250+220*Math.cos(d),d=250+220*Math.sin(d);u.setAttribute("d",`M 250,250 
                     L ${m},${s} 
                     A 220,220 0 0,1 ${y},${d} 
                     Z`),n?(m=Math.min(r,5)/5,s=v.completedColor,y=parseInt(s.slice(1,3),16),d=parseInt(s.slice(3,5),16),s=parseInt(s.slice(5,7),16),m=1-.3*m,y=Math.floor(y*m).toString(16).padStart(2,"0"),d=Math.floor(d*m).toString(16).padStart(2,"0"),s=Math.floor(s*m).toString(16).padStart(2,"0"),u.setAttribute("fill","#"+y+d+s),u.setAttribute("opacity","1"),m=p.seconds[c],u.setAttribute("title",m.time+` - ${m.date} ${m.event} (${r} occurrences)`)):(u.setAttribute("fill",v.pendingColor),u.setAttribute("opacity","0.4"),u.setAttribute("title",`Missing: ${c.toString().padStart(2,"0")} seconds`)),n&&(u.style.cursor="pointer",u.style.pointerEvents="auto",u.addEventListener("click",()=>{{var d=c,i=p.timeData[c],a=document.getElementById("second-details-popup");a&&a.remove();let t=document.createElement("div"),e=(t.id="second-details-popup",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="400px",t.style.maxHeight="500px",t.style.overflowY="auto",t.style.backgroundColor=v.backgroundColor,t.style.borderRadius="8px",t.style.padding="20px",t.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.5)",t.style.zIndex="1000",t.style.color=v.textColor,document.createElement("div")),o=(e.textContent="‚úï",e.style.position="absolute",e.style.top="10px",e.style.right="15px",e.style.fontSize="20px",e.style.cursor="pointer",e.addEventListener("click",()=>t.remove()),t.appendChild(e),document.createElement("h3")),l=(o.textContent=`${d.toString().padStart(2,"0")} Seconds - ${i.length} Times`,o.style.marginBottom="15px",o.style.color=v.clockBorderColor,t.appendChild(o),document.createElement("table")),n=(l.style.width="100%",l.style.borderCollapse="collapse",l.style.marginTop="10px",document.createElement("thead")),r=(n.innerHTML=`
            <tr>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #555;">Date</th>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #555;">Event</th>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #555;">Time</th>
            </tr>
        `,l.appendChild(n),document.createElement("tbody")),s=(i.forEach((t,e)=>{var o=document.createElement("tr");o.style.backgroundColor=0===e?"rgba(255, 163, 0, 0.2)":"transparent",o.innerHTML=`
                <td style="padding: 8px; border-bottom: 1px solid #444;">${t.date}</td>
                <td style="padding: 8px; border-bottom: 1px solid #444;">${t.event}</td>
                <td style="padding: 8px; border-bottom: 1px solid #444;">${t.time}</td>
            `,r.appendChild(o)}),l.appendChild(r),t.appendChild(l),document.body.appendChild(t),document.createElement("div"));s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.zIndex="999",s.addEventListener("click",()=>{t.remove(),s.remove()}),document.body.appendChild(s)}})),a.appendChild(u),i.appendChild(a),l.appendChild(i)}var c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.pointerEvents="none",c.style.zIndex="2";for(let t=0;t<60;t+=5){var h=(t/60*360-90)*(Math.PI/180),g=t%15==0?210:225,b=document.createElementNS("http://www.w3.org/2000/svg","line"),b=(b.setAttribute("x1",250+g*Math.cos(h)),b.setAttribute("y1",250+g*Math.sin(h)),b.setAttribute("x2",250+245*Math.cos(h)),b.setAttribute("y2",250+245*Math.sin(h)),b.setAttribute("stroke",v.textColor),b.setAttribute("stroke-width",t%15==0?3:2),c.appendChild(b),t%15==0?g-25:g-20),g=250+b*Math.cos(h),b=250+b*Math.sin(h),h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",g),h.setAttribute("y",b),h.setAttribute("fill",v.textColor),h.setAttribute("font-size",t%15==0?"16px":"14px"),h.setAttribute("font-weight","bold"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.textContent=t.toString(),c.appendChild(h)}l.appendChild(c);var x=document.createElement("div");x.style.position="absolute",x.style.top="50%",x.style.left="50%",x.style.transform="translate(-50%, -50%)",x.style.width="100px",x.style.height="100px",x.style.borderRadius="50%",x.style.backgroundColor=v.clockBorderColor,x.style.display="flex",x.style.justifyContent="center",x.style.alignItems="center",x.style.color=v.backgroundColor,x.style.fontWeight="bold",x.style.fontSize="20px",x.style.zIndex="3",x.textContent=Math.round(p.collectedCount/60*100)+"%",l.appendChild(x),e.appendChild(l);{var C=e;let o=document.createElement("div"),t=(o.style.marginTop="15px",o.id="bingo-download-btn-container",document.createElement("button"));t.textContent="üíæ Save as Image",t.style.padding="8px 15px",t.style.backgroundColor=v.clockBorderColor,t.style.color=v.backgroundColor,t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontWeight="bold",t.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),t.addEventListener("mouseout",function(){this.style.backgroundColor=v.clockBorderColor}),t.addEventListener("click",function(){o.style.display="none",html2canvas(C,{backgroundColor:v.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(t=>{o.style.display="block";var e=document.createElement("a");e.download="parkrun-stopwatch-bingo.png",e.href=t.toDataURL("image/png"),e.click()})}),o.appendChild(t),C.appendChild(o)}t=document.createElement("div");return t.style.marginTop="20px",t.style.color=v.subtleTextColor,t.style.fontSize="0.9em",t.innerHTML="Stopwatch Bingo: collect finish times with every second from 00-59.<br>Orange segments show seconds you've collected, green segments are still needed.<br>Click on any segment to see details.",e.appendChild(t),e}function t(){var t,e;document.querySelector("#results")?document.querySelector("h2")&&(t=r(n(o())),t=t,e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)):console.log("Results table not found")}"undefined"!=typeof module&&module.exports?module.exports={findResultsTable:o,extractFinishTimes:n}:t()}})();
```

### parkrun Charts

Displays charts on parkrun pages: finishers per minute on results pages and event history on event history pages

```javascript
javascript:(async()=>{var r;r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var o=document.createElement("script");o.src=r,o.onload=e,o.onerror=t,document.head.appendChild(o)});{let n={backgroundColor:"#2b223d",barColor:"#FFA300",lineColor:"#53BA9D",textColor:"#e0e0e0",subtleTextColor:"#cccccc",gridColor:"rgba(200, 200, 200, 0.2)"};function l(e,t,o=800){var r=document.createElement("div"),o=(r.className=`parkrun-chart-container ${t}-container`,r.style.width="100%",r.style.maxWidth=o+"px",r.style.margin="20px auto",r.style.padding="15px",r.style.backgroundColor=n.backgroundColor,r.style.borderRadius="8px",r.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.createElement("h3")),e=(o.textContent=e,o.style.textAlign="center",o.style.marginBottom="15px",o.style.color=n.barColor,r.appendChild(o),document.createElement("canvas"));return e.id=t,r.appendChild(e),{container:r,canvas:e}}function a(e){var t=document.querySelector(".Results-table");t&&t.parentNode?t.parentNode.insertBefore(e,t):(document.querySelector(".content")||document.body).appendChild(e)}function i(e,l,a){var t=document.createElement("div"),o=(t.style.display="flex",t.style.justifyContent="center",t.style.marginTop="10px",t.style.marginBottom="10px",document.createElement("button"));o.textContent="üíæ Save as Image",o.style.padding="6px 12px",o.style.backgroundColor=n.barColor,o.style.color="#2b223d",o.style.border="none",o.style.borderRadius="4px",o.style.cursor="pointer",o.style.fontWeight="bold",o.style.display="inline-block",o.style.margin="0 5px",o.title="Download chart as PNG image",o.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),o.addEventListener("mouseout",function(){this.style.backgroundColor=n.barColor}),o.addEventListener("click",function(){var e=document.createElement("a"),t=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/"),r=o[1];let n;n="event-history"===a?r+`-event-history-${t}.png`:r+`-event-${o[3]||"latest"}-finishers-${t}.png`,e.download=n,e.href=l.toDataURL("image/png"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}),t.appendChild(o),e.appendChild(t)}function e(){var e,t,o=(({timeData:t,minMinute:o,maxMinute:r})=>{var n=[],l=[];for(let e=o;e<=r;e++)n.push(e),l.push(t[e]||0);return{labels:n.map(e=>60<=e?Math.floor(e/60)+":"+(e%60).toString().padStart(2,"0"):e+"'"),data:l}})((()=>{let n={};var e=document.querySelectorAll("tr.Results-table-row");let l=1/0,a=0;e.forEach(t=>{t=t.querySelector("td.Results-table-td--time");if(t){t=t.textContent.trim();let e;var o=t.match(/(\d+):(\d+):(\d+)/);if(o){var r=parseInt(o[1]),o=parseInt(o[2]);e=60*r+o}else{r=t.match(/(\d+):(\d+)/);if(!r)return;e=parseInt(r[1])}l=Math.min(l,e),a=Math.max(a,e),n[e]?n[e]++:n[e]=1}});for(let e=l;e<=a;e++)n[e]||(n[e]=0);return{timeData:n,minMinute:l,maxMinute:a}})());0===o.labels.length?console.log("No finish time data found"):document.getElementById("finishersChart")?console.log("Finishers chart already exists, skipping render"):({container:t,canvas:e}=l("Finishers per Minute","finishersChart"),a(t),i(t,e,"finishers"),t=e.getContext("2d"),new Chart(t,{type:"bar",data:{labels:o.labels,datasets:[{label:"Number of Finishers",data:o.data,backgroundColor:n.barColor,borderColor:n.barColor,borderWidth:1}]},options:{animation:!1,responsive:!0,plugins:{legend:{labels:{color:n.textColor}},title:{display:!1,color:n.textColor},tooltip:{callbacks:{title:e=>{var t,o,e=e[0].label;return e.includes(":")?([o,t]=e.split(":"),o+` hour${"1"===o?"":"s"} ${t} minute`+("01"===t?"":"s")):(o=e.replace("'",""))+" minute"+("1"===o?"":"s")},label:e=>e.raw+" finisher"+(1===e.raw?"":"s")}}},scales:{x:{title:{display:!0,text:"Finish Time",color:n.textColor},ticks:{color:n.subtleTextColor},grid:{color:n.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:n.textColor},ticks:{precision:0,color:n.subtleTextColor},grid:{color:n.gridColor}}}}}))}function t(){if(document.getElementById("eventHistoryChart"))console.log("Event history chart already exists, skipping render");else{let t=(()=>{let o=[],r=[],n=[],l=[];var e=document.querySelectorAll("tr.Results-table-row");return Array.from(e).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&o.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&n.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{eventNumbers:o,dates:r,finishers:n,volunteers:l}})();var e,o;0===t.eventNumbers.length?console.log("No event history data found"):({container:o,canvas:e}=l("Event History: Finishers & Volunteers","eventHistoryChart",1e3),e.height=400,e.style.height="400px",e.style.maxHeight="400px",a(o),i(o,e,"event-history"),o=e.getContext("2d"),new Chart(o,{type:"bar",data:{labels:t.eventNumbers,datasets:[{label:"Finishers",data:t.finishers,backgroundColor:n.barColor,borderColor:n.barColor,borderWidth:1,yAxisID:"y-finishers",order:1},{label:"Volunteers",data:t.volunteers,type:"line",borderColor:n.lineColor,backgroundColor:"rgba(83, 186, 157, 0.2)",borderWidth:1,pointBackgroundColor:n.lineColor,pointRadius:2,fill:!1,tension:.2,yAxisID:"y-volunteers",order:0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:2.5,onResize:null,plugins:{legend:{labels:{color:n.textColor,usePointStyle:!0}},tooltip:{mode:"index",callbacks:{title:function(e){e=e[0].dataIndex;return`Event #${t.eventNumbers[e]} (${t.dates[e]})`},label:function(e){var t=e.dataset.label||"";return"Finishers"===t?"Finishers: "+e.raw:"Volunteers"===t?"Volunteers: "+e.raw:e.formattedValue}}}},scales:{x:{title:{display:!0,text:"Event Number",color:n.textColor},ticks:{color:n.subtleTextColor},grid:{color:n.gridColor}},"y-finishers":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:n.textColor},ticks:{precision:0,color:n.subtleTextColor},grid:{color:n.gridColor}},"y-volunteers":{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Number of Volunteers",color:n.lineColor},ticks:{precision:0,color:n.lineColor},grid:{display:!1}}}}}))}}"undefined"==typeof Chart?console.error("Chart.js not loaded"):document.querySelector(".Results-table")?(window.location.href.includes("/eventhistory/")?t:e)():console.log("Results table not found")}})();
```

### parkrun p-index display

The parkrun p-index is an unofficial statistic that measures the number of different parkrun events a person has completed a specific number of times. To achieve a p-index of 10, you must have completed at least 10 different parkrun events 10 times each. This script calculate the p-index for a parkrunner and displays it on their results page.

```javascript
javascript:(async()=>{if("undefined"!=typeof module&&module.exports)module.exports={calculatePIndex:o,extractEventDetails:t,findResultsTable:n};else{var e=n();if(e){({pIndex:e,contributingEvents:r}=o(t(e)));var r,l=document.querySelector("h2");if(l){let t=document.createElement("div"),n=(t.textContent="p-index: "+e,t.style.fontSize="1.5em",t.style.fontWeight="bold",t.style.marginTop="10px",t.style.backgroundColor="#2b223d",t.style.color="#ffa300",t.style.padding="10px",t.style.borderRadius="5px",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.setAttribute("id","p-index-display"),document.createElement("ul"));n.style.listStyleType="none",n.style.padding="0",r.forEach(e=>{var t=document.createElement("li");t.textContent=e,t.style.fontWeight="normal",t.style.fontSize="1em",n.appendChild(t)}),t.appendChild(n),l.parentNode.insertBefore(t,l.nextSibling),setTimeout(()=>{var e=t.getBoundingClientRect(),e=Math.max(e.width,e.height);t.style.width=e+"px",t.style.height=e+"px"},0)}}else console.error("Results table not found")}function t(e){let r=[];e.querySelectorAll("tbody > tr").forEach(e=>{var t=e.querySelector("td:nth-child(1) > a").textContent.trim(),n=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();r.unshift({eventName:t,date:n,eventNumber:e})});e=r.reduce((e,{eventName:t,date:n,eventNumber:r})=>(e[t]||(e[t]=[]),e[t].push({date:n,eventNumber:r}),e),{});return Object.entries(e).sort((e,t)=>t[1].length-e[1].length)}function n(){var e=document.querySelectorAll("#results");return e[e.length-1]}function o(e){e=e.filter(([,e],t)=>e.length>t);let l=e.length;function o(e){return new Date(e.split("/").reverse().join("-"))}e=e.map(([e,t])=>{var n=t[0],r=t[l-1];return{eventName:e,eventCount:t.length,firstDate:n.date,firstEventNumber:n.eventNumber,pIndexDate:r.date,pIndexEventNumber:r.eventNumber,firstDateForSorting:o(n.date),pIndexDateForSorting:o(r.date)}}).sort((e,t)=>e.pIndexDateForSorting-t.pIndexDateForSorting).slice(0,l).map(e=>e.eventName+` (${e.eventCount}): ${e.firstDate} (#${e.firstEventNumber}) - ${e.pIndexDate} (#${e.pIndexEventNumber})`);return{pIndex:l,contributingEvents:e}}})();
```
<!-- END BOOKMARKLETS SECTION -->







