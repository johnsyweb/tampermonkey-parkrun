# Pete's parkrun userscripts

## A script or scripts for messing with parkrun results pages

You'll need something like [Tampermonkey](https://www.tampermonkey.net) if
you'd like to enjoy them. Or you can use the bookmarklet versions.

## Development Setup

This project uses [mise](https://mise.jdx.dev/) for development environment management.

### Prerequisites

- [mise](https://mise.jdx.dev/) - for managing development tools

### Setup

1. Install dependencies with mise (installs Ruby, Node, and pnpm):
   ```bash
   mise install
   ```

2. Install npm dependencies:
   ```bash
   pnpm install
   ```
   
The `mise.toml` file specifies the required versions:
- Ruby 3.4.7 (for Jekyll)
- Node LTS (for development tools)
- pnpm latest (for package management)

3. For microsite development, install Ruby/Jekyll dependencies:
   ```bash
   cd docs
   bundle install
   ```

### Previewing the Microsite Locally

The microsite documentation is built with Jekyll and served from the `docs/` directory.

1. Start the Jekyll server:
   ```bash
   cd docs
   bundle exec jekyll serve --port 4000 --host 0.0.0.0
   ```

2. Visit http://localhost:4000/tampermonkey-parkrun/ in your browser

### Generating Screenshots

To generate screenshots for the microsite:

```bash
pnpm screenshots
```

This will create screenshots of all userscripts in `docs/images/`.

### Building the Microsite

The microsite is automatically deployed to GitHub Pages on every push to `main`. 

To build the site locally:

```bash
pnpm docs:build
```

To serve the site locally:

```bash
pnpm docs:serve
```

The site will be available at http://localhost:4000/tampermonkey-parkrun/

### Git Hooks

This project uses [husky](https://typicode.github.io/husky/) to manage git hooks. Hooks are automatically installed when you run `pnpm install`.

#### Pre-commit Hook

The pre-commit hook ensures code quality by running:
- `pnpm check-format` - Checks code formatting with Prettier
- `pnpm test` - Runs all Jest tests
- `pnpm lint` - Runs ESLint to check for linting errors

All checks must pass before a commit is allowed. This ensures all code is properly formatted, tested, and linted before being committed.

#### Pre-push Hook

The pre-push hook automatically generates screenshots when userscripts are modified:

- Checks if any `.user.js` files have been modified in the commits being pushed
- Automatically runs `pnpm screenshots` if userscripts were changed
- Prevents the push if screenshot generation fails

**Note:** Screenshots must be generated locally because parkrun websites block automated agents from accessing them in CI environments.

### GitHub Actions Workflow

The project includes a GitHub Actions workflow that:

1. Sets up Ruby (for Jekyll) and Node.js (for scripts)
2. Installs dependencies (via mise, pnpm, and bundler)
3. Updates the scripts data file from userscript metadata
4. Builds the Jekyll site
5. Deploys to GitHub Pages

This workflow runs on every push to `main` and automatically keeps the microsite up to date with the latest scripts.

## Why?

Why not?

## How to Install Bookmarklets

To use these scripts as bookmarklets, follow these steps:

1. Copy the JavaScript code for the desired bookmarklet from the sections below.
2. Open your browser's bookmarks manager.
3. Create a new bookmark.
4. Paste the JavaScript code into the URL field of the bookmark.
5. Save the bookmark.

Now, you can click the bookmark while on a parkrun results page to run the script.

## Updating Versions

To update the `@version` field in all userscripts, run the following Node.js script:

```bash
node scripts/update-version.js
```

This will automatically update the `@version` field in all `.user.js` files based on the current date and time.

## Bookmarklets

You can also use these scripts as bookmarklets by creating bookmarks with the following URLs:

### parkrun Alphabet Challenge

> Tracks progress on the unofficial parkrun alphabet challenge (A-Z, excluding X) with a 5x5 grid visualization and download feature.


[alphabet-challenge.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/alphabet-challenge.user.js)

```javascript
javascript:(async()=>{var o,e,t;o="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=o,n.onload=e,n.onerror=t,document.head.appendChild(n)});{let d="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").filter(e=>"X"!==e);function s(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"8px",medium:"10px",large:"10px"},container:{padding:"10px",marginTop:"10px"},typography:{heading:"1.1em",stats:"1em",statsSubtext:"0.9em"},grid:{gapSize:"5px",marginTop:"10px",cellPadding:"5px",letterFontSize:"1.2em",letterMarginBottom:"2px",eventFontSize:"0.7em",dateFontSize:"0.65em"},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"},heading:{marginBottom:"10px"}}:{isMobile:!1,spacing:{small:"10px",medium:"15px",large:"20px"},container:{padding:"20px",marginTop:"20px"},typography:{heading:"1.3em",stats:"1.2em",statsSubtext:"1em"},grid:{gapSize:"10px",marginTop:"20px",cellPadding:"10px",letterFontSize:"1.5em",letterMarginBottom:"5px",eventFontSize:"0.8em",dateFontSize:"0.7em"},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"},heading:{marginBottom:"15px"}}}function n(a){let n=s();var o=document.createElement("div"),e=(o.className="parkrun-alphabet-container",o.style.width="100%",o.style.maxWidth="800px",o.style.margin=n.container.marginTop+" auto",o.style.padding=n.container.padding,o.style.backgroundColor="#2b223d",o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",o.style.color="#e0e0e0",o.style.textAlign="center",document.createElement("h3")),e=(e.textContent="Alphabet Challenge",e.style.marginBottom=n.heading.marginBottom,e.style.color="#FFA300",e.style.fontSize=n.typography.heading,o.appendChild(e),document.createElement("div"));e.innerHTML=`<div style="font-size: ${n.typography.stats}; margin-bottom: ${n.spacing.small};">`+"<strong>"+a.completedCount+" of 25</strong> letters completed</div>"+`<div style="font-size: ${n.typography.statsSubtext};">After `+a.totalEvents+" parkruns</div>"+(a.dateOfCompletion?`<div style="font-size: ${n.typography.statsSubtext};">ðŸŽ‰ Challenge completed on: ${a.dateOfCompletion}</div>`:""),o.appendChild(e);let i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns="repeat(5, 1fr)",i.style.gap=n.grid.gapSize,i.style.marginTop=n.grid.marginTop,d.forEach(l=>{var e=document.createElement("div"),t=(e.style.aspectRatio="1",e.style.position="relative",e.style.border="1px solid #666",e.style.borderRadius="4px",e.style.backgroundColor=a.completedLetters[l]?"#FFA300":"#008080",e.style.color="#fff",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="flex-start",e.style.justifyContent="flex-start",e.style.padding=n.grid.cellPadding,e.style.fontWeight="bold",e.style.fontSize="1em",e.style.cursor=a.completedLetters[l]?"pointer":"default",document.createElement("div"));t.textContent=l,t.style.fontSize=n.grid.letterFontSize,t.style.marginBottom=n.grid.letterMarginBottom,e.appendChild(t),a.completedLetters[l]&&((t=document.createElement("div")).innerHTML=`<div style="font-size: ${n.grid.eventFontSize}; text-align: left;">`+a.completedLetters[l].eventName+"<br>"+`<span style="font-size: ${n.grid.dateFontSize};">(`+a.completedLetters[l].date+")</span></div>",n.isMobile&&(t.style.display="none"),e.appendChild(t),e.addEventListener("click",()=>{var e=s();let t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.zIndex="999",t.addEventListener("click",()=>{document.body.removeChild(t)});var n=document.createElement("div"),o=(n.style.position="fixed",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.backgroundColor="#2b223d",n.style.color="#fff",e.isMobile?"15px":"20px"),o=(n.style.padding=o,n.style.borderRadius="8px",n.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",n.style.zIndex="1000",n.style.maxWidth=e.isMobile?"95%":"90%",n.style.maxHeight=e.isMobile?"85%":"80%",n.style.overflowY="auto",n.style.fontSize=e.isMobile?"0.9em":"1em",document.createElement("h4")),e=(o.textContent="Letter "+l,o.style.marginBottom="10px",o.style.color="#FFA300",n.appendChild(o),document.createElement("div"));e.style.marginBottom="10px",e.innerHTML="<strong>"+a.completedLetters[l].eventName+'</strong><br><span style="font-size: 0.9em;">'+a.completedLetters[l].date+"</span>",n.appendChild(e),t.appendChild(n),document.body.appendChild(t)})),i.appendChild(e)}),o.appendChild(i);{var r=o;let e=s(),t=document.createElement("div"),l=(t.style.marginTop=e.button.marginTop,t.id="alphabet-download-btn-container",document.createElement("button"));l.textContent="ðŸ’¾ Save as Image",l.style.padding=e.button.padding,l.style.backgroundColor="#FFA300",l.style.color="#2b223d",l.style.border="none",l.style.borderRadius="4px",l.style.cursor="pointer",l.style.fontWeight="bold",l.style.fontSize=e.button.fontSize,l.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),l.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),l.addEventListener("click",function(){l.style.display="none",html2canvas(r,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(e=>{l.style.display="block";var t=document.createElement("a"),n=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/")[2]||"parkrunner";t.download=`alphabet-challenge-${o}-${n}.png`,t.href=e.toDataURL("image/png"),t.click()})}),t.appendChild(l),r.appendChild(t)}return o}(t=(t=document.querySelectorAll("#results"))[t.length-1])?(t=t=n((e=>{let t={};var n;let o=0,l=null;for(n of Array.from(e.querySelectorAll("tr")).reverse()){var a=n.querySelectorAll("td");if(!(a.length<1)){var i=a[0].textContent.trim(),a=a[1].textContent.trim(),r=i.charAt(0).toUpperCase();if(o++,d.includes(r)&&!t[r]&&(t[r]={eventName:i,date:a},25===Object.keys(t).length)){l=a;break}}}return e=Object.keys(t).length,{completedLetters:t,remainingLetters:d.filter(e=>!t[e]),completedCount:e,dateOfCompletion:l,totalEvents:o}})(t)),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")}})();
```

### parkrun Compass Challenge

> Visualizes your progress on the compass challenge (North, South, East, West parkruns)


[compass-challenge.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/compass-challenge.user.js)

```javascript
javascript:(async()=>{var n,t,e;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var o=document.createElement("script");o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)});{let m={backgroundColor:"#2b223d",accentColor:"#FFA300",completedColor:"#53BA9D",pendingColor:"#666",textColor:"#e0e0e0",subtleTextColor:"#cccccc"},h={north:/north/i,south:/south/i,east:/east/i,west:/west/i};function l(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"10px",medium:"15px",statsMarginBottom:"8px",completionMarginTop:"8px"},container:{padding:"10px",marginTop:"10px"},typography:{heading:"1.1em",stats:"1em",statsSubtext:"0.9em",completion:"0.95em"},compass:{baseSize:320},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"}}:{isMobile:!1,spacing:{small:"20px",medium:"20px",statsMarginBottom:"10px",completionMarginTop:"10px"},container:{padding:"20px",marginTop:"20px"},typography:{heading:"1.3em",stats:"1.2em",statsSubtext:"1em",completion:"1.1em"},compass:{baseSize:700},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"}}}function o(t){var e=l(),o=(o="Compass Challenge",n=l(),(r=document.createElement("div")).className="parkrun-compass-container",r.style.width="100%",r.style.maxWidth="800px",r.style.margin=n.container.marginTop+" auto",r.style.padding=n.container.padding,r.style.backgroundColor=m.backgroundColor,r.style.borderRadius="8px",r.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",r.style.textAlign="center",(i=document.createElement("h3")).textContent=o,i.style.marginBottom=n.spacing.small,i.style.color=m.accentColor,i.style.fontSize=n.typography.heading,r.appendChild(i),r),n=document.createElement("div");n.style.marginBottom=e.spacing.small,n.style.color=m.textColor;let a=`<div style="font-size: ${e.typography.stats}; margin-bottom: ${e.spacing.statsMarginBottom};"><strong>${t.completedCount} of 4</strong> compass directions completed</div>`;a+=`<div style="font-size: ${e.typography.statsSubtext};">After ${t.totalEvents} parkruns</div>`,t.dateOfCompletion&&(a+=`<div style="margin-top: ${e.spacing.completionMarginTop}; font-size: ${e.typography.completion};">ðŸ§­ Challenge completed on ${t.dateOfCompletion}</div>`),n.innerHTML=a,o.appendChild(n);var i=e.isMobile?Math.min(e.compass.baseSize,window.innerWidth-40):e.compass.baseSize,r=document.createElement("div");r.style.position="relative",r.style.width=i+"px",r.style.height=i+"px",r.style.margin="0 auto",r.style.boxSizing="content-box";let c=document.createElementNS("http://www.w3.org/2000/svg","svg"),p=(c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("viewBox","0 0 700 700"),c.style.position="absolute",c.style.top="0",c.style.left="0",350),u=350;n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",p),n.setAttribute("cy",u),n.setAttribute("r",230),n.setAttribute("fill","#334"),n.setAttribute("stroke",m.accentColor),n.setAttribute("stroke-width","5"),c.appendChild(n);[{name:"north",angle:270,label:"N",data:t.directions.north},{name:"east",angle:0,label:"E",data:t.directions.east},{name:"south",angle:90,label:"S",data:t.directions.south},{name:"west",angle:180,label:"W",data:t.directions.west}].forEach(e=>{var o=e.angle*(Math.PI/180),n=p+230*Math.cos(o),a=u+230*Math.sin(o),i=230*.12,r=p+115*Math.cos(o),s=u+115*Math.sin(o),t=o+Math.PI/2,l=r+i*Math.cos(t),d=s+i*Math.sin(t),r=r-i*Math.cos(t),s=s-i*Math.sin(t),i=document.createElementNS("http://www.w3.org/2000/svg","path"),t=(i.setAttribute("d",`M 350 350 L ${l} ${d} L ${n} ${a} L ${r} ${s} Z`),i.setAttribute("fill",e.data?m.completedColor:m.pendingColor),i.setAttribute("stroke","#000"),i.setAttribute("stroke-width","1"),i.setAttribute("stroke-opacity","0.3"),c.appendChild(i),p+115*Math.cos(o)),l=u+115*Math.sin(o),d=document.createElementNS("http://www.w3.org/2000/svg","text");if(d.setAttribute("x",t),d.setAttribute("y",l),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.setAttribute("fill","#fff"),d.setAttribute("font-size","28px"),d.setAttribute("font-weight","bold"),d.setAttribute("stroke","#000"),d.setAttribute("stroke-width","1"),d.setAttribute("paint-order","stroke"),d.textContent=e.label,c.appendChild(d),e.data){n=e.data.eventName.match(/(.+?)(?:\s+parkrun)?$/i),a=(n?n[1]:e.data.eventName)+" - "+e.data.date,r="text-path-"+e.name,s=document.createElementNS("http://www.w3.org/2000/svg","path");let t="";switch(e.name){case"north":t="M 180 105 A 245 245 0 0 1 520 105";break;case"east":t="M 595 180 A 245 245 0 0 1 595 520";break;case"south":t="M 180 595 A 245 245 0 0 0 520 595";break;case"west":t="M 105 520 A 245 245 0 0 1 105 180";break;default:console.warn("Unknown direction: "+e.name)}s.setAttribute("id",r),s.setAttribute("d",t),s.setAttribute("fill","none"),c.appendChild(s);i=document.createElementNS("http://www.w3.org/2000/svg","text"),o=(i.setAttribute("fill","#FFFFFF"),i.setAttribute("font-size","14px"),i.setAttribute("font-weight","bold"),document.createElementNS("http://www.w3.org/2000/svg","textPath"));o.setAttribute("href","#"+r),o.setAttribute("startOffset","50%"),o.setAttribute("text-anchor","middle"),"south"===e.name&&o.setAttribute("side","left"),o.textContent=a,i.appendChild(o),c.appendChild(i)}});e=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=document.createElementNS("http://www.w3.org/2000/svg","filter"),i.setAttribute("id","text-shadow"),i.setAttribute("x","-20%"),i.setAttribute("y","-20%"),i.setAttribute("width","140%"),i.setAttribute("height","140%"),n=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow"),n.setAttribute("dx","0"),n.setAttribute("dy","0"),n.setAttribute("stdDeviation","2"),n.setAttribute("flood-color","#000000"),n.setAttribute("flood-opacity","0.7"),i.appendChild(n),e.appendChild(i),c.appendChild(e),n=document.createElementNS("http://www.w3.org/2000/svg","circle"),n.setAttribute("cx",p),n.setAttribute("cy",u),n.setAttribute("r",30),n.setAttribute("fill",m.accentColor),c.appendChild(n),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",p),i.setAttribute("y",u),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","middle"),i.setAttribute("fill",m.backgroundColor),i.setAttribute("font-size","24px"),i.setAttribute("font-weight","bold"),i.textContent=Math.round(t.completedCount/4*100)+"%",c.appendChild(i),r.appendChild(c),o.appendChild(r);{var s=o;let t=l(),e=document.createElement("div"),a=(e.style.marginTop=t.button.marginTop,e.id="compass-download-btn-container",document.createElement("button"));a.textContent="ðŸ’¾ Save as Image",a.style.padding=t.button.padding,a.style.backgroundColor=m.accentColor,a.style.color=m.backgroundColor,a.style.border="none",a.style.borderRadius="4px",a.style.cursor="pointer",a.style.fontWeight="bold",a.style.fontSize=t.button.fontSize,a.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),a.addEventListener("mouseout",function(){this.style.backgroundColor=m.accentColor}),a.addEventListener("click",function(){a.style.display="none",html2canvas(s,{backgroundColor:m.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(t=>{a.style.display="block";var e=document.createElement("a"),o=(new Date).toISOString().split("T")[0],n=window.location.pathname.split("/")[2]||"parkrunner";e.download=`compass-challenge-${n}-${o}.png`,e.href=t.toDataURL("image/png"),e.click()})}),e.appendChild(a),s.appendChild(e)}return o}document.querySelector("#results")?(t=t=o((t=>{var e={north:null,south:null,east:null,west:null};let o=0,n=null,a=0,i=(t=t.querySelectorAll("tr"),[]);t.forEach(t=>{var e,o,n,t=t.querySelectorAll("td");t.length<5||(e=t[0].textContent.trim(),o=t[1].textContent.trim(),n=t[2].textContent.trim(),(t=t[4].textContent.trim())&&n&&o&&e&&i.push({eventName:e,date:o,eventNumber:n,time:t}))});var r=i.reverse();for(let t=0;!n&&t<r.length;t++){var s,l,{eventName:d,date:c,eventNumber:p,time:u}=r[t];a++;for([s,l]of Object.entries(h))l.test(d)&&!e[s]&&(e[s]={eventName:d,date:c,eventNumber:p,time:u},4===++o)&&(n=n||c)}return{directions:e,completedCount:o,dateOfCompletion:n,totalEvents:a}})((t=document.querySelectorAll("#results"))[t.length-1])),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")}})();
```

### parkrun Launch Returnees

> Identifies and displays participants who attended both the launch event and the latest event


[launch-returnees.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/launch-returnees.user.js)

```javascript
javascript:(async()=>{(async()=>{if(!document.getElementById("parkrun-launch-returnees")){let c={backgroundColor:"#2b223d",headerColor:"#FFA300",textColor:"#EEE",linkColor:"#53BA9D"},p=864e5;function i(e,l,i,d){var t=document.createElement("div");t.style.maxHeight="400px",t.style.overflow="auto";let s=document.createElement("ul");return s.style.listStyleType="none",s.style.padding="0",s.style.margin="0",s.style.textAlign="center",e.forEach(e=>{e=e,o=l,t=i,r=d,n=document.createElement("li"),(a=document.createElement("a")).href=r+`/parkrunner/${e}/`,a.target="_blank",r=o.get(e)||t.get(e)||"Unknown parkrunner",a.textContent=r+` (A${e})`,a.style.color=c.linkColor,a.style.textDecoration="none",n.appendChild(a);var t,r,n,a,o=n;s.appendChild(o)}),t.appendChild(s),t}function a(e,t,r,n){(o=document.createElement("div")).id="parkrun-launch-returnees",o.style.width="100%",o.style.maxWidth="800px",o.style.margin="20px auto",o.style.padding="15px",o.style.backgroundColor=c.backgroundColor,o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",o.style.color=c.textColor;l="Participants Who Attended the Launch Event",(a=document.createElement("h3")).textContent=l,a.style.textAlign="center",a.style.marginBottom="15px",a.style.color=c.headerColor;var a,o,l=a;o.appendChild(l),0===e.length?(a="No attendees from the launch event were present at the latest event.",(l=document.createElement("p")).textContent=a,l.style.textAlign="center",l.style.fontWeight="bold",a=l,o.appendChild(a)):(l=i(e,t,r,n),o.appendChild(l)),a=o,(e=document.querySelector("h1"))&&e.parentNode?e.nextSibling?e.parentNode.insertBefore(a,e.nextSibling):e.parentNode.appendChild(a):document.body.insertBefore(a,document.body.firstChild)}(async()=>{var e=window.location.pathname.match(/\/([^/]+)\/results\/latestresults/)[1],t=window.location.origin,e=t+`/${e}/results/1/`,r=(()=>{var t=document.querySelectorAll('a[href*="/parkrunner/"]'),r=new Map;for(let e=0;e<t.length;e++){var n=t[e].href.match(/\/parkrunner\/(\d+)/);n&&r.set(n[1],t[e].textContent.trim())}return r})();let n=await(async t=>{var e="parkrun-launch-returnees-"+t;try{var r=localStorage.getItem(e);if(r){var{data:n,timestamp:a}=JSON.parse(r);if(Date.now()-a<p)return new Map(n)}var o=await(await fetch(t)).text(),l=(new DOMParser).parseFromString(o,"text/html").querySelectorAll('a[href*="/parkrunner/"]'),i=new Map;for(let e=0;e<l.length;e++){var d=l[e].href.match(/\/parkrunner\/(\d+)/);d&&i.set(d[1],l[e].textContent.trim())}var s={data:Array.from(i.entries()),timestamp:Date.now()};return localStorage.setItem(e,JSON.stringify(s)),i}catch(e){return console.error("Error fetching or parsing:",t,e),new Map}})(e);a([...r.keys()].filter(e=>n.has(e)),r,n,t)})()}})()})();
```

### parkrun p-index display

> The parkrun p-index is an unofficial statistic that measures the number of different parkrun events a person has completed a specific number of times. To achieve a p-index of 10, you must have completed at least 10 different parkrun events 10 times each. This script calculate the p-index for a parkrunner and displays it on their results page.


[p-index.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/p-index.user.js)

```javascript
javascript:(async()=>{var o;function a(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"10px",medium:"15px"},container:{padding:"10px",marginTop:"10px",width:"100%",maxWidth:"800px",aspectRatio:"auto"},typography:{pIndex:"1.2em",listItem:"0.9em"},listItem:{marginBottom:"5px",textAlign:"left"},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"}}:{isMobile:!1,spacing:{small:"20px",medium:"20px"},container:{padding:"20px",marginTop:"20px",width:"auto",maxWidth:"none",aspectRatio:"1"},typography:{pIndex:"1.5em",listItem:"1em"},listItem:{marginBottom:"8px",textAlign:"center"},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"}}}if(o="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=o,n.onload=e,n.onerror=t,document.head.appendChild(n)}),"undefined"!=typeof module&&module.exports)module.exports={calculatePIndex:n,extractEventDetails:e,findResultsTable:t};else{var i,r=t();if(r){({pIndex:r,contributingEvents:i}=n(e(r)));{let o=a(),e=document.querySelector("h2");if(e){let t=document.createElement("div"),n=(t.textContent="p-index: "+r,t.style.fontSize=o.typography.pIndex,t.style.fontWeight="bold",t.style.marginTop=o.container.marginTop,t.style.backgroundColor="#2b223d",t.style.color="#ffa300",t.style.padding=o.container.padding,t.style.borderRadius="5px",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=o.container.width,t.style.maxWidth=o.container.maxWidth,t.style.marginLeft="auto",t.style.marginRight="auto",t.style.aspectRatio=o.container.aspectRatio,t.setAttribute("id","p-index-display"),document.createElement("ul"));n.style.listStyleType="none",n.style.padding="0",n.style.marginTop=o.spacing.small,n.style.width="100%",i.forEach(e=>{var t=document.createElement("li");t.textContent=e,t.style.fontWeight="normal",t.style.fontSize=o.typography.listItem,t.style.marginBottom=o.listItem.marginBottom,t.style.textAlign=o.listItem.textAlign,t.style.wordBreak="break-word",n.appendChild(t)}),t.appendChild(n),(e=>{let t=a(),n=document.createElement("div"),i=(n.style.marginTop=t.button.marginTop,n.id="p-index-download-btn-container",document.createElement("button"));i.textContent="ðŸ’¾ Save as Image",i.style.padding=t.button.padding,i.style.backgroundColor="#ffa300",i.style.color="#2b223d",i.style.border="none",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.fontSize=t.button.fontSize,i.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),i.addEventListener("mouseout",function(){this.style.backgroundColor="#ffa300"}),i.addEventListener("click",function(){i.style.display="none",html2canvas(e,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(e=>{i.style.display="block";var t=document.createElement("a"),n=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/")[2]||"parkrunner";t.download=`p-index-${o}-${n}.png`,t.href=e.toDataURL("image/png"),t.click()})}),n.appendChild(i),e.appendChild(n)})(t),e.parentNode.insertBefore(t,e.nextSibling),o.isMobile||setTimeout(()=>{var e=t.getBoundingClientRect(),e=Math.max(e.width,e.height);t.style.width=e+"px",t.style.height=e+"px"},0)}}}else console.error("Results table not found")}function e(e){let o=[];e.querySelectorAll("tbody > tr").forEach(e=>{var t=e.querySelector("td:nth-child(1) > a").textContent.trim(),n=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();o.unshift({eventName:t,date:n,eventNumber:e})});e=o.reduce((e,{eventName:t,date:n,eventNumber:o})=>(e[t]||(e[t]=[]),e[t].push({date:n,eventNumber:o}),e),{});return Object.entries(e).sort((e,t)=>t[1].length-e[1].length)}function t(){var e=document.querySelectorAll("#results");return e[e.length-1]}function n(e){e=e.filter(([,e],t)=>e.length>t);let i=e.length;function a(e){return new Date(e.split("/").reverse().join("-"))}e=e.map(([e,t])=>{var n=t[0],o=t[i-1];return{eventName:e,eventCount:t.length,firstDate:n.date,firstEventNumber:n.eventNumber,pIndexDate:o.date,pIndexEventNumber:o.eventNumber,firstDateForSorting:a(n.date),pIndexDateForSorting:a(o.date)}}).sort((e,t)=>e.pIndexDateForSorting-t.pIndexDateForSorting).slice(0,i).map(e=>e.eventName+" ("+e.eventCount+"): "+e.firstDate+" (#"+e.firstEventNumber+") - "+e.pIndexDate+" (#"+e.pIndexEventNumber+")");return{pIndex:i,contributingEvents:e}}})();
```

### parkrun Annual Summary

> Adds an annual participation summary (totals, averages, min/max) to parkrun event history pages


[parkrun-annual-summary.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-annual-summary.user.js)

```javascript
javascript:(async()=>{var o;o="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var r=document.createElement("script");r.src=o,r.onload=e,r.onerror=t,document.head.appendChild(r)});{let p={backgroundColor:"#1c1b2a",barColor:"#f59e0b",lineColor:"#22d3ee",textColor:"#f3f4f6",subtleTextColor:"#d1d5db",gridColor:"rgba(243, 244, 246, 0.18)"},s=["#f59e0b","#22d3ee","#f97316","#10b981","#a855f7","#ef4444","#3b82f6","#84cc16"],m={currentEvent:null,comparisonEvents:[],allParkruns:null};function h(){return{eventName:window.location.pathname.split("/")[1],domain:window.location.hostname,url:window.location.origin}}function c(e,t,r,o){var n=(r-e)*Math.PI/180,o=(o-t)*Math.PI/180,t=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))}async function y(e,t){e=await(async(e,t)=>{var r=e.cloneNode(!0),e=e.querySelectorAll("canvas");let n=r.querySelectorAll("canvas");e.forEach((e,t)=>{try{var r=e.toDataURL("image/png"),o=document.createElement("img");o.src=r,o.alt="Chart snapshot",o.style.maxWidth="100%",o.style.display="block",o.style.backgroundColor="#2b223d",n[t]&&n[t].replaceWith(o)}catch(e){console.error("Failed to serialize chart canvas:",e)}});var e=`
      :root { color-scheme: dark; }
      body { margin: 0; padding: 20px; background: ${p.backgroundColor}; color: ${p.textColor}; font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; line-height: 1.5; }
      a { color: ${p.lineColor}; }
      h1, h2, h3, h4 { color: ${p.barColor}; margin: 0 0 10px 0; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border: 1px solid ${p.gridColor}; padding: 10px; text-align: left; }
      th { background: #2b223d; color: ${p.barColor}; }
      tr:nth-child(even) td { background: #241c35; }
      tr:nth-child(odd) td { background: #1f182e; }
      .parkrun-annual-summary { background: ${p.backgroundColor}; padding: 16px; border-radius: 6px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25); }
      .chart-img { max-width: 100%; display: block; }
      .meta { margin-bottom: 16px; color: ${p.subtleTextColor}; font-size: 13px; }
      .meta strong { color: ${p.textColor}; }
    `,o=`
      <header>
        <h1>parkrun Annual Summary</h1>
        <div class="meta">
          <div><strong>Event:</strong> ${t.eventShortName}</div>
          <div><strong>Generated:</strong> ${t.generatedAt}</div>
        </div>
      </header>
    `;return`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>parkrun Annual Summary - ${t.eventShortName}</title><style>${e}</style></head><body>${o}${r.outerHTML}</body></html>`})(e,t),t=`parkrun-annual-summary-${t.eventShortName}-${t.generatedAtISO}.html`;return{blob:new Blob([e],{type:"text/html"}),filename:t}}function g(l){let a={};return l.dates.forEach((e,t)=>{var e=new Date(e).getFullYear(),r=l.finishers[t]??0,o=l.volunteers[t]??0,n=l.eventNumbers[t],e=(a[e]||(a[e]={year:e,eventCount:0,totalFinishers:0,totalVolunteers:0,minFinishers:null,maxFinishers:null,minVolunteers:null,maxVolunteers:null}),a[e]);e.eventCount++,e.totalFinishers+=r,e.totalVolunteers+=o,(null===e.minFinishers||r<e.minFinishers.value)&&(e.minFinishers={value:r,date:l.dates[t],eventNumber:n}),(null===e.maxFinishers||r>e.maxFinishers.value)&&(e.maxFinishers={value:r,date:l.dates[t],eventNumber:n}),(null===e.minVolunteers||o<e.minVolunteers.value)&&(e.minVolunteers={value:o,date:l.dates[t],eventNumber:n}),(null===e.maxVolunteers||o>e.maxVolunteers.value)&&(e.maxVolunteers={value:o,date:l.dates[t],eventNumber:n})}),Object.keys(a).map(Number).sort((e,t)=>e-t).map(e=>{var t=a[e];return{year:e,eventCount:t.eventCount,totalFinishers:t.totalFinishers,totalVolunteers:t.totalVolunteers,avgFinishers:Math.round(t.totalFinishers/t.eventCount),avgVolunteers:Math.round(t.totalVolunteers/t.eventCount),minFinishers:t.minFinishers,maxFinishers:t.maxFinishers,minVolunteers:t.minVolunteers,maxVolunteers:t.maxVolunteers,finishersGrowth:null,volunteersGrowth:null}}).map((e,t,r)=>0===t?e:(t=(r=r[t-1]).avgFinishers?(e.avgFinishers-r.avgFinishers)/r.avgFinishers*100:null,r=r.avgVolunteers?(e.avgVolunteers-r.avgVolunteers)/r.avgVolunteers*100:null,{...e,finishersGrowth:t,volunteersGrowth:r}))}function v(e){return e?e.value.toLocaleString():"-"}function b(e){var t;return null===e||Number.isNaN(e)?"-":(t=0<e?"+":"",`<span style="color: ${0<e?"#53BA9D":e<0?"#ff6b6b":p.subtleTextColor};">${t}${e.toFixed(1)}%</span>`)}function a(o){var e=document.createElement("div"),t=(e.style.marginBottom="15px",e.style.padding="10px",e.style.backgroundColor=p.backgroundColor,e.style.borderRadius="6px",e.style.display="flex",e.style.alignItems="center",e.style.gap="10px",e.style.flexWrap="wrap",document.createElement("span"));t.textContent="Compare with:",t.style.color=p.textColor,t.style.fontWeight="bold",e.appendChild(t);let n=document.createElement("select");n.style.padding="6px 12px",n.style.backgroundColor="#3a3250",n.style.color=p.textColor,n.style.border="1px solid "+p.gridColor,n.style.borderRadius="4px",n.style.cursor="pointer";t=document.createElement("option");t.value="",t.textContent="-- Select parkrun --",n.appendChild(t),o.forEach(e=>{var t=document.createElement("option");t.value=e.properties.eventname,t.textContent=`${e.properties.EventShortName} (${e.distance.toFixed(1)}km)`,n.appendChild(t)});let l=document.createElement("button");return l.textContent="+ Add",l.style.padding="6px 12px",l.style.backgroundColor=p.lineColor,l.style.color="#2b223d",l.style.border="none",l.style.borderRadius="4px",l.style.cursor="pointer",l.style.fontWeight="bold",l.addEventListener("click",async()=>{let t=n.value;var e,r;t&&(m.comparisonEvents.some(e=>e.eventName===t)?alert("This parkrun is already selected for comparison"):(l.disabled=!0,l.textContent="Loading...",e=h(),(e=await(async(t,e)=>{try{var a=await(await fetch(e+`/${t}/results/eventhistory/`)).text(),s=(new DOMParser).parseFromString(a,"text/html"),i=s.querySelector("h1")?.textContent.trim()??t+" Event History";let r=[],o=[],n=[],l=[];var d=s.querySelectorAll("tr.Results-table-row");return Array.from(d).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&r.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),o.push(t)),e.getAttribute("data-finishers")),t=(t&&n.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{eventName:t,title:i,eventNumbers:r,dates:o,finishers:n,volunteers:l}}catch(e){return console.error(`Failed to fetch event history for ${t}:`,e),null}})(t,e.url))?(r=o.find(e=>e.properties.eventname===t),m.comparisonEvents.push({...e,distance:r?.distance}),i()):alert("Failed to fetch event history"),l.disabled=!1,l.textContent="+ Add",n.value=""))}),e.appendChild(n),e.appendChild(l),e}function x(e){var t=document.createElement("div");return t.style.minWidth="0",t.appendChild(e),t}function C(e,t,n,r,l,o,a=!1){r=r.map(({event:e,yearly:r},t)=>{var t=s[t%s.length],o=n.map(t=>{var e=r.find(e=>e.year===t);return e&&null!=(e=l(e))?e:null});return{label:e.title||e.eventName,data:o,borderColor:t,backgroundColor:t,borderWidth:2,pointRadius:4,pointBackgroundColor:t,fill:!1,tension:.2,spanGaps:!0}}),e=e.getContext("2d");new Chart(e,{type:"line",data:{labels:n.map(e=>e.toString()),datasets:r},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.3,plugins:{legend:{labels:{color:p.textColor}},title:{display:!0,text:t,color:p.textColor}},scales:{x:{title:{display:!0,text:"Year",color:p.textColor},ticks:{color:p.subtleTextColor},grid:{color:p.gridColor}},y:{beginAtZero:!a,title:{display:!0,text:o,color:p.textColor},ticks:{precision:0,color:p.subtleTextColor,callback:a?e=>e+"%":void 0},grid:{color:p.gridColor}}}}})}function i(){var t=document.querySelector(".parkrun-annual-summary"),t=(t&&t.remove(),(()=>{var e=document.querySelector("h1")?.textContent.trim()??"Event History";let r=[],o=[],n=[],l=[];var t=document.querySelectorAll("tr.Results-table-row");return Array.from(t).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&r.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),o.push(t)),e.getAttribute("data-finishers")),t=(t&&n.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{title:e,eventNumbers:r,dates:o,finishers:n,volunteers:l}})());if(0===t.eventNumbers.length)console.log("No event history data found");else{m.currentEvent={...t,eventName:h().eventName};var t=[m.currentEvent,...m.comparisonEvents],o=document.createElement("div"),n=(o.className="parkrun-annual-summary",o.style.width="100%",o.style.maxWidth="1200px",o.style.margin="20px auto",o.style.padding="15px",o.style.backgroundColor=p.backgroundColor,o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.createElement("h3"));n.textContent="Annual Participation Summary",n.style.textAlign="center",n.style.marginBottom="15px",n.style.color=p.barColor,o.appendChild(n),null===m.allParkruns?((n=document.createElement("div")).style.padding="10px",n.style.color=p.subtleTextColor,n.style.textAlign="center",n.style.fontSize="13px",n.textContent="Loading parkrun events for comparison...",o.appendChild(n)):0===m.allParkruns.length?((n=document.createElement("div")).style.padding="10px",n.style.color="#ff6b6b",n.style.textAlign="center",n.style.fontSize="13px",n.textContent="Failed to load parkrun events data. Check console for details.",o.appendChild(n),console.error("No parkrun events loaded. Expected data from https://images.parkrun.com/events.json")):0<(n=((n,e,l=50)=>{var t=e.find(e=>e.properties.eventname===n.eventName);if(!t)return[];let[a,s]=t.geometry.coordinates,i=t.properties.countrycode,d=t.properties.seriesid;return e.filter(e=>{var t,r,o;return e.properties.eventname!==n.eventName&&e.properties.countrycode===i&&e.properties.seriesid===d&&([e,t]=e.geometry.coordinates,r=Math.abs(t-s),o=Math.abs(e-a),!(.5<r||.5<o))&&c(s,a,t,e)<=l}).map(e=>{var[t,r]=e.geometry.coordinates,r=c(s,a,r,t);return{...e,distance:r}}).sort((e,t)=>e.distance-t.distance)})(h(),m.allParkruns)).length?((n=a(n)).className="parkrun-comparison-selector-controls",o.appendChild(n)):((n=document.createElement("div")).style.padding="10px",n.style.color=p.subtleTextColor,n.style.textAlign="center",n.style.fontSize="13px",l=h(),n.textContent=`No nearby parkruns found for comparison (within 50km of ${l.eventName})`,o.appendChild(n),console.log("Current event:",l.eventName,"Total parkruns loaded:",m.allParkruns.length)),0<m.comparisonEvents.length&&(n=(()=>{let n=document.createElement("div");n.id="selectedEventsDisplay",n.style.display="flex",n.style.gap="8px",n.style.flexWrap="wrap",n.style.marginTop="10px";var e=()=>{n.innerHTML="",[m.currentEvent,...m.comparisonEvents].forEach((e,t)=>{var r=document.createElement("div"),o=(r.style.display="inline-flex",r.style.alignItems="center",r.style.gap="6px",r.style.padding="4px 10px",r.style.backgroundColor=s[t%s.length],r.style.color="#2b223d",r.style.borderRadius="12px",r.style.fontSize="12px",r.style.fontWeight="bold",document.createElement("span"));o.textContent=e.title||e.eventName,r.appendChild(o),0<t&&((e=document.createElement("span")).textContent="Ã—",e.style.cursor="pointer",e.style.marginLeft="4px",e.style.fontSize="16px",e.addEventListener("click",()=>{m.comparisonEvents.splice(t-1,1),i()}),r.appendChild(e)),n.appendChild(r)})};return e(),{container:n,updateDisplay:e}})().container,o.appendChild(n));let{tabsContainer:e,tabContents:r}=(e=>{var t=document.createElement("div");t.id="eventTabs",t.style.marginTop="15px";let o=document.createElement("div"),n=(o.style.display="flex",o.style.gap="5px",o.style.borderBottom="2px solid "+p.gridColor,o.style.marginBottom="15px",document.createElement("div"));return n.id="tabContents",e.forEach((e,r)=>{var t=document.createElement("button");t.textContent=e.title||e.eventName,t.style.padding="10px 20px",t.style.backgroundColor=0===r?s[r%s.length]:"#3a3250",t.style.color=0===r?"#2b223d":p.textColor,t.style.border="none",t.style.borderRadius="6px 6px 0 0",t.style.cursor="pointer",t.style.fontWeight="bold",t.dataset.index=r,t.addEventListener("click",()=>{o.querySelectorAll("button").forEach((e,t)=>{e.style.backgroundColor=t===r?s[t%s.length]:"#3a3250",e.style.color=t===r?"#2b223d":p.textColor}),n.querySelectorAll(".tab-content").forEach((e,t)=>{e.style.display=t===r?"block":"none"})}),o.appendChild(t)}),t.appendChild(o),t.appendChild(n),{tabsContainer:t,tabContents:n}})(t);o.appendChild(e),t.forEach((e,t)=>{e=((e,t)=>{let r=g(e);if(0===r.length)return null;(e=document.createElement("div")).className="tab-content",e.style.display=0===t?"block":"none",e.style.backgroundColor=p.backgroundColor,e.style.padding="15px",e.style.borderRadius="6px";var o=document.createElement("div");o.style.overflowX="auto",(n=document.createElement("table")).className="annualSummaryTable",n.style.width="100%",n.style.borderCollapse="collapse",n.style.fontSize="14px",n.style.color=p.textColor,n.style.backgroundColor=p.backgroundColor;let l={key:"year",dir:"asc"};var n,a=[{key:"year",label:"Year",align:"left"},{key:"eventCount",label:"Events",align:"center"},{key:"totalFinishers",label:"Finishers Total",align:"right",color:p.barColor},{key:"minFinishers",label:"Finishers Min",align:"right",color:p.barColor},{key:"maxFinishers",label:"Finishers Max",align:"right",color:p.barColor},{key:"avgFinishers",label:"Finishers Avg",align:"right",color:p.barColor},{key:"finishersGrowth",label:"Finishers YoY",align:"right"},{key:"totalVolunteers",label:"Volunteers Total",align:"right",color:p.lineColor},{key:"minVolunteers",label:"Volunteers Min",align:"right",color:p.lineColor},{key:"maxVolunteers",label:"Volunteers Max",align:"right",color:p.lineColor},{key:"avgVolunteers",label:"Volunteers Avg",align:"right",color:p.lineColor},{key:"volunteersGrowth",label:"Volunteers YoY",align:"right"}],s=document.createElement("thead");let i=document.createElement("tr"),d=(i.style.borderBottom="2px solid "+p.gridColor,a.forEach(e=>{var t=document.createElement("th");t.textContent=e.label,t.style.padding="10px",t.style.textAlign=e.align,t.style.cursor="pointer",e.color&&(t.style.color=e.color),t.addEventListener("click",()=>{l.key===e.key?l.dir="asc"===l.dir?"desc":"asc":(l.key=e.key,l.dir="desc"),c()}),i.appendChild(t)}),s.appendChild(i),n.appendChild(s),document.createElement("tbody"));function c(){d.innerHTML="",[...r].sort((e,t)=>{let r=l.key;var o="asc"===l.dir?1:-1,n=e=>{e=e[r];return null==e?-1/0:"object"==typeof e&&void 0!==e.value?e.value:e},e=n(e),n=n(t);return e===n?0:n<e?o:-o}).forEach(e=>{var t=document.createElement("tr");t.style.borderBottom="1px solid "+p.gridColor,t.innerHTML=`
          <td style="padding: 10px; text-align: left; font-weight: bold;">${e.year}</td>
          <td style="padding: 10px; text-align: center;">${e.eventCount}</td>
          <td style="padding: 10px; text-align: right; color: ${p.barColor};">${e.totalFinishers.toLocaleString()}</td>
          <td style="padding: 10px; text-align: right; color: ${p.barColor};">${v(e.minFinishers)}</td>
          <td style="padding: 10px; text-align: right; color: ${p.barColor};">${v(e.maxFinishers)}</td>
          <td style="padding: 10px; text-align: right; color: ${p.barColor};">${e.avgFinishers}</td>
          <td style="padding: 10px; text-align: right;">${b(e.finishersGrowth)}</td>
          <td style="padding: 10px; text-align: right; color: ${p.lineColor};">${e.totalVolunteers.toLocaleString()}</td>
          <td style="padding: 10px; text-align: right; color: ${p.lineColor};">${v(e.minVolunteers)}</td>
          <td style="padding: 10px; text-align: right; color: ${p.lineColor};">${v(e.maxVolunteers)}</td>
          <td style="padding: 10px; text-align: right; color: ${p.lineColor};">${e.avgVolunteers}</td>
          <td style="padding: 10px; text-align: right;">${b(e.volunteersGrowth)}</td>
        `,d.appendChild(t)})}n.appendChild(d),o.appendChild(n),e.appendChild(o),c(),(a=document.createElement("div")).style.display="grid",a.style.gridTemplateColumns="1fr 1fr",a.style.gap="20px",a.style.marginTop="20px",(s=document.createElement("div")).style.minWidth="0",(n=document.createElement("canvas")).className="annualTotalsChart-"+t,s.appendChild(n),(o=document.createElement("div")).style.minWidth="0";var u=document.createElement("canvas");return u.className="annualGrowthChart-"+t,o.appendChild(u),a.appendChild(s),a.appendChild(o),e.appendChild(a),"undefined"!=typeof Chart&&(t=n.getContext("2d"),s=u.getContext("2d"),o=r.map(e=>e.year.toString()),new Chart(t,{type:"bar",data:{labels:o,datasets:[{label:"Total Finishers",data:r.map(e=>e.totalFinishers),backgroundColor:p.barColor,borderColor:p.barColor,borderWidth:1},{label:"Total Volunteers",data:r.map(e=>e.totalVolunteers),backgroundColor:p.lineColor,borderColor:p.lineColor,borderWidth:1}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.3,plugins:{legend:{labels:{color:p.textColor}},title:{display:!0,text:"Annual Totals",color:p.textColor}},scales:{x:{title:{display:!0,text:"Year",color:p.textColor},ticks:{color:p.subtleTextColor},grid:{color:p.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Participants",color:p.textColor},ticks:{precision:0,color:p.subtleTextColor},grid:{color:p.gridColor}}}}}),a=r.filter(e=>null!==e.finishersGrowth),new Chart(s,{type:"line",data:{labels:a.map(e=>e.year.toString()),datasets:[{label:"Finishers Growth",data:a.map(e=>e.finishersGrowth),borderColor:p.barColor,backgroundColor:p.barColor,borderWidth:2,pointRadius:4,pointBackgroundColor:p.barColor,fill:!1,tension:.2},{label:"Volunteers Growth",data:a.map(e=>e.volunteersGrowth),borderColor:p.lineColor,backgroundColor:p.lineColor,borderWidth:2,pointRadius:4,pointBackgroundColor:p.lineColor,fill:!1,tension:.2}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.3,plugins:{legend:{labels:{color:p.textColor}},title:{display:!0,text:"Year-over-Year Growth (%)",color:p.textColor}},scales:{x:{title:{display:!0,text:"Year",color:p.textColor},ticks:{color:p.subtleTextColor},grid:{color:p.gridColor}},y:{title:{display:!0,text:"Growth (%)",color:p.textColor},ticks:{color:p.subtleTextColor,callback:function(e){return e+"%"}},grid:{color:p.gridColor}}}}})),e})(e,t);e&&r.appendChild(e)}),1<t.length&&(l=(e=>{if(e.length<2)return null;var t=document.createElement("div"),r=(t.id="comparisonSection",t.style.marginTop="30px",t.style.padding="15px",t.style.backgroundColor=p.backgroundColor,t.style.borderRadius="8px",(r=document.createElement("h3")).textContent="Comparison Charts",r.style.textAlign="center",r.style.color=p.barColor,r.style.marginBottom="20px",t.appendChild(r),e.map(e=>({event:e,yearly:g(e)})));let o=new Set;r.forEach(({yearly:e})=>{e.forEach(e=>o.add(e.year))});var e=Array.from(o).sort((e,t)=>e-t),n=document.createElement("div"),l=(n.style.display="grid",n.style.gridTemplateColumns="1fr 1fr",n.style.gap="20px",document.createElement("canvas")),a=(n.appendChild(x(l)),document.createElement("canvas")),s=(n.appendChild(x(a)),document.createElement("canvas")),i=(n.appendChild(x(s)),document.createElement("canvas"));n.appendChild(x(i)),t.appendChild(n),(n=document.createElement("div")).style.display="flex",n.style.justifyContent="center",n.style.marginTop="20px",n.style.gap="10px",n.style.flexWrap="wrap";let d=document.createElement("button"),c=(d.textContent="ðŸ“„ Export HTML",d.style.padding="8px 16px",d.style.backgroundColor=p.barColor,d.style.color="#1c1b2a",d.style.border="none",d.style.borderRadius="4px",d.style.cursor="pointer",d.style.fontWeight="bold",d.style.fontSize="14px",document.createElement("button")),u=(c.textContent="ðŸ“¤ Share Report",c.style.padding="8px 16px",c.style.backgroundColor=p.lineColor,c.style.color="#2b223d",c.style.border="none",c.style.borderRadius="4px",c.style.cursor="pointer",c.style.fontWeight="bold",c.style.fontSize="14px",()=>{let t=h();var e=(m.allParkruns?.find(e=>e.properties.eventname===t.eventName))?.properties?.EventShortName||t.eventName,r=new Date,o=r.toISOString().split("T")[0];return{eventShortName:e,generatedAt:r.toLocaleString(),generatedAtISO:o}});return d.addEventListener("click",async()=>{var e=d.textContent,t=d.style.display;d.textContent="Exporting...",d.disabled=!0,d.style.display="none";try{var r=document.querySelector(".parkrun-annual-summary");if(!r)throw new Error("Report container not found");var{blob:o,filename:n}=await y(r,u());let e=URL.createObjectURL(o);var l=document.createElement("a");l.href=e,l.download=n,l.click(),setTimeout(()=>URL.revokeObjectURL(e),1e3),console.log("Annual summary HTML export complete")}catch(e){console.error("Annual summary export failed:",e),alert("Error exporting HTML: "+e.message)}finally{d.disabled=!1,d.textContent=e,d.style.display=t}}),c.addEventListener("click",async()=>{var e=c.textContent,t=c.style.display;c.textContent="Sharing...",c.disabled=!0,c.style.display="none";try{var r=document.querySelector(".parkrun-annual-summary");if(!r)throw new Error("Report container not found");var o=u(),{blob:n,filename:l}=await y(r,o),a=new File([n],l,{type:"text/html"});if(navigator.canShare&&navigator.canShare({files:[a]}))await navigator.share({title:"parkrun Annual Summary - "+o.eventShortName,text:"Annual participation summary report",files:[a]}),console.log("Annual summary shared via Web Share API");else{let e=URL.createObjectURL(n);var s=document.createElement("a");s.href=e,s.download=l,s.click(),setTimeout(()=>URL.revokeObjectURL(e),1e3),alert("Sharing is not supported in this browser, so the HTML report was downloaded instead.")}}catch(e){console.error("Annual summary share failed:",e),alert("Error sharing report: "+e.message)}finally{c.disabled=!1,c.textContent=e,c.style.display=t}}),n.appendChild(d),n.appendChild(c),t.appendChild(n),"undefined"!=typeof Chart&&(C(l,"Annual Totals - Finishers",e,r,e=>e.totalFinishers,"Finishers"),C(a,"Annual Totals - Volunteers",e,r,e=>e.totalVolunteers,"Volunteers"),C(s,"YoY Growth - Finishers (%)",e,r,e=>e.finishersGrowth,"Growth (%)",!0),C(i,"YoY Growth - Volunteers (%)",e,r,e=>e.volunteersGrowth,"Growth (%)",!0)),t})(t))&&o.appendChild(l);var l,n=document.getElementById("eventHistoryChart");n&&n.parentElement?n.parentElement.parentNode.insertBefore(o,n.parentElement.nextSibling):(t="h1",l=o,(t=document.querySelector(t))&&t.parentNode&&(t.nextSibling?t.parentNode.insertBefore(l,t.nextSibling):t.parentNode.appendChild(l)))}}(async()=>{var e=document.querySelector(".Results-table"),t=window.location.href.includes("/eventhistory/");e&&t&&(m.allParkruns=await(async()=>{var e="parkrun_events_cache";try{var t=localStorage.getItem(e);if(t)try{var{data:r,timestamp:o}=JSON.parse(t),n=Date.now()-o;if(n<864e5)return console.log(`Using cached parkrun events (${Math.round(n/1e3/60)} minutes old)`),r}catch(e){console.log("Cache parse error, fetching fresh data",e)}console.log("Fetching parkrun events from https://images.parkrun.com/events.json");var l=await fetch("https://images.parkrun.com/events.json");if(console.log("Fetch response status:",l.status,l.statusText),!l.ok)return console.error("Fetch failed with status:",l.status),[];var a=await l.json(),s=a.events?.features||a.features||[];if(console.log("Features array length:",s.length),!s||0===s.length)return console.error("No features found in response data"),[];try{localStorage.setItem(e,JSON.stringify({data:s,timestamp:Date.now()})),console.log("Cached",s.length,"parkrun events for 24 hours")}catch(e){console.warn("Failed to cache parkrun events:",e)}return console.log("Successfully loaded",s.length,"parkrun events"),s}catch(e){return console.error("Failed to fetch parkruns:",e),console.error("Error details:",e.message,e.stack),[]}})(),document.getElementById("annualSummaryTable")||document.getElementById("eventTabs")?console.log("Annual summary already exists, skipping render"):i())})()}})();
```

### parkrun Cancellation Impact

> Analyzes the impact of cancelled parkrun events on nearby alternatives


[parkrun-cancellation-impact.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-cancellation-impact.user.js)

```javascript
javascript:(async()=>{var r;r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=r,n.onload=e,n.onerror=t,document.head.appendChild(n)});{let f={backgroundColor:"#1c1b2a",barColor:"#f59e0b",alertColor:"#ef4444",lineColor:"#22d3ee",textColor:"#f3f4f6",subtleTextColor:"#d1d5db",gridColor:"rgba(243, 244, 246, 0.18)",successColor:"#10b981"},v=7,b=12,x=864e5,k={currentEvent:null,allParkruns:null,gapInfo:null,nearbyParkruns:[],fetchController:null,analysisComplete:!1,impactData:null,currentCancellationIndex:-1,cancellationDates:[],sortColumn:"distance",sortDirection:"asc"};function E(e){return new Date(e+"T00:00:00Z")}function a(e,t){e=document.querySelector(e);e&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))}function w(){return{eventName:window.location.pathname.split("/")[1],domain:window.location.hostname,url:window.location.origin}}function c(e,t,n,r){var o=(n-e)*Math.PI/180,r=(r-t)*Math.PI/180,t=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))}function S(e,t=b){var n=new Date(e),e=(n.setUTCDate(n.getUTCDate()-7*t),new Date(e));return e.setUTCDate(e.getUTCDate()+7*t),{start:n,end:e}}function D(n,r,o){let a={dates:[],finishers:[],volunteers:[]};return n.rawDates.forEach((e,t)=>{e=new Date(e);r<=e&&e<=o&&(a.dates.push(n.dates[t]),a.finishers.push(n.finishers[t]),a.volunteers.push(n.volunteers[t]))}),a}function T(e){return 0===e.dates.length?{avgFinishers:0,avgVolunteers:0,totalEvents:0,minFinishers:0,maxFinishers:0,minVolunteers:0,maxVolunteers:0}:{avgFinishers:Math.round(e.finishers.reduce((e,t)=>e+t,0)/e.dates.length),avgVolunteers:Math.round(e.volunteers.reduce((e,t)=>e+t,0)/e.dates.length),totalEvents:e.dates.length,minFinishers:Math.min(...e.finishers),maxFinishers:Math.max(...e.finishers),minVolunteers:Math.min(...e.volunteers),maxVolunteers:Math.max(...e.volunteers)}}async function n(){var e=document.querySelector(".parkrun-cancellation-impact"),e=(e&&e.remove(),(()=>{var e=document.querySelector("h1")?.textContent.trim()??"Event History";let n=[],r=[],o=[],a=[],l=[];var t=document.querySelectorAll("tr.Results-table-row");return Array.from(t).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&n.push(t),e.getAttribute("data-date")),t=(t&&(o.push(t),t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&a.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{title:e,eventNumbers:n,dates:r,rawDates:o,finishers:a,volunteers:l}})());if(0===e.eventNumbers.length)console.log("No event history data found");else{var t=(e=>{var t=e.rawDates.map(e=>E(e));if(t.length<2)return null;var n=[];for(let e=1;e<t.length;e++){var r=t[e-1],o=t[e],a=(o-r)/864e5;a>v&&n.push({gapStartDate:r,gapEndDate:o,daysDiff:a,eventsBefore:e,eventsAfter:t.length-e})}return 0===n.length?null:(e=n[n.length-1],console.log(`Detected ${n.length} gap(s); using latest: ${e.daysDiff.toFixed(1)} days`),console.log("All gaps detected:",n),e)})(e);if(t){k.currentEvent={...e,eventName:w().eventName},k.gapInfo=t;let r=w(),o=document.createElement("div");if(o.className="parkrun-cancellation-impact",o.style.width="100%",o.style.maxWidth="1200px",o.style.margin="20px auto",o.style.padding="15px",o.style.backgroundColor=f.backgroundColor,o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",k.allParkruns&&0!==k.allParkruns.length)if(k.nearbyParkruns=((o,e,a=50)=>{var t=e.find(e=>e.properties.eventname===o.eventName);if(!t)return[];let[l,s]=t.geometry.coordinates,i=t.properties.countrycode,d=t.properties.seriesid;return e.filter(e=>{var t,n,r;return e.properties.eventname!==o.eventName&&e.properties.countrycode===i&&e.properties.seriesid===d&&([e,t]=e.geometry.coordinates,n=Math.abs(t-s),r=Math.abs(e-l),!(.5<n||.5<r))&&c(s,l,t,e)<=a}).map(e=>{var[t,n]=e.geometry.coordinates,n=c(s,l,n,t);return{...e,distance:n}}).sort((e,t)=>e.distance-t.distance)})(r,k.allParkruns),0===k.nearbyParkruns.length)(e=document.createElement("div")).style.padding="10px",e.style.color=f.subtleTextColor,e.style.textAlign="center",e.textContent="No nearby parkruns found within 50km.",o.appendChild(e),a("h1",o);else{let{section:t,startButton:n}=(e=>{var t=document.createElement("div"),n=(t.style.padding="20px",t.style.backgroundColor="#2b223d",t.style.borderRadius="8px",t.style.marginBottom="20px",t.style.border="1px solid "+f.gridColor,document.createElement("h3"));n.textContent="Cancellation Impact Analysis",n.style.color=f.barColor,n.style.margin="0 0 15px 0",n.style.fontSize="20px",t.appendChild(n),(n=document.createElement("div")).style.fontSize="16px",n.style.color=f.textColor,n.style.marginBottom="15px",n.innerHTML=`<strong style="color: ${f.lineColor};">${e}</strong>`,t.appendChild(n),(e=document.createElement("div")).style.fontSize="14px",e.style.lineHeight="1.8",e.style.color=f.subtleTextColor,e.style.marginBottom="18px",e.innerHTML="ðŸ“ Analyzing impact on nearby parkruns within 50km",t.appendChild(e);let r=document.createElement("button");return r.textContent="â–¶ Start Analysis",r.className="start-analysis-btn",r.style.padding="12px 24px",r.style.backgroundColor=f.lineColor,r.style.color="#1c1b2a",r.style.border="none",r.style.borderRadius="6px",r.style.cursor="pointer",r.style.fontWeight="bold",r.style.fontSize="14px",r.style.transition="all 0.2s",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#0ea5e9",r.style.transform="translateY(-1px)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=f.lineColor,r.style.transform="translateY(0)"}),t.appendChild(r),{section:t,startButton:r}})(k.allParkruns.find(e=>e.properties.eventname===r.eventName)?.properties?.EventShortName||null);o.appendChild(t),a("h1",o),n.addEventListener("click",()=>{n.disabled=!0,n.textContent="Starting...",n.style.opacity="0.6",n.style.cursor="not-allowed";var e=(()=>{let e=document.createElement("div");e.className="parkrun-cancellation-progress",e.style.padding="15px",e.style.backgroundColor=f.backgroundColor,e.style.borderRadius="6px",e.style.marginBottom="15px",e.style.border="1px solid "+f.gridColor;var t=document.createElement("h4");t.textContent="Analyzing Nearby parkrun Impact",t.style.margin="0 0 12px 0",t.style.color=f.barColor,e.appendChild(t),(t=document.createElement("div")).style.width="100%",t.style.height="20px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",t.style.marginBottom="10px",t.style.overflow="hidden";let r=document.createElement("div"),o=(r.style.width="0%",r.style.height="100%",r.style.backgroundColor=f.lineColor,r.style.transition="width 0.3s ease",t.appendChild(r),e.appendChild(t),document.createElement("div")),n=(o.style.fontSize="13px",o.style.color=f.subtleTextColor,o.style.marginBottom="12px",e.appendChild(o),document.createElement("div"));return n.style.fontSize="12px",n.style.color=f.lineColor,n.style.fontWeight="bold",n.style.marginBottom="10px",e.appendChild(n),(t=document.createElement("button")).textContent="Stop Analysis",t.style.padding="6px 12px",t.style.backgroundColor=f.alertColor,t.style.color=f.textColor,t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontWeight="bold",t.style.fontSize="12px",e.appendChild(t),{progressSection:e,updateProgress:(e,t)=>{var n=Math.round(e/t*100);r.style.width=n+"%",o.textContent=e+`/${t} parkruns analyzed`},updateStatus:e=>{n.textContent=e},stop:t,hide:()=>{e.style.display="none"}}})();t.insertAdjacentElement("afterend",e.progressSection),k.fetchController=new AbortController,(async(t,e,n)=>{let r=w(),o=k.nearbyParkruns,a=(e=>{var t=e.rawDates.map(e=>E(e));if(t.length<2)return[];var n=[];for(let e=1;e<t.length;e++){var r=t[e-1],o=t[e],a=(o-r)/864e5;a>v&&n.push({gapStartDate:r,gapEndDate:o,daysDiff:a,eventsBefore:e,eventsAfter:t.length-e})}return console.log(`Detected ${n.length} total gap(s)`),n})(k.currentEvent),l=[],d=(a.forEach(e=>{e=((e,t)=>{var n=[];let r=(6-(e=E(e.toISOString().split("T")[0])).getUTCDay())%7;0===r&&(r=7);var o=new Date(e);for(o.setUTCDate(o.getUTCDate()+r);o<t;)n.push(new Date(o)),o.setUTCDate(o.getUTCDate()+7);return n})(e.gapStartDate,e.gapEndDate);l.push(...e)}),l.sort((e,t)=>t-e),k.cancellationDates=l,console.log("All Cancellation Saturdays:",l),[]);for(let e=0;e<o.length;e++){if(k.fetchController.signal.aborted){console.log("Analysis stopped by user");break}var s=o[e],i=s.properties.eventname,c=s.properties.EventShortName||i,p=s.distance.toFixed(1);t.updateStatus(`Fetching: ${c} (${p}km)`),t.updateProgress(e,o.length);try{var u=await(async(t,e)=>{var s="parkrun_history_"+t;try{var i=localStorage.getItem(s);if(i)try{var{data:d,timestamp:c}=JSON.parse(i),p=Date.now()-c;if(p<x)return console.log(`Using cached history for ${t} (${Math.round(p/1e3/60)} minutes old)`),d}catch(e){console.log(`Cache parse error for ${t}, fetching fresh data`,e)}var u=await(await fetch(e+`/${t}/results/eventhistory/`)).text(),g=(new DOMParser).parseFromString(u,"text/html"),h=g.querySelector("h1")?.textContent.trim()??t;let n=[],r=[],o=[],a=[],l=[];var y=g.querySelectorAll("tr.Results-table-row"),m=(Array.from(y).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&n.push(t),e.getAttribute("data-date")),t=(t&&(o.push(t),t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r.push(t)),e.getAttribute("data-finishers")),t=(t&&a.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{eventName:t,title:h,eventNumbers:n,dates:r,rawDates:o,finishers:a,volunteers:l});try{localStorage.setItem(s,JSON.stringify({data:m,timestamp:Date.now()}))}catch(e){console.warn(`Failed to cache history for ${t}:`,e)}return m}catch(e){return console.error(`Failed to fetch event history for ${t}:`,e),null}})(i,r.url);u&&d.push({parkrun:s,historyData:u,shortName:c,distance:p})}catch(e){console.error(`Failed to fetch ${i}:`,e)}await new Promise(e=>setTimeout(e,100))}let g={},h=[],y=(l.forEach(l=>{var e=l.toISOString().split("T")[0];let s=[],i=S(l,b);i.end=new Date(l),i.end.setUTCDate(i.end.getUTCDate()-1),d.forEach(({parkrun:e,historyData:t,shortName:n,distance:r})=>{var o=T(D(t,i.start,i.end)),a=((t,e)=>{var n=e.toISOString().split("T")[0];for(let e=0;e<t.rawDates.length;e++)if(t.rawDates[e]===n)return{date:t.dates[e],eventNumber:t.eventNumbers[e],finishers:t.finishers[e],volunteers:t.volunteers[e]};return null})(t,l);s.push({eventName:e.properties.eventname,title:t.title,displayName:n,distance:r,baseline:o,eventOnDate:a,seasonalTrend:A(t,l),change:a?{finishersChange:a.finishers-o.avgFinishers,volunteersChange:a.volunteers-o.avgVolunteers,finishersPct:0<o.avgFinishers?(a.finishers-o.avgFinishers)/o.avgFinishers*100:0,volunteersPct:0<o.avgVolunteers?(a.volunteers-o.avgVolunteers)/o.avgVolunteers*100:0}:null})}),1<=s.filter(e=>e.eventOnDate).length?(g[e]=s,h.push(l)):console.log(`Skipping ${e}: 0/${s.length} parkruns ran (global cancellation)`)}),0<h.length?h:l);var m,C;t.updateProgress(o.length,o.length),0===h.length?(t.updateStatus("No valid cancellation dates found - all detected dates had global cancellations"),t.stop.textContent="Close",t.stop.style.backgroundColor=f.alertColor,(m=document.createElement("div")).style.padding="15px",m.style.backgroundColor="#3a3250",m.style.borderRadius="6px",m.style.marginTop="15px",m.style.color=f.textColor,m.style.textAlign="center",m.innerHTML=`
        <h3 style="color: ${f.alertColor}; margin: 0 0 10px 0;">âš  No Valid Analysis Dates</h3>
        <p style="margin: 0 0 8px 0;">All detected cancellation dates appear to be part of global cancellation periods (e.g., COVID-19).</p>
        <p style="margin: 0; color: ${f.subtleTextColor}; font-size: 13px;">
          No nearby parkruns held events on these dates, indicating system-wide cancellations rather than single-event cancellations.
        </p>
      `,e.appendChild(m)):(t.updateStatus(`Analysis complete! Found ${h.length} valid cancellation date(s)`),(m=document.querySelector(".start-analysis-btn"))&&(m.style.display="none"),t.stop.textContent="Close",t.stop.style.backgroundColor=f.successColor,k.resultsByDate=g,k.cancellationDates=y,k.analysisComplete=!0,-1===k.currentCancellationIndex&&0<y.length&&(k.currentCancellationIndex=0),C=((r,o,a,l)=>{let e=document.createElement("div"),t=(e.className="parkrun-cancellation-nav",e.style.padding="15px",e.style.backgroundColor="#2b223d",e.style.borderRadius="8px",e.style.marginBottom="20px",e.style.border="1px solid "+f.gridColor,document.createElement("div")),n=(t.style.color=f.textColor,t.style.fontSize="14px",t.style.marginBottom="12px",t.innerHTML=`
      <strong>${a.length} Cancellation Date${1!==a.length?"s":""} Available</strong>
      <div style="color: ${f.subtleTextColor}; font-size: 12px; margin-top: 4px;">
        Use dropdown or buttons to navigate â€¢ Keyboard: <kbd style="background: #3a3250; padding: 2px 6px; border-radius: 3px; font-family: monospace; border: 1px solid ${f.gridColor};">â†</kbd> <kbd style="background: #3a3250; padding: 2px 6px; border-radius: 3px; font-family: monospace; border: 1px solid ${f.gridColor};">â†’</kbd>
      </div>
    `,e.appendChild(t),document.createElement("div")),s=(n.style.display="flex",n.style.alignItems="center",n.style.gap="8px",n.style.flexWrap="wrap",document.createElement("button")),i=(s.textContent="â†",s.style.padding="6px 10px",l<a.length-1),d=(s.style.backgroundColor=i?f.lineColor:"#3a3250",s.style.color=i?"#2b223d":f.subtleTextColor,s.style.border="1px solid "+f.gridColor,s.style.borderRadius="4px",s.style.cursor=i?"pointer":"not-allowed",s.style.fontWeight="bold",s.style.fontSize="14px",s.style.transition="all 0.2s ease",s.disabled=!i,i&&(s.addEventListener("mouseenter",()=>{s.style.transform="translateY(-1px)",s.style.boxShadow="0 2px 4px rgba(34, 211, 238, 0.3)"}),s.addEventListener("mouseleave",()=>{s.style.transform="translateY(0)",s.style.boxShadow="none"})),document.createElement("select")),c=(d.style.padding="6px 8px",d.style.backgroundColor="#3a3250",d.style.color=f.textColor,d.style.border="1px solid "+f.gridColor,d.style.borderRadius="4px",d.style.cursor="pointer",d.style.fontWeight="bold",d.style.fontSize="12px",d.style.minWidth="220px",d.style.flex="1",a.forEach((e,t)=>{var n=document.createElement("option"),e=e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",weekday:"short"});n.value=t,n.textContent=e,n.selected=t===l,d.appendChild(n)}),document.createElement("button")),p=(c.textContent="â†’",c.style.padding="6px 10px",0<l),u=(c.style.backgroundColor=p?f.lineColor:"#3a3250",c.style.color=p?"#2b223d":f.subtleTextColor,c.style.border="1px solid "+f.gridColor,c.style.borderRadius="4px",c.style.cursor=p?"pointer":"not-allowed",c.style.fontWeight="bold",c.style.fontSize="14px",c.style.transition="all 0.2s ease",c.disabled=!p,p&&(c.addEventListener("mouseenter",()=>{c.style.transform="translateY(-1px)",c.style.boxShadow="0 2px 4px rgba(34, 211, 238, 0.3)"}),c.addEventListener("mouseleave",()=>{c.style.transform="translateY(0)",c.style.boxShadow="none"})),n.appendChild(s),n.appendChild(d),n.appendChild(c),e.appendChild(n),()=>{var e,t,n=r.querySelector(".parkrun-cancellation-results"),n=(n&&n.remove(),L(r,o,a,k.currentCancellationIndex),r.querySelector(".parkrun-cancellation-nav"));n&&((e=n.querySelectorAll("select"))[0]&&(e[0].value=k.currentCancellationIndex),n=(e=n.querySelectorAll("button"))[0],e=e[1],n&&(t=k.currentCancellationIndex<a.length-1,n.disabled=!t,n.style.backgroundColor=t?f.lineColor:"#3a3250",n.style.color=t?"#2b223d":f.subtleTextColor,n.style.cursor=t?"pointer":"not-allowed"),e)&&(n=0<k.currentCancellationIndex,e.disabled=!n,e.style.backgroundColor=n?f.lineColor:"#3a3250",e.style.color=n?"#2b223d":f.subtleTextColor,e.style.cursor=n?"pointer":"not-allowed")}),g=()=>{k.currentCancellationIndex<a.length-1&&(k.currentCancellationIndex+=1,u())},h=()=>{0<k.currentCancellationIndex&&(--k.currentCancellationIndex,u())},y=e=>{k.currentCancellationIndex=parseInt(e.target.value,10),u()};return s.addEventListener("click",g),c.addEventListener("click",h),d.addEventListener("change",y),k.keyboardHandler&&document.removeEventListener("keydown",k.keyboardHandler),k.keyboardHandler=e=>{"ArrowLeft"===e.key&&g(),"ArrowRight"===e.key&&h()},document.addEventListener("keydown",k.keyboardHandler),e})(e,g,y,k.currentCancellationIndex),n.insertAdjacentElement("afterend",C),L(e,g,y,k.currentCancellationIndex),setTimeout(()=>{t.hide()},500)),t.stop.addEventListener("click",()=>{t.hide()})})(e,o,t)})}else(t=document.createElement("div")).style.padding="10px",t.style.color=f.subtleTextColor,t.style.textAlign="center",t.textContent="Loading nearby parkruns...",o.appendChild(t),a("h1",o)}else console.log("No cancellation gap detected")}}function $(e,t,n){e=[...e];let r=e=>{switch(t){case"name":return e.displayName||e.eventName;case"distance":return parseFloat(e.distance);case"eventNumber":return e.eventOnDate?parseInt(e.eventOnDate.eventNumber,10):-1;case"baseline":return e.baseline.avgFinishers;case"onDate":return e.eventOnDate?e.eventOnDate.finishers:-1;case"change":return e.change?e.change.finishersChange:-999999;case"changePct":return e.change?e.change.finishersPct:-999999;default:return 0}};return e.sort((e,t)=>{e=r(e),t=r(t);return"asc"===n?e-t:t-e}),e}async function N(e,t){e=await(async(e,t)=>{var n=e.cloneNode(!0),e=e.querySelectorAll("canvas");let o=n.querySelectorAll("canvas");e.forEach((e,t)=>{try{var n=e.toDataURL("image/png"),r=document.createElement("img");r.src=n,r.alt="Chart snapshot",r.style.maxWidth="100%",r.style.display="block",r.style.backgroundColor="#2b223d",o[t]&&o[t].replaceWith(r)}catch(e){console.error("Failed to serialize chart canvas:",e)}});var e=`
      :root { color-scheme: dark; }
      body { margin: 0; padding: 20px; background: ${f.backgroundColor}; color: ${f.textColor}; font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; line-height: 1.5; }
      a { color: ${f.lineColor}; }
      h1, h2, h3, h4 { color: ${f.barColor}; margin: 0 0 10px 0; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border: 1px solid ${f.gridColor}; padding: 10px; text-align: left; }
      th { background: #2b223d; color: ${f.barColor}; }
      tr:nth-child(even) td { background: #241c35; }
      tr:nth-child(odd) td { background: #1f182e; }
      .parkrun-cancellation-results { background: ${f.backgroundColor}; padding: 16px; border-radius: 6px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25); }
      .chart-img { max-width: 100%; display: block; }
      .meta { margin-bottom: 16px; color: ${f.subtleTextColor}; font-size: 13px; }
      .meta strong { color: ${f.textColor}; }
    `,r=`
      <header>
        <h1>parkrun Cancellation Impact</h1>
        <div class="meta">
          <div><strong>Event:</strong> ${t.eventShortName}</div>
          <div><strong>Cancelled date:</strong> ${t.cancellationDateStr}</div>
          <div><strong>Generated:</strong> ${t.generatedAt}</div>
        </div>
      </header>
    `;return`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>parkrun Cancellation Impact - ${t.eventShortName} - ${t.cancellationDateStr}</title><style>${e}</style></head><body>${r}${n.outerHTML}</body></html>`})(e,t),t=`parkrun-cancellation-impact-${t.eventShortName}-${t.cancellationDateStr}.html`;return{blob:new Blob([e],{type:"text/html"}),filename:t}}function A(e,t){var n=S(t,b),t=(n.end=new Date(t),n.end.setUTCDate(n.end.getUTCDate()-1),D(e,n.start,n.end));return{window:n,filtered:t,baseline:T(t)}}function L(e,t,n,r){let o=n[r];let a=t[o.toISOString().split("T")[0]]||[],i=o.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),d=document.createElement("div");d.className="parkrun-cancellation-results",d.style.marginTop="20px";n=document.createElement("h3"),n.textContent="Nearby parkrun Impact on "+i,n.style.color=f.barColor,n.style.marginTop="20px",n.style.marginBottom="12px",d.appendChild(n),r=document.createElement("div");r.style.overflowX="auto";let l=document.createElement("table");l.style.width="100%",l.style.borderCollapse="collapse",l.style.fontSize="13px",l.style.color=f.textColor;t=document.createElement("thead");t.style.position="sticky",t.style.top="0",t.style.backgroundColor="#2b223d",t.style.zIndex="10";let s=document.createElement("tr"),c=(s.style.borderBottom="2px solid "+f.gridColor,[{label:"parkrun",key:"name",align:"left",info:"Click column headers to sort. Default ordering is by distance."},{label:"Distance",key:"distance",align:"right",info:"Distance from cancelled event in kilometers."},{label:"Event #",key:"eventNumber",align:"right",info:`Event number on ${i}. Lower numbers indicate newer parkruns.`},{label:"Baseline (Avg)",key:"baseline",align:"right",info:`12-week seasonal average (finishers/volunteers) ending the day before ${i}.`},{label:"On Date",key:"onDate",align:"right",info:`Actual attendance (finishers/volunteers) on ${i}.`},{label:"Change",key:"change",align:"right",info:"Difference between actual and baseline (finishers/volunteers)."},{label:"Change %",key:"changePct",align:"right",info:"Percentage change in finishers compared to baseline."},{label:"Trend",key:"trend",align:"right",info:"Gain (+5 or more finishers), Loss (-5 or fewer), Stable (within Â±5), or No Event."}]),p=e=>{var t=l.querySelector("tbody");t&&t.remove();let d=document.createElement("tbody");e.forEach(e=>{let t=document.createElement("tr"),n=(t.style.borderBottom="1px solid "+f.gridColor,t.style.transition="background-color 0.15s ease",null!==e.eventOnDate);n||(t.style.opacity="0.6"),t.addEventListener("mouseenter",()=>{t.style.backgroundColor=n?"rgba(34, 211, 238, 0.08)":"rgba(243, 244, 246, 0.03)"}),t.addEventListener("mouseleave",()=>{t.style.backgroundColor="transparent"});var r=document.createElement("td");r.style.padding="10px",r.style.textAlign="left",r.style.fontWeight="bold";let o=document.createElement("a");o.href=`${w().url}/${e.eventName}/results/eventhistory/`,o.textContent=e.displayName||e.eventName,o.style.color=f.lineColor,o.style.textDecoration="none",o.target="_blank",o.addEventListener("mouseenter",()=>{o.style.textDecoration="underline"}),o.addEventListener("mouseleave",()=>{o.style.textDecoration="none"}),r.appendChild(o),t.appendChild(r);var a,l,r=document.createElement("td"),r=(r.style.padding="10px",r.style.textAlign="right",r.style.color=f.subtleTextColor,r.textContent=e.distance+"km",t.appendChild(r),document.createElement("td")),r=(r.style.padding="10px",r.style.textAlign="right",e.eventOnDate&&e.eventOnDate.eventNumber?(r.textContent=e.eventOnDate.eventNumber,r.style.color=f.textColor):(r.textContent="â€”",r.style.color=f.subtleTextColor),t.appendChild(r),document.createElement("td")),r=(r.style.padding="10px",r.style.textAlign="right",r.innerHTML=`<strong>${e.baseline.avgFinishers}</strong> / `+e.baseline.avgVolunteers,t.appendChild(r),document.createElement("td")),r=(r.style.padding="10px",r.style.textAlign="right",e.eventOnDate?r.innerHTML=`<strong>${e.eventOnDate.finishers}</strong> / `+e.eventOnDate.volunteers:(r.textContent="â€”",r.style.color=f.subtleTextColor),t.appendChild(r),document.createElement("td")),s=(r.style.padding="10px",r.style.textAlign="right",e.change?(a=0<e.change.finishersChange?"+":"",i=0<e.change.volunteersChange?"+":"",s=0<e.change.finishersChange?f.successColor:f.alertColor,l=0<e.change.volunteersChange?f.successColor:f.alertColor,r.innerHTML=`
          <span style="color: ${s};">${a}${e.change.finishersChange}</span> /
          <span style="color: ${l};">${i}${e.change.volunteersChange}</span>
        `):(r.textContent="â€”",r.style.color=f.subtleTextColor),t.appendChild(r),document.createElement("td")),i=(s.style.padding="10px",s.style.textAlign="right",e.change?(a=0<e.change.finishersPct?f.successColor:f.alertColor,l=0<e.change.finishersPct?"+":"",s.innerHTML=`<span style="color: ${a};">${l}${e.change.finishersPct.toFixed(1)}%</span>`):(s.textContent="â€”",s.style.color=f.subtleTextColor),t.appendChild(s),document.createElement("td"));i.style.padding="10px",i.style.textAlign="right",e.eventOnDate?e.change.finishersChange<-5?(i.textContent="â†“ Loss",i.style.color=f.alertColor):5<e.change.finishersChange?(i.textContent="â†‘ Gain",i.style.color=f.successColor):(i.textContent="â†’ Stable",i.style.color=f.subtleTextColor):(i.textContent="No Event",i.style.color=f.subtleTextColor),t.appendChild(i),d.appendChild(t)}),l.appendChild(d)};c.forEach(t=>{let e=document.createElement("th");e.style.padding="10px",e.style.textAlign=t.align,e.style.color=f.barColor,e.style.fontWeight="bold",e.style.cursor="pointer",e.style.userSelect="none",e.style.position="relative",e.style.transition="background-color 0.15s ease",e.addEventListener("mouseenter",()=>{e.style.backgroundColor="rgba(34, 211, 238, 0.1)"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor="transparent"});var n=document.createElement("span"),n=(n.textContent=t.label,n.style.marginRight="4px",e.appendChild(n),document.createElement("span"));n.style.fontSize="10px",n.style.opacity=k.sortColumn===t.key?"1":"0.3",n.textContent=k.sortColumn!==t.key||"asc"===k.sortDirection?"â–²":"â–¼",e.appendChild(n);let r=document.createElement("span");r.textContent=" â„¹",r.style.fontSize="12px",r.style.opacity="0.6",r.style.cursor="help",r.style.transition="opacity 0.2s ease",r.title=t.info,r.addEventListener("mouseenter",()=>{r.style.opacity="1"}),r.addEventListener("mouseleave",()=>{r.style.opacity="0.6"}),e.appendChild(r),e.addEventListener("click",()=>{k.sortColumn===t.key?k.sortDirection="asc"===k.sortDirection?"desc":"asc":(k.sortColumn=t.key,k.sortDirection="asc");var e=$(a,k.sortColumn,k.sortDirection);p(e),c.forEach((e,t)=>{t=s.children[t].children[1];e.key===k.sortColumn?(t.style.opacity="1",t.textContent="asc"===k.sortDirection?"â–²":"â–¼"):(t.style.opacity="0.3",t.textContent="â–²")})}),s.appendChild(e)}),t.appendChild(s),l.appendChild(t);n=$(a,k.sortColumn,k.sortDirection);p(n),r.appendChild(l),d.appendChild(r);let u=A(k.currentEvent,o);var t=document.createElement("div"),n=(t.style.marginTop="16px",t.style.padding="12px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",document.createElement("h3")),r=(n.textContent="Cancelled Event Seasonal Trend",n.style.color=f.barColor,n.style.margin="0 0 8px 0",t.appendChild(n),document.createElement("div")),n=u.window.start.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),g=u.window.end.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),n=(r.style.color=f.textColor,r.style.fontSize="13px",r.style.marginBottom="6px",r.innerHTML=`Window: ${n} â†’ ${g} (12-week baseline)`,t.appendChild(r),document.createElement("div")),n=(n.style.color=f.textColor,n.style.fontSize="13px",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fit, minmax(200px, 1fr))",n.style.gap="8px",n.innerHTML=`
      <div>Average finishers: <strong>${u.baseline.avgFinishers}</strong></div>
      <div>Min finishers: <strong>${u.baseline.minFinishers}</strong></div>
      <div>Max finishers: <strong>${u.baseline.maxFinishers}</strong></div>
      <div>Average volunteers: <strong>${u.baseline.avgVolunteers}</strong></div>
      <div>Min volunteers: <strong>${u.baseline.minVolunteers}</strong></div>
      <div>Max volunteers: <strong>${u.baseline.maxVolunteers}</strong></div>
      <div>Total events: <strong>${u.baseline.totalEvents}</strong></div>
    `,t.appendChild(n),"undefined"!=typeof Chart&&u.filtered.finishers&&0<u.filtered.finishers.length?((g=document.createElement("canvas")).style.marginTop="12px",t.appendChild(g),new Chart(g.getContext("2d"),{type:"line",data:{labels:u.filtered.dates,datasets:[{label:"Finishers",data:u.filtered.finishers,borderColor:f.lineColor,backgroundColor:"rgba(34, 211, 238, 0.25)",tension:.2,fill:!0},{label:"Volunteers",data:u.filtered.volunteers,borderColor:f.successColor,backgroundColor:"rgba(16, 185, 129, 0.18)",tension:.2,fill:!0},{label:"Finishers baseline avg",data:u.filtered.dates.map(()=>u.baseline.avgFinishers),borderColor:f.barColor,borderDash:[6,4],pointRadius:0},{label:"Volunteers baseline avg",data:u.filtered.dates.map(()=>u.baseline.avgVolunteers),borderColor:f.gridColor,borderDash:[6,4],pointRadius:0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.6,plugins:{legend:{labels:{color:f.textColor}},title:{display:!0,text:"Finishers & volunteers over baseline window",color:f.textColor}},scales:{x:{ticks:{color:f.subtleTextColor},grid:{color:f.gridColor}},y:{beginAtZero:!0,ticks:{precision:0,color:f.subtleTextColor},grid:{color:f.gridColor},title:{display:!0,text:"Finishers",color:f.textColor}}}}})):((r=document.createElement("div")).style.color=f.subtleTextColor,r.style.fontSize="12px",r.style.marginTop="8px",r.textContent="No historical data available for the baseline window.",t.appendChild(r)),d.appendChild(t),a.filter(e=>e.change&&0<e.change.finishersChange&&void 0!==e.change.finishersPct)),g=[...n].sort((e,t)=>t.change.finishersChange-e.change.finishersChange).slice(0,1),r=[...n].filter(e=>0<e.change.finishersPct).sort((e,t)=>t.change.finishersPct-e.change.finishersPct).slice(0,1);let h=document.createElement("div");h.style.marginTop="18px",h.style.padding="12px",h.style.backgroundColor="#2b223d",h.style.borderRadius="4px";var t=document.createElement("h3"),n=(t.textContent="Most Impacted parkruns",t.style.color=f.barColor,t.style.margin="0 0 10px 0",h.appendChild(t),document.createElement("div"));if(n.style.color=f.textColor,n.style.fontSize="13px",0===g.length)n.textContent="No nearby parkruns saw an attendance increase on this date.",h.appendChild(n);else{var t=[],y=(g[0]&&(y=g[0],t.push(`Largest absolute gain: <strong>${y.displayName||y.eventName}</strong> (+${y.change.finishersChange} finishers, ${y.change.finishersPct.toFixed(1)}%)`)),r[0]&&(y=r[0],t.push(`Largest relative gain: <strong>${y.displayName||y.eventName}</strong> (+${y.change.finishersPct.toFixed(1)}%, +${y.change.finishersChange} finishers)`)),n.innerHTML=t.join("<br>"),h.appendChild(n),[g[0],r[0]].filter(Boolean));let s=new Set;y.forEach(e=>{var t,n,r,o,a,l;e&&e.seasonalTrend&&e.seasonalTrend.filtered&&(s.has(e.eventName)||(s.add(e.eventName),(t=document.createElement("div")).style.marginTop="12px",t.style.padding="10px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",(n=document.createElement("div")).style.color=f.textColor,n.style.fontWeight="bold",n.style.marginBottom="6px",n.textContent=e.displayName||e.eventName,t.appendChild(n),(n=document.createElement("div")).style.color=f.textColor,n.style.fontSize="12px",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fit, minmax(160px, 1fr))",n.style.gap="6px",n.innerHTML=`
          <div>Avg finishers: <strong>${e.seasonalTrend.baseline.avgFinishers}</strong></div>
          <div>Min finishers: <strong>${e.seasonalTrend.baseline.minFinishers}</strong></div>
          <div>Max finishers: <strong>${e.seasonalTrend.baseline.maxFinishers}</strong></div>
          <div>Avg volunteers: <strong>${e.seasonalTrend.baseline.avgVolunteers}</strong></div>
          <div>Min volunteers: <strong>${e.seasonalTrend.baseline.minVolunteers}</strong></div>
          <div>Max volunteers: <strong>${e.seasonalTrend.baseline.maxVolunteers}</strong></div>
        `,t.appendChild(n),"undefined"!=typeof Chart&&e.seasonalTrend.filtered.finishers&&0<e.seasonalTrend.filtered.finishers.length&&((n=document.createElement("canvas")).style.marginTop="10px",t.appendChild(n),r=[...e.seasonalTrend.filtered.dates],o=[...e.seasonalTrend.filtered.finishers],a=[...e.seasonalTrend.filtered.volunteers],l=i,e.eventOnDate&&(r.push(l),o.push(e.eventOnDate.finishers),a.push(e.eventOnDate.volunteers)),new Chart(n.getContext("2d"),{type:"line",data:{labels:r,datasets:[{label:"Finishers",data:o,borderColor:f.lineColor,backgroundColor:"rgba(34, 211, 238, 0.25)",tension:.2,fill:!0},{label:"Volunteers",data:a,borderColor:f.successColor,backgroundColor:"rgba(16, 185, 129, 0.18)",tension:.2,fill:!0},{label:"Finishers baseline avg",data:r.map(()=>e.seasonalTrend.baseline.avgFinishers),borderColor:f.barColor,borderDash:[6,4],pointRadius:0},{label:"Volunteers baseline avg",data:r.map(()=>e.seasonalTrend.baseline.avgVolunteers),borderColor:f.gridColor,borderDash:[6,4],pointRadius:0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.6,plugins:{legend:{labels:{color:f.textColor}},title:{display:!0,text:"Seasonal trend",color:f.textColor}},scales:{x:{ticks:{color:f.subtleTextColor},grid:{color:f.gridColor}},y:{beginAtZero:!0,ticks:{precision:0,color:f.subtleTextColor},grid:{color:f.gridColor},title:{display:!0,text:"Count",color:f.textColor}}}}})),h.appendChild(t)))})}d.appendChild(h),"undefined"!=typeof Chart&&((t=document.createElement("div")).style.marginTop="30px",(n=document.createElement("h3")).textContent="Visual Impact Analysis",n.style.color=f.barColor,n.style.marginBottom="15px",t.appendChild(n),(g=document.createElement("div")).style.display="grid",g.style.gridTemplateColumns="1fr 1fr",g.style.gap="20px",r=document.createElement("canvas"),(y=document.createElement("div")).style.minWidth="0",y.appendChild(r),g.appendChild(y),n=document.createElement("canvas"),(y=document.createElement("div")).style.minWidth="0",y.appendChild(n),g.appendChild(y),t.appendChild(g),d.appendChild(t),y=a.filter(e=>e.eventOnDate).map(e=>e.title||e.eventName),g=a.filter(e=>e.eventOnDate).map(e=>e.baseline.avgFinishers),t=a.filter(e=>e.eventOnDate).map(e=>e.eventOnDate.finishers),new Chart(r.getContext("2d"),{type:"bar",data:{labels:y,datasets:[{label:"Baseline (12-week avg)",data:g,backgroundColor:f.barColor,borderColor:f.barColor,borderWidth:1},{label:"Actual on "+i,data:t,backgroundColor:f.lineColor,borderColor:f.lineColor,borderWidth:1}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.5,plugins:{legend:{labels:{color:f.textColor}},title:{display:!0,text:"Finishers: Baseline vs Actual",color:f.textColor}},scales:{x:{ticks:{color:f.subtleTextColor,display:!1},grid:{color:f.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Finishers",color:f.textColor},ticks:{precision:0,color:f.subtleTextColor},grid:{color:f.gridColor}}}}}),r=a.filter(e=>e.eventOnDate).map(e=>e.baseline.avgVolunteers),g=a.filter(e=>e.eventOnDate).map(e=>e.eventOnDate.volunteers),new Chart(n.getContext("2d"),{type:"bar",data:{labels:y,datasets:[{label:"Baseline (12-week avg)",data:r,backgroundColor:f.barColor,borderColor:f.barColor,borderWidth:1},{label:"Actual on "+i,data:g,backgroundColor:f.lineColor,borderColor:f.lineColor,borderWidth:1}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:1.5,plugins:{legend:{labels:{color:f.textColor}},title:{display:!0,text:"Volunteers: Baseline vs Actual",color:f.textColor}},scales:{x:{ticks:{color:f.subtleTextColor,display:!1},grid:{color:f.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Volunteers",color:f.textColor},ticks:{precision:0,color:f.subtleTextColor},grid:{color:f.gridColor}}}}}));var t=document.createElement("div"),n=(t.style.marginTop="20px",t.style.padding="12px",t.style.backgroundColor="#3a3250",t.style.borderRadius="4px",document.createElement("h4")),y=(n.textContent="Summary",n.style.margin="0 0 8px 0",n.style.color=f.lineColor,t.appendChild(n),a.filter(e=>e.eventOnDate&&e.change)),r=y.reduce((e,t)=>e+t.change.finishersChange,0),g=y.reduce((e,t)=>e+t.change.volunteersChange,0),n=0<y.length?Math.round(r/y.length):0,m=0<y.length?Math.round(y.reduce((e,t)=>e+t.change.volunteersChange,0)/y.length):0,C=document.createElement("div"),y=(C.style.fontSize="13px",C.style.color=f.textColor,C.innerHTML=`
      <p style="margin: 4px 0;">
        <strong>${a.length}</strong> nearby parkruns analyzed
        <span style="color: ${f.subtleTextColor}; font-size: 11px; margin-left: 8px;" title="parkruns within 50km of the cancelled event in the same country and series">â„¹</span>
      </p>
      <p style="margin: 4px 0;">
        <strong>${y.length}</strong> held events on ${i}
        <span style="color: ${f.subtleTextColor}; font-size: 11px; margin-left: 8px;" title="Number of nearby parkruns that ran on this date">â„¹</span>
      </p>
      <p style="margin: 4px 0;">
        Average change in finishers: <span style="color: ${n<0?f.alertColor:f.successColor}; font-weight: bold;">${0<n?"+":""}${n}</span>
        <span style="color: ${f.subtleTextColor}; font-size: 11px; margin-left: 8px;" title="Mean difference between actual finishers and 12-week baseline average across events that ran">â„¹</span>
      </p>
      <p style="margin: 4px 0;">
        Average change in volunteers: <span style="color: ${m<0?f.alertColor:f.successColor}; font-weight: bold;">${0<m?"+":""}${m}</span>
        <span style="color: ${f.subtleTextColor}; font-size: 11px; margin-left: 8px;" title="Mean difference between actual volunteers and 12-week baseline average across events that ran">â„¹</span>
      </p>
      <p style="margin: 4px 0;">
        Estimated total additional finishers: <span style="color: ${r<0?f.alertColor:f.successColor}; font-weight: bold;">${0<r?"+":""}${r}</span>
        <span style="color: ${f.subtleTextColor}; font-size: 11px; margin-left: 8px;" title="Sum of all finisher changes across nearby parkruns - positive indicates runners redistributed from the cancelled event">â„¹</span>
      </p>
      <p style="margin: 4px 0;">
        Estimated total additional volunteers: <span style="color: ${g<0?f.alertColor:f.successColor}; font-weight: bold;">${0<g?"+":""}${g}</span>
        <span style="color: ${f.subtleTextColor}; font-size: 11px; margin-left: 8px;" title="Sum of all volunteer changes across nearby parkruns - indicates how many extra volunteers were needed on the day">â„¹</span>
      </p>
    `,t.appendChild(C),d.appendChild(t),document.createElement("div"));y.style.display="flex",y.style.justifyContent="center",y.style.marginTop="20px",y.style.gap="10px",y.style.flexWrap="wrap";let v=document.createElement("button"),b=(v.textContent="ðŸ“„ Export HTML",v.style.padding="8px 16px",v.style.backgroundColor=f.barColor,v.style.color="#1c1b2a",v.style.border="none",v.style.borderRadius="4px",v.style.cursor="pointer",v.style.fontWeight="bold",v.style.fontSize="14px",()=>{let t=w();return{eventShortName:k.allParkruns.find(e=>e.properties.eventname===t.eventName)?.properties?.EventShortName||t.eventName,cancellationDateStr:o.toISOString().split("T")[0]}}),x=(v.addEventListener("click",async()=>{var e=v.textContent,t=v.style.display;v.textContent="Exporting...",v.disabled=!0,v.style.display="none";try{var{eventShortName:n,cancellationDateStr:r}=b(),{blob:o,filename:a}=await N(d,{eventShortName:n,cancellationDateStr:r,generatedAt:(new Date).toLocaleString()});let e=URL.createObjectURL(o);var l=document.createElement("a");l.href=e,l.download=a,l.click(),setTimeout(()=>URL.revokeObjectURL(e),1e3),console.log("HTML export complete")}catch(e){console.error("HTML export failed:",e),alert("Error exporting HTML: "+e.message)}finally{v.disabled=!1,v.textContent=e,v.style.display=t}}),document.createElement("button"));x.textContent="ðŸ“¤ Share Report",x.style.padding="8px 16px",x.style.backgroundColor=f.lineColor,x.style.color="#2b223d",x.style.border="none",x.style.borderRadius="4px",x.style.cursor="pointer",x.style.fontWeight="bold",x.style.fontSize="14px",x.addEventListener("click",async()=>{var e=x.textContent,t=x.style.display;x.textContent="Sharing...",x.disabled=!0,x.style.display="none";try{var{eventShortName:n,cancellationDateStr:r}=b(),{blob:o,filename:a}=await N(d,{eventShortName:n,cancellationDateStr:r,generatedAt:(new Date).toLocaleString()}),l=new File([o],a,{type:"text/html"});if(navigator.canShare&&navigator.canShare({files:[l]}))await navigator.share({title:"parkrun Cancellation Impact - "+n,text:"Cancellation date: "+r,files:[l]}),console.log("Report shared via Web Share API");else{let e=URL.createObjectURL(o);var s=document.createElement("a");s.href=e,s.download=a,s.click(),setTimeout(()=>URL.revokeObjectURL(e),1e3),alert("Sharing is not supported in this browser, so the HTML report was downloaded instead.")}}catch(e){console.error("Share failed:",e),alert("Error sharing report: "+e.message)}finally{x.disabled=!1,x.textContent=e,x.style.display=t}}),y.appendChild(v),y.appendChild(x),d.appendChild(y),e.appendChild(d)}(async()=>{var e=document.querySelector(".Results-table"),t=window.location.href.includes("/eventhistory/");e&&t&&(k.allParkruns=await(async()=>{var e="parkrun_events_cache";try{var t=localStorage.getItem(e);if(t)try{var{data:n,timestamp:r}=JSON.parse(t),o=Date.now()-r;if(o<x)return console.log(`Using cached parkrun events (${Math.round(o/1e3/60)} minutes old)`),n}catch(e){console.log("Cache parse error, fetching fresh data",e)}console.log("Fetching parkrun events from https://images.parkrun.com/events.json");var a=await fetch("https://images.parkrun.com/events.json");if(!a.ok)return console.error("Fetch failed with status:",a.status),[];var l=await a.json(),s=l.events?.features||l.features||[];if(!s||0===s.length)return console.error("No features found in response data"),[];try{localStorage.setItem(e,JSON.stringify({data:s,timestamp:Date.now()}))}catch(e){console.warn("Failed to cache parkrun events:",e)}return console.log("Successfully loaded",s.length,"parkrun events"),s}catch(e){return console.error("Failed to fetch parkruns:",e),[]}})(),n())})()}})();
```

### parkrun Charts

> Displays charts on parkrun pages: finishers per minute on results pages and event history on event history pages


[parkrun-charts.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-charts.user.js)

```javascript
javascript:(async()=>{var o;o="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var r=document.createElement("script");r.src=o,r.onload=e,r.onerror=t,document.head.appendChild(r)});{let p={backgroundColor:"#2b223d",barColor:"#FFA300",lineColor:"#53BA9D",textColor:"#e0e0e0",subtleTextColor:"#cccccc",gridColor:"rgba(200, 200, 200, 0.2)"},u=!1;function m(e,t,r=800){var o=document.createElement("div"),r=(o.className="parkrun-chart-container "+t+"-container",o.style.width="100%",o.style.maxWidth=r+"px",o.style.margin="20px auto",o.style.padding="15px",o.style.backgroundColor=p.backgroundColor,o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.createElement("h3")),e=(r.textContent=e,r.style.textAlign="center",r.style.marginBottom="15px",r.style.color=p.barColor,o.appendChild(r),document.createElement("canvas"));return e.id=t,o.appendChild(e),{container:o,canvas:e}}function h(e,t){e=document.querySelector(e);e&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))}function b(l){var e=document.createElement("div");e.style.display="flex",e.style.justifyContent="center",e.style.marginTop="10px",e.style.marginBottom="10px";let a=document.createElement("button");a.textContent="ðŸ’¾ Save as Image",a.style.padding="6px 12px",a.style.backgroundColor=p.barColor,a.style.color="#2b223d",a.style.border="none",a.style.borderRadius="4px",a.style.cursor="pointer",a.style.fontWeight="bold",a.style.display="inline-block",a.style.margin="0 5px",a.title="Download chart as PNG image",a.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),a.addEventListener("mouseout",function(){this.style.backgroundColor=p.barColor}),a.addEventListener("click",function(){a.style.display="none",html2canvas(l,{backgroundColor:p.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(e=>{a.style.display="block";var t=document.createElement("a"),r=(new Date).toISOString().split("T")[0],o=window.location.pathname.split("/")[1],n=l.classList.contains("eventHistoryChart-container")?"event-history":"finishers";t.download=o+`-${n}-${r}.png`,t.href=e.toDataURL("image/png"),t.click()})}),e.appendChild(a),l.appendChild(e)}function g(e){var t=e.getContext("2d");let r="parkrun-charts",o="unknown",n="";"undefined"!=typeof GM_info&&GM_info&&GM_info.script&&(r=GM_info.script.name||r,o=GM_info.script.version||o,n=GM_info.script.homepage||"");var l=[`Generated by ${r} v`+o,n],a=(t.save(),t.font=u?"bold 16px Arial":"10px Arial",t.fillStyle=u?"rgba(255, 0, 0, 0.5)":"rgba(200, 200, 200, 0.1)",t.textAlign="right",t.textBaseline="bottom",u?20:14),i=e.width-10;let s=e.height-10;for(let e=l.length-1;0<=e;e--){var d=l[e];d&&(t.fillText(d,i,s),s-=a)}t.restore()}function e(){var r=[[document.querySelector("h1")?.textContent?.trim(),document.querySelector("h3")?.textContent?.trim()].filter(Boolean).join(" | "),"Finishers per Minute"].filter(Boolean).join(": "),o=(({timeData:t,minMinute:r,maxMinute:o})=>{var n=[],l=[];for(let e=r;e<=o;e++)n.push(e),l.push(t[e]||0);return{labels:n.map(e=>Math.floor(e/60)+":"+(e%60).toString().padStart(2,"0")),data:l}})((()=>{let n={};var e=document.querySelectorAll("tr.Results-table-row");let l=1/0,a=0;e.forEach(t=>{t=t.querySelector("td.Results-table-td--time");if(t){t=t.textContent.trim();let e;var r=t.match(/(\d+):(\d+):(\d+)/);if(r){var o=parseInt(r[1]),r=parseInt(r[2]);e=60*o+r}else{o=t.match(/(\d+):(\d+)/);if(!o)return;e=parseInt(o[1])}l=Math.min(l,e),a=Math.max(a,e),n[e]?n[e]++:n[e]=1}});for(let e=l;e<=a;e++)n[e]||(n[e]=0);return{timeData:n,minMinute:l,maxMinute:a}})());if(0===o.labels.length)console.log("No finish time data found");else if(document.getElementById("finishersChart"))console.log("Finishers chart already exists, skipping render");else{let{container:e,canvas:t}=m(r,"finishersChart");h("h3",e),b(e);r=t.getContext("2d");new Chart(r,{type:"bar",data:{labels:o.labels,datasets:[{label:"Number of Finishers",data:o.data,backgroundColor:p.barColor,borderColor:p.barColor,borderWidth:1}]},options:{animation:!1,responsive:!0,plugins:{legend:{labels:{color:p.textColor}},title:{display:!1,color:p.textColor},tooltip:{callbacks:{title:e=>{var t,r,e=e[0].label;return e.includes(":")?([r,t]=e.split(":"),r+` hour${"1"===r?"":"s"} ${t} minute`+("01"===t?"":"s")):(r=e.replace("'",""))+" minute"+("1"===r?"":"s")},label:e=>e.raw+" finisher"+(1===e.raw?"":"s")}}},scales:{x:{title:{display:!0,text:"Finish Time",color:p.textColor},ticks:{color:p.subtleTextColor},grid:{color:p.gridColor}},y:{beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:p.textColor},ticks:{precision:0,color:p.subtleTextColor},grid:{color:p.gridColor}}},onHover:()=>{setTimeout(()=>g(t),0)},onResize:()=>{setTimeout(()=>g(t),0)},customPlugin:{id:"watermarkPlugin",afterDraw:()=>{setTimeout(()=>g(t),0)}}}}),setTimeout(()=>g(t),0)}}function y(o,n){var e=[];for(let r=0;r<o.length;r++)if(r<n-1)e.push(null);else{let t=0;for(let e=0;e<n;e++)t+=o[r-e];e.push(parseFloat((t/n).toFixed(1)))}return e}function v(t,e,r){let o=1/0,n=-1/0,l=-1,a=-1;for(let e=0;e<t.length;e++)t[e]<o&&(o=t[e],l=e),t[e]===o&&(l=e),t[e]>n&&(n=t[e],a=e),t[e]===n&&(a=e);return{min:{value:o,eventNumber:e[l],date:r[l],index:l},max:{value:n,eventNumber:e[a],date:r[a],index:a}}}function x(e,t){return 0!==e&&0!==t&&Math.floor(Math.log10(e))===Math.floor(Math.log10(t))}function t(){if(document.getElementById("eventHistoryChart"))console.log("Event history chart already exists, skipping render");else{let n=(()=>{var e=document.querySelector("h1")?.textContent.trim()??"Event History";let r=[],o=[],n=[],l=[];var t=document.querySelectorAll("tr.Results-table-row");return Array.from(t).reverse().forEach(e=>{var t=e.getAttribute("data-parkrun"),t=(t&&r.push(t),e.getAttribute("data-date")),t=(t&&(t=new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),o.push(t)),e.getAttribute("data-finishers")),t=(t&&n.push(parseInt(t,10)),e.getAttribute("data-volunteers"));t&&l.push(parseInt(t,10))}),{title:e,eventNumbers:r,dates:o,finishers:n,volunteers:l}})();if(0===n.eventNumbers.length)console.log("No event history data found");else{var r=y(n.finishers,12),o=y(n.volunteers,12),l=v(n.finishers,n.eventNumbers,n.dates),a=v(n.volunteers,n.eventNumbers,n.dates),i={"y-parkrunners":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"parkrunners",color:p.textColor},ticks:{precision:0,color:p.subtleTextColor},grid:{color:p.gridColor}},"y-finishers":{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:p.barColor},ticks:{precision:0,color:p.barColor},grid:{color:p.gridColor}},"y-volunteers":{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Number of Volunteers",color:p.lineColor},ticks:{precision:0,color:p.lineColor},grid:{display:!1}}},s=x(l.max.value,a.max.value),d=s?"y-parkrunners":"y-finishers",s=s?"y-parkrunners":"y-volunteers";let{container:e,canvas:t}=m(n.title+": Finishers & Volunteers","eventHistoryChart",1e3);t.height=400,t.style.height="400px",t.style.maxHeight="400px",h("h1",e);var u=t.getContext("2d"),c=document.createElement("div"),l=(c.className="chart-stats-footer",c.style.marginTop="10px",c.style.padding="10px",c.style.backgroundColor=p.backgroundColor,c.style.color=p.textColor,c.style.borderRadius="4px",c.style.fontSize="14px",c.style.textAlign="center",c.innerHTML=`
      <span style="color: ${p.barColor}">Finishers:</span> Min: ${l.min.value} (${l.min.date}, Event #${l.min.eventNumber}) |
      Max: ${l.max.value} (${l.max.date}, Event #${l.max.eventNumber})<br>
      <span style="color: ${p.lineColor}">Volunteers:</span> Min: ${a.min.value} (${a.min.date}, Event #${a.min.eventNumber}) |
      Max: ${a.max.value} (${a.max.date}, Event #${a.max.eventNumber})
    `,e.appendChild(c),{title:{display:!0,text:"Date",color:p.textColor},ticks:{color:p.subtleTextColor,maxRotation:45,minRotation:45,callback:function(e,t){var r=n.dates.length;let o=1;return 100<r?o=10:50<r?o=5:20<r&&(o=2),0===t||t===n.dates.length-1||t%o==0?n.dates[t]:""}},grid:{color:p.gridColor}}),a=[{label:"Finishers",data:n.finishers,backgroundColor:p.barColor,borderColor:p.barColor,borderWidth:1,yAxisID:d,order:1},{label:"12-Event Avg (Finishers)",data:r,type:"line",borderColor:p.barColor,backgroundColor:"transparent",borderWidth:2,borderDash:[5,5],pointRadius:0,fill:!1,yAxisID:d,order:0},{label:"Volunteers",data:n.volunteers,type:"line",borderColor:p.lineColor,backgroundColor:"rgba(83, 186, 157, 0.2)",borderWidth:1,pointBackgroundColor:p.lineColor,pointRadius:2,fill:!1,tension:.2,yAxisID:s,order:2},{label:"12-Event Avg (Volunteers)",data:o,type:"line",borderColor:p.lineColor,backgroundColor:"transparent",borderWidth:2,borderDash:[5,5],pointRadius:0,fill:!1,yAxisID:s,order:3}],c={x:l};c[d]=i[d],s!=d&&(c[s]=i[s]),new Chart(u,{type:"bar",data:{labels:n.dates,datasets:a},options:{animation:!1,responsive:!0,maintainAspectRatio:!0,aspectRatio:2.5,plugins:{legend:{labels:{color:p.textColor,usePointStyle:!0}},tooltip:{mode:"index",callbacks:{title:function(e){var e=e[0].dataIndex,t=n.eventNumbers[e];return n.dates[e]+` (Event #${t})`},label:function(e){var t=e.dataset.label||"";return"Finishers"===t?"Finishers: "+e.raw:"Volunteers"===t?"Volunteers: "+e.raw:t.includes("Avg")?t+": "+e.raw:e.formattedValue}}}},scales:c,onHover:()=>{setTimeout(()=>g(t),0)},onResize:()=>{setTimeout(()=>g(t),0)},customPlugin:{id:"watermarkPlugin",afterDraw:()=>{setTimeout(()=>g(t),0)}}}}),setTimeout(()=>g(t),0),b(e)}}}"undefined"!=typeof module&&void 0!==module.exports?module.exports.sameOrderOfMagnitude=x:"undefined"==typeof Chart?console.error("Chart.js not loaded"):document.querySelector(".Results-table")?(window.location.href.includes("/eventhistory/")?t:e)():console.log("Results table not found")}})();
```

### parkrun Walker Analysis

> Highlight and summarize walkers (>=10:00/km) and compare with faster participants on parkrun results pages.


[parkrun-walker-analysis.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/parkrun-walker-analysis.user.js)

```javascript
javascript:(async()=>{var r;r="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var n=document.createElement("script");n.src=r,n.onload=e,n.onerror=t,document.head.appendChild(n)});let E="undefined"!=typeof window&&window.Chart?window.Chart:void 0;function e(l){return l.map((e,t)=>{var n,r;return e.timeStr&&0<e.timeSec?e:(n=(n=(n=l).slice(0,t).reverse().find(e=>e.timeStr&&0<e.timeSec))?n.timeSec:null,t=(r=(r=l).slice(t+1).find(e=>e.timeStr&&0<e.timeSec))?r.timeSec:null,r=n||t||0,{...e,timeSec:r,estimatedTime:0<r})})}function F(){let e="",t="",n="";var r,l="undefined"!=typeof document?document.querySelector("h1"):null,l=(l?e=l.textContent.trim():"undefined"!=typeof document&&document.title&&(e=document.title.split("-")[0].trim()),"undefined"!=typeof document?document.querySelector("h3"):null);return l&&((r=(l=l.textContent).match(/(\d{1,2}\/\d{1,2}\/\d{2,4})/))&&(t=r[1]),r=l.match(/#(\d+)/))&&(n=r[1]),{eventName:e,eventDate:t,eventNumber:n}}function v(e,t){return(e.eventName?e.eventName.replace(/[^a-z0-9]+/gi,"").toLowerCase():"event")+`_${e.eventDate?e.eventDate.replace(/\//g,"_"):"date"}_${e.eventNumber||"num"}_${t}.png`}function p(e){let t=5;try{"string"==typeof e&&e&&e.toLowerCase().includes("-juniors")&&(t=2)}catch(e){}return 10*t*60}var t=Array.from(document.querySelectorAll("tr.Results-table-row"));if(t.length){let y=e(t.map((e,t)=>{var n=e.querySelector(".Results-table-td--time .compact"),n=n?n.textContent.trim():"",r=(r=n)?2===(r=r.split(":").map(Number)).length?60*r[0]+r[1]:3===r.length?3600*r[0]+60*r[1]+r[2]:0:0,l=(e.getAttribute("data-gender")||"").trim(),a=parseInt(e.getAttribute("data-runs"),10),o=parseInt(e.getAttribute("data-vols"),10),i=(e.getAttribute("data-achievement")||"").trim();let d="Unknown",s=(!isNaN(a)&&0<a&&(d=1===a?"First Timer (anywhere)":"First Timer!"===i?"First Timer (to this event)":!(a<10)&&g(a,"parkrun").status||"Multiple parkruns"),"Unknown"),u=0;isNaN(o)||(0===o?s="Yet to Volunteer":1===o?s="Volunteered once":1<o&&o<10?s="Volunteered multiple times":(i=g(o,"Volunteer"),s=i.status||"Has Volunteered",u=i.milestone));a=e.innerHTML.match(/milestone-v(\d+)/);a&&(s=`Volunteer ${a[1]} Club`,u=parseInt(a[1],10));let c="";o=e.querySelector(".Results-table-td--agegrade");o&&(i=o.textContent.trim())&&(c=i.replace("%",""));let p="Unknown";a=e.getAttribute("data-agegroup")||"";a?p=a.replace(/^[A-Z]+/,""):(o=e.querySelector(".Results-table-td--agegroup"))?(i=o.textContent.trim().replace(/^[A-Z]+/,""),p=i||(n?"Not specified":"Unknown")):n&&(p="Not specified");let m=l.toLowerCase();return{timeStr:n,timeSec:r,gender:m="male"===m||"m"===m?"Male":"female"===m||"f"===m?"Female":n?"Not specified":"Unknown",parkrunExperience:d,volunteerStatus:s,volunteerMilestone:u,ageGrade:c,ageGroup:p,_row:e,_idx:t}})),b={10:"#EBE9F0",25:"#6D5698",50:"#C81D31",100:"#2E393B",250:"#2C504A",500:"#2E4DA7",1e3:"#FFE049","Volunteered once":"#90EE90","Volunteered multiple times":"#00CEAE","Has Volunteered":"#00CEAE","Yet to Volunteer":"#FFA300",Unknown:"#A1B6B7"},f=[{key:"parkrunExperience",label:"parkrun Experience"},{key:"volunteerStatus",label:"Volunteer Experience"},{key:"gender",label:"Gender"},{key:"ageGroup",label:"Age Group"}],k="parkrunExperience",x="finishersStackedChart",C=null,r=document.getElementById("walkerAnalysisControls");function g(e,t){var n;for(n of[1e3,500,250,100,50,25,10])if(e>=n)return{status:`${t} ${n} Club`,milestone:n};return{status:null,milestone:0}}function l(){r.innerHTML="Breakdown: "+f.map(e=>`<button style="margin:0 8px;padding:6px 12px;border-radius:4px;border:none;background:${k===e.key?"#FFA300":"#00CEAE"};color:#2b223d;font-weight:bold;cursor:pointer;" data-key="${e.key}">${e.label}</button>`).join(""),r.querySelectorAll("button").forEach(t=>{t.onclick=()=>{var e;e=t.getAttribute("data-key"),k=e,n()}})}function n(){l();let e=document.getElementById("walkerRunnerSummaryTable"),t=(e||((e=document.createElement("div")).id="walkerRunnerSummaryTable"),e.innerHTML=(l=>{let t=p("undefined"!=typeof document&&document.location?document.location.href:""),a=y.filter(e=>e.timeSec>=t),o=y.filter(e=>0<e.timeSec&&e.timeSec<t),i=a.length,d=o.length,n=new Set,e=(a.forEach(e=>n.add(e[l]||"Unknown")),o.forEach(e=>n.add(e[l]||"Unknown")),Array.from(n));if("ageGroup"===l)(e=e.filter(e=>e&&"Unknown"!==e&&"Not specified"!==e)).sort((e,t)=>{e=parseInt((e||"").split("-")[0],10),t=parseInt((t||"").split("-")[0],10);return isNaN(e)?1:isNaN(t)?-1:e-t}),n.has("Not specified")&&e.push("Not specified"),n.has("Unknown")&&e.push("Unknown");else if("parkrunExperience"===l){let r=["First Timer (anywhere)","First Timer (to this event)","Multiple parkruns","parkrun 10 Club","parkrun 25 Club","parkrun 50 Club","parkrun 100 Club","parkrun 250 Club","parkrun 500 Club","parkrun 1000 Club"],n=e=>{var t,n=r.indexOf(e);return-1!==n?n:(n=e.match(/parkrun (\d+) Club/))?(t=[10,25,50,100,250,500,1e3],n=parseInt(n[1],10),-1!==(t=t.indexOf(n))?3+t:200+n):"Unknown"===e?9999:999};e.sort((e,t)=>n(e)-n(t))}else if("volunteerStatus"===l){let n=["Yet to Volunteer","Volunteered once","Volunteered multiple times","Volunteer 10 Club","Volunteer 25 Club","Volunteer 50 Club","Volunteer 100 Club","Volunteer 250 Club","Volunteer 500 Club","Volunteer 1000 Club"],r=e=>{var t=n.indexOf(e);return-1!==t?t:(t=e.match(/(\d+)/))?200+parseInt(t[1],10):"Has Volunteered"===e?150:"Unknown"===e?9999:999};e.sort((e,t)=>r(e)-r(t))}else e.sort();let s=i+d;var r=s?(i/s*100).toFixed(1):"0.0",u=s?(d/s*100).toFixed(1):"0.0";let c=`<div style="text-align:center;margin-bottom:0.5em;font-size:1.08em;">
      <strong>Walkers:</strong> ${i} (${r}%) &nbsp; | &nbsp; <strong>Runners:</strong> ${d} (${u}%) &nbsp; | &nbsp; <strong>Total finishers:</strong> ${s}
    </div>`;return c+=`<table class="Results-table" style="margin:1em auto;font-size:1.1em;">
      <thead><tr><th>${f.find(e=>e.key===l).label}</th><th>Walkers (n)</th><th>Walkers (%)</th><th>Runners (n)</th><th>Runners (%)</th><th>Total (n)</th><th>Total (%)</th></tr></thead><tbody>`,e.forEach(t=>{var e=a.filter(e=>(e[l]||"Unknown")===t).length,n=o.filter(e=>(e[l]||"Unknown")===t).length,r=e+n;c+=`<tr><td>${t}</td><td style="text-align:right">${e}</td><td style="text-align:right">${i?(e/i*100).toFixed(1):"0.0"}%</td><td style="text-align:right">${n}</td><td style="text-align:right">${d?(n/d*100).toFixed(1):"0.0"}%</td><td style="text-align:right">${r}</td><td style="text-align:right">${s?(r/s*100).toFixed(1):"0.0"}%</td></tr>`}),c=c+`<tr style="font-weight:bold;"><td>Total</td><td style="text-align:right">${i}</td><td style="text-align:right">100.0%</td><td style="text-align:right">${d}</td><td style="text-align:right">100.0%</td><td style="text-align:right">${s}</td><td style="text-align:right">100.0%</td></tr>`+"</tbody></table>"})(k),document.getElementById("walkerAnalysisContainer")),n=(t||((t=document.createElement("div")).id="walkerAnalysisContainer",t.style.width="100%",t.style.maxWidth="900px",t.style.margin="20px auto"),t.innerHTML="",document.getElementById(x));n||((n=document.createElement("div")).id=x),t.appendChild(n),t.appendChild(r),t.appendChild(e);var m=document.querySelector("h3");m&&m.parentNode?t.parentNode===m.parentNode&&t.previousSibling===m||(m.nextSibling?m.parentNode.insertBefore(t,m.nextSibling):m.parentNode.appendChild(t)):document.body.appendChild(t);{var g=k,h=(m=f.find(e=>e.key===k).label,x);let{bins:l,minMinute:t,maxMinute:n}=(n=>{let r={},l=1/0,a=0;return y.forEach(e=>{var t;0!==e.timeSec&&(t=Math.floor(e.timeSec/60),l=Math.min(l,t),a=Math.max(a,t),r[t]||(r[t]={}),e=e[n]||"Unknown",r[t][e]=(r[t][e]||0)+1)}),{bins:r,minMinute:l,maxMinute:a}})(g),a=[];for(let e=t;e<=n;e++)a.push(e);let r=new Set,o=(Object.values(l).forEach(e=>Object.keys(e).forEach(e=>r.add(e))),Array.from(r)),e=(o=((e,t)=>{var n;if("ageGroup"===t)return(n=e.filter(e=>e&&"Unknown"!==e&&"Not specified"!==e)).sort((e,t)=>{e=parseInt((e||"").split("-")[0],10),t=parseInt((t||"").split("-")[0],10);return isNaN(e)?1:isNaN(t)?-1:e-t}),e.includes("Not specified")&&n.push("Not specified"),e.includes("Unknown")&&n.push("Unknown"),n;if("parkrunExperience"===t){let r=["First Timer (anywhere)","First Timer (to this event)","Multiple parkruns","parkrun 10 Club","parkrun 25 Club","parkrun 50 Club","parkrun 100 Club","parkrun 250 Club","parkrun 500 Club","parkrun 1000 Club"],n=e=>{var t,n=r.indexOf(e);return-1!==n?n:(n=e.match(/parkrun (\d+) Club/))?(t=[10,25,50,100,250,500,1e3],n=parseInt(n[1],10),-1!==(t=t.indexOf(n))?3+t:200+n):"Unknown"===e?9999:999};return e.slice().sort((e,t)=>n(e)-n(t))}if("volunteerStatus"!==t)return e.slice().sort();{let n=["Yet to Volunteer","Volunteered once","Volunteered multiple times","Volunteer 10 Club","Volunteer 25 Club","Volunteer 50 Club","Volunteer 100 Club","Volunteer 250 Club","Volunteer 500 Club","Volunteer 1000 Club"],r=e=>{var t=n.indexOf(e);return-1!==t?t:(t=e.match(/(\d+)/))?200+parseInt(t[1],10):"Has Volunteered"===e?150:"Unknown"===e?9999:999};return e.slice().sort((e,t)=>r(e)-r(t))}})(o,g)).map(t=>{return{label:t,data:a.map(e=>l[e]&&l[e][t]?l[e][t]:0),backgroundColor:(e=t,"volunteerStatus"===g?(r=e.match(/(\d+)/))?(r=parseInt(r[1],10),b[r]||"#cccccc"):b[e]||"#cccccc":"parkrunExperience"===g?(r=e.match(/(\d+)/))?(r=parseInt(r[1],10),b[r]||"#cccccc"):{"First Timer (anywhere)":"#FFE049","First Timer (to this event)":"#FFA300","Multiple parkruns":"#00CEAE",Unknown:"#A1B6B7"}[e]||"#cccccc":"gender"===g?{Male:"#00CEAE",Female:"#E21145","Not specified":"#FFE049",Unknown:"#A1B6B7"}[e]||"#FFA300":"ageGroup"===g?"Not specified"===e?"#F2F2F2":"Unknown"===e?"#A1B6B7":(r=e.match(/^(\d+)-/))&&(r=parseInt(r[1],10),n=["#DA70D6","#9370DB","#6495ED","#4169E1","#1E90FF","#00BFFF","#00CED1","#20B2AA","#3CB371","#32CD32","#9ACD32","#FFD700","#FFA500","#FF8C00","#FF6347","#DC143C","#DB7093"],r=Math.floor((r-10)/5),n[Math.min(r,n.length-1)])||"#cccccc":["#FFA300","#00CEAE","#E21145","#EBE9F0","#FFE049","#2C504A","#6D5698","#C81D31","#A1B6B7"][o.indexOf(e)%9]),stack:"stack1"};var e,n,r}),i=a.map(e=>Math.floor(e/60)+":"+(e%60).toString().padStart(2,"0")),c=document.getElementById(h),d=(c?c.innerHTML="":(c=document.createElement("div")).id=h,c.style.background="#2b223d",c.style.borderRadius="8px",c.style.margin="20px auto",c.style.padding="15px",c.style.maxWidth="900px",c.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.createElement("h3")),p=(d.textContent="Finishers per Minute by "+m,d.style.textAlign="center",d.style.marginBottom="15px",d.style.color="#FFA300",c.appendChild(d),document.createElement("canvas")),s=(c.appendChild(p),document.createElement("button")),u=(s.textContent="ðŸ’¾ Save as Image",s.style.padding="6px 12px",s.style.backgroundColor="#FFA300",s.style.color="#2b223d",s.style.border="none",s.style.borderRadius="4px",s.style.cursor="pointer",s.style.fontWeight="bold",s.style.display="inline-block",s.style.margin="10px auto 0 auto",s.title="Download chart as PNG image",s.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),s.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),s.addEventListener("click",async function(){try{var e=F(),t=c.querySelector("h3"),n=v(e,t?t.textContent.replace(/[^a-z0-9]+/gi,"-").replace(/^-+|-+$/g,"").toLowerCase():"chart"),r=p,l=r.width,a=l,o=r.height+100,i=document.createElement("canvas"),d=(i.width=a,i.height=o,i.getContext("2d")),s=(d.fillStyle="#2b223d",d.fillRect(0,0,a,o),d.fillStyle="#FFA300",d.textAlign="center",d.textBaseline="middle",d.font="bold 56px Arial",t?t.textContent:"Finishers per Minute"),u=(d.fillText(s,a/2,50),d.drawImage(r,0,100),document.createElement("a"));u.download=n,u.href=i.toDataURL("image/png"),u.click()}catch(e){alert("Failed to export image: "+e)}}),c.querySelector(".walker-controls-footer"));u||((u=document.createElement("div")).className="walker-controls-footer",u.style.display="flex",u.style.justifyContent="center",u.style.marginTop="12px",c.appendChild(u)),u.innerHTML="",u.appendChild(s),C&&(C.destroy(),C=null),setTimeout(()=>{E&&(C=new E(p.getContext("2d"),{type:"bar",data:{labels:i,datasets:e},options:{responsive:!0,layout:{padding:{left:60,right:60,top:40,bottom:40}},plugins:{legend:{labels:{color:"#e0e0e0"}},title:{display:!1}},scales:{x:{stacked:!0,title:{display:!0,text:"Finish Time",color:"#e0e0e0"},ticks:{color:"#cccccc"},grid:{color:"rgba(200,200,200,0.2)"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Number of Finishers",color:"#e0e0e0"},ticks:{color:"#cccccc",precision:0},grid:{color:"rgba(200,200,200,0.2)"}}}}}))},0)}(h=document.getElementById(x))&&h.parentNode?h.nextSibling?h.parentNode.insertBefore(r,h.nextSibling):h.parentNode.appendChild(r):document.body.appendChild(r)}r||((r=document.createElement("div")).id="walkerAnalysisControls",r.style.textAlign="center",r.style.margin="20px 0 10px 0",r.style.color="#e0e0e0",r.style.background="#2b223d",r.style.padding="10px",r.style.borderRadius="8px",r.style.maxWidth="900px",r.style.marginLeft="auto",r.style.marginRight="auto"),n()}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={assignUnknownFinishTimes:e,getEventMetadata:F,generateExportFilename:v,computeWalkerThreshold:p})})();
```

### parkrun Position Bingo Challenge

> Tracks progress on the unofficial parkrun position bingo challenge (last two digits of position) with a 10x10 grid visualization and detailed event info.


[position-bingo.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/position-bingo.user.js)

```javascript
javascript:(async()=>{var n,e,t;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((e,t)=>{var o=document.createElement("script");o.src=n,o.onload=e,o.onerror=t,document.head.appendChild(o)});{let p=100;function m(){return window.innerWidth<768?{isMobile:!0,container:{padding:"10px",marginTop:"10px"},typography:{heading:"1.1em",stats:"1em",statsSubtext:"0.9em"},grid:{boxSize:28,gapSize:3,cellFontSize:"0.7em",cellPadding:"1px",positionFontSize:"0.9em",eventFontSize:"0.65em",dateFontSize:"0.6em"},button:{padding:"6px 12px",fontSize:"0.9em",marginTop:"10px"}}:{isMobile:!1,container:{padding:"20px",marginTop:"20px"},typography:{heading:"1.3em",stats:"1.2em",statsSubtext:"1em"},grid:{boxSize:100,gapSize:5,cellFontSize:"0.9em",cellPadding:"2px",positionFontSize:"1.2em",eventFontSize:"0.8em",dateFontSize:"0.7em"},button:{padding:"8px 15px",fontSize:"1em",marginTop:"15px"}}}function o(l){var e=m(),o=document.createElement("div"),t=(o.id="positionBingoContainer",o.className="parkrun-position-bingo-container",o.style.width="100%",o.style.maxWidth="1200px",o.style.margin=e.container.marginTop+" auto",o.style.padding=e.container.padding,o.style.backgroundColor="#2b223d",o.style.borderRadius="8px",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",o.style.color="#e0e0e0",o.style.textAlign="center",document.createElement("h3")),t=(t.textContent="Position Bingo Challenge",t.style.marginBottom=e.isMobile?"8px":"10px",t.style.color="#FFA300",t.style.fontSize=e.typography.heading,o.appendChild(t),document.createElement("div")),t=(t.innerHTML=`<div style="font-size: ${e.typography.stats}; margin-bottom: ${e.isMobile?"8px":"10px"};">`+"<strong>"+l.completedCount+" of "+p+"</strong> positions completed</div>"+`<div style="font-size: ${e.typography.statsSubtext};">After `+l.totalEvents+" parkruns</div>",o.appendChild(t),Math.ceil(p/10)),n=e.grid.boxSize,i=e.grid.gapSize,s=document.createElement("div");s.style.display="grid",s.style.gridTemplateColumns=`repeat(10, ${n}px)`,s.style.gridTemplateRows=`repeat(${t}, ${n}px)`,s.style.gap=i+"px",s.style.margin="0 auto",s.style.justifyContent="center";for(let n=0;n<p;n++){var a=document.createElement("div"),r=(a.style.boxSizing="border-box",a.style.border="1px solid #666",a.style.borderRadius="4px",a.style.backgroundColor=l.completedPositions[n]?"#FFA300":"#008080",a.style.color="#fff",a.style.textAlign="left",a.style.padding=e.grid.cellPadding,a.style.fontWeight="bold",a.style.fontSize=e.grid.cellFontSize,a.style.cursor=l.completedPositions[n]?"pointer":"default",a.style.aspectRatio="1",document.createElement("div"));r.textContent=n.toString().padStart(2,"0"),r.style.fontSize=e.grid.positionFontSize,r.style.marginBottom=e.isMobile?"2px":"5px",a.appendChild(r),l.completedPositions[n]&&((r=document.createElement("div")).innerHTML=`<div style="font-size: ${e.grid.eventFontSize}; text-align: center;">`+l.completedPositions[n][0].eventName+"<br>"+`<span style="font-size: ${e.grid.dateFontSize};">`+l.completedPositions[n][0].date+" ("+l.completedPositions[n][0].position+")</span></div>",e.isMobile&&(r.style.display="none"),a.appendChild(r),a.addEventListener("click",()=>{var e=m();let t=document.createElement("div"),i=(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.zIndex="999",t.addEventListener("click",()=>{document.body.removeChild(t)}),document.createElement("div"));i.style.position="fixed",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",i.style.backgroundColor="#2b223d",i.style.color="#fff";var o=e.isMobile?"15px":"20px",o=(i.style.padding=o,i.style.borderRadius="8px",i.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",i.style.zIndex="1000",i.style.maxWidth=e.isMobile?"95%":"90%",i.style.maxHeight=e.isMobile?"85%":"80%",i.style.overflowY="auto",i.style.fontSize=e.isMobile?"0.9em":"1em",document.createElement("h4"));o.textContent="Position "+n.toString().padStart(2,"0"),o.style.marginBottom="10px",o.style.color="#FFA300",i.appendChild(o),l.completedPositions[n].forEach(({eventName:e,date:t,position:o})=>{var n=document.createElement("div");n.style.marginBottom="10px",n.innerHTML="<strong>"+e+'</strong><br><span style="font-size: 0.9em;">'+t+" ("+o+")</span>",i.appendChild(n)}),t.appendChild(i),document.body.appendChild(t)})),s.appendChild(a)}o.appendChild(s);{var d=o;let e=m(),t=document.createElement("div"),i=(t.style.marginTop=e.button.marginTop,t.id="position-bingo-download-btn-container",document.createElement("button"));i.textContent="ðŸ’¾ Save as Image",i.style.padding=e.button.padding,i.style.backgroundColor="#FFA300",i.style.color="#2b223d",i.style.border="none",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontWeight="bold",i.style.fontSize=e.button.fontSize,i.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),i.addEventListener("mouseout",function(){this.style.backgroundColor="#FFA300"}),i.addEventListener("click",function(){i.style.display="none",html2canvas(d,{backgroundColor:"#2b223d",scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(e=>{i.style.display="block";var t=document.createElement("a"),o=(new Date).toISOString().split("T")[0],n=window.location.pathname.split("/")[2]||"parkrunner";t.download=`position-bingo-${n}-${o}.png`,t.href=e.toDataURL("image/png"),t.click()})}),t.appendChild(i),d.appendChild(t)}return o}(t=(t=document.querySelectorAll("#results"))[t.length-1])?(t=t=o((e=>{let t={};var o;let n=0;for(o of Array.from(e.querySelectorAll("tr")).reverse()){var i=o.querySelectorAll("td");if(!(i.length<5)){var l=i[3].textContent.trim(),s=parseInt(l.slice(-2),10),a=i[0].textContent.trim(),i=i[1].textContent.trim();if(!isNaN(s)&&0<=s&&s<p&&(t[s]||(t[s]=[]),t[s].push({eventName:a,date:i,position:l}),Object.keys(t).length===p))break;n++}}return{completedPositions:t,remainingPositions:Array.from({length:p},(e,t)=>t).filter(e=>!t[e]),completedCount:Object.keys(t).length,totalEvents:n}})(t)),(e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))):console.log("Results table not found")}})();
```

### parkrun Stopwatch Bingo

> Visualizes your progress on the stopwatch bingo challenge (collecting seconds 00-59)


[stopwatch-bingo.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/stopwatch-bingo.user.js)

```javascript
javascript:(async()=>{var n;n="https://html2canvas.hertzen.com/dist/html2canvas.min.js",await new Promise((t,e)=>{var o=document.createElement("script");o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)});{let T={backgroundColor:"#2b223d",clockBorderColor:"#FFA300",clockFaceColor:"#333",completedColor:"#FFA300",textColor:"#e0e0e0",subtleTextColor:"#cccccc"};function o(){var t=document.querySelectorAll("#results");return t[t.length-1]}function l(t){var e={},o={};let n=0,l=0,r=null,i=null;t=t.querySelectorAll("tr");let s=[];t.forEach(e=>{e=e.querySelectorAll("td");if(!(e.length<5)){var o=e[0].textContent.trim(),n=e[1].textContent.trim(),l=e[2].textContent.trim(),e=e[4].textContent.trim();if(e&&l&&n&&o){o=o+" # "+l;let t;l=e.match(/(\d+):(\d+):(\d+)/);if(l)t=parseInt(l[3],10);else{l=e.match(/(\d+):(\d+)/);if(!l)return;t=parseInt(l[2],10)}s.push({secondValue:t,date:n,event:o,time:e})}}});var d=s.reverse();for(let t=0;t<d.length;t++){var{secondValue:a,date:c,event:p,time:m}=d[t];if(l++,!(a in e||(e[a]={date:c,event:p,time:m},60!=++n)||i)){i=c,r=p,o[a]=[{date:c,event:p,time:m}];break}o[a]||(o[a]=[]),o[a].push({date:c,event:p,time:m})}return{seconds:e,timeData:o,collectedCount:n,totalParkruns:l,dateOfCompletion:i,firstCompleteEvent:r}}function r(m){o="Stopwatch Bingo Challenge",(e=document.createElement("div")).id||(e.id="stopwatchBingoContainer"),e.className="parkrun-bingo-container",e.style.width="100%",e.style.maxWidth="800px",e.style.margin="20px auto",e.style.padding=window.innerWidth<768?"10px":"20px",e.style.backgroundColor=T.backgroundColor,e.style.borderRadius="8px",e.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",e.style.textAlign="center",(t=document.createElement("h3")).textContent=o,t.style.marginBottom="15px",t.style.color=T.clockBorderColor,t.style.fontSize=window.innerWidth<768?"1.1em":"1.3em",e.appendChild(t);var o=e,t=window.innerWidth<768,e=document.createElement("div"),n=(e.style.marginBottom=t?"10px":"20px",e.style.color=T.textColor,t?"1em":"1.2em");let l=`<div style="font-size: ${n}; margin-bottom: 10px;"><strong>${m.collectedCount} of 60</strong> seconds collected</div>`;l+=`<div style="font-size: ${t?"0.9em":"1em"};">After ${m.totalParkruns} parkruns</div>`,m.dateOfCompletion&&(l+=`<div style="margin-top: 10px; font-size: ${t?"0.95em":"1.1em"};">ðŸ† Bingo completed on ${m.dateOfCompletion} (${m.firstCompleteEvent})</div>`),e.innerHTML=l,o.appendChild(e);var r,i,s,d,a,c,u,y,h,g,x,b,C=t?Math.min(320,window.innerWidth-40):500,v=C/500,f=document.createElement("div");f.style.position="relative",f.style.width=C+"px",f.style.height=C+"px",f.style.margin="0 auto",f.style.borderRadius="50%",f.style.border=Math.round(10*v)+"px solid "+T.clockBorderColor,f.style.backgroundColor=T.clockFaceColor,f.style.boxSizing="content-box";let w=1;for(let t=0;t<60;t++){var p=m.timeData[t]?m.timeData[t].length:0;p>w&&(w=p)}for(let p=0;p<60;p++)p in m.seconds&&(r=m.timeData[p]?m.timeData[p].length:0,b=((p-.4)/60*360-90)*(Math.PI/180),i=((p+.4)/60*360-90)*(Math.PI/180),(s=document.createElement("div")).style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none",h=220*v,d=50*v,c=a=C/2,(u=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("width","100%"),u.setAttribute("height","100%"),u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.zIndex="1",y=document.createElementNS("http://www.w3.org/2000/svg","path"),h=d+Math.max(0,Math.round(r/w*(h-d))),b=[`M ${g=a+d*Math.cos(b)},`+(x=c+d*Math.sin(b)),`L ${a+h*Math.cos(b)},`+(c+h*Math.sin(b)),`A ${h},${h} 0 0,1 ${a+h*Math.cos(i)},`+(c+h*Math.sin(i)),`L ${a+d*Math.cos(i)},`+(c+d*Math.sin(i)),`A ${d},${d} 0 0,0 ${g},`+x,"Z"].join(" "),y.setAttribute("d",b),y.setAttribute("fill",T.completedColor),y.setAttribute("opacity","1"),y.setAttribute("title",p.toString().padStart(2,"0")+` Seconds - ${r} `+(1===r?"Time":"Times")),y.style.cursor="pointer",y.style.pointerEvents="auto",y.addEventListener("click",()=>{{var d=p,a=m.timeData[p],c=document.getElementById("second-details-popup");c&&c.remove();let t=document.createElement("div"),e=(t.id="second-details-popup",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="400px",t.style.maxHeight="500px",t.style.overflowY="auto",t.style.backgroundColor=T.backgroundColor,t.style.borderRadius="8px",t.style.padding="20px",t.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.5)",t.style.zIndex="1000",t.style.color=T.textColor,document.createElement("div")),o=(e.textContent="âœ•",e.style.position="absolute",e.style.top="10px",e.style.right="15px",e.style.fontSize="20px",e.style.cursor="pointer",e.addEventListener("click",()=>t.remove()),t.appendChild(e),document.createElement("h3")),n=(o.textContent=`${d.toString().padStart(2,"0")} Seconds - ${a.length} Times`,o.style.marginBottom="15px",o.style.color=T.clockBorderColor,t.appendChild(o),document.createElement("table")),l=(n.style.width="100%",n.style.borderCollapse="collapse",n.style.marginTop="10px",document.createElement("thead")),r=document.createElement("tr"),i=([{title:"Date",align:"left"},{title:"Event",align:"left"},{title:"Time",align:"left"}].forEach(t=>{var e=document.createElement("th");e.textContent=t.title,e.style.textAlign=t.align,e.style.padding="8px",e.style.borderBottom="1px solid #555",r.appendChild(e)}),l.appendChild(r),n.appendChild(l),document.createElement("tbody")),s=(a.forEach((t,e)=>{var o=document.createElement("tr"),e=(o.style.backgroundColor=0===e?"rgba(255, 163, 0, 0.2)":"transparent",[{content:t.date},{content:t.event},{content:t.time}].map(t=>`<td style="padding: 8px; border-bottom: 1px solid #444;">${t.content}</td>`).join(""));o.innerHTML=e,i.appendChild(o)}),n.appendChild(i),t.appendChild(n),document.body.appendChild(t),document.createElement("div"));s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.style.zIndex="999",s.addEventListener("click",()=>{t.remove(),s.remove()}),document.body.appendChild(s)}}),u.appendChild(y),s.appendChild(u),f.appendChild(s));var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttribute("width","100%"),E.setAttribute("height","100%"),E.style.position="absolute",E.style.top="0",E.style.left="0",E.style.pointerEvents="none",E.style.zIndex="2";for(let t=0;t<60;t+=5){var k=(t/60*360-90)*(Math.PI/180),S=245*v,A=(t%15==0?210:225)*v,M=C/2,$=C/2,B=document.createElementNS("http://www.w3.org/2000/svg","line"),S=(B.setAttribute("x1",M+A*Math.cos(k)),B.setAttribute("y1",$+A*Math.sin(k)),B.setAttribute("x2",M+S*Math.cos(k)),B.setAttribute("y2",$+S*Math.sin(k)),B.setAttribute("stroke",T.textColor),B.setAttribute("stroke-width",(t%15==0?3:2)*v),E.appendChild(B),A-(t%15==0?25:20)*v),B=M+S*Math.cos(k),A=$+S*Math.sin(k),M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("x",B),M.setAttribute("y",A),M.setAttribute("fill",T.textColor),M.setAttribute("font-size",(t%15==0?16:14)*v+"px"),M.setAttribute("font-weight","bold"),M.setAttribute("text-anchor","middle"),M.setAttribute("dominant-baseline","middle"),M.textContent=t.toString(),E.appendChild(M)}f.appendChild(E);n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.width=100*v+"px",n.style.height=100*v+"px",n.style.borderRadius="50%",n.style.backgroundColor=T.clockBorderColor,n.style.display="flex",n.style.justifyContent="center",n.style.alignItems="center",n.style.color=T.backgroundColor,n.style.fontWeight="bold",n.style.fontSize=20*v+"px",n.style.zIndex="3",n.textContent=Math.round(m.collectedCount/60*100)+"%",f.appendChild(n),o.appendChild(f);{var z=o;let t=window.innerWidth<768,e=document.createElement("div"),l=(e.style.marginTop=t?"10px":"15px",e.id="bingo-download-btn-container",document.createElement("button"));l.textContent="ðŸ’¾ Save as Image",l.style.padding=t?"6px 12px":"8px 15px",l.style.backgroundColor=T.clockBorderColor,l.style.color=T.backgroundColor,l.style.border="none",l.style.borderRadius="4px",l.style.cursor="pointer",l.style.fontWeight="bold",l.style.fontSize=t?"0.9em":"1em",l.addEventListener("mouseover",function(){this.style.backgroundColor="#e59200"}),l.addEventListener("mouseout",function(){this.style.backgroundColor=T.clockBorderColor}),l.addEventListener("click",function(){l.style.display="none",html2canvas(z,{backgroundColor:T.backgroundColor,scale:2,logging:!1,allowTaint:!0,useCORS:!0}).then(t=>{l.style.display="block";var e=document.createElement("a"),o=(new Date).toISOString().split("T")[0],n=window.location.pathname.split("/")[2]||"parkrunner";e.download=`stopwatch-bingo-${n}-${o}.png`,e.href=t.toDataURL("image/png"),e.click()})}),e.appendChild(l),z.appendChild(e)}e=document.createElement("div");return e.style.marginTop=t?"10px":"20px",e.style.color=T.subtleTextColor,e.style.fontSize=t?"0.8em":"0.9em",e.style.padding=t?"0 5px":"0",e.innerHTML="Stopwatch Bingo: collect finish times with every second from 00-59.<br>Orange segments show seconds you've collected. Segment length indicates frequency.<br>Click on any segment to see details.",o.appendChild(e),o}function t(){var t,e;document.querySelector("#results")?document.querySelector("h2")&&(t=r(l(o())),t=t,e=document.querySelector("h2"))&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)):console.log("Results table not found")}"undefined"!=typeof module&&module.exports?module.exports={findResultsTable:o,extractFinishTimes:l}:t()}})();
```

### parkrun Countries Visited

> Shows country flag emojis next to parkrunner name for all countries they have completed parkruns in


[visited-countries.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/visited-countries.user.js)

```javascript
javascript:(async()=>{{let t={at:{flag:"ðŸ‡¦ðŸ‡¹",name:"Austria"},ru:{flag:"ðŸ‡·ðŸ‡º",name:"Russia"},au:{flag:"ðŸ‡¦ðŸ‡º",name:"Australia"},ca:{flag:"ðŸ‡¨ðŸ‡¦",name:"Canada"},com:{flag:"ðŸ‡ºðŸ‡¸",name:"United States"},de:{flag:"ðŸ‡©ðŸ‡ª",name:"Germany"},dk:{flag:"ðŸ‡©ðŸ‡°",name:"Denmark"},fi:{flag:"ðŸ‡«ðŸ‡®",name:"Finland"},fr:{flag:"ðŸ‡«ðŸ‡·",name:"France"},ie:{flag:"ðŸ‡®ðŸ‡ª",name:"Ireland"},is:{flag:"ðŸ‡®ðŸ‡¸",name:"Iceland"},it:{flag:"ðŸ‡®ðŸ‡¹",name:"Italy"},jp:{flag:"ðŸ‡¯ðŸ‡µ",name:"Japan"},lt:{flag:"ðŸ‡±ðŸ‡¹",name:"Lithuania"},my:{flag:"ðŸ‡²ðŸ‡¾",name:"Malaysia"},nl:{flag:"ðŸ‡³ðŸ‡±",name:"Netherlands"},no:{flag:"ðŸ‡³ðŸ‡´",name:"Norway"},nz:{flag:"ðŸ‡³ðŸ‡¿",name:"New Zealand"},pl:{flag:"ðŸ‡µðŸ‡±",name:"Poland"},se:{flag:"ðŸ‡¸ðŸ‡ª",name:"Sweden"},sg:{flag:"ðŸ‡¸ðŸ‡¬",name:"Singapore"},uk:{flag:"ðŸ‡¬ðŸ‡§",name:"United Kingdom"},us:{flag:"ðŸ‡ºðŸ‡¸",name:"United States "},za:{flag:"ðŸ‡¿ðŸ‡¦",name:"South Africa"}};function l(e){e=e.hostname.split(".");let a=e[e.length-1];return a="com"===a&&2===e[0].length?e[0]:a}if("undefined"!=typeof module&&module.exports)module.exports={getCountryCodeFromUrl:l};else{n=(n=document.querySelectorAll("#results"))[n.length-1];if(n){n.querySelectorAll("tr").forEach(e=>{var a,n,e=e.querySelector('td a[href*="parkrun"]');e&&(a=l(new URL(e.href)),a=t[a])&&((n=document.createElement("span")).textContent=" "+a.flag,n.title=a.name,n.style.cursor="help",e.appendChild(n))});n=(e=>{let a=new Map;return e.querySelectorAll("tr").forEach(e=>{var e=e.querySelector('td a[href*="parkrun"]');e&&(e=l(new URL(e.href)),a.set(e,(a.get(e)||0)+1))}),Array.from(a.entries()).sort((e,a)=>{e=t[e[0]]?.name||e[0],a=t[a[0]]?.name||a[0];return e.localeCompare(a)}).map(([e,a])=>{var n=t[e];return{symbol:n?n.flag:e,name:n?n.name:e.toUpperCase(),count:a}})})(n);if(n.length){var e=document.querySelector("h2");if(e){var a=document.createElement("div");a.id="countries-visited",a.style.marginLeft="10px",a.style.fontSize="1.8em",a.style.marginTop="5px",a.title=n.length+" Countries visited, according to parkrun's domains. Political boundaries may not be accurate.";let l=document.createElement("span");l.style.lineHeight="1.5",l.style.display="inline-block",n.forEach(({symbol:e,name:a,count:n})=>{var t=document.createElement("span");t.textContent=e,t.title=a+` (${n})`,t.style.cursor="help",l.appendChild(t),l.appendChild(document.createTextNode(" "))}),a.appendChild(l),e.appendChild(a)}else console.log("No title")}else console.log("No countries visited")}else console.log("Results table not found")}var n}})();
```

### parkrun Volunteer Days Display

> Displays the number of volunteer days for parkrun finishers on results pages, for celebration purposes (and let's not make assumptions about ratios)


[volunteer-days-display.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/volunteer-days-display.user.js)

```javascript
javascript:(async()=>{!function e(){if(document.querySelector("tr[data-vols]")){if(document.querySelectorAll("tr[data-vols] > td.Results-table-td.Results-table-td--name > div.detailed").forEach(e=>{var t,a,s=e.closest("tr").getAttribute("data-vols");s&&0<parseInt(s)&&((t=document.createElement("span")).classList.add("spacer"),t.textContent=" | ",(a=document.createElement("span")).textContent=s+" volunteer day"+("1"===s?"":"s"),a.classList.add("volunteer-days"),(s=e.firstElementChild)?(s.insertAdjacentElement("afterend",t),t.insertAdjacentElement("afterend",a)):e.appendChild(a))}),o=document.querySelector("tr[data-vols]")){let t=o.closest("tbody");var a,s,o=document.querySelector('select[name="sort"], .Results-sort select, select.Results-sort, .Results-controls select');function r(o){var e;t&&((e=Array.from(t.querySelectorAll("tr")).map((e,t)=>({row:e,index:t}))).sort((e,t)=>{var a=parseInt(e.row.getAttribute("data-vols")||"0",10),s=parseInt(t.row.getAttribute("data-vols")||"0",10);return a===s?e.index-t.index:"asc"===o?a-s:s-a}),e.forEach(({row:e})=>t.appendChild(e)))}o&&(o.querySelector('option[value="vols-asc"]')||(a=new Option("Sort by Volunteer days â–²","vols-asc"),s=new Option("Sort by Volunteer days â–¼","vols-desc"),o.appendChild(a),o.appendChild(s)),o.dataset.volsSortWired||(o.addEventListener("change",e=>{var t=e.target.value||"";"vols-asc"!==t&&"vols-desc"!==t||(e.cancelable&&e.preventDefault(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),"function"==typeof e.stopPropagation&&e.stopPropagation(),r(t.endsWith("asc")?"asc":"desc"))},!0),o.addEventListener("change",e=>{"vols-asc"===(e=e.target.value||"")?r("asc"):"vols-desc"===e&&r("desc")}),o.dataset.volsSortWired="true"))}}else setTimeout(e,500)}()})();
```

### parkrun Wilson index display

> The "Wilson index" in parkrun is the highest consecutive event number completed, starting from #1. This script calculates and displays a parkrunner's Wilson index on their results page.


[w-index.user.js](https://raw.githubusercontent.com/johnsyweb/tampermonkey-parkrun/refs/heads/main/w-index.user.js)

```javascript
javascript:(async()=>{var a;function o(t,e=7){var n;let a=null;for(n of t.querySelectorAll('[id="results"]')){var r=n.querySelector("tr");if(r)if(r.querySelectorAll("th, td").length===e){a=n;break}}return a}function p(t){return Array.from(t.querySelectorAll("tbody > tr")).reverse().map(t=>{var e=t.querySelector("td:nth-child(1)").textContent.trim(),n=t.querySelector("td:nth-child(2)").textContent.trim(),t=t.querySelector("td:nth-child(3)").textContent.trim();return{eventName:e,eventDate:n,eventNumber:parseInt(t,10)}})}function c(t){let e=0;var n;for(n of t.map(t=>t.eventNumber).sort((t,e)=>t-e)){if(n>=e+2)break;n===e+1&&e++}return e}function u(e){var n=[];for(let t=0;t<e.length;t++){var a=e.slice(0,t+1),r=t+1,o=`${e[t].eventName} # ${e[t].eventNumber} on `+e[t].eventDate,a=c(a);n.push({parkruns:r,event:o,wilsonIndex:a})}return n}function m(){return window.innerWidth<768?{isMobile:!0,spacing:{small:"10px",medium:"15px"},container:{padding:"10px",marginTop:"10px"},typography:{wilsonIndex:"1.2em",input:"16px",button:"16px"},chart:{height:"250px",fonts:{title:14,axisTitle:12,axisTicks:10,legend:11,tooltipTitle:12,tooltipBody:11}},form:{marginBottom:"10px",input:{width:"calc(100% - 20px)",maxWidth:"300px",padding:"8px",marginRight:"0"},button:{padding:"8px 15px",width:"calc(100% - 20px)",maxWidth:"300px"},layout:{display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"}}}:{isMobile:!1,spacing:{small:"20px",medium:"20px"},container:{padding:"20px",marginTop:"20px"},typography:{wilsonIndex:"1.5em",input:"inherit",button:"inherit"},chart:{height:"300px",fonts:{title:16,axisTitle:14,axisTicks:12,legend:12,tooltipTitle:14,tooltipBody:12}},form:{marginBottom:"20px",input:{width:"300px",maxWidth:"300px",padding:"5px",marginRight:"10px"},button:{padding:"5px 10px",width:"auto",maxWidth:"none"},layout:{display:"block",flexDirection:"row",gap:"0",alignItems:"flex-start"}}}}async function f(t){var t=await(async(e,n,t=36e5)=>{let a=sessionStorage.getItem(n);if(a){var{data:r,timestamp:o}=JSON.parse(a);if(Date.now()-o<t)return r}return fetch(e).then(t=>{if(t.ok)return t.text();throw new Error(`Failed to fetch: ${t.status} `+t.statusText)}).then(t=>(sessionStorage.setItem(n,JSON.stringify({data:t,timestamp:Date.now()})),t)).catch(t=>{if(console.error(`Error fetching ${e}:`,t),a)return console.warn("Using stale cached data after fetch failure"),JSON.parse(a).data;throw t})})(window.location.origin+`/parkrunner/${t}/all/`,`parkrunner_${t}_all`),t=(new DOMParser).parseFromString(t,"text/html"),e=o(t);return e?(t=t.querySelector("h2"))?(t=h(t))?{friendIndices:u(p(e)),friendInfo:t}:(console.error("Could not extract friend athlete info"),null):(console.error("Friend H2 element not found"),null):(console.error("Friend results table not found"),null)}function h(t){return t.textContent.trim()}function x(t){var e=["#FFA300","#90EE90","#FF69B4","#4169E1","#FFD700","#9370DB","#20B2AA","#FF6347","#DDA0DD","#00CED1"];return e[t%e.length]}function t(){var t=o(document);if(t){var e=document.querySelector("h2");if(e){var n=h(e);if(n){var t=p(t),a=c(t),t=u(t);if(e){var i=m(),l=document.createElement("div"),r=(l.id="w-index-display",l.style.width="100%",l.style.maxWidth="800px",l.style.margin=i.container.marginTop+" auto",l.style.backgroundColor="#2b223d",l.style.padding=i.container.padding,l.style.borderRadius="5px",document.createElement("div"));r.textContent="Wilson index: "+a,r.style.fontSize=i.typography.wilsonIndex,r.style.color="#ffa300",r.style.fontWeight="bold",r.style.marginBottom=i.spacing.small,r.style.textAlign="center",l.appendChild(r);a=t,i=l,r=n,t=m(),(n=document.createElement("div")).style.width="100%",n.style.maxWidth="100%",n.style.height=t.chart.height,n.style.position="relative",n.style.boxSizing="border-box",n.style.overflow="hidden",d=document.createElement("canvas"),n.appendChild(d),i.appendChild(n),i=d.getContext("2d");let o=new Chart(i,{type:"line",data:{labels:a.map(t=>t.parkruns),datasets:[{label:r,data:a.map(t=>({x:t.parkruns,y:t.wilsonIndex,event:t.event})),borderColor:x(0),backgroundColor:"#2b223d"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Wilson Index",font:{size:t.chart.fonts.axisTitle}},ticks:{font:{size:t.chart.fonts.axisTicks}},suggestedMax:Math.ceil(1.1*Math.max(...a.map(t=>t.wilsonIndex)))},x:{title:{display:!0,text:"parkruns",font:{size:t.chart.fonts.axisTitle}},ticks:{font:{size:t.chart.fonts.axisTicks}},min:0,suggestedMax:Math.ceil(1.1*a.length)}},plugins:{title:{display:!0,text:"Wilson Index Progress",font:{size:t.chart.fonts.title}},legend:{labels:{font:{size:t.chart.fonts.legend}}},tooltip:{callbacks:{label:function(t){t=t.raw;return["Wilson Index: "+t.y,"Event: "+t.event]}},titleFont:{size:t.chart.fonts.tooltipTitle},bodyFont:{size:t.chart.fonts.tooltipBody}}}}});{n=l;var s=async(t,e)=>{var n,a,r;n=o,t=t,a=e,r=n.data.datasets.length,a={label:e,data:t.map(t=>({x:t.parkruns,y:t.wilsonIndex,event:t.event})),borderColor:x(r),backgroundColor:"#2b223d"},n.data.datasets.push(a),n.update(),t=Math.max(...n.data.datasets.flatMap(t=>t.data.map(t=>t.x))),r=Math.max(...n.data.datasets.flatMap(t=>t.data.map(t=>t.y))),n.options.scales.x.suggestedMax=Math.ceil(1.1*t),n.options.scales.y.suggestedMax=Math.ceil(1.1*r),n.update()};var d=m(),i=document.createElement("form");i.style.marginBottom=d.form.marginBottom,i.style.textAlign="center",i.style.display=d.form.layout.display,i.style.flexDirection=d.form.layout.flexDirection,i.style.gap=d.form.layout.gap,i.style.alignItems=d.form.layout.alignItems;let a=document.createElement("input"),r=(a.style.width=d.form.input.width,a.style.maxWidth=d.form.input.maxWidth,a.type="text",a.placeholder="Enter friend's athlete ID (e.g. A507)",a.style.padding=d.form.input.padding,a.style.marginRight=d.form.input.marginRight,a.style.borderRadius="3px",a.style.border="1px solid #ffa300",a.style.backgroundColor="#2b223d",a.style.color="#ffa300",a.style.fontSize=d.typography.input,document.createElement("button"));r.textContent="Compare",r.style.padding=d.form.button.padding,r.style.width=d.form.button.width,r.style.maxWidth=d.form.button.maxWidth,r.style.backgroundColor="#ffa300",r.style.color="#2b223d",r.style.border="none",r.style.borderRadius="3px",r.style.cursor="pointer",r.style.fontSize=d.typography.button,r.style.fontWeight="bold",i.appendChild(a),i.appendChild(r),i.addEventListener("submit",async t=>{t.preventDefault();t=a.value.trim().replace(/^[aA]/,"");if(t){r.disabled=!0,r.textContent="Loading...";try{var{friendIndices:e,friendInfo:n}=await f(t);s(e,n)}catch(t){console.error("Failed to fetch friend's results:",t),alert("Failed to fetch friend's results. Please check the ID and try again.")}finally{r.disabled=!1,r.textContent="Compare"}}}),n.insertBefore(i,n.firstChild)}e.parentNode.insertBefore(l,e.nextSibling)}}else console.error("Could not extract athlete info")}else console.error("H2 element not found")}else console.error("Results table not found")}a="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((t,e)=>{var n=document.createElement("script");n.src=a,n.onload=t,n.onerror=e,document.head.appendChild(n)}),"undefined"!=typeof module&&module.exports?module.exports={calculateWilsonIndex:c,calculateWilsonIndexOverTime:u,extractEventDetails:p,findResultsTable:o}:t()})();
```
<!-- END BOOKMARKLETS SECTION -->



































































































## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please see the [CONTRIBUTING.md](CONTRIBUTING.md) file for guidelines.
