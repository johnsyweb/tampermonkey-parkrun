# Pete's parkrun userscripts

## A script or scripts for messing with parkrun results pages

You'll need something like [Tampermonkey](https://www.tampermonkey.net) if
you'd like to enjoy them. Or you can use the bookmarklet versions.

## Why?

Why not?

## Bookmarklets

You can also use these scripts as bookmarklets by creating bookmarks with the following URLs:

### parkrun Wilson index display

Calculate the Wilson index for a parkrunner and display it on their results page

```javascript
(async()=>{var n;function s(e,t=7){var r;let n=null;for(r of e.querySelectorAll('[id="results"]')){var a=r.querySelector("tr");if(a)if(a.querySelectorAll("th, td").length===t){n=r;break}}return n}function d(e){return Array.from(e.querySelectorAll("tbody > tr")).reverse().map(e=>{var t=e.querySelector("td:nth-child(1)").textContent.trim(),r=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();return{eventName:t,eventDate:r,eventNumber:parseInt(e,10)}})}function i(e){let t=0;var r;for(r of e.map(e=>e.eventNumber).sort((e,t)=>e-t)){if(r>=t+2)break;r===t+1&&t++}return t}function c(t){var r=[];for(let e=0;e<t.length;e++){var n=t.slice(0,e+1),a=e+1,l=`${t[e].eventName} # ${t[e].eventNumber} on `+t[e].eventDate,n=i(n);r.push({parkruns:a,event:l,wilsonIndex:n})}return r}function u(e,a){var t=document.createElement("form");t.style.marginBottom="20px",t.style.textAlign="center";let l=document.createElement("input"),o=(l.style.width="200px",l.type="text",l.placeholder="Enter friend's athlete ID (e.g. A507)",l.style.padding="5px",l.style.marginRight="10px",l.style.borderRadius="3px",l.style.border="1px solid #ffa300",l.style.backgroundColor="#2b223d",l.style.color="#ffa300",document.createElement("button"));o.textContent="Compare",o.style.padding="5px 10px",o.style.backgroundColor="#ffa300",o.style.color="#2b223d",o.style.border="none",o.style.borderRadius="3px",o.style.cursor="pointer",t.appendChild(l),t.appendChild(o),t.addEventListener("submit",async e=>{e.preventDefault();var t,e=l.value.trim().replace(/^[aA]/,"");if(e){o.disabled=!0,o.textContent="Loading...";try{t=e,t=await(await fetch(`https://www.parkrun.com.au/parkrunner/${e}/all/`)).text();var r,n=await s((new DOMParser).parseFromString(t,"text/html"));n&&(r=c(d(n)),a(r,e))}catch(e){console.error("Failed to fetch friend's results:",e),alert("Failed to fetch friend's results. Please check the ID and try again.")}finally{o.disabled=!1,o.textContent="Compare"}}}),e.insertBefore(t,e.firstChild)}function p(e){return e.textContent.trim()}function m(e){var t=["#FFA300","#90EE90","#FF69B4","#4169E1","#FFD700","#9370DB","#20B2AA","#FF6347","#DDA0DD","#00CED1"];return t[e%t.length]}function e(){var e=s(document);if(e){var t=document.querySelector("h2");if(t){var r=p(t);if(r){var e=d(e),n=i(e),e=c(e);if(t){var a=document.createElement("div"),o=(a.style.marginTop="20px",a.style.backgroundColor="#2b223d",a.style.padding="20px",a.style.borderRadius="5px",document.createElement("div"));o.textContent="Wilson index: "+n,o.style.fontSize="1.5em",o.style.color="#ffa300",o.style.fontWeight="bold",o.style.marginBottom="20px",o.style.textAlign="center",a.appendChild(o);n=e,o=a,e=r,(r=document.createElement("canvas")).style.width="100%",r.style.height="300px",o.appendChild(r),o=r.getContext("2d");let l=new Chart(o,{type:"line",data:{labels:n.map(e=>e.parkruns),datasets:[{label:e,data:n.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:m(0),backgroundColor:"#2b223d"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Wilson Index"},suggestedMax:Math.ceil(1.1*Math.max(...n.map(e=>e.wilsonIndex)))},x:{title:{display:!0,text:"parkruns"},min:0,suggestedMax:Math.ceil(1.1*n.length)}},plugins:{title:{display:!0,text:"Wilson Index Progress"},tooltip:{callbacks:{label:function(e){e=e.raw;return["Wilson Index: "+e.y,"Event: "+e.event]}}}}}});u(a,async(e,t)=>{var r,n,a,t=await(await fetch(window.location.origin+`/parkrunner/${t}/all/`)).text(),t=p((new DOMParser).parseFromString(t,"text/html").querySelector("h2"));r=l,e=e,n=t,a=r.data.datasets.length,n={label:t,data:e.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:m(a),backgroundColor:"#2b223d"},r.data.datasets.push(n),r.update(),e=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.x))),a=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.y))),r.options.scales.x.suggestedMax=Math.ceil(1.1*e),r.options.scales.y.suggestedMax=Math.ceil(1.1*a),r.update()}),t.parentNode.insertBefore(a,t.nextSibling)}}else console.error("Could not extract athlete info")}else console.error("H2 element not found")}else console.error("Results table not found")}n="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var r=document.createElement("script");r.src=n,r.onload=e,r.onerror=t,document.head.appendChild(r)}),"undefined"!=typeof module&&module.exports?module.exports={calculateWilsonIndex:i,calculateWilsonIndexOverTime:c,extractEventDetails:d,findResultsTable:s}:e()})();
```

### parkrun p-index display

The parkrun p-index is an unofficial statistic that measures the number of different parkrun events a person has completed a specific number of times. To achieve a p-index of 10, you must have completed at least 10 different parkrun events 10 times each. This script calculate the p-index for a parkrunner and displays it on their results page.

```javascript
(async()=>{if("undefined"!=typeof module&&module.exports)module.exports={calculatePIndex:o,extractEventDetails:t,findResultsTable:n};else{var e=n();if(e){({pIndex:e,contributingEvents:r}=o(t(e)));var r,l=document.querySelector("h2");if(l){let t=document.createElement("div"),n=(t.textContent="p-index: "+e,t.style.fontSize="1.5em",t.style.fontWeight="bold",t.style.marginTop="10px",t.style.backgroundColor="#2b223d",t.style.color="#ffa300",t.style.padding="10px",t.style.borderRadius="5px",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.setAttribute("id","p-index-display"),document.createElement("ul"));n.style.listStyleType="none",n.style.padding="0",r.forEach(e=>{var t=document.createElement("li");t.textContent=e,t.style.fontWeight="normal",t.style.fontSize="1em",n.appendChild(t)}),t.appendChild(n),l.parentNode.insertBefore(t,l.nextSibling),setTimeout(()=>{var e=t.getBoundingClientRect(),e=Math.max(e.width,e.height);t.style.width=e+"px",t.style.height=e+"px"},0)}}else console.error("Results table not found")}function t(e){let r=[];e.querySelectorAll("tbody > tr").forEach(e=>{var t=e.querySelector("td:nth-child(1) > a").textContent.trim(),n=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();r.unshift({eventName:t,date:n,eventNumber:e})});e=r.reduce((e,{eventName:t,date:n,eventNumber:r})=>(e[t]||(e[t]=[]),e[t].push({date:n,eventNumber:r}),e),{});return Object.entries(e).sort((e,t)=>t[1].length-e[1].length)}function n(){var e=document.querySelectorAll("#results");return e[e.length-1]}function o(e){e=e.filter(([,e],t)=>e.length>t);let l=e.length;function o(e){return new Date(e.split("/").reverse().join("-"))}e=e.map(([e,t])=>{var n=t[0],r=t[l-1];return{eventName:e,eventCount:t.length,firstDate:n.date,firstEventNumber:n.eventNumber,pIndexDate:r.date,pIndexEventNumber:r.eventNumber,firstDateForSorting:o(n.date),pIndexDateForSorting:o(r.date)}}).sort((e,t)=>e.pIndexDateForSorting-t.pIndexDateForSorting).slice(0,l).map(e=>e.eventName+` (${e.eventCount}): ${e.firstDate} (#${e.firstEventNumber}) - ${e.pIndexDate} (#${e.pIndexEventNumber})`);return{pIndex:l,contributingEvents:e}}})();
```
### parkrun Wilson index display

```javascript
(async()=>{var n;function s(e,t=7){var r;let n=null;for(r of e.querySelectorAll('[id="results"]')){var a=r.querySelector("tr");if(a)if(a.querySelectorAll("th, td").length===t){n=r;break}}return n}function d(e){return Array.from(e.querySelectorAll("tbody > tr")).reverse().map(e=>{var t=e.querySelector("td:nth-child(1)").textContent.trim(),r=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();return{eventName:t,eventDate:r,eventNumber:parseInt(e,10)}})}function i(e){let t=0;var r;for(r of e.map(e=>e.eventNumber).sort((e,t)=>e-t)){if(r>=t+2)break;r===t+1&&t++}return t}function c(t){var r=[];for(let e=0;e<t.length;e++){var n=t.slice(0,e+1),a=e+1,l=`${t[e].eventName} # ${t[e].eventNumber} on `+t[e].eventDate,n=i(n);r.push({parkruns:a,event:l,wilsonIndex:n})}return r}function u(e,a){var t=document.createElement("form");t.style.marginBottom="20px",t.style.textAlign="center";let l=document.createElement("input"),o=(l.style.width="200px",l.type="text",l.placeholder="Enter friend's athlete ID (e.g. A507)",l.style.padding="5px",l.style.marginRight="10px",l.style.borderRadius="3px",l.style.border="1px solid #ffa300",l.style.backgroundColor="#2b223d",l.style.color="#ffa300",document.createElement("button"));o.textContent="Compare",o.style.padding="5px 10px",o.style.backgroundColor="#ffa300",o.style.color="#2b223d",o.style.border="none",o.style.borderRadius="3px",o.style.cursor="pointer",t.appendChild(l),t.appendChild(o),t.addEventListener("submit",async e=>{e.preventDefault();var t,e=l.value.trim().replace(/^[aA]/,"");if(e){o.disabled=!0,o.textContent="Loading...";try{t=e,t=await(await fetch(`https://www.parkrun.com.au/parkrunner/${e}/all/`)).text();var r,n=await s((new DOMParser).parseFromString(t,"text/html"));n&&(r=c(d(n)),a(r,e))}catch(e){console.error("Failed to fetch friend's results:",e),alert("Failed to fetch friend's results. Please check the ID and try again.")}finally{o.disabled=!1,o.textContent="Compare"}}}),e.insertBefore(t,e.firstChild)}function p(e){return e.textContent.trim()}function m(e){var t=["#FFA300","#90EE90","#FF69B4","#4169E1","#FFD700","#9370DB","#20B2AA","#FF6347","#DDA0DD","#00CED1"];return t[e%t.length]}function e(){var e=s(document);if(e){var t=document.querySelector("h2");if(t){var r=p(t);if(r){var e=d(e),n=i(e),e=c(e);if(t){var a=document.createElement("div"),o=(a.style.marginTop="20px",a.style.backgroundColor="#2b223d",a.style.padding="20px",a.style.borderRadius="5px",document.createElement("div"));o.textContent="Wilson index: "+n,o.style.fontSize="1.5em",o.style.color="#ffa300",o.style.fontWeight="bold",o.style.marginBottom="20px",o.style.textAlign="center",a.appendChild(o);n=e,o=a,e=r,(r=document.createElement("canvas")).style.width="100%",r.style.height="300px",o.appendChild(r),o=r.getContext("2d");let l=new Chart(o,{type:"line",data:{labels:n.map(e=>e.parkruns),datasets:[{label:e,data:n.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:m(0),backgroundColor:"#2b223d"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Wilson Index"},suggestedMax:Math.ceil(1.1*Math.max(...n.map(e=>e.wilsonIndex)))},x:{title:{display:!0,text:"parkruns"},min:0,suggestedMax:Math.ceil(1.1*n.length)}},plugins:{title:{display:!0,text:"Wilson Index Progress"},tooltip:{callbacks:{label:function(e){e=e.raw;return["Wilson Index: "+e.y,"Event: "+e.event]}}}}}});u(a,async(e,t)=>{var r,n,a,t=await(await fetch(window.location.origin+`/parkrunner/${t}/all/`)).text(),t=p((new DOMParser).parseFromString(t,"text/html").querySelector("h2"));r=l,e=e,n=t,a=r.data.datasets.length,n={label:t,data:e.map(e=>({x:e.parkruns,y:e.wilsonIndex,event:e.event})),borderColor:m(a),backgroundColor:"#2b223d"},r.data.datasets.push(n),r.update(),e=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.x))),a=Math.max(...r.data.datasets.flatMap(e=>e.data.map(e=>e.y))),r.options.scales.x.suggestedMax=Math.ceil(1.1*e),r.options.scales.y.suggestedMax=Math.ceil(1.1*a),r.update()}),t.parentNode.insertBefore(a,t.nextSibling)}}else console.error("Could not extract athlete info")}else console.error("H2 element not found")}else console.error("Results table not found")}n="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js",await new Promise((e,t)=>{var r=document.createElement("script");r.src=n,r.onload=e,r.onerror=t,document.head.appendChild(r)}),"undefined"!=typeof module&&module.exports?module.exports={calculateWilsonIndex:i,calculateWilsonIndexOverTime:c,extractEventDetails:d,findResultsTable:s}:e()})();
```

### parkrun p-index display

```javascript
(async()=>{if("undefined"!=typeof module&&module.exports)module.exports={calculatePIndex:o,extractEventDetails:t,findResultsTable:n};else{var e=n();if(e){({pIndex:e,contributingEvents:r}=o(t(e)));var r,l=document.querySelector("h2");if(l){let t=document.createElement("div"),n=(t.textContent="p-index: "+e,t.style.fontSize="1.5em",t.style.fontWeight="bold",t.style.marginTop="10px",t.style.backgroundColor="#2b223d",t.style.color="#ffa300",t.style.padding="10px",t.style.borderRadius="5px",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.setAttribute("id","p-index-display"),document.createElement("ul"));n.style.listStyleType="none",n.style.padding="0",r.forEach(e=>{var t=document.createElement("li");t.textContent=e,t.style.fontWeight="normal",t.style.fontSize="1em",n.appendChild(t)}),t.appendChild(n),l.parentNode.insertBefore(t,l.nextSibling),setTimeout(()=>{var e=t.getBoundingClientRect(),e=Math.max(e.width,e.height);t.style.width=e+"px",t.style.height=e+"px"},0)}}else console.error("Results table not found")}function t(e){let r=[];e.querySelectorAll("tbody > tr").forEach(e=>{var t=e.querySelector("td:nth-child(1) > a").textContent.trim(),n=e.querySelector("td:nth-child(2)").textContent.trim(),e=e.querySelector("td:nth-child(3)").textContent.trim();r.unshift({eventName:t,date:n,eventNumber:e})});e=r.reduce((e,{eventName:t,date:n,eventNumber:r})=>(e[t]||(e[t]=[]),e[t].push({date:n,eventNumber:r}),e),{});return Object.entries(e).sort((e,t)=>t[1].length-e[1].length)}function n(){var e=document.querySelectorAll("#results");return e[e.length-1]}function o(e){e=e.filter(([,e],t)=>e.length>t);let l=e.length;function o(e){return new Date(e.split("/").reverse().join("-"))}e=e.map(([e,t])=>{var n=t[0],r=t[l-1];return{eventName:e,eventCount:t.length,firstDate:n.date,firstEventNumber:n.eventNumber,pIndexDate:r.date,pIndexEventNumber:r.eventNumber,firstDateForSorting:o(n.date),pIndexDateForSorting:o(r.date)}}).sort((e,t)=>e.pIndexDateForSorting-t.pIndexDateForSorting).slice(0,l).map(e=>e.eventName+` (${e.eventCount}): ${e.firstDate} (#${e.firstEventNumber}) - ${e.pIndexDate} (#${e.pIndexEventNumber})`);return{pIndex:l,contributingEvents:e}}})();
```
